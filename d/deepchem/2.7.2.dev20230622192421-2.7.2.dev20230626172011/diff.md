# Comparing `tmp/deepchem-2.7.2.dev20230622192421.tar.gz` & `tmp/deepchem-2.7.2.dev20230626172011.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "deepchem-2.7.2.dev20230622192421.tar", last modified: Thu Jun 22 19:24:21 2023, max compression
+gzip compressed data, was "deepchem-2.7.2.dev20230626172011.tar", last modified: Mon Jun 26 17:20:11 2023, max compression
```

## Comparing `deepchem-2.7.2.dev20230622192421.tar` & `deepchem-2.7.2.dev20230626172011.tar`

### file list

```diff
@@ -1,297 +1,297 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.813571 deepchem-2.7.2.dev20230622192421/
--rwxr-xr-x   0 runner    (1001) docker     (123)     1047 2023-06-22 19:24:10.000000 deepchem-2.7.2.dev20230622192421/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-06-22 19:24:21.813571 deepchem-2.7.2.dev20230622192421/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     7124 2023-06-22 19:24:10.000000 deepchem-2.7.2.dev20230622192421/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.789571 deepchem-2.7.2.dev20230622192421/deepchem/
--rw-r--r--   0 runner    (1001) docker     (123)      373 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.789571 deepchem-2.7.2.dev20230622192421/deepchem/data/
--rw-r--r--   0 runner    (1001) docker     (123)      939 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    67894 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/data/data_loader.py
--rw-r--r--   0 runner    (1001) docker     (123)   118009 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/data/datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     7256 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/data/pytorch_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    12606 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/data/supports.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.789571 deepchem-2.7.2.dev20230622192421/deepchem/dock/
--rw-r--r--   0 runner    (1001) docker     (123)      297 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/dock/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4910 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/dock/binding_pocket.py
--rw-r--r--   0 runner    (1001) docker     (123)     6105 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/dock/docking.py
--rw-r--r--   0 runner    (1001) docker     (123)    19576 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/dock/pose_generation.py
--rw-r--r--   0 runner    (1001) docker     (123)     6917 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/dock/pose_scoring.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.789571 deepchem-2.7.2.dev20230622192421/deepchem/feat/
--rw-r--r--   0 runner    (1001) docker     (123)     4457 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7335 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/atomic_conformation.py
--rw-r--r--   0 runner    (1001) docker     (123)    19458 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/base_classes.py
--rw-r--r--   0 runner    (1001) docker     (123)     1904 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/bert_tokenizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     4368 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/binding_pocket_features.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.793571 deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)     1400 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    12898 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py
--rw-r--r--   0 runner    (1001) docker     (123)    10769 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/contact_fingerprints.py
--rw-r--r--   0 runner    (1001) docker     (123)    27676 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/grid_featurizers.py
--rw-r--r--   0 runner    (1001) docker     (123)    20248 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    11465 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/splif_fingerprints.py
--rw-r--r--   0 runner    (1001) docker     (123)    11743 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/dft_data.py
--rw-r--r--   0 runner    (1001) docker     (123)    22111 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/graph_data.py
--rw-r--r--   0 runner    (1001) docker     (123)    38890 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/graph_features.py
--rw-r--r--   0 runner    (1001) docker     (123)     1396 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/huggingface_featurizer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.793571 deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)      489 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7539 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/cgcnn_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3508 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/element_property_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     3232 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/elemnet_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    28058 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/lcnn_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3823 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/sine_coulomb_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)    14808 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/mol_graphs.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.793571 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2884 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/atomic_coordinates.py
--rw-r--r--   0 runner    (1001) docker     (123)     2376 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py
--rw-r--r--   0 runner    (1001) docker     (123)     6488 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/circular_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     9448 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/conformer_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    10925 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/coulomb_matrices.py
--rw-r--r--   0 runner    (1001) docker     (123)    19123 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     7507 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/grover_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2046 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     8401 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/mat_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     7587 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    20381 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     9346 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/molgan_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2835 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/mordred_descriptors.py
--rw-r--r--   0 runner    (1001) docker     (123)     6359 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/one_hot_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/raw_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     9855 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/rdkit_descriptors.py
--rw-r--r--   0 runner    (1001) docker     (123)     7280 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/smiles_to_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     5433 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/smiles_to_seq.py
--rw-r--r--   0 runner    (1001) docker     (123)     4313 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/snap_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3448 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3909 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/reaction_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2326 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/roberta_tokenizer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.793571 deepchem-2.7.2.dev20230622192421/deepchem/feat/sequence_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)      112 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/sequence_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3383 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    11383 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/smiles_tokenizer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.793571 deepchem-2.7.2.dev20230622192421/deepchem/feat/vocabulary_builders/
--rw-r--r--   0 runner    (1001) docker     (123)      278 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/vocabulary_builders/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    17291 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/vocabulary_builders/grover_vocab.py
--rw-r--r--   0 runner    (1001) docker     (123)     2315 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/vocabulary_builders/hf_vocab.py
--rw-r--r--   0 runner    (1001) docker     (123)     1116 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/feat/vocabulary_builders/vocabulary_builder.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.793571 deepchem-2.7.2.dev20230622192421/deepchem/hyper/
--rw-r--r--   0 runner    (1001) docker     (123)      260 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/hyper/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5702 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/hyper/base_classes.py
--rw-r--r--   0 runner    (1001) docker     (123)    17151 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/hyper/gaussian_process.py
--rw-r--r--   0 runner    (1001) docker     (123)    10208 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/hyper/grid_search.py
--rw-r--r--   0 runner    (1001) docker     (123)    12427 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/hyper/random_search.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.797571 deepchem-2.7.2.dev20230622192421/deepchem/metalearning/
--rw-r--r--   0 runner    (1001) docker     (123)      118 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/metalearning/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    10539 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/metalearning/maml.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.797571 deepchem-2.7.2.dev20230622192421/deepchem/metrics/
--rw-r--r--   0 runner    (1001) docker     (123)     2015 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/metrics/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7715 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/metrics/genomic_metrics.py
--rw-r--r--   0 runner    (1001) docker     (123)    31620 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/metrics/metric.py
--rw-r--r--   0 runner    (1001) docker     (123)     6533 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/metrics/score_function.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.797571 deepchem-2.7.2.dev20230622192421/deepchem/models/
--rw-r--r--   0 runner    (1001) docker     (123)     4780 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/IRV.py
--rw-r--r--   0 runner    (1001) docker     (123)     4420 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    13833 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/atomic_conv.py
--rw-r--r--   0 runner    (1001) docker     (123)     4414 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/callbacks.py
--rw-r--r--   0 runner    (1001) docker     (123)    17354 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/chemnet_layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    15504 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/chemnet_models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.797571 deepchem-2.7.2.dev20230622192421/deepchem/models/dft/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/dft/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9553 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/dft/dftxc.py
--rw-r--r--   0 runner    (1001) docker     (123)     9576 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/dft/nnxc.py
--rw-r--r--   0 runner    (1001) docker     (123)     4664 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/dft/scf.py
--rw-r--r--   0 runner    (1001) docker     (123)    23457 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/fcnet.py
--rw-r--r--   0 runner    (1001) docker     (123)    24548 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/gan.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.797571 deepchem-2.7.2.dev20230622192421/deepchem/models/gbdt_models/
--rw-r--r--   0 runner    (1001) docker     (123)       75 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/gbdt_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5921 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/gbdt_models/gbdt_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    57408 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/graph_models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.801571 deepchem-2.7.2.dev20230622192421/deepchem/models/jax_models/
--rw-r--r--   0 runner    (1001) docker     (123)      133 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/jax_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    28179 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/jax_models/jax_model.py
--rw-r--r--   0 runner    (1001) docker     (123)     3408 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/jax_models/layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    17070 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/jax_models/pinns_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    56522 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/keras_model.py
--rw-r--r--   0 runner    (1001) docker     (123)   144759 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/layers.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.801571 deepchem-2.7.2.dev20230622192421/deepchem/models/lightning/
--rw-r--r--   0 runner    (1001) docker     (123)      181 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/lightning/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1742 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/lightning/dc_lightning_dataset_module.py
--rw-r--r--   0 runner    (1001) docker     (123)     2447 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/lightning/dc_lightning_module.py
--rw-r--r--   0 runner    (1001) docker     (123)    61903 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/losses.py
--rw-r--r--   0 runner    (1001) docker     (123)     8256 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/models.py
--rw-r--r--   0 runner    (1001) docker     (123)    14135 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/molgan.py
--rw-r--r--   0 runner    (1001) docker     (123)     5437 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/multitask.py
--rw-r--r--   0 runner    (1001) docker     (123)    10975 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/normalizing_flows.py
--rw-r--r--   0 runner    (1001) docker     (123)    26871 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/optimizers.py
--rw-r--r--   0 runner    (1001) docker     (123)    13095 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/progressive_multitask.py
--rw-r--r--   0 runner    (1001) docker     (123)    17830 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/robust_multitask.py
--rw-r--r--   0 runner    (1001) docker     (123)     4546 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/scscore.py
--rw-r--r--   0 runner    (1001) docker     (123)    25969 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/seqtoseq.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.801571 deepchem-2.7.2.dev20230622192421/deepchem/models/sklearn_models/
--rw-r--r--   0 runner    (1001) docker     (123)       87 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/sklearn_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5679 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/sklearn_models/sklearn_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    10552 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/text_cnn.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.801571 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/
--rw-r--r--   0 runner    (1001) docker     (123)     2208 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3633 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/attention.py
--rw-r--r--   0 runner    (1001) docker     (123)    12226 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/attentivefp.py
--rw-r--r--   0 runner    (1001) docker     (123)    14455 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/cgcnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     5571 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/chemberta.py
--rw-r--r--   0 runner    (1001) docker     (123)     9543 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/cnn.py
--rw-r--r--   0 runner    (1001) docker     (123)    31166 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/dmpnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     7143 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/ferminet.py
--rw-r--r--   0 runner    (1001) docker     (123)    15845 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/gat.py
--rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/gcn.py
--rw-r--r--   0 runner    (1001) docker     (123)    51159 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/gnn.py
--rw-r--r--   0 runner    (1001) docker     (123)    25005 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/gnn3d.py
--rw-r--r--   0 runner    (1001) docker     (123)    37602 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/grover.py
--rw-r--r--   0 runner    (1001) docker     (123)    38432 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/grover_layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    22749 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/hf_models.py
--rw-r--r--   0 runner    (1001) docker     (123)    30077 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/infograph.py
--rw-r--r--   0 runner    (1001) docker     (123)    19215 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/kfac_optimizer.py
--rw-r--r--   0 runner    (1001) docker     (123)   118589 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    18575 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/lcnn.py
--rw-r--r--   0 runner    (1001) docker     (123)    17126 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/mat.py
--rw-r--r--   0 runner    (1001) docker     (123)    11170 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/megnet.py
--rw-r--r--   0 runner    (1001) docker     (123)    18122 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/modular.py
--rw-r--r--   0 runner    (1001) docker     (123)    12074 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/mpnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     4165 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/normalizing_flows_pytorch.py
--rw-r--r--   0 runner    (1001) docker     (123)    12297 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/pagtn.py
--rw-r--r--   0 runner    (1001) docker     (123)    23019 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/pna_gnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     3528 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/readout.py
--rw-r--r--   0 runner    (1001) docker     (123)    52629 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/torch_model.py
--rw-r--r--   0 runner    (1001) docker     (123)     5249 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/models/wandblogger.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.805571 deepchem-2.7.2.dev20230622192421/deepchem/molnet/
--rw-r--r--   0 runner    (1001) docker     (123)     3339 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    11668 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/check_availability.py
--rw-r--r--   0 runner    (1001) docker     (123)     1845 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/defaults.py
--rw-r--r--   0 runner    (1001) docker     (123)    14702 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/dnasim.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.809571 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5375 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/bace_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    14202 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/bace_features.py
--rw-r--r--   0 runner    (1001) docker     (123)     5785 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/bbbc_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3604 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/bbbp_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2623 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/cell_counting_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4188 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/chembl25_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3706 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/chembl_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    10252 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/chembl_tasks.py
--rw-r--r--   0 runner    (1001) docker     (123)     2625 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/clearance_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4245 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/clintox_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3507 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/delaney_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6957 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/factors_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3523 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/freesolv_dataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     3496 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/hiv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3437 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/hopv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2734 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/hppb_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6379 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/kaggle_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)   165414 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/kaggle_features.py
--rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/kinase_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3318 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/lipo_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     9165 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/load_dataset_template.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.809571 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4705 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py
--rw-r--r--   0 runner    (1001) docker     (123)     4474 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_bandgap.py
--rw-r--r--   0 runner    (1001) docker     (123)     4646 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py
--rw-r--r--   0 runner    (1001) docker     (123)     4589 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py
--rw-r--r--   0 runner    (1001) docker     (123)     4516 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_perovskite.py
--rw-r--r--   0 runner    (1001) docker     (123)     8680 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/molnet_loader.py
--rw-r--r--   0 runner    (1001) docker     (123)     3631 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/muv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3290 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/nci_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6927 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/pcba_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     8586 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/pdbbind_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2549 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/ppb_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4800 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/qm7_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     5045 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/qm8_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     5697 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/qm9_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3567 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/sampl_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4640 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/sider_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3140 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/sweetlead_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2687 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/thermosol_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3530 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/tox21_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    18900 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/toxcast_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     7662 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/uspto_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6623 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/uv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2036 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/uv_tasks.py
--rw-r--r--   0 runner    (1001) docker     (123)     6895 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/zinc15_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     5319 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/preset_hyper_parameters.py
--rw-r--r--   0 runner    (1001) docker     (123)    13549 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/run_benchmark.py
--rw-r--r--   0 runner    (1001) docker     (123)     4874 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/run_benchmark_low_data.py
--rw-r--r--   0 runner    (1001) docker     (123)    36564 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/molnet/run_benchmark_models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.809571 deepchem-2.7.2.dev20230622192421/deepchem/rl/
--rw-r--r--   0 runner    (1001) docker     (123)     9312 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/rl/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    23102 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/rl/a2c.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.809571 deepchem-2.7.2.dev20230622192421/deepchem/rl/envs/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/rl/envs/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1773 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/rl/envs/test_tictactoe.py
--rw-r--r--   0 runner    (1001) docker     (123)     3632 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/rl/envs/tictactoe.py
--rw-r--r--   0 runner    (1001) docker     (123)    25262 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/rl/ppo.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.809571 deepchem-2.7.2.dev20230622192421/deepchem/splits/
--rw-r--r--   0 runner    (1001) docker     (123)     1384 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/splits/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    63895 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/splits/splitters.py
--rw-r--r--   0 runner    (1001) docker     (123)     4017 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/splits/task_splitter.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.809571 deepchem-2.7.2.dev20230622192421/deepchem/trans/
--rw-r--r--   0 runner    (1001) docker     (123)     1255 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/trans/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6571 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/trans/duplicate.py
--rw-r--r--   0 runner    (1001) docker     (123)    91191 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/trans/transformers.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.813571 deepchem-2.7.2.dev20230622192421/deepchem/utils/
--rw-r--r--   0 runner    (1001) docker     (123)     6141 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    10069 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/conformers.py
--rw-r--r--   0 runner    (1001) docker     (123)    13294 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/coordinate_box_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    20923 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/data_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     1840 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/debug_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3041 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/dftutils.py
--rw-r--r--   0 runner    (1001) docker     (123)    10476 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/docking_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    13528 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/electron_sampler.py
--rw-r--r--   0 runner    (1001) docker     (123)    19454 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/evaluate.py
--rw-r--r--   0 runner    (1001) docker     (123)     6134 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/fake_data_generator.py
--rw-r--r--   0 runner    (1001) docker     (123)    13312 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/fragment_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3903 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/genomics_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     8259 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/geometry_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     6033 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/graph_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     6554 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/grover.py
--rw-r--r--   0 runner    (1001) docker     (123)     3644 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/hash_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    19262 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/molecule_feature_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    17713 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/noncovalent_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    11749 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/pdbqt_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     4341 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/pytorch_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    65672 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/rdkit_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      552 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/save.py
--rw-r--r--   0 runner    (1001) docker     (123)     6815 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/sequence_utils.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.813571 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6598 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_coordinate_box_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      788 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_data_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      896 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_dftutils.py
--rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_docking_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3309 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_electron_sampler.py
--rw-r--r--   0 runner    (1001) docker     (123)    12977 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_evaluate.py
--rw-r--r--   0 runner    (1001) docker     (123)     2481 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_fake_data_generator.py
--rw-r--r--   0 runner    (1001) docker     (123)     2610 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_fragment_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     4684 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_generator_evaluator.py
--rw-r--r--   0 runner    (1001) docker     (123)     1956 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_genomics_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3296 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_geometry_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      866 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_graph_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     1523 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_grover.py
--rw-r--r--   0 runner    (1001) docker     (123)     1476 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_hash_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     9115 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_molecule_feature_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     6251 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_noncovalent_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3922 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_pdbqt_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     1577 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_pytorch_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     9005 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_rdkit_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_sequence_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      386 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_updated_scipy.py
--rw-r--r--   0 runner    (1001) docker     (123)     2859 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_voxel_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      919 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/typing.py
--rw-r--r--   0 runner    (1001) docker     (123)     1113 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/vina_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     7797 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/deepchem/utils/voxel_utils.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-22 19:24:21.789571 deepchem-2.7.2.dev20230622192421/deepchem.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-06-22 19:24:21.000000 deepchem-2.7.2.dev20230622192421/deepchem.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    10711 2023-06-22 19:24:21.000000 deepchem-2.7.2.dev20230622192421/deepchem.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-22 19:24:21.000000 deepchem-2.7.2.dev20230622192421/deepchem.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)      249 2023-06-22 19:24:21.000000 deepchem-2.7.2.dev20230622192421/deepchem.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        9 2023-06-22 19:24:21.000000 deepchem-2.7.2.dev20230622192421/deepchem.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (123)      701 2023-06-22 19:24:21.813571 deepchem-2.7.2.dev20230622192421/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     2670 2023-06-22 19:24:11.000000 deepchem-2.7.2.dev20230622192421/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.565817 deepchem-2.7.2.dev20230626172011/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1047 2023-06-26 17:20:00.000000 deepchem-2.7.2.dev20230626172011/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-06-26 17:20:11.565817 deepchem-2.7.2.dev20230626172011/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     7124 2023-06-26 17:20:00.000000 deepchem-2.7.2.dev20230626172011/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.541817 deepchem-2.7.2.dev20230626172011/deepchem/
+-rw-r--r--   0 runner    (1001) docker     (123)      373 2023-06-26 17:20:00.000000 deepchem-2.7.2.dev20230626172011/deepchem/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.541817 deepchem-2.7.2.dev20230626172011/deepchem/data/
+-rw-r--r--   0 runner    (1001) docker     (123)      939 2023-06-26 17:20:00.000000 deepchem-2.7.2.dev20230626172011/deepchem/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    67894 2023-06-26 17:20:00.000000 deepchem-2.7.2.dev20230626172011/deepchem/data/data_loader.py
+-rw-r--r--   0 runner    (1001) docker     (123)   118009 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/data/datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7256 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/data/pytorch_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12606 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/data/supports.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.541817 deepchem-2.7.2.dev20230626172011/deepchem/dock/
+-rw-r--r--   0 runner    (1001) docker     (123)      297 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/dock/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4910 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/dock/binding_pocket.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6105 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/dock/docking.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19576 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/dock/pose_generation.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6917 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/dock/pose_scoring.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.541817 deepchem-2.7.2.dev20230626172011/deepchem/feat/
+-rw-r--r--   0 runner    (1001) docker     (123)     4457 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7335 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/atomic_conformation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19458 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/base_classes.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1904 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/bert_tokenizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4368 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/binding_pocket_features.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.541817 deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)     1400 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12898 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10769 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/contact_fingerprints.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27676 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/grid_featurizers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20248 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11465 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/splif_fingerprints.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11743 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/dft_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22111 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/graph_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    38890 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/graph_features.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1396 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/huggingface_featurizer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.541817 deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)      489 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7539 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/cgcnn_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3508 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/element_property_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3232 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/elemnet_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28058 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/lcnn_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3823 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/sine_coulomb_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14808 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/mol_graphs.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.545817 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2884 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/atomic_coordinates.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2376 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6488 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/circular_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9448 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/conformer_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10925 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/coulomb_matrices.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19123 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7507 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/grover_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2046 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8401 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/mat_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7587 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20381 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9346 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/molgan_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2835 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/mordred_descriptors.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6359 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/one_hot_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/raw_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9855 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/rdkit_descriptors.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7280 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/smiles_to_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5433 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/smiles_to_seq.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4313 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/snap_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3448 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3909 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/reaction_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2326 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/roberta_tokenizer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.545817 deepchem-2.7.2.dev20230626172011/deepchem/feat/sequence_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)      112 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/sequence_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3383 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11383 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/smiles_tokenizer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.545817 deepchem-2.7.2.dev20230626172011/deepchem/feat/vocabulary_builders/
+-rw-r--r--   0 runner    (1001) docker     (123)      278 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/vocabulary_builders/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17291 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/vocabulary_builders/grover_vocab.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2315 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/vocabulary_builders/hf_vocab.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1116 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/feat/vocabulary_builders/vocabulary_builder.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.545817 deepchem-2.7.2.dev20230626172011/deepchem/hyper/
+-rw-r--r--   0 runner    (1001) docker     (123)      260 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/hyper/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5702 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/hyper/base_classes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17151 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/hyper/gaussian_process.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10208 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/hyper/grid_search.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12427 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/hyper/random_search.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.545817 deepchem-2.7.2.dev20230626172011/deepchem/metalearning/
+-rw-r--r--   0 runner    (1001) docker     (123)      118 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/metalearning/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10539 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/metalearning/maml.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.545817 deepchem-2.7.2.dev20230626172011/deepchem/metrics/
+-rw-r--r--   0 runner    (1001) docker     (123)     2015 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/metrics/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7715 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/metrics/genomic_metrics.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31620 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/metrics/metric.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6533 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/metrics/score_function.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.549817 deepchem-2.7.2.dev20230626172011/deepchem/models/
+-rw-r--r--   0 runner    (1001) docker     (123)     4780 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/IRV.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4420 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13833 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/atomic_conv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4414 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/callbacks.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17354 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/chemnet_layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15504 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/chemnet_models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.549817 deepchem-2.7.2.dev20230626172011/deepchem/models/dft/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/dft/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9553 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/dft/dftxc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9576 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/dft/nnxc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4664 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/dft/scf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23457 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/fcnet.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24548 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/gan.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.549817 deepchem-2.7.2.dev20230626172011/deepchem/models/gbdt_models/
+-rw-r--r--   0 runner    (1001) docker     (123)       75 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/gbdt_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5921 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/gbdt_models/gbdt_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    57408 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/graph_models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.549817 deepchem-2.7.2.dev20230626172011/deepchem/models/jax_models/
+-rw-r--r--   0 runner    (1001) docker     (123)      133 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/jax_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28179 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/jax_models/jax_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3408 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/jax_models/layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17070 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/jax_models/pinns_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    56522 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/keras_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)   144759 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/layers.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.549817 deepchem-2.7.2.dev20230626172011/deepchem/models/lightning/
+-rw-r--r--   0 runner    (1001) docker     (123)      181 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/lightning/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1742 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/lightning/dc_lightning_dataset_module.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2447 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/lightning/dc_lightning_module.py
+-rw-r--r--   0 runner    (1001) docker     (123)    61903 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/losses.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8256 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14135 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/molgan.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5437 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/multitask.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10975 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/normalizing_flows.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26871 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/optimizers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13095 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/progressive_multitask.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17830 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/robust_multitask.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4546 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/scscore.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25969 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/seqtoseq.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.549817 deepchem-2.7.2.dev20230626172011/deepchem/models/sklearn_models/
+-rw-r--r--   0 runner    (1001) docker     (123)       87 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/sklearn_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5679 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/sklearn_models/sklearn_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10552 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/text_cnn.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.553817 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/
+-rw-r--r--   0 runner    (1001) docker     (123)     2221 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3633 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/attention.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12226 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/attentivefp.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14455 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/cgcnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5571 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/chemberta.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9543 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/cnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31166 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/dmpnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7143 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/ferminet.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15845 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/gat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/gcn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    51159 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/gnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25005 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/gnn3d.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37602 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/grover.py
+-rw-r--r--   0 runner    (1001) docker     (123)    38432 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/grover_layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22749 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/hf_models.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30077 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/infograph.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19215 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/kfac_optimizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)   121865 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18575 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/lcnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17126 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/mat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11170 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/megnet.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18122 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/modular.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12074 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/mpnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4165 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/normalizing_flows_pytorch.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12297 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/pagtn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23019 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/pna_gnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3528 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/readout.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52629 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/torch_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5249 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/models/wandblogger.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.553817 deepchem-2.7.2.dev20230626172011/deepchem/molnet/
+-rw-r--r--   0 runner    (1001) docker     (123)     3339 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11668 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/check_availability.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1845 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/defaults.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14702 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/dnasim.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.557817 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5375 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/bace_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14202 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/bace_features.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5785 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/bbbc_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3604 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/bbbp_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2623 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/cell_counting_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4188 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/chembl25_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3706 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/chembl_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10252 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/chembl_tasks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2625 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/clearance_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4245 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/clintox_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3507 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/delaney_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6957 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/factors_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3523 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/freesolv_dataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3496 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/hiv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3437 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/hopv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2734 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/hppb_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6379 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/kaggle_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)   165414 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/kaggle_features.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/kinase_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3318 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/lipo_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9165 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/load_dataset_template.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.557817 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4705 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4474 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_bandgap.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4646 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4589 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4516 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_perovskite.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8680 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/molnet_loader.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3631 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/muv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3290 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/nci_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6927 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/pcba_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8586 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/pdbbind_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2549 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/ppb_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4800 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/qm7_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5045 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/qm8_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5697 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/qm9_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3567 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/sampl_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4640 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/sider_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3140 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/sweetlead_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2687 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/thermosol_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3530 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/tox21_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18900 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/toxcast_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7662 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/uspto_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6623 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/uv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2036 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/uv_tasks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6895 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/zinc15_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5319 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/preset_hyper_parameters.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13549 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/run_benchmark.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4874 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/run_benchmark_low_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36564 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/molnet/run_benchmark_models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.557817 deepchem-2.7.2.dev20230626172011/deepchem/rl/
+-rw-r--r--   0 runner    (1001) docker     (123)     9312 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/rl/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23102 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/rl/a2c.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.557817 deepchem-2.7.2.dev20230626172011/deepchem/rl/envs/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/rl/envs/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1773 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/rl/envs/test_tictactoe.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3632 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/rl/envs/tictactoe.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25262 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/rl/ppo.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.557817 deepchem-2.7.2.dev20230626172011/deepchem/splits/
+-rw-r--r--   0 runner    (1001) docker     (123)     1384 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/splits/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    63895 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/splits/splitters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4017 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/splits/task_splitter.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.561817 deepchem-2.7.2.dev20230626172011/deepchem/trans/
+-rw-r--r--   0 runner    (1001) docker     (123)     1255 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/trans/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6571 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/trans/duplicate.py
+-rw-r--r--   0 runner    (1001) docker     (123)    91191 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/trans/transformers.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.561817 deepchem-2.7.2.dev20230626172011/deepchem/utils/
+-rw-r--r--   0 runner    (1001) docker     (123)     6141 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10069 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/conformers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13294 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/coordinate_box_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20923 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/data_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1840 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/debug_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3041 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/dftutils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10476 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/docking_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13528 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/electron_sampler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19454 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/evaluate.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6134 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/fake_data_generator.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13312 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/fragment_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3903 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/genomics_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8259 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/geometry_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6033 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/graph_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6554 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/grover.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3644 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/hash_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19262 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/molecule_feature_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17713 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/noncovalent_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11749 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/pdbqt_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4341 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/pytorch_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65672 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/rdkit_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      552 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/save.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6815 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/sequence_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.565817 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6598 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_coordinate_box_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      788 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_data_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      896 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_dftutils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_docking_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3309 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_electron_sampler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12977 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_evaluate.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2481 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_fake_data_generator.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2610 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_fragment_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4684 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_generator_evaluator.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1956 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_genomics_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3296 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_geometry_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      866 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_graph_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1523 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_grover.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1476 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_hash_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9115 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_molecule_feature_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6251 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_noncovalent_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3922 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_pdbqt_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1577 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_pytorch_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9005 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_rdkit_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_sequence_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      386 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_updated_scipy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2859 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_voxel_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      919 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/typing.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1113 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/vina_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7797 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/deepchem/utils/voxel_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-26 17:20:11.541817 deepchem-2.7.2.dev20230626172011/deepchem.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-06-26 17:20:11.000000 deepchem-2.7.2.dev20230626172011/deepchem.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    10711 2023-06-26 17:20:11.000000 deepchem-2.7.2.dev20230626172011/deepchem.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-26 17:20:11.000000 deepchem-2.7.2.dev20230626172011/deepchem.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      249 2023-06-26 17:20:11.000000 deepchem-2.7.2.dev20230626172011/deepchem.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        9 2023-06-26 17:20:11.000000 deepchem-2.7.2.dev20230626172011/deepchem.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      701 2023-06-26 17:20:11.565817 deepchem-2.7.2.dev20230626172011/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     2670 2023-06-26 17:20:01.000000 deepchem-2.7.2.dev20230626172011/setup.py
```

### Comparing `deepchem-2.7.2.dev20230622192421/LICENSE` & `deepchem-2.7.2.dev20230626172011/LICENSE`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/PKG-INFO` & `deepchem-2.7.2.dev20230626172011/PKG-INFO`

 * *Files 8% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: deepchem
-Version: 2.7.2.dev20230622192421
+Version: 2.7.2.dev20230626172011
 Summary: Deep learning models for drug discovery,         quantum chemistry, and the life sciences.
 Home-page: https://github.com/deepchem/deepchem
 Maintainer: DeepChem contributors
 License: MIT
 Project-URL: Documentation, https://deepchem.readthedocs.io/en/latest/
 Project-URL: Source, https://github.com/deepchem/deepchem
 Keywords: deepchem,chemistry,biology,materials-science,life-science,drug-discovery
```

### Comparing `deepchem-2.7.2.dev20230622192421/README.md` & `deepchem-2.7.2.dev20230626172011/README.md`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/data/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/data/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/data/data_loader.py` & `deepchem-2.7.2.dev20230626172011/deepchem/data/data_loader.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/data/datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/data/datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/data/pytorch_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/data/pytorch_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/data/supports.py` & `deepchem-2.7.2.dev20230626172011/deepchem/data/supports.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/dock/binding_pocket.py` & `deepchem-2.7.2.dev20230626172011/deepchem/dock/binding_pocket.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/dock/docking.py` & `deepchem-2.7.2.dev20230626172011/deepchem/dock/docking.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/dock/pose_generation.py` & `deepchem-2.7.2.dev20230626172011/deepchem/dock/pose_generation.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/dock/pose_scoring.py` & `deepchem-2.7.2.dev20230626172011/deepchem/dock/pose_scoring.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/atomic_conformation.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/atomic_conformation.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/base_classes.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/base_classes.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/bert_tokenizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/bert_tokenizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/binding_pocket_features.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/binding_pocket_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/contact_fingerprints.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/contact_fingerprints.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/grid_featurizers.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/grid_featurizers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/complex_featurizers/splif_fingerprints.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/complex_featurizers/splif_fingerprints.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/dft_data.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/dft_data.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/graph_data.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/graph_data.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/graph_features.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/graph_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/huggingface_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/huggingface_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/cgcnn_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/cgcnn_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/element_property_fingerprint.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/element_property_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/elemnet_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/elemnet_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/lcnn_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/lcnn_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/material_featurizers/sine_coulomb_matrix.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/material_featurizers/sine_coulomb_matrix.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/mol_graphs.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/mol_graphs.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/atomic_coordinates.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/atomic_coordinates.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/circular_fingerprint.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/circular_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/conformer_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/conformer_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/coulomb_matrices.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/coulomb_matrices.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/grover_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/grover_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/mat_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/mat_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/molgan_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/molgan_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/mordred_descriptors.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/mordred_descriptors.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/one_hot_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/one_hot_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/raw_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/raw_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/rdkit_descriptors.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/rdkit_descriptors.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/smiles_to_image.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/smiles_to_image.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/smiles_to_seq.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/smiles_to_seq.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/snap_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/snap_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/reaction_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/reaction_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/roberta_tokenizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/roberta_tokenizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/smiles_tokenizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/smiles_tokenizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/vocabulary_builders/grover_vocab.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/vocabulary_builders/grover_vocab.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/vocabulary_builders/hf_vocab.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/vocabulary_builders/hf_vocab.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/feat/vocabulary_builders/vocabulary_builder.py` & `deepchem-2.7.2.dev20230626172011/deepchem/feat/vocabulary_builders/vocabulary_builder.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/hyper/base_classes.py` & `deepchem-2.7.2.dev20230626172011/deepchem/hyper/base_classes.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/hyper/gaussian_process.py` & `deepchem-2.7.2.dev20230626172011/deepchem/hyper/gaussian_process.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/hyper/grid_search.py` & `deepchem-2.7.2.dev20230626172011/deepchem/hyper/grid_search.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/hyper/random_search.py` & `deepchem-2.7.2.dev20230626172011/deepchem/hyper/random_search.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/metalearning/maml.py` & `deepchem-2.7.2.dev20230626172011/deepchem/metalearning/maml.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/metrics/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/metrics/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/metrics/genomic_metrics.py` & `deepchem-2.7.2.dev20230626172011/deepchem/metrics/genomic_metrics.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/metrics/metric.py` & `deepchem-2.7.2.dev20230626172011/deepchem/metrics/metric.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/metrics/score_function.py` & `deepchem-2.7.2.dev20230626172011/deepchem/metrics/score_function.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/IRV.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/IRV.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/atomic_conv.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/atomic_conv.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/callbacks.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/callbacks.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/chemnet_layers.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/chemnet_layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/chemnet_models.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/chemnet_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/dft/dftxc.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/dft/dftxc.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/dft/nnxc.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/dft/nnxc.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/dft/scf.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/dft/scf.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/fcnet.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/fcnet.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/gan.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/gan.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/gbdt_models/gbdt_model.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/gbdt_models/gbdt_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/graph_models.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/graph_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/jax_models/jax_model.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/jax_models/jax_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/jax_models/layers.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/jax_models/layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/jax_models/pinns_model.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/jax_models/pinns_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/keras_model.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/keras_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/layers.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/lightning/dc_lightning_dataset_module.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/lightning/dc_lightning_dataset_module.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/lightning/dc_lightning_module.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/lightning/dc_lightning_module.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/losses.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/losses.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/models.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/molgan.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/molgan.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/multitask.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/multitask.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/normalizing_flows.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/normalizing_flows.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/optimizers.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/optimizers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/progressive_multitask.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/progressive_multitask.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/robust_multitask.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/robust_multitask.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/scscore.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/scscore.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/seqtoseq.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/seqtoseq.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/sklearn_models/sklearn_model.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/sklearn_models/sklearn_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/text_cnn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/text_cnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -12,15 +12,15 @@
 from deepchem.models.torch_models.infograph import InfoGraphStar, InfoGraphStarModel, InfoGraphEncoder, GINEncoder, InfoGraph, InfoGraphModel, InfoGraphEncoder
 from deepchem.models.torch_models.mpnn import MPNN, MPNNModel
 from deepchem.models.torch_models.lcnn import LCNN, LCNNModel
 from deepchem.models.torch_models.pagtn import Pagtn, PagtnModel
 from deepchem.models.torch_models.mat import MAT, MATModel
 from deepchem.models.torch_models.megnet import MEGNetModel
 from deepchem.models.torch_models.normalizing_flows_pytorch import NormalizingFlow
-from deepchem.models.torch_models.layers import MultilayerPerceptron, CNNModule, CombineMeanStd, WeightedLinearCombo, AtomicConvolution, NeighborList, SetGather
+from deepchem.models.torch_models.layers import MultilayerPerceptron, CNNModule, CombineMeanStd, WeightedLinearCombo, AtomicConvolution, NeighborList, SetGather, EdgeNetwork
 from deepchem.models.torch_models.cnn import CNN
 from deepchem.models.torch_models.attention import ScaledDotProductAttention, SelfAttention
 from deepchem.models.torch_models.grover import GroverModel, GroverPretrain, GroverFinetune
 from deepchem.models.torch_models.readout import GroverReadout
 try:
     from deepchem.models.torch_models.dmpnn import DMPNN, DMPNNModel
     from deepchem.models.torch_models.gnn import GNN, GNNHead, GNNModular
```

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/attention.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/attention.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/attentivefp.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/attentivefp.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/cgcnn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/cgcnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/chemberta.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/chemberta.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/cnn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/cnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/dmpnn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/dmpnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/ferminet.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/ferminet.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/gat.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/gat.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/gcn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/gcn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/gnn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/gnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/gnn3d.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/gnn3d.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/grover.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/grover.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/grover_layers.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/grover_layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/hf_models.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/hf_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/infograph.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/infograph.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/kfac_optimizer.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/kfac_optimizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/layers.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/layers.py`

 * *Files 1% similar despite different names*

```diff
@@ -30,7383 +30,7588 @@
 000001d0: 0a0a 6672 6f6d 2064 6565 7063 6865 6d2e  ..from deepchem.
 000001e0: 7574 696c 732e 7479 7069 6e67 2069 6d70  utils.typing imp
 000001f0: 6f72 7420 4f6e 654f 724d 616e 792c 2041  ort OneOrMany, A
 00000200: 6374 6976 6174 696f 6e46 6e2c 2041 7272  ctivationFn, Arr
 00000210: 6179 4c69 6b65 0a66 726f 6d20 6465 6570  ayLike.from deep
 00000220: 6368 656d 2e75 7469 6c73 2e70 7974 6f72  chem.utils.pytor
 00000230: 6368 5f75 7469 6c73 2069 6d70 6f72 7420  ch_utils import 
-00000240: 6765 745f 6163 7469 7661 7469 6f6e 0a66  get_activation.f
-00000250: 726f 6d20 746f 7263 682e 6e6e 2069 6d70  rom torch.nn imp
-00000260: 6f72 7420 696e 6974 2061 7320 696e 6974  ort init as init
-00000270: 6961 6c69 7a65 7273 0a0a 0a63 6c61 7373  ializers...class
-00000280: 204d 756c 7469 6c61 7965 7250 6572 6365   MultilayerPerce
-00000290: 7074 726f 6e28 6e6e 2e4d 6f64 756c 6529  ptron(nn.Module)
-000002a0: 3a0a 2020 2020 2222 2241 2073 696d 706c  :.    """A simpl
-000002b0: 6520 6675 6c6c 7920 636f 6e6e 6563 7465  e fully connecte
-000002c0: 6420 6665 6564 2d66 6f72 7761 7264 206e  d feed-forward n
-000002d0: 6574 776f 726b 2c20 6f74 6865 7277 6973  etwork, otherwis
-000002e0: 6520 6b6e 6f77 6e20 6173 2061 206d 756c  e known as a mul
-000002f0: 7469 6c61 7965 7220 7065 7263 6570 7472  tilayer perceptr
-00000300: 6f6e 2028 4d4c 5029 2e0a 0a20 2020 2045  on (MLP)...    E
-00000310: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
-00000320: 2d2d 2d2d 0a20 2020 203e 3e3e 206d 6f64  ----.    >>> mod
-00000330: 656c 203d 204d 756c 7469 6c61 7965 7250  el = MultilayerP
-00000340: 6572 6365 7074 726f 6e28 645f 696e 7075  erceptron(d_inpu
-00000350: 743d 3130 2c20 645f 6869 6464 656e 3d28  t=10, d_hidden=(
-00000360: 322c 3329 2c20 645f 6f75 7470 7574 3d32  2,3), d_output=2
-00000370: 2c20 6472 6f70 6f75 743d 302e 302c 2061  , dropout=0.0, a
-00000380: 6374 6976 6174 696f 6e5f 666e 3d27 7265  ctivation_fn='re
-00000390: 6c75 2729 0a20 2020 203e 3e3e 2078 203d  lu').    >>> x =
-000003a0: 2074 6f72 6368 2e6f 6e65 7328 322c 2031   torch.ones(2, 1
-000003b0: 3029 0a20 2020 203e 3e3e 206f 7574 203d  0).    >>> out =
-000003c0: 206d 6f64 656c 2878 290a 2020 2020 3e3e   model(x).    >>
-000003d0: 3e20 7072 696e 7428 6f75 742e 7368 6170  > print(out.shap
-000003e0: 6529 0a20 2020 2074 6f72 6368 2e53 697a  e).    torch.Siz
-000003f0: 6528 5b32 2c20 325d 290a 2020 2020 2222  e([2, 2]).    ""
-00000400: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-00000410: 745f 5f28 7365 6c66 2c0a 2020 2020 2020  t__(self,.      
-00000420: 2020 2020 2020 2020 2020 2064 5f69 6e70             d_inp
-00000430: 7574 3a20 696e 742c 0a20 2020 2020 2020  ut: int,.       
-00000440: 2020 2020 2020 2020 2020 645f 6f75 7470            d_outp
-00000450: 7574 3a20 696e 742c 0a20 2020 2020 2020  ut: int,.       
-00000460: 2020 2020 2020 2020 2020 645f 6869 6464            d_hidd
-00000470: 656e 3a20 4f70 7469 6f6e 616c 5b74 7570  en: Optional[tup
-00000480: 6c65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  le] = None,.    
-00000490: 2020 2020 2020 2020 2020 2020 2064 726f               dro
-000004a0: 706f 7574 3a20 666c 6f61 7420 3d20 302e  pout: float = 0.
-000004b0: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-000004c0: 2020 2020 6261 7463 685f 6e6f 726d 3a20      batch_norm: 
-000004d0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-000004e0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-000004f0: 6174 6368 5f6e 6f72 6d5f 6d6f 6d65 6e74  atch_norm_moment
-00000500: 756d 3a20 666c 6f61 7420 3d20 302e 312c  um: float = 0.1,
-00000510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000520: 2020 6163 7469 7661 7469 6f6e 5f66 6e3a    activation_fn:
-00000530: 2055 6e69 6f6e 5b43 616c 6c61 626c 652c   Union[Callable,
-00000540: 2073 7472 5d20 3d20 2772 656c 7527 2c0a   str] = 'relu',.
-00000550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000560: 2073 6b69 705f 636f 6e6e 6563 7469 6f6e   skip_connection
-00000570: 3a20 626f 6f6c 203d 2046 616c 7365 293a  : bool = False):
-00000580: 0a20 2020 2020 2020 2022 2222 496e 6974  .        """Init
-00000590: 6961 6c69 7a65 2074 6865 206d 6f64 656c  ialize the model
-000005a0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-000005b0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-000005c0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-000005d0: 2064 5f69 6e70 7574 3a20 696e 740a 2020   d_input: int.  
-000005e0: 2020 2020 2020 2020 2020 7468 6520 6469            the di
-000005f0: 6d65 6e73 696f 6e20 6f66 2074 6865 2069  mension of the i
-00000600: 6e70 7574 206c 6179 6572 0a20 2020 2020  nput layer.     
-00000610: 2020 2064 5f6f 7574 7075 743a 2069 6e74     d_output: int
-00000620: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00000630: 2064 696d 656e 7369 6f6e 206f 6620 7468   dimension of th
-00000640: 6520 6f75 7470 7574 206c 6179 6572 0a20  e output layer. 
-00000650: 2020 2020 2020 2064 5f68 6964 6465 6e3a         d_hidden:
-00000660: 2074 7570 6c65 0a20 2020 2020 2020 2020   tuple.         
-00000670: 2020 2074 6865 2064 696d 656e 7369 6f6e     the dimension
-00000680: 7320 6f66 2074 6865 2068 6964 6465 6e20  s of the hidden 
-00000690: 6c61 7965 7273 0a20 2020 2020 2020 2064  layers.        d
-000006a0: 726f 706f 7574 3a20 666c 6f61 740a 2020  ropout: float.  
-000006b0: 2020 2020 2020 2020 2020 7468 6520 6472            the dr
-000006c0: 6f70 6f75 7420 7072 6f62 6162 696c 6974  opout probabilit
-000006d0: 790a 2020 2020 2020 2020 6261 7463 685f  y.        batch_
-000006e0: 6e6f 726d 3a20 626f 6f6c 0a20 2020 2020  norm: bool.     
-000006f0: 2020 2020 2020 2077 6865 7468 6572 2074         whether t
-00000700: 6f20 7573 6520 6261 7463 6820 6e6f 726d  o use batch norm
-00000710: 616c 697a 6174 696f 6e0a 2020 2020 2020  alization.      
-00000720: 2020 6261 7463 685f 6e6f 726d 5f6d 6f6d    batch_norm_mom
-00000730: 656e 7475 6d3a 2066 6c6f 6174 0a20 2020  entum: float.   
-00000740: 2020 2020 2020 2020 2074 6865 206d 6f6d           the mom
-00000750: 656e 7475 6d20 666f 7220 6261 7463 6820  entum for batch 
-00000760: 6e6f 726d 616c 697a 6174 696f 6e0a 2020  normalization.  
-00000770: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
-00000780: 5f66 6e3a 2073 7472 0a20 2020 2020 2020  _fn: str.       
-00000790: 2020 2020 2074 6865 2061 6374 6976 6174       the activat
-000007a0: 696f 6e20 6675 6e63 7469 6f6e 2074 6f20  ion function to 
-000007b0: 7573 6520 696e 2074 6865 2068 6964 6465  use in the hidde
-000007c0: 6e20 6c61 7965 7273 0a20 2020 2020 2020  n layers.       
-000007d0: 2073 6b69 705f 636f 6e6e 6563 7469 6f6e   skip_connection
-000007e0: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
-000007f0: 2020 2077 6865 7468 6572 2074 6f20 6164     whether to ad
-00000800: 6420 6120 736b 6970 2063 6f6e 6e65 6374  d a skip connect
-00000810: 696f 6e20 6672 6f6d 2074 6865 2069 6e70  ion from the inp
-00000820: 7574 2074 6f20 7468 6520 6f75 7470 7574  ut to the output
-00000830: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00000840: 2020 2020 2073 7570 6572 284d 756c 7469       super(Multi
-00000850: 6c61 7965 7250 6572 6365 7074 726f 6e2c  layerPerceptron,
-00000860: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-00000870: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
-00000880: 5f69 6e70 7574 203d 2064 5f69 6e70 7574  _input = d_input
-00000890: 0a20 2020 2020 2020 2073 656c 662e 645f  .        self.d_
-000008a0: 6869 6464 656e 203d 2064 5f68 6964 6465  hidden = d_hidde
-000008b0: 6e0a 2020 2020 2020 2020 7365 6c66 2e64  n.        self.d
-000008c0: 5f6f 7574 7075 7420 3d20 645f 6f75 7470  _output = d_outp
-000008d0: 7574 0a20 2020 2020 2020 2073 656c 662e  ut.        self.
-000008e0: 6472 6f70 6f75 7420 3d20 6e6e 2e44 726f  dropout = nn.Dro
-000008f0: 706f 7574 2864 726f 706f 7574 290a 2020  pout(dropout).  
-00000900: 2020 2020 2020 7365 6c66 2e62 6174 6368        self.batch
-00000910: 5f6e 6f72 6d20 3d20 6261 7463 685f 6e6f  _norm = batch_no
-00000920: 726d 0a20 2020 2020 2020 2073 656c 662e  rm.        self.
-00000930: 6261 7463 685f 6e6f 726d 5f6d 6f6d 656e  batch_norm_momen
-00000940: 7475 6d20 3d20 6261 7463 685f 6e6f 726d  tum = batch_norm
-00000950: 5f6d 6f6d 656e 7475 6d0a 2020 2020 2020  _momentum.      
-00000960: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
-00000970: 6e5f 666e 203d 2067 6574 5f61 6374 6976  n_fn = get_activ
-00000980: 6174 696f 6e28 6163 7469 7661 7469 6f6e  ation(activation
-00000990: 5f66 6e29 0a20 2020 2020 2020 2073 656c  _fn).        sel
-000009a0: 662e 6d6f 6465 6c20 3d20 6e6e 2e53 6571  f.model = nn.Seq
-000009b0: 7565 6e74 6961 6c28 2a73 656c 662e 6275  uential(*self.bu
-000009c0: 696c 645f 6c61 7965 7273 2829 290a 2020  ild_layers()).  
-000009d0: 2020 2020 2020 7365 6c66 2e73 6b69 7020        self.skip 
-000009e0: 3d20 6e6e 2e4c 696e 6561 7228 645f 696e  = nn.Linear(d_in
-000009f0: 7075 742c 2064 5f6f 7574 7075 7429 2069  put, d_output) i
-00000a00: 6620 736b 6970 5f63 6f6e 6e65 6374 696f  f skip_connectio
-00000a10: 6e20 656c 7365 204e 6f6e 650a 0a20 2020  n else None..   
-00000a20: 2064 6566 2062 7569 6c64 5f6c 6179 6572   def build_layer
-00000a30: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-00000a40: 2022 2222 0a20 2020 2020 2020 2042 7569   """.        Bui
-00000a50: 6c64 2074 6865 206c 6179 6572 7320 6f66  ld the layers of
-00000a60: 2074 6865 206d 6f64 656c 2c20 6974 6572   the model, iter
-00000a70: 6174 696e 6720 7468 726f 7567 6820 7468  ating through th
-00000a80: 6520 6869 6464 656e 2064 696d 656e 7369  e hidden dimensi
-00000a90: 6f6e 7320 746f 2070 726f 6475 6365 2061  ons to produce a
-00000aa0: 206c 6973 7420 6f66 206c 6179 6572 732e   list of layers.
-00000ab0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00000ac0: 2020 2020 2020 6c61 7965 725f 6c69 7374        layer_list
-00000ad0: 203d 205b 5d0a 2020 2020 2020 2020 6c61   = [].        la
-00000ae0: 7965 725f 6469 6d20 3d20 7365 6c66 2e64  yer_dim = self.d
-00000af0: 5f69 6e70 7574 0a20 2020 2020 2020 2069  _input.        i
-00000b00: 6620 7365 6c66 2e64 5f68 6964 6465 6e20  f self.d_hidden 
-00000b10: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00000b20: 2020 2020 2020 2020 2066 6f72 2064 2069           for d i
-00000b30: 6e20 7365 6c66 2e64 5f68 6964 6465 6e3a  n self.d_hidden:
-00000b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000b50: 206c 6179 6572 5f6c 6973 742e 6170 7065   layer_list.appe
-00000b60: 6e64 286e 6e2e 4c69 6e65 6172 286c 6179  nd(nn.Linear(lay
-00000b70: 6572 5f64 696d 2c20 6429 290a 2020 2020  er_dim, d)).    
-00000b80: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00000b90: 725f 6c69 7374 2e61 7070 656e 6428 7365  r_list.append(se
-00000ba0: 6c66 2e64 726f 706f 7574 290a 2020 2020  lf.dropout).    
-00000bb0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00000bc0: 656c 662e 6261 7463 685f 6e6f 726d 3a0a  elf.batch_norm:.
-00000bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000be0: 2020 2020 6c61 7965 725f 6c69 7374 2e61      layer_list.a
-00000bf0: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
-00000c00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00000c10: 6e2e 4261 7463 684e 6f72 6d31 6428 642c  n.BatchNorm1d(d,
-00000c20: 206d 6f6d 656e 7475 6d3d 7365 6c66 2e62   momentum=self.b
-00000c30: 6174 6368 5f6e 6f72 6d5f 6d6f 6d65 6e74  atch_norm_moment
-00000c40: 756d 2929 0a20 2020 2020 2020 2020 2020  um)).           
-00000c50: 2020 2020 206c 6179 6572 5f64 696d 203d       layer_dim =
-00000c60: 2064 0a20 2020 2020 2020 206c 6179 6572   d.        layer
-00000c70: 5f6c 6973 742e 6170 7065 6e64 286e 6e2e  _list.append(nn.
-00000c80: 4c69 6e65 6172 286c 6179 6572 5f64 696d  Linear(layer_dim
-00000c90: 2c20 7365 6c66 2e64 5f6f 7574 7075 7429  , self.d_output)
-00000ca0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00000cb0: 206c 6179 6572 5f6c 6973 740a 0a20 2020   layer_list..   
-00000cc0: 2064 6566 2066 6f72 7761 7264 2873 656c   def forward(sel
-00000cd0: 662c 2078 3a20 5465 6e73 6f72 2920 2d3e  f, x: Tensor) ->
-00000ce0: 2054 656e 736f 723a 0a20 2020 2020 2020   Tensor:.       
-00000cf0: 2022 2222 466f 7277 6172 6420 7061 7373   """Forward pass
-00000d00: 206f 6620 7468 6520 6d6f 6465 6c2e 2222   of the model.""
-00000d10: 220a 2020 2020 2020 2020 696e 7075 7420  ".        input 
-00000d20: 3d20 780a 2020 2020 2020 2020 666f 7220  = x.        for 
-00000d30: 6c61 7965 7220 696e 2073 656c 662e 6d6f  layer in self.mo
-00000d40: 6465 6c3a 0a20 2020 2020 2020 2020 2020  del:.           
-00000d50: 2078 203d 206c 6179 6572 2878 290a 2020   x = layer(x).  
-00000d60: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00000d70: 6e73 7461 6e63 6528 6c61 7965 722c 206e  nstance(layer, n
-00000d80: 6e2e 4c69 6e65 6172 293a 0a20 2020 2020  n.Linear):.     
-00000d90: 2020 2020 2020 2020 2020 2078 203d 2073             x = s
-00000da0: 656c 662e 6163 7469 7661 7469 6f6e 5f66  elf.activation_f
-00000db0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00000dc0: 2020 2020 2020 2078 0a20 2020 2020 2020         x.       
-00000dd0: 2020 2020 2020 2020 2029 2020 2320 446f           )  # Do
-00000de0: 6e65 2062 6563 6175 7365 2061 6374 6976  ne because activ
-00000df0: 6174 696f 6e5f 666e 2072 6574 7572 6e73  ation_fn returns
-00000e00: 2061 2074 6f72 6368 2e6e 6e2e 6675 6e63   a torch.nn.func
-00000e10: 7469 6f6e 616c 0a20 2020 2020 2020 2069  tional.        i
-00000e20: 6620 7365 6c66 2e73 6b69 7020 6973 206e  f self.skip is n
-00000e30: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00000e40: 2020 2020 2072 6574 7572 6e20 7820 2b20       return x + 
-00000e50: 7365 6c66 2e73 6b69 7028 696e 7075 7429  self.skip(input)
-00000e60: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00000e70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00000e80: 6e20 780a 0a0a 636c 6173 7320 434e 4e4d  n x...class CNNM
-00000e90: 6f64 756c 6528 6e6e 2e4d 6f64 756c 6529  odule(nn.Module)
-00000ea0: 3a0a 2020 2020 2222 2241 2031 2c20 322c  :.    """A 1, 2,
-00000eb0: 206f 7220 3320 6469 6d65 6e73 696f 6e61   or 3 dimensiona
-00000ec0: 6c20 636f 6e76 6f6c 7574 696f 6e61 6c20  l convolutional 
-00000ed0: 6e65 7477 6f72 6b20 666f 7220 6569 7468  network for eith
-00000ee0: 6572 2072 6567 7265 7373 696f 6e20 6f72  er regression or
-00000ef0: 2063 6c61 7373 6966 6963 6174 696f 6e2e   classification.
-00000f00: 0a20 2020 2054 6865 206e 6574 776f 726b  .    The network
-00000f10: 2063 6f6e 7369 7374 7320 6f66 2074 6865   consists of the
-00000f20: 2066 6f6c 6c6f 7769 6e67 2073 6571 7565   following seque
-00000f30: 6e63 6520 6f66 206c 6179 6572 733a 0a20  nce of layers:. 
-00000f40: 2020 202d 2041 2063 6f6e 6669 6775 7261     - A configura
-00000f50: 626c 6520 6e75 6d62 6572 206f 6620 636f  ble number of co
-00000f60: 6e76 6f6c 7574 696f 6e61 6c20 6c61 7965  nvolutional laye
-00000f70: 7273 0a20 2020 202d 2041 2067 6c6f 6261  rs.    - A globa
-00000f80: 6c20 706f 6f6c 696e 6720 6c61 7965 7220  l pooling layer 
-00000f90: 2865 6974 6865 7220 6d61 7820 706f 6f6c  (either max pool
-00000fa0: 206f 7220 6176 6572 6167 6520 706f 6f6c   or average pool
-00000fb0: 290a 2020 2020 2d20 4120 6669 6e61 6c20  ).    - A final 
-00000fc0: 6675 6c6c 7920 636f 6e6e 6563 7465 6420  fully connected 
-00000fd0: 6c61 7965 7220 746f 2063 6f6d 7075 7465  layer to compute
-00000fe0: 2074 6865 206f 7574 7075 740a 2020 2020   the output.    
-00000ff0: 4974 206f 7074 696f 6e61 6c6c 7920 6361  It optionally ca
-00001000: 6e20 636f 6d70 6f73 6520 7468 6520 6d6f  n compose the mo
-00001010: 6465 6c20 6672 6f6d 2070 7265 2d61 6374  del from pre-act
-00001020: 6976 6174 696f 6e20 7265 7369 6475 616c  ivation residual
-00001030: 2062 6c6f 636b 732c 2061 730a 2020 2020   blocks, as.    
-00001040: 6465 7363 7269 6265 6420 696e 2068 7474  described in htt
-00001050: 7073 3a2f 2f61 7278 6976 2e6f 7267 2f61  ps://arxiv.org/a
-00001060: 6273 2f31 3630 332e 3035 3032 372c 2072  bs/1603.05027, r
-00001070: 6174 6865 7220 7468 616e 2061 2073 696d  ather than a sim
-00001080: 706c 6520 7374 6163 6b20 6f66 0a20 2020  ple stack of.   
-00001090: 2063 6f6e 766f 6c75 7469 6f6e 206c 6179   convolution lay
-000010a0: 6572 732e 2020 5468 6973 206f 6674 656e  ers.  This often
-000010b0: 206c 6561 6473 2074 6f20 6561 7369 6572   leads to easier
-000010c0: 2074 7261 696e 696e 672c 2065 7370 6563   training, espec
-000010d0: 6961 6c6c 7920 7768 656e 2075 7369 6e67  ially when using
-000010e0: 2061 0a20 2020 206c 6172 6765 206e 756d   a.    large num
-000010f0: 6265 7220 6f66 206c 6179 6572 732e 2020  ber of layers.  
-00001100: 4e6f 7465 2074 6861 7420 7265 7369 6475  Note that residu
-00001110: 616c 2062 6c6f 636b 7320 6361 6e20 6f6e  al blocks can on
-00001120: 6c79 2062 6520 7573 6564 2077 6865 6e0a  ly be used when.
-00001130: 2020 2020 7375 6363 6573 7369 7665 206c      successive l
-00001140: 6179 6572 7320 6861 7665 2074 6865 2073  ayers have the s
-00001150: 616d 6520 6f75 7470 7574 2073 6861 7065  ame output shape
-00001160: 2e20 2057 6865 7265 7665 7220 7468 6520  .  Wherever the 
-00001170: 6f75 7470 7574 2073 6861 7065 2063 6861  output shape cha
-00001180: 6e67 6573 2c20 610a 2020 2020 7369 6d70  nges, a.    simp
-00001190: 6c65 2063 6f6e 766f 6c75 7469 6f6e 206c  le convolution l
-000011a0: 6179 6572 2077 696c 6c20 6265 2075 7365  ayer will be use
-000011b0: 6420 6576 656e 2069 6620 7265 7369 6475  d even if residu
-000011c0: 616c 3d54 7275 652e 0a20 2020 2045 7861  al=True..    Exa
-000011d0: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
-000011e0: 2d2d 0a20 2020 203e 3e3e 206d 6f64 656c  --.    >>> model
-000011f0: 203d 2043 4e4e 4d6f 6475 6c65 286e 5f74   = CNNModule(n_t
-00001200: 6173 6b73 3d35 2c20 6e5f 6665 6174 7572  asks=5, n_featur
-00001210: 6573 3d38 2c20 6469 6d73 3d32 2c20 6c61  es=8, dims=2, la
-00001220: 7965 725f 6669 6c74 6572 733d 5b33 2c38  yer_filters=[3,8
-00001230: 2c38 2c31 365d 2c20 6b65 726e 656c 5f73  ,8,16], kernel_s
-00001240: 697a 653d 332c 206e 5f63 6c61 7373 6573  ize=3, n_classes
-00001250: 203d 2037 2c20 6d6f 6465 3d27 636c 6173   = 7, mode='clas
-00001260: 7369 6669 6361 7469 6f6e 272c 2075 6e63  sification', unc
-00001270: 6572 7461 696e 7479 3d46 616c 7365 2c20  ertainty=False, 
-00001280: 7061 6464 696e 673d 2773 616d 6527 290a  padding='same').
-00001290: 2020 2020 3e3e 3e20 7820 3d20 746f 7263      >>> x = torc
-000012a0: 682e 6f6e 6573 2832 2c20 3232 342c 2032  h.ones(2, 224, 2
-000012b0: 3234 2c20 3829 0a20 2020 203e 3e3e 2078  24, 8).    >>> x
-000012c0: 203d 206d 6f64 656c 2878 290a 2020 2020   = model(x).    
-000012d0: 3e3e 3e20 666f 7220 7465 6e73 6f72 2069  >>> for tensor i
-000012e0: 6e20 783a 0a20 2020 202e 2e2e 2020 2020  n x:.    ...    
-000012f0: 7072 696e 7428 7465 6e73 6f72 2e73 6861  print(tensor.sha
-00001300: 7065 290a 2020 2020 746f 7263 682e 5369  pe).    torch.Si
-00001310: 7a65 285b 322c 2035 2c20 375d 290a 2020  ze([2, 5, 7]).  
-00001320: 2020 746f 7263 682e 5369 7a65 285b 322c    torch.Size([2,
-00001330: 2035 2c20 375d 290a 2020 2020 2222 220a   5, 7]).    """.
-00001340: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00001350: 5f28 7365 6c66 2c0a 2020 2020 2020 2020  _(self,.        
-00001360: 2020 2020 2020 2020 206e 5f74 6173 6b73           n_tasks
-00001370: 3a20 696e 742c 0a20 2020 2020 2020 2020  : int,.         
-00001380: 2020 2020 2020 2020 6e5f 6665 6174 7572          n_featur
-00001390: 6573 3a20 696e 742c 0a20 2020 2020 2020  es: int,.       
-000013a0: 2020 2020 2020 2020 2020 6469 6d73 3a20            dims: 
-000013b0: 696e 742c 0a20 2020 2020 2020 2020 2020  int,.           
-000013c0: 2020 2020 2020 6c61 7965 725f 6669 6c74        layer_filt
-000013d0: 6572 733a 204c 6973 745b 696e 745d 203d  ers: List[int] =
-000013e0: 205b 3130 305d 2c0a 2020 2020 2020 2020   [100],.        
-000013f0: 2020 2020 2020 2020 206b 6572 6e65 6c5f           kernel_
-00001400: 7369 7a65 3a20 4f6e 654f 724d 616e 795b  size: OneOrMany[
-00001410: 696e 745d 203d 2035 2c0a 2020 2020 2020  int] = 5,.      
-00001420: 2020 2020 2020 2020 2020 2073 7472 6964             strid
-00001430: 6573 3a20 4f6e 654f 724d 616e 795b 696e  es: OneOrMany[in
-00001440: 745d 203d 2031 2c0a 2020 2020 2020 2020  t] = 1,.        
-00001450: 2020 2020 2020 2020 2077 6569 6768 745f           weight_
-00001460: 696e 6974 5f73 7464 6465 7673 3a20 4f6e  init_stddevs: On
-00001470: 654f 724d 616e 795b 666c 6f61 745d 203d  eOrMany[float] =
-00001480: 2030 2e30 322c 0a20 2020 2020 2020 2020   0.02,.         
-00001490: 2020 2020 2020 2020 6269 6173 5f69 6e69          bias_ini
-000014a0: 745f 636f 6e73 7473 3a20 4f6e 654f 724d  t_consts: OneOrM
-000014b0: 616e 795b 666c 6f61 745d 203d 2031 2e30  any[float] = 1.0
-000014c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000014d0: 2020 2064 726f 706f 7574 733a 204f 6e65     dropouts: One
-000014e0: 4f72 4d61 6e79 5b66 6c6f 6174 5d20 3d20  OrMany[float] = 
-000014f0: 302e 352c 0a20 2020 2020 2020 2020 2020  0.5,.           
-00001500: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
-00001510: 5f66 6e73 3a20 4f6e 654f 724d 616e 795b  _fns: OneOrMany[
-00001520: 4163 7469 7661 7469 6f6e 466e 5d20 3d20  ActivationFn] = 
-00001530: 2772 656c 7527 2c0a 2020 2020 2020 2020  'relu',.        
-00001540: 2020 2020 2020 2020 2070 6f6f 6c5f 7479           pool_ty
-00001550: 7065 3a20 7374 7220 3d20 276d 6178 272c  pe: str = 'max',
-00001560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001570: 2020 6d6f 6465 3a20 7374 7220 3d20 2763    mode: str = 'c
-00001580: 6c61 7373 6966 6963 6174 696f 6e27 2c0a  lassification',.
-00001590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015a0: 206e 5f63 6c61 7373 6573 3a20 696e 7420   n_classes: int 
-000015b0: 3d20 322c 0a20 2020 2020 2020 2020 2020  = 2,.           
-000015c0: 2020 2020 2020 756e 6365 7274 6169 6e74        uncertaint
-000015d0: 793a 2062 6f6f 6c20 3d20 4661 6c73 652c  y: bool = False,
-000015e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000015f0: 2020 7265 7369 6475 616c 3a20 626f 6f6c    residual: bool
-00001600: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-00001610: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
-00001620: 6e67 3a20 556e 696f 6e5b 696e 742c 2073  ng: Union[int, s
-00001630: 7472 5d20 3d20 2776 616c 6964 2729 202d  tr] = 'valid') -
-00001640: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00001650: 2222 2243 7265 6174 6520 6120 434e 4e2e  """Create a CNN.
-00001660: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00001670: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00001680: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00001690: 6e5f 7461 736b 733a 2069 6e74 0a20 2020  n_tasks: int.   
-000016a0: 2020 2020 2020 2020 206e 756d 6265 7220           number 
-000016b0: 6f66 2074 6173 6b73 0a20 2020 2020 2020  of tasks.       
-000016c0: 206e 5f66 6561 7475 7265 733a 2069 6e74   n_features: int
-000016d0: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
-000016e0: 6265 7220 6f66 2066 6561 7475 7265 730a  ber of features.
-000016f0: 2020 2020 2020 2020 6469 6d73 3a20 696e          dims: in
-00001700: 740a 2020 2020 2020 2020 2020 2020 7468  t.            th
-00001710: 6520 6e75 6d62 6572 206f 6620 6469 6d65  e number of dime
-00001720: 6e73 696f 6e73 2074 6f20 6170 706c 7920  nsions to apply 
-00001730: 636f 6e76 6f6c 7574 696f 6e73 206f 7665  convolutions ove
-00001740: 7220 2831 2c20 322c 206f 7220 3329 0a20  r (1, 2, or 3). 
-00001750: 2020 2020 2020 206c 6179 6572 5f66 696c         layer_fil
-00001760: 7465 7273 3a20 6c69 7374 0a20 2020 2020  ters: list.     
-00001770: 2020 2020 2020 2074 6865 206e 756d 6265         the numbe
-00001780: 7220 6f66 206f 7574 7075 7420 6669 6c74  r of output filt
-00001790: 6572 7320 666f 7220 6561 6368 2063 6f6e  ers for each con
-000017a0: 766f 6c75 7469 6f6e 616c 206c 6179 6572  volutional layer
-000017b0: 2069 6e20 7468 6520 6e65 7477 6f72 6b2e   in the network.
-000017c0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-000017d0: 206c 656e 6774 6820 6f66 2074 6869 7320   length of this 
-000017e0: 6c69 7374 2064 6574 6572 6d69 6e65 7320  list determines 
-000017f0: 7468 6520 6e75 6d62 6572 206f 6620 6c61  the number of la
-00001800: 7965 7273 2e0a 2020 2020 2020 2020 6b65  yers..        ke
-00001810: 726e 656c 5f73 697a 653a 2069 6e74 2c20  rnel_size: int, 
-00001820: 7475 706c 652c 206f 7220 6c69 7374 0a20  tuple, or list. 
-00001830: 2020 2020 2020 2020 2020 2061 206c 6973             a lis
-00001840: 7420 6769 7669 6e67 2074 6865 2073 6861  t giving the sha
-00001850: 7065 206f 6620 7468 6520 636f 6e76 6f6c  pe of the convol
-00001860: 7574 696f 6e61 6c20 6b65 726e 656c 2066  utional kernel f
-00001870: 6f72 2065 6163 6820 6c61 7965 722e 2020  or each layer.  
-00001880: 4561 6368 0a20 2020 2020 2020 2020 2020  Each.           
-00001890: 2065 6c65 6d65 6e74 206d 6179 2062 6520   element may be 
-000018a0: 6569 7468 6572 2061 6e20 696e 7420 2875  either an int (u
-000018b0: 7365 2074 6865 2073 616d 6520 6b65 726e  se the same kern
-000018c0: 656c 2077 6964 7468 2066 6f72 2065 7665  el width for eve
-000018d0: 7279 2064 696d 656e 7369 6f6e 290a 2020  ry dimension).  
-000018e0: 2020 2020 2020 2020 2020 6f72 2061 2074            or a t
-000018f0: 7570 6c65 2028 7468 6520 6b65 726e 656c  uple (the kernel
-00001900: 2077 6964 7468 2061 6c6f 6e67 2065 6163   width along eac
-00001910: 6820 6469 6d65 6e73 696f 6e29 2e20 2041  h dimension).  A
-00001920: 6c74 6572 6e61 7469 7665 6c79 2074 6869  lternatively thi
-00001930: 7320 6d61 790a 2020 2020 2020 2020 2020  s may.          
-00001940: 2020 6265 2061 2073 696e 676c 6520 696e    be a single in
-00001950: 7420 6f72 2074 7570 6c65 2069 6e73 7465  t or tuple inste
-00001960: 6164 206f 6620 6120 6c69 7374 2c20 696e  ad of a list, in
-00001970: 2077 6869 6368 2063 6173 6520 7468 6520   which case the 
-00001980: 7361 6d65 206b 6572 6e65 6c0a 2020 2020  same kernel.    
-00001990: 2020 2020 2020 2020 7368 6170 6520 6973          shape is
-000019a0: 2075 7365 6420 666f 7220 6576 6572 7920   used for every 
-000019b0: 6c61 7965 722e 0a20 2020 2020 2020 2073  layer..        s
-000019c0: 7472 6964 6573 3a20 696e 742c 2074 7570  trides: int, tup
-000019d0: 6c65 2c20 6f72 206c 6973 740a 2020 2020  le, or list.    
-000019e0: 2020 2020 2020 2020 6120 6c69 7374 2067          a list g
-000019f0: 6976 696e 6720 7468 6520 7374 7269 6465  iving the stride
-00001a00: 2062 6574 7765 656e 2061 7070 6c69 6361   between applica
-00001a10: 7469 6f6e 7320 6f66 2074 6865 2020 6b65  tions of the  ke
-00001a20: 726e 656c 2066 6f72 2065 6163 6820 6c61  rnel for each la
-00001a30: 7965 722e 0a20 2020 2020 2020 2020 2020  yer..           
-00001a40: 2045 6163 6820 656c 656d 656e 7420 6d61   Each element ma
-00001a50: 7920 6265 2065 6974 6865 7220 616e 2069  y be either an i
-00001a60: 6e74 2028 7573 6520 7468 6520 7361 6d65  nt (use the same
-00001a70: 2073 7472 6964 6520 666f 7220 6576 6572   stride for ever
-00001a80: 7920 6469 6d65 6e73 696f 6e29 0a20 2020  y dimension).   
-00001a90: 2020 2020 2020 2020 206f 7220 6120 7475           or a tu
-00001aa0: 706c 6520 2874 6865 2073 7472 6964 6520  ple (the stride 
-00001ab0: 616c 6f6e 6720 6561 6368 2064 696d 656e  along each dimen
-00001ac0: 7369 6f6e 292e 2020 416c 7465 726e 6174  sion).  Alternat
-00001ad0: 6976 656c 7920 7468 6973 206d 6179 2062  ively this may b
-00001ae0: 6520 610a 2020 2020 2020 2020 2020 2020  e a.            
-00001af0: 7369 6e67 6c65 2069 6e74 206f 7220 7475  single int or tu
-00001b00: 706c 6520 696e 7374 6561 6420 6f66 2061  ple instead of a
-00001b10: 206c 6973 742c 2069 6e20 7768 6963 6820   list, in which 
-00001b20: 6361 7365 2074 6865 2073 616d 6520 7374  case the same st
-00001b30: 7269 6465 2069 730a 2020 2020 2020 2020  ride is.        
-00001b40: 2020 2020 7573 6564 2066 6f72 2065 7665      used for eve
-00001b50: 7279 206c 6179 6572 2e0a 2020 2020 2020  ry layer..      
-00001b60: 2020 7765 6967 6874 5f69 6e69 745f 7374    weight_init_st
-00001b70: 6464 6576 733a 206c 6973 7420 6f72 2066  ddevs: list or f
-00001b80: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-00001b90: 2074 6865 2073 7461 6e64 6172 6420 6465   the standard de
-00001ba0: 7669 6174 696f 6e20 6f66 2074 6865 2064  viation of the d
-00001bb0: 6973 7472 6962 7574 696f 6e20 746f 2075  istribution to u
-00001bc0: 7365 2066 6f72 2077 6569 6768 7420 696e  se for weight in
-00001bd0: 6974 6961 6c69 7a61 7469 6f6e 0a20 2020  itialization.   
-00001be0: 2020 2020 2020 2020 206f 6620 6561 6368           of each
-00001bf0: 206c 6179 6572 2e20 2054 6865 206c 656e   layer.  The len
-00001c00: 6774 6820 6f66 2074 6869 7320 6c69 7374  gth of this list
-00001c10: 2073 686f 756c 6420 6571 7561 6c20 6c65   should equal le
-00001c20: 6e28 6c61 7965 725f 6669 6c74 6572 7329  n(layer_filters)
-00001c30: 2b31 2c0a 2020 2020 2020 2020 2020 2020  +1,.            
-00001c40: 7768 6572 6520 7468 6520 6669 6e61 6c20  where the final 
-00001c50: 656c 656d 656e 7420 636f 7272 6573 706f  element correspo
-00001c60: 6e64 7320 746f 2074 6865 2064 656e 7365  nds to the dense
-00001c70: 206c 6179 6572 2e20 2041 6c74 6572 6e61   layer.  Alterna
-00001c80: 7469 7665 6c79 2074 6869 730a 2020 2020  tively this.    
-00001c90: 2020 2020 2020 2020 6d61 7920 6265 2061          may be a
-00001ca0: 2073 696e 676c 6520 7661 6c75 6520 696e   single value in
-00001cb0: 7374 6561 6420 6f66 2061 206c 6973 742c  stead of a list,
-00001cc0: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
-00001cd0: 6865 2073 616d 6520 7661 6c75 6520 6973  he same value is
-00001ce0: 2075 7365 640a 2020 2020 2020 2020 2020   used.          
-00001cf0: 2020 666f 7220 6576 6572 7920 6c61 7965    for every laye
-00001d00: 722e 0a20 2020 2020 2020 2062 6961 735f  r..        bias_
-00001d10: 696e 6974 5f63 6f6e 7374 733a 206c 6973  init_consts: lis
-00001d20: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-00001d30: 2020 2020 2020 2074 6865 2076 616c 7565         the value
-00001d40: 2074 6f20 696e 6974 6961 6c69 7a65 2074   to initialize t
-00001d50: 6865 2062 6961 7365 7320 696e 2065 6163  he biases in eac
-00001d60: 6820 6c61 7965 7220 746f 2e20 2054 6865  h layer to.  The
-00001d70: 206c 656e 6774 6820 6f66 2074 6869 730a   length of this.
-00001d80: 2020 2020 2020 2020 2020 2020 6c69 7374              list
-00001d90: 2073 686f 756c 6420 6571 7561 6c20 6c65   should equal le
-00001da0: 6e28 6c61 7965 725f 6669 6c74 6572 7329  n(layer_filters)
-00001db0: 2b31 2c20 7768 6572 6520 7468 6520 6669  +1, where the fi
-00001dc0: 6e61 6c20 656c 656d 656e 7420 636f 7272  nal element corr
-00001dd0: 6573 706f 6e64 730a 2020 2020 2020 2020  esponds.        
-00001de0: 2020 2020 746f 2074 6865 2064 656e 7365      to the dense
-00001df0: 206c 6179 6572 2e20 2041 6c74 6572 6e61   layer.  Alterna
-00001e00: 7469 7665 6c79 2074 6869 7320 6d61 7920  tively this may 
-00001e10: 6265 2061 2073 696e 676c 6520 7661 6c75  be a single valu
-00001e20: 6520 696e 7374 6561 6420 6f66 2061 0a20  e instead of a. 
-00001e30: 2020 2020 2020 2020 2020 206c 6973 742c             list,
-00001e40: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
-00001e50: 6865 2073 616d 6520 7661 6c75 6520 6973  he same value is
-00001e60: 2075 7365 6420 666f 7220 6576 6572 7920   used for every 
-00001e70: 6c61 7965 722e 0a20 2020 2020 2020 2064  layer..        d
-00001e80: 726f 706f 7574 733a 206c 6973 7420 6f72  ropouts: list or
-00001e90: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
-00001ea0: 2020 2074 6865 2064 726f 706f 7574 2070     the dropout p
-00001eb0: 726f 6261 6269 6c69 7479 2074 6f20 7573  robability to us
-00001ec0: 6520 666f 7220 6561 6368 206c 6179 6572  e for each layer
-00001ed0: 2e20 2054 6865 206c 656e 6774 6820 6f66  .  The length of
-00001ee0: 2074 6869 7320 6c69 7374 2073 686f 756c   this list shoul
-00001ef0: 6420 6571 7561 6c20 6c65 6e28 6c61 7965  d equal len(laye
-00001f00: 725f 6669 6c74 6572 7329 2e0a 2020 2020  r_filters)..    
-00001f10: 2020 2020 2020 2020 416c 7465 726e 6174          Alternat
-00001f20: 6976 656c 7920 7468 6973 206d 6179 2062  ively this may b
-00001f30: 6520 6120 7369 6e67 6c65 2076 616c 7565  e a single value
-00001f40: 2069 6e73 7465 6164 206f 6620 6120 6c69   instead of a li
-00001f50: 7374 2c20 696e 2077 6869 6368 2063 6173  st, in which cas
-00001f60: 6520 7468 6520 7361 6d65 2076 616c 7565  e the same value
-00001f70: 2069 7320 7573 6564 2066 6f72 2065 7665   is used for eve
-00001f80: 7279 206c 6179 6572 0a20 2020 2020 2020  ry layer.       
-00001f90: 2061 6374 6976 6174 696f 6e5f 666e 733a   activation_fns:
-00001fa0: 2073 7472 206f 7220 6c69 7374 0a20 2020   str or list.   
-00001fb0: 2020 2020 2020 2020 2074 6865 2074 6f72           the tor
-00001fc0: 6368 2061 6374 6976 6174 696f 6e20 6675  ch activation fu
-00001fd0: 6e63 7469 6f6e 2074 6f20 6170 706c 7920  nction to apply 
-00001fe0: 746f 2065 6163 6820 6c61 7965 722e 2054  to each layer. T
-00001ff0: 6865 206c 656e 6774 6820 6f66 2074 6869  he length of thi
-00002000: 7320 6c69 7374 2073 686f 756c 6420 6571  s list should eq
-00002010: 7561 6c0a 2020 2020 2020 2020 2020 2020  ual.            
-00002020: 6c65 6e28 6c61 7965 725f 6669 6c74 6572  len(layer_filter
-00002030: 7329 2e20 2041 6c74 6572 6e61 7469 7665  s).  Alternative
-00002040: 6c79 2074 6869 7320 6d61 7920 6265 2061  ly this may be a
-00002050: 2073 696e 676c 6520 7661 6c75 6520 696e   single value in
-00002060: 7374 6561 6420 6f66 2061 206c 6973 742c  stead of a list,
-00002070: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
-00002080: 6865 0a20 2020 2020 2020 2020 2020 2073  he.            s
-00002090: 616d 6520 7661 6c75 6520 6973 2075 7365  ame value is use
-000020a0: 6420 666f 7220 6576 6572 7920 6c61 7965  d for every laye
-000020b0: 722c 2027 7265 6c75 2720 6279 2064 6566  r, 'relu' by def
-000020c0: 6175 6c74 0a20 2020 2020 2020 2070 6f6f  ault.        poo
-000020d0: 6c5f 7479 7065 3a20 7374 720a 2020 2020  l_type: str.    
-000020e0: 2020 2020 2020 2020 7468 6520 7479 7065          the type
-000020f0: 206f 6620 706f 6f6c 696e 6720 6c61 7965   of pooling laye
-00002100: 7220 746f 2075 7365 2c20 6569 7468 6572  r to use, either
-00002110: 2027 6d61 7827 206f 7220 2761 7665 7261   'max' or 'avera
-00002120: 6765 270a 2020 2020 2020 2020 6d6f 6465  ge'.        mode
-00002130: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
-00002140: 2020 4569 7468 6572 2027 636c 6173 7369    Either 'classi
-00002150: 6669 6361 7469 6f6e 2720 6f72 2027 7265  fication' or 're
-00002160: 6772 6573 7369 6f6e 270a 2020 2020 2020  gression'.      
-00002170: 2020 6e5f 636c 6173 7365 733a 2069 6e74    n_classes: int
-00002180: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00002190: 206e 756d 6265 7220 6f66 2063 6c61 7373   number of class
-000021a0: 6573 2074 6f20 7072 6564 6963 7420 286f  es to predict (o
-000021b0: 6e6c 7920 7573 6564 2069 6e20 636c 6173  nly used in clas
-000021c0: 7369 6669 6361 7469 6f6e 206d 6f64 6529  sification mode)
-000021d0: 0a20 2020 2020 2020 2075 6e63 6572 7461  .        uncerta
-000021e0: 696e 7479 3a20 626f 6f6c 0a20 2020 2020  inty: bool.     
-000021f0: 2020 2020 2020 2069 6620 5472 7565 2c20         if True, 
-00002200: 696e 636c 7564 6520 6578 7472 6120 6f75  include extra ou
-00002210: 7470 7574 7320 616e 6420 6c6f 7373 2074  tputs and loss t
-00002220: 6572 6d73 2074 6f20 656e 6162 6c65 2074  erms to enable t
-00002230: 6865 2075 6e63 6572 7461 696e 7479 0a20  he uncertainty. 
-00002240: 2020 2020 2020 2020 2020 2069 6e20 6f75             in ou
-00002250: 7470 7574 7320 746f 2062 6520 7072 6564  tputs to be pred
-00002260: 6963 7465 640a 2020 2020 2020 2020 7265  icted.        re
-00002270: 7369 6475 616c 3a20 626f 6f6c 0a20 2020  sidual: bool.   
-00002280: 2020 2020 2020 2020 2069 6620 5472 7565           if True
-00002290: 2c20 7468 6520 6d6f 6465 6c20 7769 6c6c  , the model will
-000022a0: 2062 6520 636f 6d70 6f73 6564 206f 6620   be composed of 
-000022b0: 7072 652d 6163 7469 7661 7469 6f6e 2072  pre-activation r
-000022c0: 6573 6964 7561 6c20 626c 6f63 6b73 2069  esidual blocks i
-000022d0: 6e73 7465 6164 0a20 2020 2020 2020 2020  nstead.         
-000022e0: 2020 206f 6620 6120 7369 6d70 6c65 2073     of a simple s
-000022f0: 7461 636b 206f 6620 636f 6e76 6f6c 7574  tack of convolut
-00002300: 696f 6e61 6c20 6c61 7965 7273 2e0a 2020  ional layers..  
-00002310: 2020 2020 2020 7061 6464 696e 673a 2073        padding: s
-00002320: 7472 2c20 696e 7420 6f72 2074 7570 6c65  tr, int or tuple
-00002330: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00002340: 2070 6164 6469 6e67 2074 6f20 7573 6520   padding to use 
-00002350: 666f 7220 636f 6e76 6f6c 7574 696f 6e61  for convolutiona
-00002360: 6c20 6c61 7965 7273 2c20 6569 7468 6572  l layers, either
-00002370: 2027 7661 6c69 6427 206f 7220 2773 616d   'valid' or 'sam
-00002380: 6527 0a20 2020 2020 2020 2022 2222 0a0a  e'.        """..
-00002390: 2020 2020 2020 2020 7375 7065 7228 434e          super(CN
-000023a0: 4e4d 6f64 756c 652c 2073 656c 6629 2e5f  NModule, self)._
-000023b0: 5f69 6e69 745f 5f28 290a 0a20 2020 2020  _init__()..     
-000023c0: 2020 2069 6620 6469 6d73 206e 6f74 2069     if dims not i
-000023d0: 6e20 2831 2c20 322c 2033 293a 0a20 2020  n (1, 2, 3):.   
-000023e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000023f0: 616c 7565 4572 726f 7228 274e 756d 6265  alueError('Numbe
-00002400: 7220 6f66 2064 696d 656e 7369 6f6e 7320  r of dimensions 
-00002410: 6d75 7374 2062 6520 312c 2032 206f 7220  must be 1, 2 or 
-00002420: 3327 290a 0a20 2020 2020 2020 2069 6620  3')..        if 
-00002430: 6d6f 6465 206e 6f74 2069 6e20 5b27 636c  mode not in ['cl
-00002440: 6173 7369 6669 6361 7469 6f6e 272c 2027  assification', '
-00002450: 7265 6772 6573 7369 6f6e 275d 3a0a 2020  regression']:.  
-00002460: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00002470: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00002480: 2020 2020 2020 2020 2020 2020 226d 6f64              "mod
-00002490: 6520 6d75 7374 2062 6520 6569 7468 6572  e must be either
-000024a0: 2027 636c 6173 7369 6669 6361 7469 6f6e   'classification
-000024b0: 2720 6f72 2027 7265 6772 6573 7369 6f6e  ' or 'regression
-000024c0: 2722 290a 0a20 2020 2020 2020 2073 656c  '")..        sel
-000024d0: 662e 6e5f 7461 736b 7320 3d20 6e5f 7461  f.n_tasks = n_ta
-000024e0: 736b 730a 2020 2020 2020 2020 7365 6c66  sks.        self
-000024f0: 2e6e 5f66 6561 7475 7265 7320 3d20 6e5f  .n_features = n_
-00002500: 6665 6174 7572 6573 0a20 2020 2020 2020  features.       
-00002510: 2073 656c 662e 6469 6d73 203d 2064 696d   self.dims = dim
-00002520: 730a 2020 2020 2020 2020 7365 6c66 2e6d  s.        self.m
-00002530: 6f64 6520 3d20 6d6f 6465 0a20 2020 2020  ode = mode.     
-00002540: 2020 2073 656c 662e 6e5f 636c 6173 7365     self.n_classe
-00002550: 7320 3d20 6e5f 636c 6173 7365 730a 2020  s = n_classes.  
-00002560: 2020 2020 2020 7365 6c66 2e75 6e63 6572        self.uncer
-00002570: 7461 696e 7479 203d 2075 6e63 6572 7461  tainty = uncerta
-00002580: 696e 7479 0a20 2020 2020 2020 2073 656c  inty.        sel
-00002590: 662e 6d6f 6465 203d 206d 6f64 650a 2020  f.mode = mode.  
-000025a0: 2020 2020 2020 7365 6c66 2e6c 6179 6572        self.layer
-000025b0: 5f66 696c 7465 7273 203d 206c 6179 6572  _filters = layer
-000025c0: 5f66 696c 7465 7273 0a20 2020 2020 2020  _filters.       
-000025d0: 2073 656c 662e 7265 7369 6475 616c 203d   self.residual =
-000025e0: 2072 6573 6964 7561 6c0a 0a20 2020 2020   residual..     
-000025f0: 2020 206e 5f6c 6179 6572 7320 3d20 6c65     n_layers = le
-00002600: 6e28 6c61 7965 725f 6669 6c74 6572 7329  n(layer_filters)
-00002610: 0a0a 2020 2020 2020 2020 2320 5079 546f  ..        # PyTo
-00002620: 7263 6820 6c61 7965 7273 2072 6571 7569  rch layers requi
-00002630: 7265 2069 6e70 7574 2061 6e64 206f 7574  re input and out
-00002640: 7075 7420 6368 616e 6e65 6c73 2061 7320  put channels as 
-00002650: 7061 7261 6d65 7465 720a 2020 2020 2020  parameter.      
-00002660: 2020 2320 6966 206f 6e6c 7920 6f6e 6520    # if only one 
-00002670: 6c61 7965 7220 746f 206d 616b 6520 7468  layer to make th
-00002680: 6520 6d6f 6465 6c20 6372 6561 7469 6e67  e model creating
-00002690: 206c 6f6f 7020 6265 6c6f 7720 776f 726b   loop below work
-000026a0: 2c20 6d75 6c74 6970 6c79 206c 6179 6572  , multiply layer
-000026b0: 5f66 696c 7465 7273 2077 7574 6720 320a  _filters wutg 2.
-000026c0: 2020 2020 2020 2020 6966 206c 656e 286c          if len(l
-000026d0: 6179 6572 5f66 696c 7465 7273 2920 3d3d  ayer_filters) ==
-000026e0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-000026f0: 6c61 7965 725f 6669 6c74 6572 7320 3d20  layer_filters = 
-00002700: 6c61 7965 725f 6669 6c74 6572 7320 2a20  layer_filters * 
-00002710: 320a 0a20 2020 2020 2020 2069 6620 6e6f  2..        if no
-00002720: 7420 6973 696e 7374 616e 6365 286b 6572  t isinstance(ker
-00002730: 6e65 6c5f 7369 7a65 2c20 5365 7175 656e  nel_size, Sequen
-00002740: 6365 436f 6c6c 6563 7469 6f6e 293a 0a20  ceCollection):. 
-00002750: 2020 2020 2020 2020 2020 206b 6572 6e65             kerne
-00002760: 6c5f 7369 7a65 203d 205b 6b65 726e 656c  l_size = [kernel
-00002770: 5f73 697a 655d 202a 206e 5f6c 6179 6572  _size] * n_layer
-00002780: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-00002790: 2069 7369 6e73 7461 6e63 6528 7374 7269   isinstance(stri
-000027a0: 6465 732c 2053 6571 7565 6e63 6543 6f6c  des, SequenceCol
-000027b0: 6c65 6374 696f 6e29 3a0a 2020 2020 2020  lection):.      
-000027c0: 2020 2020 2020 7374 7269 6465 7320 3d20        strides = 
-000027d0: 5b73 7472 6964 6573 5d20 2a20 6e5f 6c61  [strides] * n_la
-000027e0: 7965 7273 0a20 2020 2020 2020 2069 6620  yers.        if 
-000027f0: 6e6f 7420 6973 696e 7374 616e 6365 2864  not isinstance(d
-00002800: 726f 706f 7574 732c 2053 6571 7565 6e63  ropouts, Sequenc
-00002810: 6543 6f6c 6c65 6374 696f 6e29 3a0a 2020  eCollection):.  
-00002820: 2020 2020 2020 2020 2020 6472 6f70 6f75            dropou
-00002830: 7473 203d 205b 6472 6f70 6f75 7473 5d20  ts = [dropouts] 
-00002840: 2a20 6e5f 6c61 7965 7273 0a20 2020 2020  * n_layers.     
-00002850: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00002860: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00002870: 2020 6163 7469 7661 7469 6f6e 5f66 6e73    activation_fns
-00002880: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00002890: 2020 7374 7229 206f 7220 6e6f 7420 6973    str) or not is
-000028a0: 696e 7374 616e 6365 2861 6374 6976 6174  instance(activat
-000028b0: 696f 6e5f 666e 732c 2053 6571 7565 6e63  ion_fns, Sequenc
-000028c0: 6543 6f6c 6c65 6374 696f 6e29 3a0a 2020  eCollection):.  
-000028d0: 2020 2020 2020 2020 2020 6163 7469 7661            activa
-000028e0: 7469 6f6e 5f66 6e73 203d 205b 6163 7469  tion_fns = [acti
-000028f0: 7661 7469 6f6e 5f66 6e73 5d20 2a20 6e5f  vation_fns] * n_
-00002900: 6c61 7965 7273 0a20 2020 2020 2020 2069  layers.        i
-00002910: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00002920: 2877 6569 6768 745f 696e 6974 5f73 7464  (weight_init_std
-00002930: 6465 7673 2c20 5365 7175 656e 6365 436f  devs, SequenceCo
-00002940: 6c6c 6563 7469 6f6e 293a 0a20 2020 2020  llection):.     
-00002950: 2020 2020 2020 2077 6569 6768 745f 696e         weight_in
-00002960: 6974 5f73 7464 6465 7673 203d 205b 7765  it_stddevs = [we
-00002970: 6967 6874 5f69 6e69 745f 7374 6464 6576  ight_init_stddev
-00002980: 735d 202a 206e 5f6c 6179 6572 730a 2020  s] * n_layers.  
-00002990: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-000029a0: 6e73 7461 6e63 6528 6269 6173 5f69 6e69  nstance(bias_ini
-000029b0: 745f 636f 6e73 7473 2c20 5365 7175 656e  t_consts, Sequen
-000029c0: 6365 436f 6c6c 6563 7469 6f6e 293a 0a20  ceCollection):. 
-000029d0: 2020 2020 2020 2020 2020 2062 6961 735f             bias_
-000029e0: 696e 6974 5f63 6f6e 7374 7320 3d20 5b62  init_consts = [b
-000029f0: 6961 735f 696e 6974 5f63 6f6e 7374 735d  ias_init_consts]
-00002a00: 202a 206e 5f6c 6179 6572 730a 0a20 2020   * n_layers..   
-00002a10: 2020 2020 2073 656c 662e 6163 7469 7661       self.activa
-00002a20: 7469 6f6e 5f66 6e73 203d 205b 6765 745f  tion_fns = [get_
-00002a30: 6163 7469 7661 7469 6f6e 2866 2920 666f  activation(f) fo
-00002a40: 7220 6620 696e 2061 6374 6976 6174 696f  r f in activatio
-00002a50: 6e5f 666e 735d 0a20 2020 2020 2020 2073  n_fns].        s
-00002a60: 656c 662e 6472 6f70 6f75 7473 203d 2064  elf.dropouts = d
-00002a70: 726f 706f 7574 730a 0a20 2020 2020 2020  ropouts..       
-00002a80: 2069 6620 756e 6365 7274 6169 6e74 793a   if uncertainty:
-00002a90: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00002aa0: 206d 6f64 6520 213d 2027 7265 6772 6573   mode != 'regres
-00002ab0: 7369 6f6e 273a 0a20 2020 2020 2020 2020  sion':.         
-00002ac0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00002ad0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00002ae0: 2020 2020 2020 2020 2020 2020 2022 556e               "Un
-00002af0: 6365 7274 6169 6e74 7920 6973 206f 6e6c  certainty is onl
-00002b00: 7920 7375 7070 6f72 7465 6420 696e 2072  y supported in r
-00002b10: 6567 7265 7373 696f 6e20 6d6f 6465 2229  egression mode")
-00002b20: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00002b30: 2061 6e79 2864 203d 3d20 302e 3020 666f   any(d == 0.0 fo
-00002b40: 7220 6420 696e 2064 726f 706f 7574 7329  r d in dropouts)
-00002b50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002b60: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00002b70: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00002b80: 2020 2020 2020 2020 2744 726f 706f 7574          'Dropout
-00002b90: 206d 7573 7420 6265 2069 6e63 6c75 6465   must be include
-00002ba0: 6420 696e 2065 7665 7279 206c 6179 6572  d in every layer
-00002bb0: 2074 6f20 7072 6564 6963 7420 756e 6365   to predict unce
-00002bc0: 7274 6169 6e74 7927 0a20 2020 2020 2020  rtainty'.       
-00002bd0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00002be0: 2020 2020 2320 5079 7468 6f6e 2074 7570      # Python tup
-00002bf0: 6c65 7320 7573 6520 3020 6261 7365 6420  les use 0 based 
-00002c00: 696e 6465 7869 6e67 2c20 6469 6d73 2064  indexing, dims d
-00002c10: 6566 696e 6573 206e 756d 6265 7220 6f66  efines number of
-00002c20: 2064 696d 656e 7369 6f6e 2066 6f72 2063   dimension for c
-00002c30: 6f6e 766f 6c75 7469 6f6e 616c 206f 7065  onvolutional ope
-00002c40: 7261 7469 6f6e 0a20 2020 2020 2020 2043  ration.        C
-00002c50: 6f6e 764c 6179 6572 203d 2028 6e6e 2e43  onvLayer = (nn.C
-00002c60: 6f6e 7631 642c 206e 6e2e 436f 6e76 3264  onv1d, nn.Conv2d
-00002c70: 2c20 6e6e 2e43 6f6e 7633 6429 5b73 656c  , nn.Conv3d)[sel
-00002c80: 662e 6469 6d73 202d 2031 5d0a 0a20 2020  f.dims - 1]..   
-00002c90: 2020 2020 2069 6620 706f 6f6c 5f74 7970       if pool_typ
-00002ca0: 6520 3d3d 2027 6176 6572 6167 6527 3a0a  e == 'average':.
-00002cb0: 2020 2020 2020 2020 2020 2020 506f 6f6c              Pool
-00002cc0: 4c61 7965 7220 3d20 2846 2e61 7667 5f70  Layer = (F.avg_p
-00002cd0: 6f6f 6c31 642c 2046 2e61 7667 5f70 6f6f  ool1d, F.avg_poo
-00002ce0: 6c32 642c 0a20 2020 2020 2020 2020 2020  l2d,.           
-00002cf0: 2020 2020 2020 2020 2020 2020 2020 462e                F.
-00002d00: 6176 675f 706f 6f6c 3364 295b 7365 6c66  avg_pool3d)[self
-00002d10: 2e64 696d 7320 2d20 315d 0a20 2020 2020  .dims - 1].     
-00002d20: 2020 2065 6c69 6620 706f 6f6c 5f74 7970     elif pool_typ
-00002d30: 6520 3d3d 2027 6d61 7827 3a0a 2020 2020  e == 'max':.    
-00002d40: 2020 2020 2020 2020 506f 6f6c 4c61 7965          PoolLaye
-00002d50: 7220 3d20 2846 2e6d 6178 5f70 6f6f 6c31  r = (F.max_pool1
-00002d60: 642c 2046 2e6d 6178 5f70 6f6f 6c32 642c  d, F.max_pool2d,
-00002d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002d80: 2020 2020 2020 2020 2020 462e 6d61 785f            F.max_
-00002d90: 706f 6f6c 3364 295b 7365 6c66 2e64 696d  pool3d)[self.dim
-00002da0: 7320 2d20 315d 0a20 2020 2020 2020 2065  s - 1].        e
-00002db0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00002dc0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00002dd0: 7228 2270 6f6f 6c5f 7479 7065 206d 7573  r("pool_type mus
-00002de0: 7420 6265 2065 6974 6865 7220 2761 7665  t be either 'ave
-00002df0: 7261 6765 2720 6f72 2027 6d61 7827 2229  rage' or 'max'")
-00002e00: 0a0a 2020 2020 2020 2020 7365 6c66 2e50  ..        self.P
-00002e10: 6f6f 6c4c 6179 6572 203d 2050 6f6f 6c4c  oolLayer = PoolL
-00002e20: 6179 6572 0a20 2020 2020 2020 2073 656c  ayer.        sel
-00002e30: 662e 6c61 7965 7273 203d 206e 6e2e 4d6f  f.layers = nn.Mo
-00002e40: 6475 6c65 4c69 7374 2829 0a0a 2020 2020  duleList()..    
-00002e50: 2020 2020 696e 5f73 6861 7065 203d 206e      in_shape = n
-00002e60: 5f66 6561 7475 7265 730a 0a20 2020 2020  _features..     
-00002e70: 2020 2066 6f72 206f 7574 5f73 6861 7065     for out_shape
-00002e80: 2c20 7369 7a65 2c20 7374 7269 6465 2c20  , size, stride, 
-00002e90: 7765 6967 6874 5f73 7464 6465 762c 2062  weight_stddev, b
-00002ea0: 6961 735f 636f 6e73 7420 696e 207a 6970  ias_const in zip
-00002eb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00002ec0: 2020 6c61 7965 725f 6669 6c74 6572 732c    layer_filters,
-00002ed0: 206b 6572 6e65 6c5f 7369 7a65 2c20 7374   kernel_size, st
-00002ee0: 7269 6465 732c 2077 6569 6768 745f 696e  rides, weight_in
-00002ef0: 6974 5f73 7464 6465 7673 2c0a 2020 2020  it_stddevs,.    
-00002f00: 2020 2020 2020 2020 2020 2020 6269 6173              bias
-00002f10: 5f69 6e69 745f 636f 6e73 7473 293a 0a0a  _init_consts):..
-00002f20: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00002f30: 7220 3d20 436f 6e76 4c61 7965 7228 696e  r = ConvLayer(in
-00002f40: 5f63 6861 6e6e 656c 733d 696e 5f73 6861  _channels=in_sha
-00002f50: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
-00002f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f70: 2020 6f75 745f 6368 616e 6e65 6c73 3d6f    out_channels=o
-00002f80: 7574 5f73 6861 7065 2c0a 2020 2020 2020  ut_shape,.      
-00002f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fa0: 2020 2020 2020 2020 6b65 726e 656c 5f73          kernel_s
-00002fb0: 697a 653d 7369 7a65 2c0a 2020 2020 2020  ize=size,.      
-00002fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fd0: 2020 2020 2020 2020 7374 7269 6465 3d73          stride=s
-00002fe0: 7472 6964 652c 0a20 2020 2020 2020 2020  tride,.         
-00002ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003000: 2020 2020 2070 6164 6469 6e67 3d70 6164       padding=pad
-00003010: 6469 6e67 2c0a 2020 2020 2020 2020 2020  ding,.          
-00003020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003030: 2020 2020 6469 6c61 7469 6f6e 3d31 2c0a      dilation=1,.
-00003040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003050: 2020 2020 2020 2020 2020 2020 2020 6772                gr
-00003060: 6f75 7073 3d31 2c0a 2020 2020 2020 2020  oups=1,.        
-00003070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003080: 2020 2020 2020 6269 6173 3d54 7275 6529        bias=True)
-00003090: 0a0a 2020 2020 2020 2020 2020 2020 6e6e  ..            nn
-000030a0: 2e69 6e69 742e 6e6f 726d 616c 5f28 6c61  .init.normal_(la
-000030b0: 7965 722e 7765 6967 6874 2c20 302c 2077  yer.weight, 0, w
-000030c0: 6569 6768 745f 7374 6464 6576 290a 0a20  eight_stddev).. 
-000030d0: 2020 2020 2020 2020 2020 2023 2069 6e69             # ini
-000030e0: 7469 616c 697a 696e 6720 6c61 7965 7220  tializing layer 
-000030f0: 6269 6173 2077 6974 6820 6e6e 2e69 6e69  bias with nn.ini
-00003100: 7420 6769 7665 7320 6d79 7079 2074 7970  t gives mypy typ
-00003110: 6563 6865 636b 2065 7272 6f72 0a20 2020  echeck error.   
-00003120: 2020 2020 2020 2020 2023 2075 7369 6e67           # using
-00003130: 2074 6865 2066 6f6c 6c6f 7769 6e67 2077   the following w
-00003140: 6f72 6b61 726f 756e 640a 2020 2020 2020  orkaround.      
-00003150: 2020 2020 2020 6966 206c 6179 6572 2e62        if layer.b
-00003160: 6961 7320 6973 206e 6f74 204e 6f6e 653a  ias is not None:
-00003170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003180: 206c 6179 6572 2e62 6961 7320 3d20 6e6e   layer.bias = nn
-00003190: 2e50 6172 616d 6574 6572 280a 2020 2020  .Parameter(.    
-000031a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000031b0: 746f 7263 682e 6675 6c6c 286c 6179 6572  torch.full(layer
-000031c0: 2e62 6961 732e 7368 6170 652c 2062 6961  .bias.shape, bia
-000031d0: 735f 636f 6e73 7429 290a 0a20 2020 2020  s_const))..     
-000031e0: 2020 2020 2020 2073 656c 662e 6c61 7965         self.laye
-000031f0: 7273 2e61 7070 656e 6428 6c61 7965 7229  rs.append(layer)
-00003200: 0a0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-00003210: 5f73 6861 7065 203d 206f 7574 5f73 6861  _shape = out_sha
-00003220: 7065 0a0a 2020 2020 2020 2020 7365 6c66  pe..        self
-00003230: 2e63 6c61 7373 6966 6965 725f 6666 6e20  .classifier_ffn 
-00003240: 3d20 6e6e 2e4c 617a 794c 696e 6561 7228  = nn.LazyLinear(
-00003250: 7365 6c66 2e6e 5f74 6173 6b73 202a 2073  self.n_tasks * s
-00003260: 656c 662e 6e5f 636c 6173 7365 7329 0a20  elf.n_classes). 
-00003270: 2020 2020 2020 2073 656c 662e 6f75 7470         self.outp
-00003280: 7574 5f6c 6179 6572 203d 206e 6e2e 4c61  ut_layer = nn.La
-00003290: 7a79 4c69 6e65 6172 2873 656c 662e 6e5f  zyLinear(self.n_
-000032a0: 7461 736b 7329 0a20 2020 2020 2020 2073  tasks).        s
-000032b0: 656c 662e 756e 6365 7274 6169 6e74 795f  elf.uncertainty_
-000032c0: 6c61 7965 7220 3d20 6e6e 2e4c 617a 794c  layer = nn.LazyL
-000032d0: 696e 6561 7228 7365 6c66 2e6e 5f74 6173  inear(self.n_tas
-000032e0: 6b73 290a 0a20 2020 2064 6566 2066 6f72  ks)..    def for
-000032f0: 7761 7264 2873 656c 662c 2069 6e70 7574  ward(self, input
-00003300: 733a 204f 6e65 4f72 4d61 6e79 5b74 6f72  s: OneOrMany[tor
-00003310: 6368 2e54 656e 736f 725d 2920 2d3e 204c  ch.Tensor]) -> L
-00003320: 6973 745b 416e 795d 3a0a 2020 2020 2020  ist[Any]:.      
-00003330: 2020 2222 220a 2020 2020 2020 2020 5061    """.        Pa
-00003340: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00003350: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00003360: 2020 2020 783a 2074 6f72 6368 2e54 656e      x: torch.Ten
-00003370: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00003380: 496e 7075 7420 5465 6e73 6f72 0a20 2020  Input Tensor.   
-00003390: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-000033a0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-000033b0: 2020 2020 2074 6f72 6368 2e54 656e 736f       torch.Tenso
-000033c0: 720a 2020 2020 2020 2020 2020 2020 4f75  r.            Ou
-000033d0: 7470 7574 2061 7320 7065 7220 7573 6520  tput as per use 
-000033e0: 6361 7365 203a 2072 6567 7265 7373 696f  case : regressio
-000033f0: 6e2f 636c 6173 7369 6669 6361 7469 6f6e  n/classification
-00003400: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00003410: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00003420: 6365 2869 6e70 7574 732c 2074 6f72 6368  ce(inputs, torch
-00003430: 2e54 656e 736f 7229 3a0a 2020 2020 2020  .Tensor):.      
-00003440: 2020 2020 2020 782c 2064 726f 706f 7574        x, dropout
-00003450: 5f73 7769 7463 6820 3d20 696e 7075 7473  _switch = inputs
-00003460: 2c20 4e6f 6e65 0a20 2020 2020 2020 2065  , None.        e
-00003470: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00003480: 2078 2c20 6472 6f70 6f75 745f 7377 6974   x, dropout_swit
-00003490: 6368 203d 2069 6e70 7574 730a 0a20 2020  ch = inputs..   
-000034a0: 2020 2020 2078 203d 2074 6f72 6368 2e74       x = torch.t
-000034b0: 7261 6e73 706f 7365 2878 2c20 312c 202d  ranspose(x, 1, -
-000034c0: 3129 2020 2320 6e20 6820 7720 6320 2d3e  1)  # n h w c ->
-000034d0: 206e 2063 2068 2077 0a0a 2020 2020 2020   n c h w..      
-000034e0: 2020 7072 6576 5f6c 6179 6572 203d 2078    prev_layer = x
-000034f0: 0a0a 2020 2020 2020 2020 666f 7220 6c61  ..        for la
-00003500: 7965 722c 2061 6374 6976 6174 696f 6e5f  yer, activation_
-00003510: 666e 2c20 6472 6f70 6f75 7420 696e 207a  fn, dropout in z
-00003520: 6970 2873 656c 662e 6c61 7965 7273 2c0a  ip(self.layers,.
-00003530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000240: 6765 745f 6163 7469 7661 7469 6f6e 2c20  get_activation, 
+00000250: 7365 676d 656e 745f 7375 6d0a 6672 6f6d  segment_sum.from
+00000260: 2074 6f72 6368 2e6e 6e20 696d 706f 7274   torch.nn import
+00000270: 2069 6e69 7420 6173 2069 6e69 7469 616c   init as initial
+00000280: 697a 6572 730a 0a0a 636c 6173 7320 4d75  izers...class Mu
+00000290: 6c74 696c 6179 6572 5065 7263 6570 7472  ltilayerPerceptr
+000002a0: 6f6e 286e 6e2e 4d6f 6475 6c65 293a 0a20  on(nn.Module):. 
+000002b0: 2020 2022 2222 4120 7369 6d70 6c65 2066     """A simple f
+000002c0: 756c 6c79 2063 6f6e 6e65 6374 6564 2066  ully connected f
+000002d0: 6565 642d 666f 7277 6172 6420 6e65 7477  eed-forward netw
+000002e0: 6f72 6b2c 206f 7468 6572 7769 7365 206b  ork, otherwise k
+000002f0: 6e6f 776e 2061 7320 6120 6d75 6c74 696c  nown as a multil
+00000300: 6179 6572 2070 6572 6365 7074 726f 6e20  ayer perceptron 
+00000310: 284d 4c50 292e 0a0a 2020 2020 4578 616d  (MLP)...    Exam
+00000320: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
+00000330: 2d0a 2020 2020 3e3e 3e20 6d6f 6465 6c20  -.    >>> model 
+00000340: 3d20 4d75 6c74 696c 6179 6572 5065 7263  = MultilayerPerc
+00000350: 6570 7472 6f6e 2864 5f69 6e70 7574 3d31  eptron(d_input=1
+00000360: 302c 2064 5f68 6964 6465 6e3d 2832 2c33  0, d_hidden=(2,3
+00000370: 292c 2064 5f6f 7574 7075 743d 322c 2064  ), d_output=2, d
+00000380: 726f 706f 7574 3d30 2e30 2c20 6163 7469  ropout=0.0, acti
+00000390: 7661 7469 6f6e 5f66 6e3d 2772 656c 7527  vation_fn='relu'
+000003a0: 290a 2020 2020 3e3e 3e20 7820 3d20 746f  ).    >>> x = to
+000003b0: 7263 682e 6f6e 6573 2832 2c20 3130 290a  rch.ones(2, 10).
+000003c0: 2020 2020 3e3e 3e20 6f75 7420 3d20 6d6f      >>> out = mo
+000003d0: 6465 6c28 7829 0a20 2020 203e 3e3e 2070  del(x).    >>> p
+000003e0: 7269 6e74 286f 7574 2e73 6861 7065 290a  rint(out.shape).
+000003f0: 2020 2020 746f 7263 682e 5369 7a65 285b      torch.Size([
+00000400: 322c 2032 5d29 0a20 2020 2022 2222 0a0a  2, 2]).    """..
+00000410: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00000420: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+00000430: 2020 2020 2020 2020 645f 696e 7075 743a          d_input:
+00000440: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
+00000450: 2020 2020 2020 2064 5f6f 7574 7075 743a         d_output:
+00000460: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
+00000470: 2020 2020 2020 2064 5f68 6964 6465 6e3a         d_hidden:
+00000480: 204f 7074 696f 6e61 6c5b 7475 706c 655d   Optional[tuple]
+00000490: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000004a0: 2020 2020 2020 2020 2020 6472 6f70 6f75            dropou
+000004b0: 743a 2066 6c6f 6174 203d 2030 2e30 2c0a  t: float = 0.0,.
+000004c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000004d0: 2062 6174 6368 5f6e 6f72 6d3a 2062 6f6f   batch_norm: boo
+000004e0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+000004f0: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+00000500: 685f 6e6f 726d 5f6d 6f6d 656e 7475 6d3a  h_norm_momentum:
+00000510: 2066 6c6f 6174 203d 2030 2e31 2c0a 2020   float = 0.1,.  
+00000520: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00000530: 6374 6976 6174 696f 6e5f 666e 3a20 556e  ctivation_fn: Un
+00000540: 696f 6e5b 4361 6c6c 6162 6c65 2c20 7374  ion[Callable, st
+00000550: 725d 203d 2027 7265 6c75 272c 0a20 2020  r] = 'relu',.   
+00000560: 2020 2020 2020 2020 2020 2020 2020 736b                sk
+00000570: 6970 5f63 6f6e 6e65 6374 696f 6e3a 2062  ip_connection: b
+00000580: 6f6f 6c20 3d20 4661 6c73 6529 3a0a 2020  ool = False):.  
+00000590: 2020 2020 2020 2222 2249 6e69 7469 616c        """Initial
+000005a0: 697a 6520 7468 6520 6d6f 6465 6c2e 0a0a  ize the model...
+000005b0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+000005c0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+000005d0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 645f  -----.        d_
+000005e0: 696e 7075 743a 2069 6e74 0a20 2020 2020  input: int.     
+000005f0: 2020 2020 2020 2074 6865 2064 696d 656e         the dimen
+00000600: 7369 6f6e 206f 6620 7468 6520 696e 7075  sion of the inpu
+00000610: 7420 6c61 7965 720a 2020 2020 2020 2020  t layer.        
+00000620: 645f 6f75 7470 7574 3a20 696e 740a 2020  d_output: int.  
+00000630: 2020 2020 2020 2020 2020 7468 6520 6469            the di
+00000640: 6d65 6e73 696f 6e20 6f66 2074 6865 206f  mension of the o
+00000650: 7574 7075 7420 6c61 7965 720a 2020 2020  utput layer.    
+00000660: 2020 2020 645f 6869 6464 656e 3a20 7475      d_hidden: tu
+00000670: 706c 650a 2020 2020 2020 2020 2020 2020  ple.            
+00000680: 7468 6520 6469 6d65 6e73 696f 6e73 206f  the dimensions o
+00000690: 6620 7468 6520 6869 6464 656e 206c 6179  f the hidden lay
+000006a0: 6572 730a 2020 2020 2020 2020 6472 6f70  ers.        drop
+000006b0: 6f75 743a 2066 6c6f 6174 0a20 2020 2020  out: float.     
+000006c0: 2020 2020 2020 2074 6865 2064 726f 706f         the dropo
+000006d0: 7574 2070 726f 6261 6269 6c69 7479 0a20  ut probability. 
+000006e0: 2020 2020 2020 2062 6174 6368 5f6e 6f72         batch_nor
+000006f0: 6d3a 2062 6f6f 6c0a 2020 2020 2020 2020  m: bool.        
+00000700: 2020 2020 7768 6574 6865 7220 746f 2075      whether to u
+00000710: 7365 2062 6174 6368 206e 6f72 6d61 6c69  se batch normali
+00000720: 7a61 7469 6f6e 0a20 2020 2020 2020 2062  zation.        b
+00000730: 6174 6368 5f6e 6f72 6d5f 6d6f 6d65 6e74  atch_norm_moment
+00000740: 756d 3a20 666c 6f61 740a 2020 2020 2020  um: float.      
+00000750: 2020 2020 2020 7468 6520 6d6f 6d65 6e74        the moment
+00000760: 756d 2066 6f72 2062 6174 6368 206e 6f72  um for batch nor
+00000770: 6d61 6c69 7a61 7469 6f6e 0a20 2020 2020  malization.     
+00000780: 2020 2061 6374 6976 6174 696f 6e5f 666e     activation_fn
+00000790: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+000007a0: 2020 7468 6520 6163 7469 7661 7469 6f6e    the activation
+000007b0: 2066 756e 6374 696f 6e20 746f 2075 7365   function to use
+000007c0: 2069 6e20 7468 6520 6869 6464 656e 206c   in the hidden l
+000007d0: 6179 6572 730a 2020 2020 2020 2020 736b  ayers.        sk
+000007e0: 6970 5f63 6f6e 6e65 6374 696f 6e3a 2062  ip_connection: b
+000007f0: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
+00000800: 7768 6574 6865 7220 746f 2061 6464 2061  whether to add a
+00000810: 2073 6b69 7020 636f 6e6e 6563 7469 6f6e   skip connection
+00000820: 2066 726f 6d20 7468 6520 696e 7075 7420   from the input 
+00000830: 746f 2074 6865 206f 7574 7075 740a 2020  to the output.  
+00000840: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00000850: 2020 7375 7065 7228 4d75 6c74 696c 6179    super(Multilay
+00000860: 6572 5065 7263 6570 7472 6f6e 2c20 7365  erPerceptron, se
+00000870: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a20  lf).__init__(). 
+00000880: 2020 2020 2020 2073 656c 662e 645f 696e         self.d_in
+00000890: 7075 7420 3d20 645f 696e 7075 740a 2020  put = d_input.  
+000008a0: 2020 2020 2020 7365 6c66 2e64 5f68 6964        self.d_hid
+000008b0: 6465 6e20 3d20 645f 6869 6464 656e 0a20  den = d_hidden. 
+000008c0: 2020 2020 2020 2073 656c 662e 645f 6f75         self.d_ou
+000008d0: 7470 7574 203d 2064 5f6f 7574 7075 740a  tput = d_output.
+000008e0: 2020 2020 2020 2020 7365 6c66 2e64 726f          self.dro
+000008f0: 706f 7574 203d 206e 6e2e 4472 6f70 6f75  pout = nn.Dropou
+00000900: 7428 6472 6f70 6f75 7429 0a20 2020 2020  t(dropout).     
+00000910: 2020 2073 656c 662e 6261 7463 685f 6e6f     self.batch_no
+00000920: 726d 203d 2062 6174 6368 5f6e 6f72 6d0a  rm = batch_norm.
+00000930: 2020 2020 2020 2020 7365 6c66 2e62 6174          self.bat
+00000940: 6368 5f6e 6f72 6d5f 6d6f 6d65 6e74 756d  ch_norm_momentum
+00000950: 203d 2062 6174 6368 5f6e 6f72 6d5f 6d6f   = batch_norm_mo
+00000960: 6d65 6e74 756d 0a20 2020 2020 2020 2073  mentum.        s
+00000970: 656c 662e 6163 7469 7661 7469 6f6e 5f66  elf.activation_f
+00000980: 6e20 3d20 6765 745f 6163 7469 7661 7469  n = get_activati
+00000990: 6f6e 2861 6374 6976 6174 696f 6e5f 666e  on(activation_fn
+000009a0: 290a 2020 2020 2020 2020 7365 6c66 2e6d  ).        self.m
+000009b0: 6f64 656c 203d 206e 6e2e 5365 7175 656e  odel = nn.Sequen
+000009c0: 7469 616c 282a 7365 6c66 2e62 7569 6c64  tial(*self.build
+000009d0: 5f6c 6179 6572 7328 2929 0a20 2020 2020  _layers()).     
+000009e0: 2020 2073 656c 662e 736b 6970 203d 206e     self.skip = n
+000009f0: 6e2e 4c69 6e65 6172 2864 5f69 6e70 7574  n.Linear(d_input
+00000a00: 2c20 645f 6f75 7470 7574 2920 6966 2073  , d_output) if s
+00000a10: 6b69 705f 636f 6e6e 6563 7469 6f6e 2065  kip_connection e
+00000a20: 6c73 6520 4e6f 6e65 0a0a 2020 2020 6465  lse None..    de
+00000a30: 6620 6275 696c 645f 6c61 7965 7273 2873  f build_layers(s
+00000a40: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00000a50: 220a 2020 2020 2020 2020 4275 696c 6420  ".        Build 
+00000a60: 7468 6520 6c61 7965 7273 206f 6620 7468  the layers of th
+00000a70: 6520 6d6f 6465 6c2c 2069 7465 7261 7469  e model, iterati
+00000a80: 6e67 2074 6872 6f75 6768 2074 6865 2068  ng through the h
+00000a90: 6964 6465 6e20 6469 6d65 6e73 696f 6e73  idden dimensions
+00000aa0: 2074 6f20 7072 6f64 7563 6520 6120 6c69   to produce a li
+00000ab0: 7374 206f 6620 6c61 7965 7273 2e0a 2020  st of layers..  
+00000ac0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00000ad0: 2020 206c 6179 6572 5f6c 6973 7420 3d20     layer_list = 
+00000ae0: 5b5d 0a20 2020 2020 2020 206c 6179 6572  [].        layer
+00000af0: 5f64 696d 203d 2073 656c 662e 645f 696e  _dim = self.d_in
+00000b00: 7075 740a 2020 2020 2020 2020 6966 2073  put.        if s
+00000b10: 656c 662e 645f 6869 6464 656e 2069 7320  elf.d_hidden is 
+00000b20: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00000b30: 2020 2020 2020 666f 7220 6420 696e 2073        for d in s
+00000b40: 656c 662e 645f 6869 6464 656e 3a0a 2020  elf.d_hidden:.  
+00000b50: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00000b60: 7965 725f 6c69 7374 2e61 7070 656e 6428  yer_list.append(
+00000b70: 6e6e 2e4c 696e 6561 7228 6c61 7965 725f  nn.Linear(layer_
+00000b80: 6469 6d2c 2064 2929 0a20 2020 2020 2020  dim, d)).       
+00000b90: 2020 2020 2020 2020 206c 6179 6572 5f6c           layer_l
+00000ba0: 6973 742e 6170 7065 6e64 2873 656c 662e  ist.append(self.
+00000bb0: 6472 6f70 6f75 7429 0a20 2020 2020 2020  dropout).       
+00000bc0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00000bd0: 2e62 6174 6368 5f6e 6f72 6d3a 0a20 2020  .batch_norm:.   
+00000be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000bf0: 206c 6179 6572 5f6c 6973 742e 6170 7065   layer_list.appe
+00000c00: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+00000c10: 2020 2020 2020 2020 2020 2020 6e6e 2e42              nn.B
+00000c20: 6174 6368 4e6f 726d 3164 2864 2c20 6d6f  atchNorm1d(d, mo
+00000c30: 6d65 6e74 756d 3d73 656c 662e 6261 7463  mentum=self.batc
+00000c40: 685f 6e6f 726d 5f6d 6f6d 656e 7475 6d29  h_norm_momentum)
+00000c50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00000c60: 2020 6c61 7965 725f 6469 6d20 3d20 640a    layer_dim = d.
+00000c70: 2020 2020 2020 2020 6c61 7965 725f 6c69          layer_li
+00000c80: 7374 2e61 7070 656e 6428 6e6e 2e4c 696e  st.append(nn.Lin
+00000c90: 6561 7228 6c61 7965 725f 6469 6d2c 2073  ear(layer_dim, s
+00000ca0: 656c 662e 645f 6f75 7470 7574 2929 0a20  elf.d_output)). 
+00000cb0: 2020 2020 2020 2072 6574 7572 6e20 6c61         return la
+00000cc0: 7965 725f 6c69 7374 0a0a 2020 2020 6465  yer_list..    de
+00000cd0: 6620 666f 7277 6172 6428 7365 6c66 2c20  f forward(self, 
+00000ce0: 783a 2054 656e 736f 7229 202d 3e20 5465  x: Tensor) -> Te
+00000cf0: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
+00000d00: 2246 6f72 7761 7264 2070 6173 7320 6f66  "Forward pass of
+00000d10: 2074 6865 206d 6f64 656c 2e22 2222 0a20   the model.""". 
+00000d20: 2020 2020 2020 2069 6e70 7574 203d 2078         input = x
+00000d30: 0a20 2020 2020 2020 2066 6f72 206c 6179  .        for lay
+00000d40: 6572 2069 6e20 7365 6c66 2e6d 6f64 656c  er in self.model
+00000d50: 3a0a 2020 2020 2020 2020 2020 2020 7820  :.            x 
+00000d60: 3d20 6c61 7965 7228 7829 0a20 2020 2020  = layer(x).     
+00000d70: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00000d80: 616e 6365 286c 6179 6572 2c20 6e6e 2e4c  ance(layer, nn.L
+00000d90: 696e 6561 7229 3a0a 2020 2020 2020 2020  inear):.        
+00000da0: 2020 2020 2020 2020 7820 3d20 7365 6c66          x = self
+00000db0: 2e61 6374 6976 6174 696f 6e5f 666e 280a  .activation_fn(.
+00000dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000dd0: 2020 2020 780a 2020 2020 2020 2020 2020      x.          
+00000de0: 2020 2020 2020 2920 2023 2044 6f6e 6520        )  # Done 
+00000df0: 6265 6361 7573 6520 6163 7469 7661 7469  because activati
+00000e00: 6f6e 5f66 6e20 7265 7475 726e 7320 6120  on_fn returns a 
+00000e10: 746f 7263 682e 6e6e 2e66 756e 6374 696f  torch.nn.functio
+00000e20: 6e61 6c0a 2020 2020 2020 2020 6966 2073  nal.        if s
+00000e30: 656c 662e 736b 6970 2069 7320 6e6f 7420  elf.skip is not 
+00000e40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00000e50: 2020 7265 7475 726e 2078 202b 2073 656c    return x + sel
+00000e60: 662e 736b 6970 2869 6e70 7574 290a 2020  f.skip(input).  
+00000e70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00000e80: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+00000e90: 0a0a 0a63 6c61 7373 2043 4e4e 4d6f 6475  ...class CNNModu
+00000ea0: 6c65 286e 6e2e 4d6f 6475 6c65 293a 0a20  le(nn.Module):. 
+00000eb0: 2020 2022 2222 4120 312c 2032 2c20 6f72     """A 1, 2, or
+00000ec0: 2033 2064 696d 656e 7369 6f6e 616c 2063   3 dimensional c
+00000ed0: 6f6e 766f 6c75 7469 6f6e 616c 206e 6574  onvolutional net
+00000ee0: 776f 726b 2066 6f72 2065 6974 6865 7220  work for either 
+00000ef0: 7265 6772 6573 7369 6f6e 206f 7220 636c  regression or cl
+00000f00: 6173 7369 6669 6361 7469 6f6e 2e0a 2020  assification..  
+00000f10: 2020 5468 6520 6e65 7477 6f72 6b20 636f    The network co
+00000f20: 6e73 6973 7473 206f 6620 7468 6520 666f  nsists of the fo
+00000f30: 6c6c 6f77 696e 6720 7365 7175 656e 6365  llowing sequence
+00000f40: 206f 6620 6c61 7965 7273 3a0a 2020 2020   of layers:.    
+00000f50: 2d20 4120 636f 6e66 6967 7572 6162 6c65  - A configurable
+00000f60: 206e 756d 6265 7220 6f66 2063 6f6e 766f   number of convo
+00000f70: 6c75 7469 6f6e 616c 206c 6179 6572 730a  lutional layers.
+00000f80: 2020 2020 2d20 4120 676c 6f62 616c 2070      - A global p
+00000f90: 6f6f 6c69 6e67 206c 6179 6572 2028 6569  ooling layer (ei
+00000fa0: 7468 6572 206d 6178 2070 6f6f 6c20 6f72  ther max pool or
+00000fb0: 2061 7665 7261 6765 2070 6f6f 6c29 0a20   average pool). 
+00000fc0: 2020 202d 2041 2066 696e 616c 2066 756c     - A final ful
+00000fd0: 6c79 2063 6f6e 6e65 6374 6564 206c 6179  ly connected lay
+00000fe0: 6572 2074 6f20 636f 6d70 7574 6520 7468  er to compute th
+00000ff0: 6520 6f75 7470 7574 0a20 2020 2049 7420  e output.    It 
+00001000: 6f70 7469 6f6e 616c 6c79 2063 616e 2063  optionally can c
+00001010: 6f6d 706f 7365 2074 6865 206d 6f64 656c  ompose the model
+00001020: 2066 726f 6d20 7072 652d 6163 7469 7661   from pre-activa
+00001030: 7469 6f6e 2072 6573 6964 7561 6c20 626c  tion residual bl
+00001040: 6f63 6b73 2c20 6173 0a20 2020 2064 6573  ocks, as.    des
+00001050: 6372 6962 6564 2069 6e20 6874 7470 733a  cribed in https:
+00001060: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
+00001070: 3136 3033 2e30 3530 3237 2c20 7261 7468  1603.05027, rath
+00001080: 6572 2074 6861 6e20 6120 7369 6d70 6c65  er than a simple
+00001090: 2073 7461 636b 206f 660a 2020 2020 636f   stack of.    co
+000010a0: 6e76 6f6c 7574 696f 6e20 6c61 7965 7273  nvolution layers
+000010b0: 2e20 2054 6869 7320 6f66 7465 6e20 6c65  .  This often le
+000010c0: 6164 7320 746f 2065 6173 6965 7220 7472  ads to easier tr
+000010d0: 6169 6e69 6e67 2c20 6573 7065 6369 616c  aining, especial
+000010e0: 6c79 2077 6865 6e20 7573 696e 6720 610a  ly when using a.
+000010f0: 2020 2020 6c61 7267 6520 6e75 6d62 6572      large number
+00001100: 206f 6620 6c61 7965 7273 2e20 204e 6f74   of layers.  Not
+00001110: 6520 7468 6174 2072 6573 6964 7561 6c20  e that residual 
+00001120: 626c 6f63 6b73 2063 616e 206f 6e6c 7920  blocks can only 
+00001130: 6265 2075 7365 6420 7768 656e 0a20 2020  be used when.   
+00001140: 2073 7563 6365 7373 6976 6520 6c61 7965   successive laye
+00001150: 7273 2068 6176 6520 7468 6520 7361 6d65  rs have the same
+00001160: 206f 7574 7075 7420 7368 6170 652e 2020   output shape.  
+00001170: 5768 6572 6576 6572 2074 6865 206f 7574  Wherever the out
+00001180: 7075 7420 7368 6170 6520 6368 616e 6765  put shape change
+00001190: 732c 2061 0a20 2020 2073 696d 706c 6520  s, a.    simple 
+000011a0: 636f 6e76 6f6c 7574 696f 6e20 6c61 7965  convolution laye
+000011b0: 7220 7769 6c6c 2062 6520 7573 6564 2065  r will be used e
+000011c0: 7665 6e20 6966 2072 6573 6964 7561 6c3d  ven if residual=
+000011d0: 5472 7565 2e0a 2020 2020 4578 616d 706c  True..    Exampl
+000011e0: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
+000011f0: 2020 2020 3e3e 3e20 6d6f 6465 6c20 3d20      >>> model = 
+00001200: 434e 4e4d 6f64 756c 6528 6e5f 7461 736b  CNNModule(n_task
+00001210: 733d 352c 206e 5f66 6561 7475 7265 733d  s=5, n_features=
+00001220: 382c 2064 696d 733d 322c 206c 6179 6572  8, dims=2, layer
+00001230: 5f66 696c 7465 7273 3d5b 332c 382c 382c  _filters=[3,8,8,
+00001240: 3136 5d2c 206b 6572 6e65 6c5f 7369 7a65  16], kernel_size
+00001250: 3d33 2c20 6e5f 636c 6173 7365 7320 3d20  =3, n_classes = 
+00001260: 372c 206d 6f64 653d 2763 6c61 7373 6966  7, mode='classif
+00001270: 6963 6174 696f 6e27 2c20 756e 6365 7274  ication', uncert
+00001280: 6169 6e74 793d 4661 6c73 652c 2070 6164  ainty=False, pad
+00001290: 6469 6e67 3d27 7361 6d65 2729 0a20 2020  ding='same').   
+000012a0: 203e 3e3e 2078 203d 2074 6f72 6368 2e6f   >>> x = torch.o
+000012b0: 6e65 7328 322c 2032 3234 2c20 3232 342c  nes(2, 224, 224,
+000012c0: 2038 290a 2020 2020 3e3e 3e20 7820 3d20   8).    >>> x = 
+000012d0: 6d6f 6465 6c28 7829 0a20 2020 203e 3e3e  model(x).    >>>
+000012e0: 2066 6f72 2074 656e 736f 7220 696e 2078   for tensor in x
+000012f0: 3a0a 2020 2020 2e2e 2e20 2020 2070 7269  :.    ...    pri
+00001300: 6e74 2874 656e 736f 722e 7368 6170 6529  nt(tensor.shape)
+00001310: 0a20 2020 2074 6f72 6368 2e53 697a 6528  .    torch.Size(
+00001320: 5b32 2c20 352c 2037 5d29 0a20 2020 2074  [2, 5, 7]).    t
+00001330: 6f72 6368 2e53 697a 6528 5b32 2c20 352c  orch.Size([2, 5,
+00001340: 2037 5d29 0a20 2020 2022 2222 0a0a 2020   7]).    """..  
+00001350: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+00001360: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+00001370: 2020 2020 2020 6e5f 7461 736b 733a 2069        n_tasks: i
+00001380: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+00001390: 2020 2020 206e 5f66 6561 7475 7265 733a       n_features:
+000013a0: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
+000013b0: 2020 2020 2020 2064 696d 733a 2069 6e74         dims: int
+000013c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000013d0: 2020 206c 6179 6572 5f66 696c 7465 7273     layer_filters
+000013e0: 3a20 4c69 7374 5b69 6e74 5d20 3d20 5b31  : List[int] = [1
+000013f0: 3030 5d2c 0a20 2020 2020 2020 2020 2020  00],.           
+00001400: 2020 2020 2020 6b65 726e 656c 5f73 697a        kernel_siz
+00001410: 653a 204f 6e65 4f72 4d61 6e79 5b69 6e74  e: OneOrMany[int
+00001420: 5d20 3d20 352c 0a20 2020 2020 2020 2020  ] = 5,.         
+00001430: 2020 2020 2020 2020 7374 7269 6465 733a          strides:
+00001440: 204f 6e65 4f72 4d61 6e79 5b69 6e74 5d20   OneOrMany[int] 
+00001450: 3d20 312c 0a20 2020 2020 2020 2020 2020  = 1,.           
+00001460: 2020 2020 2020 7765 6967 6874 5f69 6e69        weight_ini
+00001470: 745f 7374 6464 6576 733a 204f 6e65 4f72  t_stddevs: OneOr
+00001480: 4d61 6e79 5b66 6c6f 6174 5d20 3d20 302e  Many[float] = 0.
+00001490: 3032 2c0a 2020 2020 2020 2020 2020 2020  02,.            
+000014a0: 2020 2020 2062 6961 735f 696e 6974 5f63       bias_init_c
+000014b0: 6f6e 7374 733a 204f 6e65 4f72 4d61 6e79  onsts: OneOrMany
+000014c0: 5b66 6c6f 6174 5d20 3d20 312e 302c 0a20  [float] = 1.0,. 
+000014d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014e0: 6472 6f70 6f75 7473 3a20 4f6e 654f 724d  dropouts: OneOrM
+000014f0: 616e 795b 666c 6f61 745d 203d 2030 2e35  any[float] = 0.5
+00001500: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00001510: 2020 2061 6374 6976 6174 696f 6e5f 666e     activation_fn
+00001520: 733a 204f 6e65 4f72 4d61 6e79 5b41 6374  s: OneOrMany[Act
+00001530: 6976 6174 696f 6e46 6e5d 203d 2027 7265  ivationFn] = 're
+00001540: 6c75 272c 0a20 2020 2020 2020 2020 2020  lu',.           
+00001550: 2020 2020 2020 706f 6f6c 5f74 7970 653a        pool_type:
+00001560: 2073 7472 203d 2027 6d61 7827 2c0a 2020   str = 'max',.  
+00001570: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00001580: 6f64 653a 2073 7472 203d 2027 636c 6173  ode: str = 'clas
+00001590: 7369 6669 6361 7469 6f6e 272c 0a20 2020  sification',.   
+000015a0: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
+000015b0: 636c 6173 7365 733a 2069 6e74 203d 2032  classes: int = 2
+000015c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000015d0: 2020 2075 6e63 6572 7461 696e 7479 3a20     uncertainty: 
+000015e0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+000015f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00001600: 6573 6964 7561 6c3a 2062 6f6f 6c20 3d20  esidual: bool = 
+00001610: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+00001620: 2020 2020 2020 2020 7061 6464 696e 673a          padding:
+00001630: 2055 6e69 6f6e 5b69 6e74 2c20 7374 725d   Union[int, str]
+00001640: 203d 2027 7661 6c69 6427 2920 2d3e 204e   = 'valid') -> N
+00001650: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00001660: 4372 6561 7465 2061 2043 4e4e 2e0a 0a20  Create a CNN... 
+00001670: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00001680: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00001690: 2d2d 2d2d 0a20 2020 2020 2020 206e 5f74  ----.        n_t
+000016a0: 6173 6b73 3a20 696e 740a 2020 2020 2020  asks: int.      
+000016b0: 2020 2020 2020 6e75 6d62 6572 206f 6620        number of 
+000016c0: 7461 736b 730a 2020 2020 2020 2020 6e5f  tasks.        n_
+000016d0: 6665 6174 7572 6573 3a20 696e 740a 2020  features: int.  
+000016e0: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
+000016f0: 206f 6620 6665 6174 7572 6573 0a20 2020   of features.   
+00001700: 2020 2020 2064 696d 733a 2069 6e74 0a20       dims: int. 
+00001710: 2020 2020 2020 2020 2020 2074 6865 206e             the n
+00001720: 756d 6265 7220 6f66 2064 696d 656e 7369  umber of dimensi
+00001730: 6f6e 7320 746f 2061 7070 6c79 2063 6f6e  ons to apply con
+00001740: 766f 6c75 7469 6f6e 7320 6f76 6572 2028  volutions over (
+00001750: 312c 2032 2c20 6f72 2033 290a 2020 2020  1, 2, or 3).    
+00001760: 2020 2020 6c61 7965 725f 6669 6c74 6572      layer_filter
+00001770: 733a 206c 6973 740a 2020 2020 2020 2020  s: list.        
+00001780: 2020 2020 7468 6520 6e75 6d62 6572 206f      the number o
+00001790: 6620 6f75 7470 7574 2066 696c 7465 7273  f output filters
+000017a0: 2066 6f72 2065 6163 6820 636f 6e76 6f6c   for each convol
+000017b0: 7574 696f 6e61 6c20 6c61 7965 7220 696e  utional layer in
+000017c0: 2074 6865 206e 6574 776f 726b 2e0a 2020   the network..  
+000017d0: 2020 2020 2020 2020 2020 5468 6520 6c65            The le
+000017e0: 6e67 7468 206f 6620 7468 6973 206c 6973  ngth of this lis
+000017f0: 7420 6465 7465 726d 696e 6573 2074 6865  t determines the
+00001800: 206e 756d 6265 7220 6f66 206c 6179 6572   number of layer
+00001810: 732e 0a20 2020 2020 2020 206b 6572 6e65  s..        kerne
+00001820: 6c5f 7369 7a65 3a20 696e 742c 2074 7570  l_size: int, tup
+00001830: 6c65 2c20 6f72 206c 6973 740a 2020 2020  le, or list.    
+00001840: 2020 2020 2020 2020 6120 6c69 7374 2067          a list g
+00001850: 6976 696e 6720 7468 6520 7368 6170 6520  iving the shape 
+00001860: 6f66 2074 6865 2063 6f6e 766f 6c75 7469  of the convoluti
+00001870: 6f6e 616c 206b 6572 6e65 6c20 666f 7220  onal kernel for 
+00001880: 6561 6368 206c 6179 6572 2e20 2045 6163  each layer.  Eac
+00001890: 680a 2020 2020 2020 2020 2020 2020 656c  h.            el
+000018a0: 656d 656e 7420 6d61 7920 6265 2065 6974  ement may be eit
+000018b0: 6865 7220 616e 2069 6e74 2028 7573 6520  her an int (use 
+000018c0: 7468 6520 7361 6d65 206b 6572 6e65 6c20  the same kernel 
+000018d0: 7769 6474 6820 666f 7220 6576 6572 7920  width for every 
+000018e0: 6469 6d65 6e73 696f 6e29 0a20 2020 2020  dimension).     
+000018f0: 2020 2020 2020 206f 7220 6120 7475 706c         or a tupl
+00001900: 6520 2874 6865 206b 6572 6e65 6c20 7769  e (the kernel wi
+00001910: 6474 6820 616c 6f6e 6720 6561 6368 2064  dth along each d
+00001920: 696d 656e 7369 6f6e 292e 2020 416c 7465  imension).  Alte
+00001930: 726e 6174 6976 656c 7920 7468 6973 206d  rnatively this m
+00001940: 6179 0a20 2020 2020 2020 2020 2020 2062  ay.            b
+00001950: 6520 6120 7369 6e67 6c65 2069 6e74 206f  e a single int o
+00001960: 7220 7475 706c 6520 696e 7374 6561 6420  r tuple instead 
+00001970: 6f66 2061 206c 6973 742c 2069 6e20 7768  of a list, in wh
+00001980: 6963 6820 6361 7365 2074 6865 2073 616d  ich case the sam
+00001990: 6520 6b65 726e 656c 0a20 2020 2020 2020  e kernel.       
+000019a0: 2020 2020 2073 6861 7065 2069 7320 7573       shape is us
+000019b0: 6564 2066 6f72 2065 7665 7279 206c 6179  ed for every lay
+000019c0: 6572 2e0a 2020 2020 2020 2020 7374 7269  er..        stri
+000019d0: 6465 733a 2069 6e74 2c20 7475 706c 652c  des: int, tuple,
+000019e0: 206f 7220 6c69 7374 0a20 2020 2020 2020   or list.       
+000019f0: 2020 2020 2061 206c 6973 7420 6769 7669       a list givi
+00001a00: 6e67 2074 6865 2073 7472 6964 6520 6265  ng the stride be
+00001a10: 7477 6565 6e20 6170 706c 6963 6174 696f  tween applicatio
+00001a20: 6e73 206f 6620 7468 6520 206b 6572 6e65  ns of the  kerne
+00001a30: 6c20 666f 7220 6561 6368 206c 6179 6572  l for each layer
+00001a40: 2e0a 2020 2020 2020 2020 2020 2020 4561  ..            Ea
+00001a50: 6368 2065 6c65 6d65 6e74 206d 6179 2062  ch element may b
+00001a60: 6520 6569 7468 6572 2061 6e20 696e 7420  e either an int 
+00001a70: 2875 7365 2074 6865 2073 616d 6520 7374  (use the same st
+00001a80: 7269 6465 2066 6f72 2065 7665 7279 2064  ride for every d
+00001a90: 696d 656e 7369 6f6e 290a 2020 2020 2020  imension).      
+00001aa0: 2020 2020 2020 6f72 2061 2074 7570 6c65        or a tuple
+00001ab0: 2028 7468 6520 7374 7269 6465 2061 6c6f   (the stride alo
+00001ac0: 6e67 2065 6163 6820 6469 6d65 6e73 696f  ng each dimensio
+00001ad0: 6e29 2e20 2041 6c74 6572 6e61 7469 7665  n).  Alternative
+00001ae0: 6c79 2074 6869 7320 6d61 7920 6265 2061  ly this may be a
+00001af0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+00001b00: 676c 6520 696e 7420 6f72 2074 7570 6c65  gle int or tuple
+00001b10: 2069 6e73 7465 6164 206f 6620 6120 6c69   instead of a li
+00001b20: 7374 2c20 696e 2077 6869 6368 2063 6173  st, in which cas
+00001b30: 6520 7468 6520 7361 6d65 2073 7472 6964  e the same strid
+00001b40: 6520 6973 0a20 2020 2020 2020 2020 2020  e is.           
+00001b50: 2075 7365 6420 666f 7220 6576 6572 7920   used for every 
+00001b60: 6c61 7965 722e 0a20 2020 2020 2020 2077  layer..        w
+00001b70: 6569 6768 745f 696e 6974 5f73 7464 6465  eight_init_stdde
+00001b80: 7673 3a20 6c69 7374 206f 7220 666c 6f61  vs: list or floa
+00001b90: 740a 2020 2020 2020 2020 2020 2020 7468  t.            th
+00001ba0: 6520 7374 616e 6461 7264 2064 6576 6961  e standard devia
+00001bb0: 7469 6f6e 206f 6620 7468 6520 6469 7374  tion of the dist
+00001bc0: 7269 6275 7469 6f6e 2074 6f20 7573 6520  ribution to use 
+00001bd0: 666f 7220 7765 6967 6874 2069 6e69 7469  for weight initi
+00001be0: 616c 697a 6174 696f 6e0a 2020 2020 2020  alization.      
+00001bf0: 2020 2020 2020 6f66 2065 6163 6820 6c61        of each la
+00001c00: 7965 722e 2020 5468 6520 6c65 6e67 7468  yer.  The length
+00001c10: 206f 6620 7468 6973 206c 6973 7420 7368   of this list sh
+00001c20: 6f75 6c64 2065 7175 616c 206c 656e 286c  ould equal len(l
+00001c30: 6179 6572 5f66 696c 7465 7273 292b 312c  ayer_filters)+1,
+00001c40: 0a20 2020 2020 2020 2020 2020 2077 6865  .            whe
+00001c50: 7265 2074 6865 2066 696e 616c 2065 6c65  re the final ele
+00001c60: 6d65 6e74 2063 6f72 7265 7370 6f6e 6473  ment corresponds
+00001c70: 2074 6f20 7468 6520 6465 6e73 6520 6c61   to the dense la
+00001c80: 7965 722e 2020 416c 7465 726e 6174 6976  yer.  Alternativ
+00001c90: 656c 7920 7468 6973 0a20 2020 2020 2020  ely this.       
+00001ca0: 2020 2020 206d 6179 2062 6520 6120 7369       may be a si
+00001cb0: 6e67 6c65 2076 616c 7565 2069 6e73 7465  ngle value inste
+00001cc0: 6164 206f 6620 6120 6c69 7374 2c20 696e  ad of a list, in
+00001cd0: 2077 6869 6368 2063 6173 6520 7468 6520   which case the 
+00001ce0: 7361 6d65 2076 616c 7565 2069 7320 7573  same value is us
+00001cf0: 6564 0a20 2020 2020 2020 2020 2020 2066  ed.            f
+00001d00: 6f72 2065 7665 7279 206c 6179 6572 2e0a  or every layer..
+00001d10: 2020 2020 2020 2020 6269 6173 5f69 6e69          bias_ini
+00001d20: 745f 636f 6e73 7473 3a20 6c69 7374 206f  t_consts: list o
+00001d30: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
+00001d40: 2020 2020 7468 6520 7661 6c75 6520 746f      the value to
+00001d50: 2069 6e69 7469 616c 697a 6520 7468 6520   initialize the 
+00001d60: 6269 6173 6573 2069 6e20 6561 6368 206c  biases in each l
+00001d70: 6179 6572 2074 6f2e 2020 5468 6520 6c65  ayer to.  The le
+00001d80: 6e67 7468 206f 6620 7468 6973 0a20 2020  ngth of this.   
+00001d90: 2020 2020 2020 2020 206c 6973 7420 7368           list sh
+00001da0: 6f75 6c64 2065 7175 616c 206c 656e 286c  ould equal len(l
+00001db0: 6179 6572 5f66 696c 7465 7273 292b 312c  ayer_filters)+1,
+00001dc0: 2077 6865 7265 2074 6865 2066 696e 616c   where the final
+00001dd0: 2065 6c65 6d65 6e74 2063 6f72 7265 7370   element corresp
+00001de0: 6f6e 6473 0a20 2020 2020 2020 2020 2020  onds.           
+00001df0: 2074 6f20 7468 6520 6465 6e73 6520 6c61   to the dense la
+00001e00: 7965 722e 2020 416c 7465 726e 6174 6976  yer.  Alternativ
+00001e10: 656c 7920 7468 6973 206d 6179 2062 6520  ely this may be 
+00001e20: 6120 7369 6e67 6c65 2076 616c 7565 2069  a single value i
+00001e30: 6e73 7465 6164 206f 6620 610a 2020 2020  nstead of a.    
+00001e40: 2020 2020 2020 2020 6c69 7374 2c20 696e          list, in
+00001e50: 2077 6869 6368 2063 6173 6520 7468 6520   which case the 
+00001e60: 7361 6d65 2076 616c 7565 2069 7320 7573  same value is us
+00001e70: 6564 2066 6f72 2065 7665 7279 206c 6179  ed for every lay
+00001e80: 6572 2e0a 2020 2020 2020 2020 6472 6f70  er..        drop
+00001e90: 6f75 7473 3a20 6c69 7374 206f 7220 666c  outs: list or fl
+00001ea0: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00001eb0: 7468 6520 6472 6f70 6f75 7420 7072 6f62  the dropout prob
+00001ec0: 6162 696c 6974 7920 746f 2075 7365 2066  ability to use f
+00001ed0: 6f72 2065 6163 6820 6c61 7965 722e 2020  or each layer.  
+00001ee0: 5468 6520 6c65 6e67 7468 206f 6620 7468  The length of th
+00001ef0: 6973 206c 6973 7420 7368 6f75 6c64 2065  is list should e
+00001f00: 7175 616c 206c 656e 286c 6179 6572 5f66  qual len(layer_f
+00001f10: 696c 7465 7273 292e 0a20 2020 2020 2020  ilters)..       
+00001f20: 2020 2020 2041 6c74 6572 6e61 7469 7665       Alternative
+00001f30: 6c79 2074 6869 7320 6d61 7920 6265 2061  ly this may be a
+00001f40: 2073 696e 676c 6520 7661 6c75 6520 696e   single value in
+00001f50: 7374 6561 6420 6f66 2061 206c 6973 742c  stead of a list,
+00001f60: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
+00001f70: 6865 2073 616d 6520 7661 6c75 6520 6973  he same value is
+00001f80: 2075 7365 6420 666f 7220 6576 6572 7920   used for every 
+00001f90: 6c61 7965 720a 2020 2020 2020 2020 6163  layer.        ac
+00001fa0: 7469 7661 7469 6f6e 5f66 6e73 3a20 7374  tivation_fns: st
+00001fb0: 7220 6f72 206c 6973 740a 2020 2020 2020  r or list.      
+00001fc0: 2020 2020 2020 7468 6520 746f 7263 6820        the torch 
+00001fd0: 6163 7469 7661 7469 6f6e 2066 756e 6374  activation funct
+00001fe0: 696f 6e20 746f 2061 7070 6c79 2074 6f20  ion to apply to 
+00001ff0: 6561 6368 206c 6179 6572 2e20 5468 6520  each layer. The 
+00002000: 6c65 6e67 7468 206f 6620 7468 6973 206c  length of this l
+00002010: 6973 7420 7368 6f75 6c64 2065 7175 616c  ist should equal
+00002020: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
+00002030: 286c 6179 6572 5f66 696c 7465 7273 292e  (layer_filters).
+00002040: 2020 416c 7465 726e 6174 6976 656c 7920    Alternatively 
+00002050: 7468 6973 206d 6179 2062 6520 6120 7369  this may be a si
+00002060: 6e67 6c65 2076 616c 7565 2069 6e73 7465  ngle value inste
+00002070: 6164 206f 6620 6120 6c69 7374 2c20 696e  ad of a list, in
+00002080: 2077 6869 6368 2063 6173 6520 7468 650a   which case the.
+00002090: 2020 2020 2020 2020 2020 2020 7361 6d65              same
+000020a0: 2076 616c 7565 2069 7320 7573 6564 2066   value is used f
+000020b0: 6f72 2065 7665 7279 206c 6179 6572 2c20  or every layer, 
+000020c0: 2772 656c 7527 2062 7920 6465 6661 756c  'relu' by defaul
+000020d0: 740a 2020 2020 2020 2020 706f 6f6c 5f74  t.        pool_t
+000020e0: 7970 653a 2073 7472 0a20 2020 2020 2020  ype: str.       
+000020f0: 2020 2020 2074 6865 2074 7970 6520 6f66       the type of
+00002100: 2070 6f6f 6c69 6e67 206c 6179 6572 2074   pooling layer t
+00002110: 6f20 7573 652c 2065 6974 6865 7220 276d  o use, either 'm
+00002120: 6178 2720 6f72 2027 6176 6572 6167 6527  ax' or 'average'
+00002130: 0a20 2020 2020 2020 206d 6f64 653a 2073  .        mode: s
+00002140: 7472 0a20 2020 2020 2020 2020 2020 2045  tr.            E
+00002150: 6974 6865 7220 2763 6c61 7373 6966 6963  ither 'classific
+00002160: 6174 696f 6e27 206f 7220 2772 6567 7265  ation' or 'regre
+00002170: 7373 696f 6e27 0a20 2020 2020 2020 206e  ssion'.        n
+00002180: 5f63 6c61 7373 6573 3a20 696e 740a 2020  _classes: int.  
+00002190: 2020 2020 2020 2020 2020 7468 6520 6e75            the nu
+000021a0: 6d62 6572 206f 6620 636c 6173 7365 7320  mber of classes 
+000021b0: 746f 2070 7265 6469 6374 2028 6f6e 6c79  to predict (only
+000021c0: 2075 7365 6420 696e 2063 6c61 7373 6966   used in classif
+000021d0: 6963 6174 696f 6e20 6d6f 6465 290a 2020  ication mode).  
+000021e0: 2020 2020 2020 756e 6365 7274 6169 6e74        uncertaint
+000021f0: 793a 2062 6f6f 6c0a 2020 2020 2020 2020  y: bool.        
+00002200: 2020 2020 6966 2054 7275 652c 2069 6e63      if True, inc
+00002210: 6c75 6465 2065 7874 7261 206f 7574 7075  lude extra outpu
+00002220: 7473 2061 6e64 206c 6f73 7320 7465 726d  ts and loss term
+00002230: 7320 746f 2065 6e61 626c 6520 7468 6520  s to enable the 
+00002240: 756e 6365 7274 6169 6e74 790a 2020 2020  uncertainty.    
+00002250: 2020 2020 2020 2020 696e 206f 7574 7075          in outpu
+00002260: 7473 2074 6f20 6265 2070 7265 6469 6374  ts to be predict
+00002270: 6564 0a20 2020 2020 2020 2072 6573 6964  ed.        resid
+00002280: 7561 6c3a 2062 6f6f 6c0a 2020 2020 2020  ual: bool.      
+00002290: 2020 2020 2020 6966 2054 7275 652c 2074        if True, t
+000022a0: 6865 206d 6f64 656c 2077 696c 6c20 6265  he model will be
+000022b0: 2063 6f6d 706f 7365 6420 6f66 2070 7265   composed of pre
+000022c0: 2d61 6374 6976 6174 696f 6e20 7265 7369  -activation resi
+000022d0: 6475 616c 2062 6c6f 636b 7320 696e 7374  dual blocks inst
+000022e0: 6561 640a 2020 2020 2020 2020 2020 2020  ead.            
+000022f0: 6f66 2061 2073 696d 706c 6520 7374 6163  of a simple stac
+00002300: 6b20 6f66 2063 6f6e 766f 6c75 7469 6f6e  k of convolution
+00002310: 616c 206c 6179 6572 732e 0a20 2020 2020  al layers..     
+00002320: 2020 2070 6164 6469 6e67 3a20 7374 722c     padding: str,
+00002330: 2069 6e74 206f 7220 7475 706c 650a 2020   int or tuple.  
+00002340: 2020 2020 2020 2020 2020 7468 6520 7061            the pa
+00002350: 6464 696e 6720 746f 2075 7365 2066 6f72  dding to use for
+00002360: 2063 6f6e 766f 6c75 7469 6f6e 616c 206c   convolutional l
+00002370: 6179 6572 732c 2065 6974 6865 7220 2776  ayers, either 'v
+00002380: 616c 6964 2720 6f72 2027 7361 6d65 270a  alid' or 'same'.
+00002390: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+000023a0: 2020 2020 2073 7570 6572 2843 4e4e 4d6f       super(CNNMo
+000023b0: 6475 6c65 2c20 7365 6c66 292e 5f5f 696e  dule, self).__in
+000023c0: 6974 5f5f 2829 0a0a 2020 2020 2020 2020  it__()..        
+000023d0: 6966 2064 696d 7320 6e6f 7420 696e 2028  if dims not in (
+000023e0: 312c 2032 2c20 3329 3a0a 2020 2020 2020  1, 2, 3):.      
+000023f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00002400: 6545 7272 6f72 2827 4e75 6d62 6572 206f  eError('Number o
+00002410: 6620 6469 6d65 6e73 696f 6e73 206d 7573  f dimensions mus
+00002420: 7420 6265 2031 2c20 3220 6f72 2033 2729  t be 1, 2 or 3')
+00002430: 0a0a 2020 2020 2020 2020 6966 206d 6f64  ..        if mod
+00002440: 6520 6e6f 7420 696e 205b 2763 6c61 7373  e not in ['class
+00002450: 6966 6963 6174 696f 6e27 2c20 2772 6567  ification', 'reg
+00002460: 7265 7373 696f 6e27 5d3a 0a20 2020 2020  ression']:.     
+00002470: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00002480: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00002490: 2020 2020 2020 2020 2022 6d6f 6465 206d           "mode m
+000024a0: 7573 7420 6265 2065 6974 6865 7220 2763  ust be either 'c
+000024b0: 6c61 7373 6966 6963 6174 696f 6e27 206f  lassification' o
+000024c0: 7220 2772 6567 7265 7373 696f 6e27 2229  r 'regression'")
+000024d0: 0a0a 2020 2020 2020 2020 7365 6c66 2e6e  ..        self.n
+000024e0: 5f74 6173 6b73 203d 206e 5f74 6173 6b73  _tasks = n_tasks
+000024f0: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
+00002500: 6665 6174 7572 6573 203d 206e 5f66 6561  features = n_fea
+00002510: 7475 7265 730a 2020 2020 2020 2020 7365  tures.        se
+00002520: 6c66 2e64 696d 7320 3d20 6469 6d73 0a20  lf.dims = dims. 
+00002530: 2020 2020 2020 2073 656c 662e 6d6f 6465         self.mode
+00002540: 203d 206d 6f64 650a 2020 2020 2020 2020   = mode.        
+00002550: 7365 6c66 2e6e 5f63 6c61 7373 6573 203d  self.n_classes =
+00002560: 206e 5f63 6c61 7373 6573 0a20 2020 2020   n_classes.     
+00002570: 2020 2073 656c 662e 756e 6365 7274 6169     self.uncertai
+00002580: 6e74 7920 3d20 756e 6365 7274 6169 6e74  nty = uncertaint
+00002590: 790a 2020 2020 2020 2020 7365 6c66 2e6d  y.        self.m
+000025a0: 6f64 6520 3d20 6d6f 6465 0a20 2020 2020  ode = mode.     
+000025b0: 2020 2073 656c 662e 6c61 7965 725f 6669     self.layer_fi
+000025c0: 6c74 6572 7320 3d20 6c61 7965 725f 6669  lters = layer_fi
+000025d0: 6c74 6572 730a 2020 2020 2020 2020 7365  lters.        se
+000025e0: 6c66 2e72 6573 6964 7561 6c20 3d20 7265  lf.residual = re
+000025f0: 7369 6475 616c 0a0a 2020 2020 2020 2020  sidual..        
+00002600: 6e5f 6c61 7965 7273 203d 206c 656e 286c  n_layers = len(l
+00002610: 6179 6572 5f66 696c 7465 7273 290a 0a20  ayer_filters).. 
+00002620: 2020 2020 2020 2023 2050 7954 6f72 6368         # PyTorch
+00002630: 206c 6179 6572 7320 7265 7175 6972 6520   layers require 
+00002640: 696e 7075 7420 616e 6420 6f75 7470 7574  input and output
+00002650: 2063 6861 6e6e 656c 7320 6173 2070 6172   channels as par
+00002660: 616d 6574 6572 0a20 2020 2020 2020 2023  ameter.        #
+00002670: 2069 6620 6f6e 6c79 206f 6e65 206c 6179   if only one lay
+00002680: 6572 2074 6f20 6d61 6b65 2074 6865 206d  er to make the m
+00002690: 6f64 656c 2063 7265 6174 696e 6720 6c6f  odel creating lo
+000026a0: 6f70 2062 656c 6f77 2077 6f72 6b2c 206d  op below work, m
+000026b0: 756c 7469 706c 7920 6c61 7965 725f 6669  ultiply layer_fi
+000026c0: 6c74 6572 7320 7775 7467 2032 0a20 2020  lters wutg 2.   
+000026d0: 2020 2020 2069 6620 6c65 6e28 6c61 7965       if len(laye
+000026e0: 725f 6669 6c74 6572 7329 203d 3d20 313a  r_filters) == 1:
+000026f0: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00002700: 6572 5f66 696c 7465 7273 203d 206c 6179  er_filters = lay
+00002710: 6572 5f66 696c 7465 7273 202a 2032 0a0a  er_filters * 2..
+00002720: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00002730: 7369 6e73 7461 6e63 6528 6b65 726e 656c  sinstance(kernel
+00002740: 5f73 697a 652c 2053 6571 7565 6e63 6543  _size, SequenceC
+00002750: 6f6c 6c65 6374 696f 6e29 3a0a 2020 2020  ollection):.    
+00002760: 2020 2020 2020 2020 6b65 726e 656c 5f73          kernel_s
+00002770: 697a 6520 3d20 5b6b 6572 6e65 6c5f 7369  ize = [kernel_si
+00002780: 7a65 5d20 2a20 6e5f 6c61 7965 7273 0a20  ze] * n_layers. 
+00002790: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+000027a0: 696e 7374 616e 6365 2873 7472 6964 6573  instance(strides
+000027b0: 2c20 5365 7175 656e 6365 436f 6c6c 6563  , SequenceCollec
+000027c0: 7469 6f6e 293a 0a20 2020 2020 2020 2020  tion):.         
+000027d0: 2020 2073 7472 6964 6573 203d 205b 7374     strides = [st
+000027e0: 7269 6465 735d 202a 206e 5f6c 6179 6572  rides] * n_layer
+000027f0: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
+00002800: 2069 7369 6e73 7461 6e63 6528 6472 6f70   isinstance(drop
+00002810: 6f75 7473 2c20 5365 7175 656e 6365 436f  outs, SequenceCo
+00002820: 6c6c 6563 7469 6f6e 293a 0a20 2020 2020  llection):.     
+00002830: 2020 2020 2020 2064 726f 706f 7574 7320         dropouts 
+00002840: 3d20 5b64 726f 706f 7574 735d 202a 206e  = [dropouts] * n
+00002850: 5f6c 6179 6572 730a 2020 2020 2020 2020  _layers.        
+00002860: 6966 2069 7369 6e73 7461 6e63 6528 0a20  if isinstance(. 
+00002870: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00002880: 6374 6976 6174 696f 6e5f 666e 732c 0a20  ctivation_fns,. 
+00002890: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000028a0: 7472 2920 6f72 206e 6f74 2069 7369 6e73  tr) or not isins
+000028b0: 7461 6e63 6528 6163 7469 7661 7469 6f6e  tance(activation
+000028c0: 5f66 6e73 2c20 5365 7175 656e 6365 436f  _fns, SequenceCo
+000028d0: 6c6c 6563 7469 6f6e 293a 0a20 2020 2020  llection):.     
+000028e0: 2020 2020 2020 2061 6374 6976 6174 696f         activatio
+000028f0: 6e5f 666e 7320 3d20 5b61 6374 6976 6174  n_fns = [activat
+00002900: 696f 6e5f 666e 735d 202a 206e 5f6c 6179  ion_fns] * n_lay
+00002910: 6572 730a 2020 2020 2020 2020 6966 206e  ers.        if n
+00002920: 6f74 2069 7369 6e73 7461 6e63 6528 7765  ot isinstance(we
+00002930: 6967 6874 5f69 6e69 745f 7374 6464 6576  ight_init_stddev
+00002940: 732c 2053 6571 7565 6e63 6543 6f6c 6c65  s, SequenceColle
+00002950: 6374 696f 6e29 3a0a 2020 2020 2020 2020  ction):.        
+00002960: 2020 2020 7765 6967 6874 5f69 6e69 745f      weight_init_
+00002970: 7374 6464 6576 7320 3d20 5b77 6569 6768  stddevs = [weigh
+00002980: 745f 696e 6974 5f73 7464 6465 7673 5d20  t_init_stddevs] 
+00002990: 2a20 6e5f 6c61 7965 7273 0a20 2020 2020  * n_layers.     
+000029a0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+000029b0: 616e 6365 2862 6961 735f 696e 6974 5f63  ance(bias_init_c
+000029c0: 6f6e 7374 732c 2053 6571 7565 6e63 6543  onsts, SequenceC
+000029d0: 6f6c 6c65 6374 696f 6e29 3a0a 2020 2020  ollection):.    
+000029e0: 2020 2020 2020 2020 6269 6173 5f69 6e69          bias_ini
+000029f0: 745f 636f 6e73 7473 203d 205b 6269 6173  t_consts = [bias
+00002a00: 5f69 6e69 745f 636f 6e73 7473 5d20 2a20  _init_consts] * 
+00002a10: 6e5f 6c61 7965 7273 0a0a 2020 2020 2020  n_layers..      
+00002a20: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
+00002a30: 6e5f 666e 7320 3d20 5b67 6574 5f61 6374  n_fns = [get_act
+00002a40: 6976 6174 696f 6e28 6629 2066 6f72 2066  ivation(f) for f
+00002a50: 2069 6e20 6163 7469 7661 7469 6f6e 5f66   in activation_f
+00002a60: 6e73 5d0a 2020 2020 2020 2020 7365 6c66  ns].        self
+00002a70: 2e64 726f 706f 7574 7320 3d20 6472 6f70  .dropouts = drop
+00002a80: 6f75 7473 0a0a 2020 2020 2020 2020 6966  outs..        if
+00002a90: 2075 6e63 6572 7461 696e 7479 3a0a 0a20   uncertainty:.. 
+00002aa0: 2020 2020 2020 2020 2020 2069 6620 6d6f             if mo
+00002ab0: 6465 2021 3d20 2772 6567 7265 7373 696f  de != 'regressio
+00002ac0: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
+00002ad0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00002ae0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00002af0: 2020 2020 2020 2020 2020 2255 6e63 6572            "Uncer
+00002b00: 7461 696e 7479 2069 7320 6f6e 6c79 2073  tainty is only s
+00002b10: 7570 706f 7274 6564 2069 6e20 7265 6772  upported in regr
+00002b20: 6573 7369 6f6e 206d 6f64 6522 290a 0a20  ession mode").. 
+00002b30: 2020 2020 2020 2020 2020 2069 6620 616e             if an
+00002b40: 7928 6420 3d3d 2030 2e30 2066 6f72 2064  y(d == 0.0 for d
+00002b50: 2069 6e20 6472 6f70 6f75 7473 293a 0a20   in dropouts):. 
+00002b60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00002b70: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00002b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002b90: 2020 2020 2027 4472 6f70 6f75 7420 6d75       'Dropout mu
+00002ba0: 7374 2062 6520 696e 636c 7564 6564 2069  st be included i
+00002bb0: 6e20 6576 6572 7920 6c61 7965 7220 746f  n every layer to
+00002bc0: 2070 7265 6469 6374 2075 6e63 6572 7461   predict uncerta
+00002bd0: 696e 7479 270a 2020 2020 2020 2020 2020  inty'.          
+00002be0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00002bf0: 2023 2050 7974 686f 6e20 7475 706c 6573   # Python tuples
+00002c00: 2075 7365 2030 2062 6173 6564 2069 6e64   use 0 based ind
+00002c10: 6578 696e 672c 2064 696d 7320 6465 6669  exing, dims defi
+00002c20: 6e65 7320 6e75 6d62 6572 206f 6620 6469  nes number of di
+00002c30: 6d65 6e73 696f 6e20 666f 7220 636f 6e76  mension for conv
+00002c40: 6f6c 7574 696f 6e61 6c20 6f70 6572 6174  olutional operat
+00002c50: 696f 6e0a 2020 2020 2020 2020 436f 6e76  ion.        Conv
+00002c60: 4c61 7965 7220 3d20 286e 6e2e 436f 6e76  Layer = (nn.Conv
+00002c70: 3164 2c20 6e6e 2e43 6f6e 7632 642c 206e  1d, nn.Conv2d, n
+00002c80: 6e2e 436f 6e76 3364 295b 7365 6c66 2e64  n.Conv3d)[self.d
+00002c90: 696d 7320 2d20 315d 0a0a 2020 2020 2020  ims - 1]..      
+00002ca0: 2020 6966 2070 6f6f 6c5f 7479 7065 203d    if pool_type =
+00002cb0: 3d20 2761 7665 7261 6765 273a 0a20 2020  = 'average':.   
+00002cc0: 2020 2020 2020 2020 2050 6f6f 6c4c 6179           PoolLay
+00002cd0: 6572 203d 2028 462e 6176 675f 706f 6f6c  er = (F.avg_pool
+00002ce0: 3164 2c20 462e 6176 675f 706f 6f6c 3264  1d, F.avg_pool2d
+00002cf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002d00: 2020 2020 2020 2020 2020 2046 2e61 7667             F.avg
+00002d10: 5f70 6f6f 6c33 6429 5b73 656c 662e 6469  _pool3d)[self.di
+00002d20: 6d73 202d 2031 5d0a 2020 2020 2020 2020  ms - 1].        
+00002d30: 656c 6966 2070 6f6f 6c5f 7479 7065 203d  elif pool_type =
+00002d40: 3d20 276d 6178 273a 0a20 2020 2020 2020  = 'max':.       
+00002d50: 2020 2020 2050 6f6f 6c4c 6179 6572 203d       PoolLayer =
+00002d60: 2028 462e 6d61 785f 706f 6f6c 3164 2c20   (F.max_pool1d, 
+00002d70: 462e 6d61 785f 706f 6f6c 3264 2c0a 2020  F.max_pool2d,.  
+00002d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d90: 2020 2020 2020 2046 2e6d 6178 5f70 6f6f         F.max_poo
+00002da0: 6c33 6429 5b73 656c 662e 6469 6d73 202d  l3d)[self.dims -
+00002db0: 2031 5d0a 2020 2020 2020 2020 656c 7365   1].        else
+00002dc0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00002dd0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00002de0: 706f 6f6c 5f74 7970 6520 6d75 7374 2062  pool_type must b
+00002df0: 6520 6569 7468 6572 2027 6176 6572 6167  e either 'averag
+00002e00: 6527 206f 7220 276d 6178 2722 290a 0a20  e' or 'max'").. 
+00002e10: 2020 2020 2020 2073 656c 662e 506f 6f6c         self.Pool
+00002e20: 4c61 7965 7220 3d20 506f 6f6c 4c61 7965  Layer = PoolLaye
+00002e30: 720a 2020 2020 2020 2020 7365 6c66 2e6c  r.        self.l
+00002e40: 6179 6572 7320 3d20 6e6e 2e4d 6f64 756c  ayers = nn.Modul
+00002e50: 654c 6973 7428 290a 0a20 2020 2020 2020  eList()..       
+00002e60: 2069 6e5f 7368 6170 6520 3d20 6e5f 6665   in_shape = n_fe
+00002e70: 6174 7572 6573 0a0a 2020 2020 2020 2020  atures..        
+00002e80: 666f 7220 6f75 745f 7368 6170 652c 2073  for out_shape, s
+00002e90: 697a 652c 2073 7472 6964 652c 2077 6569  ize, stride, wei
+00002ea0: 6768 745f 7374 6464 6576 2c20 6269 6173  ght_stddev, bias
+00002eb0: 5f63 6f6e 7374 2069 6e20 7a69 7028 0a20  _const in zip(. 
+00002ec0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00002ed0: 6179 6572 5f66 696c 7465 7273 2c20 6b65  ayer_filters, ke
+00002ee0: 726e 656c 5f73 697a 652c 2073 7472 6964  rnel_size, strid
+00002ef0: 6573 2c20 7765 6967 6874 5f69 6e69 745f  es, weight_init_
+00002f00: 7374 6464 6576 732c 0a20 2020 2020 2020  stddevs,.       
+00002f10: 2020 2020 2020 2020 2062 6961 735f 696e           bias_in
+00002f20: 6974 5f63 6f6e 7374 7329 3a0a 0a20 2020  it_consts):..   
+00002f30: 2020 2020 2020 2020 206c 6179 6572 203d           layer =
+00002f40: 2043 6f6e 764c 6179 6572 2869 6e5f 6368   ConvLayer(in_ch
+00002f50: 616e 6e65 6c73 3d69 6e5f 7368 6170 652c  annels=in_shape,
+00002f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002f70: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00002f80: 7574 5f63 6861 6e6e 656c 733d 6f75 745f  ut_channels=out_
+00002f90: 7368 6170 652c 0a20 2020 2020 2020 2020  shape,.         
+00002fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fb0: 2020 2020 206b 6572 6e65 6c5f 7369 7a65       kernel_size
+00002fc0: 3d73 697a 652c 0a20 2020 2020 2020 2020  =size,.         
+00002fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fe0: 2020 2020 2073 7472 6964 653d 7374 7269       stride=stri
+00002ff0: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+00003000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003010: 2020 7061 6464 696e 673d 7061 6464 696e    padding=paddin
+00003020: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+00003030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003040: 2064 696c 6174 696f 6e3d 312c 0a20 2020   dilation=1,.   
+00003050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003060: 2020 2020 2020 2020 2020 2067 726f 7570             group
+00003070: 733d 312c 0a20 2020 2020 2020 2020 2020  s=1,.           
+00003080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003090: 2020 2062 6961 733d 5472 7565 290a 0a20     bias=True).. 
+000030a0: 2020 2020 2020 2020 2020 206e 6e2e 696e             nn.in
+000030b0: 6974 2e6e 6f72 6d61 6c5f 286c 6179 6572  it.normal_(layer
+000030c0: 2e77 6569 6768 742c 2030 2c20 7765 6967  .weight, 0, weig
+000030d0: 6874 5f73 7464 6465 7629 0a0a 2020 2020  ht_stddev)..    
+000030e0: 2020 2020 2020 2020 2320 696e 6974 6961          # initia
+000030f0: 6c69 7a69 6e67 206c 6179 6572 2062 6961  lizing layer bia
+00003100: 7320 7769 7468 206e 6e2e 696e 6974 2067  s with nn.init g
+00003110: 6976 6573 206d 7970 7920 7479 7065 6368  ives mypy typech
+00003120: 6563 6b20 6572 726f 720a 2020 2020 2020  eck error.      
+00003130: 2020 2020 2020 2320 7573 696e 6720 7468        # using th
+00003140: 6520 666f 6c6c 6f77 696e 6720 776f 726b  e following work
+00003150: 6172 6f75 6e64 0a20 2020 2020 2020 2020  around.         
+00003160: 2020 2069 6620 6c61 7965 722e 6269 6173     if layer.bias
+00003170: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00003180: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00003190: 7965 722e 6269 6173 203d 206e 6e2e 5061  yer.bias = nn.Pa
+000031a0: 7261 6d65 7465 7228 0a20 2020 2020 2020  rameter(.       
+000031b0: 2020 2020 2020 2020 2020 2020 2074 6f72               tor
+000031c0: 6368 2e66 756c 6c28 6c61 7965 722e 6269  ch.full(layer.bi
+000031d0: 6173 2e73 6861 7065 2c20 6269 6173 5f63  as.shape, bias_c
+000031e0: 6f6e 7374 2929 0a0a 2020 2020 2020 2020  onst))..        
+000031f0: 2020 2020 7365 6c66 2e6c 6179 6572 732e      self.layers.
+00003200: 6170 7065 6e64 286c 6179 6572 290a 0a20  append(layer).. 
+00003210: 2020 2020 2020 2020 2020 2069 6e5f 7368             in_sh
+00003220: 6170 6520 3d20 6f75 745f 7368 6170 650a  ape = out_shape.
+00003230: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
+00003240: 6173 7369 6669 6572 5f66 666e 203d 206e  assifier_ffn = n
+00003250: 6e2e 4c61 7a79 4c69 6e65 6172 2873 656c  n.LazyLinear(sel
+00003260: 662e 6e5f 7461 736b 7320 2a20 7365 6c66  f.n_tasks * self
+00003270: 2e6e 5f63 6c61 7373 6573 290a 2020 2020  .n_classes).    
+00003280: 2020 2020 7365 6c66 2e6f 7574 7075 745f      self.output_
+00003290: 6c61 7965 7220 3d20 6e6e 2e4c 617a 794c  layer = nn.LazyL
+000032a0: 696e 6561 7228 7365 6c66 2e6e 5f74 6173  inear(self.n_tas
+000032b0: 6b73 290a 2020 2020 2020 2020 7365 6c66  ks).        self
+000032c0: 2e75 6e63 6572 7461 696e 7479 5f6c 6179  .uncertainty_lay
+000032d0: 6572 203d 206e 6e2e 4c61 7a79 4c69 6e65  er = nn.LazyLine
+000032e0: 6172 2873 656c 662e 6e5f 7461 736b 7329  ar(self.n_tasks)
+000032f0: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
+00003300: 6428 7365 6c66 2c20 696e 7075 7473 3a20  d(self, inputs: 
+00003310: 4f6e 654f 724d 616e 795b 746f 7263 682e  OneOrMany[torch.
+00003320: 5465 6e73 6f72 5d29 202d 3e20 4c69 7374  Tensor]) -> List
+00003330: 5b41 6e79 5d3a 0a20 2020 2020 2020 2022  [Any]:.        "
+00003340: 2222 0a20 2020 2020 2020 2050 6172 616d  "".        Param
+00003350: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00003360: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00003370: 2078 3a20 746f 7263 682e 5465 6e73 6f72   x: torch.Tensor
+00003380: 0a20 2020 2020 2020 2020 2020 2049 6e70  .            Inp
+00003390: 7574 2054 656e 736f 720a 2020 2020 2020  ut Tensor.      
+000033a0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+000033b0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+000033c0: 2020 746f 7263 682e 5465 6e73 6f72 0a20    torch.Tensor. 
+000033d0: 2020 2020 2020 2020 2020 204f 7574 7075             Outpu
+000033e0: 7420 6173 2070 6572 2075 7365 2063 6173  t as per use cas
+000033f0: 6520 3a20 7265 6772 6573 7369 6f6e 2f63  e : regression/c
+00003400: 6c61 7373 6966 6963 6174 696f 6e0a 2020  lassification.  
+00003410: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00003420: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00003430: 696e 7075 7473 2c20 746f 7263 682e 5465  inputs, torch.Te
+00003440: 6e73 6f72 293a 0a20 2020 2020 2020 2020  nsor):.         
+00003450: 2020 2078 2c20 6472 6f70 6f75 745f 7377     x, dropout_sw
+00003460: 6974 6368 203d 2069 6e70 7574 732c 204e  itch = inputs, N
+00003470: 6f6e 650a 2020 2020 2020 2020 656c 7365  one.        else
+00003480: 3a0a 2020 2020 2020 2020 2020 2020 782c  :.            x,
+00003490: 2064 726f 706f 7574 5f73 7769 7463 6820   dropout_switch 
+000034a0: 3d20 696e 7075 7473 0a0a 2020 2020 2020  = inputs..      
+000034b0: 2020 7820 3d20 746f 7263 682e 7472 616e    x = torch.tran
+000034c0: 7370 6f73 6528 782c 2031 2c20 2d31 2920  spose(x, 1, -1) 
+000034d0: 2023 206e 2068 2077 2063 202d 3e20 6e20   # n h w c -> n 
+000034e0: 6320 6820 770a 0a20 2020 2020 2020 2070  c h w..        p
+000034f0: 7265 765f 6c61 7965 7220 3d20 780a 0a20  rev_layer = x.. 
+00003500: 2020 2020 2020 2066 6f72 206c 6179 6572         for layer
+00003510: 2c20 6163 7469 7661 7469 6f6e 5f66 6e2c  , activation_fn,
+00003520: 2064 726f 706f 7574 2069 6e20 7a69 7028   dropout in zip(
+00003530: 7365 6c66 2e6c 6179 6572 732c 0a20 2020  self.layers,.   
 00003540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00003550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003560: 2073 656c 662e 6163 7469 7661 7469 6f6e   self.activation
-00003570: 5f66 6e73 2c0a 2020 2020 2020 2020 2020  _fns,.          
-00003580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003560: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003570: 6c66 2e61 6374 6976 6174 696f 6e5f 666e  lf.activation_fn
+00003580: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
 00003590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000035a0: 2020 2020 2020 2073 656c 662e 6472 6f70         self.drop
-000035b0: 6f75 7473 293a 0a20 2020 2020 2020 2020  outs):.         
-000035c0: 2020 2078 203d 206c 6179 6572 2878 290a     x = layer(x).
-000035d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000035e0: 6472 6f70 6f75 7420 3e20 302e 2061 6e64  dropout > 0. and
-000035f0: 2064 726f 706f 7574 5f73 7769 7463 683a   dropout_switch:
-00003600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003610: 2078 203d 2046 2e64 726f 706f 7574 2878   x = F.dropout(x
-00003620: 2c20 6472 6f70 6f75 7429 0a0a 2020 2020  , dropout)..    
-00003630: 2020 2020 2020 2020 2320 7265 7369 6475          # residu
-00003640: 616c 2062 6c6f 636b 7320 6361 6e20 6f6e  al blocks can on
-00003650: 6c79 2062 6520 7573 6564 2077 6865 6e20  ly be used when 
-00003660: 7375 6363 6573 7369 7665 206c 6179 6572  successive layer
-00003670: 7320 6861 7665 2074 6865 2073 616d 6520  s have the same 
-00003680: 6f75 7470 7574 2073 6861 7065 0a20 2020  output shape.   
-00003690: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000036a0: 2e72 6573 6964 7561 6c20 616e 6420 782e  .residual and x.
-000036b0: 7368 6170 655b 315d 203d 3d20 7072 6576  shape[1] == prev
-000036c0: 5f6c 6179 6572 2e73 6861 7065 5b31 5d3a  _layer.shape[1]:
-000036d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000036e0: 2078 203d 2078 202b 2070 7265 765f 6c61   x = x + prev_la
-000036f0: 7965 720a 0a20 2020 2020 2020 2020 2020  yer..           
-00003700: 2069 6620 6163 7469 7661 7469 6f6e 5f66   if activation_f
-00003710: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
-00003720: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-00003730: 203d 2061 6374 6976 6174 696f 6e5f 666e   = activation_fn
-00003740: 2878 290a 0a20 2020 2020 2020 2020 2020  (x)..           
-00003750: 2070 7265 765f 6c61 7965 7220 3d20 780a   prev_layer = x.
-00003760: 0a20 2020 2020 2020 2078 203d 2073 656c  .        x = sel
-00003770: 662e 506f 6f6c 4c61 7965 7228 782c 206b  f.PoolLayer(x, k
-00003780: 6572 6e65 6c5f 7369 7a65 3d78 2e73 697a  ernel_size=x.siz
-00003790: 6528 295b 323a 5d29 0a0a 2020 2020 2020  e()[2:])..      
-000037a0: 2020 6f75 7470 7574 7320 3d20 5b5d 0a20    outputs = []. 
-000037b0: 2020 2020 2020 2062 6174 6368 5f73 697a         batch_siz
-000037c0: 6520 3d20 782e 7368 6170 655b 305d 0a0a  e = x.shape[0]..
-000037d0: 2020 2020 2020 2020 7820 3d20 746f 7263          x = torc
-000037e0: 682e 7265 7368 6170 6528 782c 2028 6261  h.reshape(x, (ba
-000037f0: 7463 685f 7369 7a65 2c20 2d31 2929 0a0a  tch_size, -1))..
-00003800: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00003810: 6d6f 6465 203d 3d20 2263 6c61 7373 6966  mode == "classif
-00003820: 6963 6174 696f 6e22 3a0a 0a20 2020 2020  ication":..     
-00003830: 2020 2020 2020 206c 6f67 6974 7320 3d20         logits = 
-00003840: 7365 6c66 2e63 6c61 7373 6966 6965 725f  self.classifier_
-00003850: 6666 6e28 7829 0a20 2020 2020 2020 2020  ffn(x).         
-00003860: 2020 206c 6f67 6974 7320 3d20 6c6f 6769     logits = logi
-00003870: 7473 2e76 6965 7728 6261 7463 685f 7369  ts.view(batch_si
-00003880: 7a65 2c20 7365 6c66 2e6e 5f74 6173 6b73  ze, self.n_tasks
-00003890: 2c20 7365 6c66 2e6e 5f63 6c61 7373 6573  , self.n_classes
-000038a0: 290a 2020 2020 2020 2020 2020 2020 6f75  ).            ou
-000038b0: 7470 7574 203d 2046 2e73 6f66 746d 6178  tput = F.softmax
-000038c0: 286c 6f67 6974 732c 2064 696d 3d32 290a  (logits, dim=2).
-000038d0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-000038e0: 7574 7320 3d20 5b6f 7574 7075 742c 206c  uts = [output, l
-000038f0: 6f67 6974 735d 0a0a 2020 2020 2020 2020  ogits]..        
-00003900: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00003910: 2020 6f75 7470 7574 203d 2073 656c 662e    output = self.
-00003920: 6f75 7470 7574 5f6c 6179 6572 2878 290a  output_layer(x).
-00003930: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-00003940: 7574 203d 206f 7574 7075 742e 7669 6577  ut = output.view
-00003950: 2862 6174 6368 5f73 697a 652c 2073 656c  (batch_size, sel
-00003960: 662e 6e5f 7461 736b 7329 0a0a 2020 2020  f.n_tasks)..    
-00003970: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00003980: 756e 6365 7274 6169 6e74 793a 0a20 2020  uncertainty:.   
-00003990: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-000039a0: 5f76 6172 203d 2073 656c 662e 756e 6365  _var = self.unce
-000039b0: 7274 6169 6e74 795f 6c61 7965 7228 7829  rtainty_layer(x)
-000039c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000039d0: 206c 6f67 5f76 6172 203d 206c 6f67 5f76   log_var = log_v
-000039e0: 6172 2e76 6965 7728 6261 7463 685f 7369  ar.view(batch_si
-000039f0: 7a65 2c20 7365 6c66 2e6e 5f74 6173 6b73  ze, self.n_tasks
-00003a00: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
-00003a10: 2020 2020 2076 6172 203d 2074 6f72 6368       var = torch
-00003a20: 2e65 7870 286c 6f67 5f76 6172 290a 2020  .exp(log_var).  
-00003a30: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00003a40: 7470 7574 7320 3d20 5b6f 7574 7075 742c  tputs = [output,
-00003a50: 2076 6172 2c20 6f75 7470 7574 2c20 6c6f   var, output, lo
-00003a60: 675f 7661 725d 0a20 2020 2020 2020 2020  g_var].         
-00003a70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00003a80: 2020 2020 2020 2020 206f 7574 7075 7473           outputs
-00003a90: 203d 205b 6f75 7470 7574 5d0a 0a20 2020   = [output]..   
-00003aa0: 2020 2020 2072 6574 7572 6e20 6f75 7470       return outp
-00003ab0: 7574 730a 0a0a 636c 6173 7320 5363 616c  uts...class Scal
-00003ac0: 654e 6f72 6d28 6e6e 2e4d 6f64 756c 6529  eNorm(nn.Module)
-00003ad0: 3a0a 2020 2020 2222 2241 7070 6c79 2053  :.    """Apply S
-00003ae0: 6361 6c65 204e 6f72 6d61 6c69 7a61 7469  cale Normalizati
-00003af0: 6f6e 2074 6f20 696e 7075 742e 0a0a 2020  on to input...  
-00003b00: 2020 5468 6520 5363 616c 654e 6f72 6d20    The ScaleNorm 
-00003b10: 6c61 7965 7220 6669 7273 7420 636f 6d70  layer first comp
-00003b20: 7574 6573 2074 6865 2073 7175 6172 6520  utes the square 
-00003b30: 726f 6f74 206f 6620 7468 6520 7363 616c  root of the scal
-00003b40: 652c 2074 6865 6e20 636f 6d70 7574 6573  e, then computes
-00003b50: 2074 6865 206d 6174 7269 782f 7665 6374   the matrix/vect
-00003b60: 6f72 206e 6f72 6d20 6f66 2074 6865 2069  or norm of the i
-00003b70: 6e70 7574 2074 656e 736f 722e 0a20 2020  nput tensor..   
-00003b80: 2054 6865 206e 6f72 6d20 7661 6c75 6520   The norm value 
-00003b90: 6973 2063 616c 6375 6c61 7465 6420 6173  is calculated as
-00003ba0: 2060 7371 7274 2873 6361 6c65 2920 2f20   `sqrt(scale) / 
-00003bb0: 6d61 7472 6978 206e 6f72 6d60 2e0a 2020  matrix norm`..  
-00003bc0: 2020 4669 6e61 6c6c 792c 2074 6865 2072    Finally, the r
-00003bd0: 6573 756c 7420 6973 2072 6574 7572 6e65  esult is returne
-00003be0: 6420 6173 2060 696e 7075 745f 7465 6e73  d as `input_tens
-00003bf0: 6f72 202a 206e 6f72 6d20 7661 6c75 6560  or * norm value`
-00003c00: 2e0a 0a20 2020 2054 6869 7320 6c61 7965  ...    This laye
-00003c10: 7220 6361 6e20 6265 2075 7365 6420 696e  r can be used in
-00003c20: 7374 6561 6420 6f66 204c 6179 6572 4e6f  stead of LayerNo
-00003c30: 726d 2077 6865 6e20 6120 7363 616c 6564  rm when a scaled
-00003c40: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
-00003c50: 6e6f 726d 2069 7320 7265 7175 6972 6564  norm is required
-00003c60: 2e0a 2020 2020 496e 7374 6561 6420 6f66  ..    Instead of
-00003c70: 2070 6572 666f 726d 696e 6720 7468 6520   performing the 
-00003c80: 7363 616c 696e 6720 6f70 6572 6174 696f  scaling operatio
-00003c90: 6e20 2860 7363 616c 6520 2f20 6e6f 726d  n (`scale / norm
-00003ca0: 6029 2069 6e20 6120 6c61 6d62 6461 2d6c  `) in a lambda-l
-00003cb0: 696b 6520 6c61 7965 722c 2077 6520 6172  ike layer, we ar
-00003cc0: 6520 6465 6669 6e69 6e67 2069 7420 7769  e defining it wi
-00003cd0: 7468 696e 2074 6869 7320 6c61 7965 7220  thin this layer 
-00003ce0: 746f 206d 616b 6520 7072 6f74 6f74 7970  to make prototyp
-00003cf0: 696e 6720 6d6f 7265 2065 6666 6963 6965  ing more efficie
-00003d00: 6e74 2e0a 0a20 2020 2052 6566 6572 656e  nt...    Referen
-00003d10: 6365 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ces.    --------
-00003d20: 2d2d 0a20 2020 202e 2e20 5b31 5d20 4c75  --.    .. [1] Lu
-00003d30: 6b61 737a 204d 617a 6961 726b 6120 6574  kasz Maziarka et
-00003d40: 2061 6c2e 2022 4d6f 6c65 6375 6c65 2041   al. "Molecule A
-00003d50: 7474 656e 7469 6f6e 2054 7261 6e73 666f  ttention Transfo
-00003d60: 726d 6572 2220 4772 6170 6820 5265 7072  rmer" Graph Repr
-00003d70: 6573 656e 7461 7469 6f6e 204c 6561 726e  esentation Learn
-00003d80: 696e 6720 776f 726b 7368 6f70 2061 6e64  ing workshop and
-00003d90: 204d 6163 6869 6e65 204c 6561 726e 696e   Machine Learnin
-00003da0: 6720 616e 6420 7468 6520 5068 7973 6963  g and the Physic
-00003db0: 616c 2053 6369 656e 6365 7320 776f 726b  al Sciences work
-00003dc0: 7368 6f70 2061 7420 4e65 7572 4950 5320  shop at NeurIPS 
-00003dd0: 3230 3139 2e20 3230 3230 2e20 6874 7470  2019. 2020. http
-00003de0: 733a 2f2f 6172 7869 762e 6f72 672f 6162  s://arxiv.org/ab
-00003df0: 732f 3230 3032 2e30 3832 3634 0a0a 2020  s/2002.08264..  
-00003e00: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
-00003e10: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
-00003e20: 6672 6f6d 2064 6565 7063 6865 6d2e 6d6f  from deepchem.mo
-00003e30: 6465 6c73 2e74 6f72 6368 5f6d 6f64 656c  dels.torch_model
-00003e40: 732e 6c61 7965 7273 2069 6d70 6f72 7420  s.layers import 
-00003e50: 5363 616c 654e 6f72 6d0a 2020 2020 3e3e  ScaleNorm.    >>
-00003e60: 3e20 7363 616c 6520 3d20 302e 3335 0a20  > scale = 0.35. 
-00003e70: 2020 203e 3e3e 206c 6179 6572 203d 2053     >>> layer = S
-00003e80: 6361 6c65 4e6f 726d 2873 6361 6c65 290a  caleNorm(scale).
-00003e90: 2020 2020 3e3e 3e20 696e 7075 745f 7465      >>> input_te
-00003ea0: 6e73 6f72 203d 2074 6f72 6368 2e74 656e  nsor = torch.ten
-00003eb0: 736f 7228 5b5b 312e 3236 392c 2033 392e  sor([[1.269, 39.
-00003ec0: 3336 5d2c 205b 302e 3030 3931 382c 202d  36], [0.00918, -
-00003ed0: 392e 3132 5d5d 290a 2020 2020 3e3e 3e20  9.12]]).    >>> 
-00003ee0: 6f75 7470 7574 5f74 656e 736f 7220 3d20  output_tensor = 
-00003ef0: 6c61 7965 7228 696e 7075 745f 7465 6e73  layer(input_tens
-00003f00: 6f72 290a 2020 2020 2222 220a 0a20 2020  or).    """..   
-00003f10: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00003f20: 6c66 2c20 7363 616c 653a 2066 6c6f 6174  lf, scale: float
-00003f30: 2c20 6570 733a 2066 6c6f 6174 203d 2031  , eps: float = 1
-00003f40: 652d 3529 3a0a 2020 2020 2020 2020 2222  e-5):.        ""
-00003f50: 2249 6e69 7469 616c 697a 6520 6120 5363  "Initialize a Sc
-00003f60: 616c 654e 6f72 6d20 6c61 7965 722e 0a0a  aleNorm layer...
-00003f70: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00003f80: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00003f90: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7363  -----.        sc
-00003fa0: 616c 653a 2066 6c6f 6174 0a20 2020 2020  ale: float.     
-00003fb0: 2020 2020 2020 2053 6361 6c65 206d 6167         Scale mag
-00003fc0: 6e69 7475 6465 2e0a 2020 2020 2020 2020  nitude..        
-00003fd0: 6570 733a 2066 6c6f 6174 0a20 2020 2020  eps: float.     
-00003fe0: 2020 2020 2020 2045 7073 696c 6f6e 2076         Epsilon v
-00003ff0: 616c 7565 2e20 4465 6661 756c 7420 3d20  alue. Default = 
-00004000: 3165 2d35 2e0a 2020 2020 2020 2020 2222  1e-5..        ""
-00004010: 220a 2020 2020 2020 2020 7375 7065 7228  ".        super(
-00004020: 5363 616c 654e 6f72 6d2c 2073 656c 6629  ScaleNorm, self)
-00004030: 2e5f 5f69 6e69 745f 5f28 290a 2020 2020  .__init__().    
-00004040: 2020 2020 7365 6c66 2e73 6361 6c65 203d      self.scale =
-00004050: 206e 6e2e 5061 7261 6d65 7465 7228 746f   nn.Parameter(to
-00004060: 7263 682e 7465 6e73 6f72 286d 6174 682e  rch.tensor(math.
-00004070: 7371 7274 2873 6361 6c65 2929 290a 2020  sqrt(scale))).  
-00004080: 2020 2020 2020 7365 6c66 2e65 7073 203d        self.eps =
-00004090: 2065 7073 0a0a 2020 2020 6465 6620 666f   eps..    def fo
-000040a0: 7277 6172 6428 7365 6c66 2c20 783a 2074  rward(self, x: t
-000040b0: 6f72 6368 2e54 656e 736f 7229 202d 3e20  orch.Tensor) -> 
-000040c0: 746f 7263 682e 5465 6e73 6f72 3a0a 2020  torch.Tensor:.  
-000040d0: 2020 2020 2020 6e6f 726d 203d 2073 656c        norm = sel
-000040e0: 662e 7363 616c 6520 2f20 746f 7263 682e  f.scale / torch.
-000040f0: 6e6f 726d 2878 2c20 6469 6d3d 2d31 2c0a  norm(x, dim=-1,.
-00004100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035b0: 2020 2020 7365 6c66 2e64 726f 706f 7574      self.dropout
+000035c0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+000035d0: 7820 3d20 6c61 7965 7228 7829 0a0a 2020  x = layer(x)..  
+000035e0: 2020 2020 2020 2020 2020 6966 2064 726f            if dro
+000035f0: 706f 7574 203e 2030 2e20 616e 6420 6472  pout > 0. and dr
+00003600: 6f70 6f75 745f 7377 6974 6368 3a0a 2020  opout_switch:.  
+00003610: 2020 2020 2020 2020 2020 2020 2020 7820                x 
+00003620: 3d20 462e 6472 6f70 6f75 7428 782c 2064  = F.dropout(x, d
+00003630: 726f 706f 7574 290a 0a20 2020 2020 2020  ropout)..       
+00003640: 2020 2020 2023 2072 6573 6964 7561 6c20       # residual 
+00003650: 626c 6f63 6b73 2063 616e 206f 6e6c 7920  blocks can only 
+00003660: 6265 2075 7365 6420 7768 656e 2073 7563  be used when suc
+00003670: 6365 7373 6976 6520 6c61 7965 7273 2068  cessive layers h
+00003680: 6176 6520 7468 6520 7361 6d65 206f 7574  ave the same out
+00003690: 7075 7420 7368 6170 650a 2020 2020 2020  put shape.      
+000036a0: 2020 2020 2020 6966 2073 656c 662e 7265        if self.re
+000036b0: 7369 6475 616c 2061 6e64 2078 2e73 6861  sidual and x.sha
+000036c0: 7065 5b31 5d20 3d3d 2070 7265 765f 6c61  pe[1] == prev_la
+000036d0: 7965 722e 7368 6170 655b 315d 3a0a 2020  yer.shape[1]:.  
+000036e0: 2020 2020 2020 2020 2020 2020 2020 7820                x 
+000036f0: 3d20 7820 2b20 7072 6576 5f6c 6179 6572  = x + prev_layer
+00003700: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00003710: 2061 6374 6976 6174 696f 6e5f 666e 2069   activation_fn i
+00003720: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00003730: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+00003740: 6163 7469 7661 7469 6f6e 5f66 6e28 7829  activation_fn(x)
+00003750: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00003760: 6576 5f6c 6179 6572 203d 2078 0a0a 2020  ev_layer = x..  
+00003770: 2020 2020 2020 7820 3d20 7365 6c66 2e50        x = self.P
+00003780: 6f6f 6c4c 6179 6572 2878 2c20 6b65 726e  oolLayer(x, kern
+00003790: 656c 5f73 697a 653d 782e 7369 7a65 2829  el_size=x.size()
+000037a0: 5b32 3a5d 290a 0a20 2020 2020 2020 206f  [2:])..        o
+000037b0: 7574 7075 7473 203d 205b 5d0a 2020 2020  utputs = [].    
+000037c0: 2020 2020 6261 7463 685f 7369 7a65 203d      batch_size =
+000037d0: 2078 2e73 6861 7065 5b30 5d0a 0a20 2020   x.shape[0]..   
+000037e0: 2020 2020 2078 203d 2074 6f72 6368 2e72       x = torch.r
+000037f0: 6573 6861 7065 2878 2c20 2862 6174 6368  eshape(x, (batch
+00003800: 5f73 697a 652c 202d 3129 290a 0a20 2020  _size, -1))..   
+00003810: 2020 2020 2069 6620 7365 6c66 2e6d 6f64       if self.mod
+00003820: 6520 3d3d 2022 636c 6173 7369 6669 6361  e == "classifica
+00003830: 7469 6f6e 223a 0a0a 2020 2020 2020 2020  tion":..        
+00003840: 2020 2020 6c6f 6769 7473 203d 2073 656c      logits = sel
+00003850: 662e 636c 6173 7369 6669 6572 5f66 666e  f.classifier_ffn
+00003860: 2878 290a 2020 2020 2020 2020 2020 2020  (x).            
+00003870: 6c6f 6769 7473 203d 206c 6f67 6974 732e  logits = logits.
+00003880: 7669 6577 2862 6174 6368 5f73 697a 652c  view(batch_size,
+00003890: 2073 656c 662e 6e5f 7461 736b 732c 2073   self.n_tasks, s
+000038a0: 656c 662e 6e5f 636c 6173 7365 7329 0a20  elf.n_classes). 
+000038b0: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+000038c0: 7420 3d20 462e 736f 6674 6d61 7828 6c6f  t = F.softmax(lo
+000038d0: 6769 7473 2c20 6469 6d3d 3229 0a20 2020  gits, dim=2).   
+000038e0: 2020 2020 2020 2020 206f 7574 7075 7473           outputs
+000038f0: 203d 205b 6f75 7470 7574 2c20 6c6f 6769   = [output, logi
+00003900: 7473 5d0a 0a20 2020 2020 2020 2065 6c73  ts]..        els
+00003910: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
+00003920: 7574 7075 7420 3d20 7365 6c66 2e6f 7574  utput = self.out
+00003930: 7075 745f 6c61 7965 7228 7829 0a20 2020  put_layer(x).   
+00003940: 2020 2020 2020 2020 206f 7574 7075 7420           output 
+00003950: 3d20 6f75 7470 7574 2e76 6965 7728 6261  = output.view(ba
+00003960: 7463 685f 7369 7a65 2c20 7365 6c66 2e6e  tch_size, self.n
+00003970: 5f74 6173 6b73 290a 0a20 2020 2020 2020  _tasks)..       
+00003980: 2020 2020 2069 6620 7365 6c66 2e75 6e63       if self.unc
+00003990: 6572 7461 696e 7479 3a0a 2020 2020 2020  ertainty:.      
+000039a0: 2020 2020 2020 2020 2020 6c6f 675f 7661            log_va
+000039b0: 7220 3d20 7365 6c66 2e75 6e63 6572 7461  r = self.uncerta
+000039c0: 696e 7479 5f6c 6179 6572 2878 290a 2020  inty_layer(x).  
+000039d0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+000039e0: 675f 7661 7220 3d20 6c6f 675f 7661 722e  g_var = log_var.
+000039f0: 7669 6577 2862 6174 6368 5f73 697a 652c  view(batch_size,
+00003a00: 2073 656c 662e 6e5f 7461 736b 732c 2031   self.n_tasks, 1
+00003a10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00003a20: 2020 7661 7220 3d20 746f 7263 682e 6578    var = torch.ex
+00003a30: 7028 6c6f 675f 7661 7229 0a20 2020 2020  p(log_var).     
+00003a40: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+00003a50: 7473 203d 205b 6f75 7470 7574 2c20 7661  ts = [output, va
+00003a60: 722c 206f 7574 7075 742c 206c 6f67 5f76  r, output, log_v
+00003a70: 6172 5d0a 2020 2020 2020 2020 2020 2020  ar].            
+00003a80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00003a90: 2020 2020 2020 6f75 7470 7574 7320 3d20        outputs = 
+00003aa0: 5b6f 7574 7075 745d 0a0a 2020 2020 2020  [output]..      
+00003ab0: 2020 7265 7475 726e 206f 7574 7075 7473    return outputs
+00003ac0: 0a0a 0a63 6c61 7373 2053 6361 6c65 4e6f  ...class ScaleNo
+00003ad0: 726d 286e 6e2e 4d6f 6475 6c65 293a 0a20  rm(nn.Module):. 
+00003ae0: 2020 2022 2222 4170 706c 7920 5363 616c     """Apply Scal
+00003af0: 6520 4e6f 726d 616c 697a 6174 696f 6e20  e Normalization 
+00003b00: 746f 2069 6e70 7574 2e0a 0a20 2020 2054  to input...    T
+00003b10: 6865 2053 6361 6c65 4e6f 726d 206c 6179  he ScaleNorm lay
+00003b20: 6572 2066 6972 7374 2063 6f6d 7075 7465  er first compute
+00003b30: 7320 7468 6520 7371 7561 7265 2072 6f6f  s the square roo
+00003b40: 7420 6f66 2074 6865 2073 6361 6c65 2c20  t of the scale, 
+00003b50: 7468 656e 2063 6f6d 7075 7465 7320 7468  then computes th
+00003b60: 6520 6d61 7472 6978 2f76 6563 746f 7220  e matrix/vector 
+00003b70: 6e6f 726d 206f 6620 7468 6520 696e 7075  norm of the inpu
+00003b80: 7420 7465 6e73 6f72 2e0a 2020 2020 5468  t tensor..    Th
+00003b90: 6520 6e6f 726d 2076 616c 7565 2069 7320  e norm value is 
+00003ba0: 6361 6c63 756c 6174 6564 2061 7320 6073  calculated as `s
+00003bb0: 7172 7428 7363 616c 6529 202f 206d 6174  qrt(scale) / mat
+00003bc0: 7269 7820 6e6f 726d 602e 0a20 2020 2046  rix norm`..    F
+00003bd0: 696e 616c 6c79 2c20 7468 6520 7265 7375  inally, the resu
+00003be0: 6c74 2069 7320 7265 7475 726e 6564 2061  lt is returned a
+00003bf0: 7320 6069 6e70 7574 5f74 656e 736f 7220  s `input_tensor 
+00003c00: 2a20 6e6f 726d 2076 616c 7565 602e 0a0a  * norm value`...
+00003c10: 2020 2020 5468 6973 206c 6179 6572 2063      This layer c
+00003c20: 616e 2062 6520 7573 6564 2069 6e73 7465  an be used inste
+00003c30: 6164 206f 6620 4c61 7965 724e 6f72 6d20  ad of LayerNorm 
+00003c40: 7768 656e 2061 2073 6361 6c65 6420 7665  when a scaled ve
+00003c50: 7273 696f 6e20 6f66 2074 6865 206e 6f72  rsion of the nor
+00003c60: 6d20 6973 2072 6571 7569 7265 642e 0a20  m is required.. 
+00003c70: 2020 2049 6e73 7465 6164 206f 6620 7065     Instead of pe
+00003c80: 7266 6f72 6d69 6e67 2074 6865 2073 6361  rforming the sca
+00003c90: 6c69 6e67 206f 7065 7261 7469 6f6e 2028  ling operation (
+00003ca0: 6073 6361 6c65 202f 206e 6f72 6d60 2920  `scale / norm`) 
+00003cb0: 696e 2061 206c 616d 6264 612d 6c69 6b65  in a lambda-like
+00003cc0: 206c 6179 6572 2c20 7765 2061 7265 2064   layer, we are d
+00003cd0: 6566 696e 696e 6720 6974 2077 6974 6869  efining it withi
+00003ce0: 6e20 7468 6973 206c 6179 6572 2074 6f20  n this layer to 
+00003cf0: 6d61 6b65 2070 726f 746f 7479 7069 6e67  make prototyping
+00003d00: 206d 6f72 6520 6566 6669 6369 656e 742e   more efficient.
+00003d10: 0a0a 2020 2020 5265 6665 7265 6e63 6573  ..    References
+00003d20: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+00003d30: 2020 2020 2e2e 205b 315d 204c 756b 6173      .. [1] Lukas
+00003d40: 7a20 4d61 7a69 6172 6b61 2065 7420 616c  z Maziarka et al
+00003d50: 2e20 224d 6f6c 6563 756c 6520 4174 7465  . "Molecule Atte
+00003d60: 6e74 696f 6e20 5472 616e 7366 6f72 6d65  ntion Transforme
+00003d70: 7222 2047 7261 7068 2052 6570 7265 7365  r" Graph Represe
+00003d80: 6e74 6174 696f 6e20 4c65 6172 6e69 6e67  ntation Learning
+00003d90: 2077 6f72 6b73 686f 7020 616e 6420 4d61   workshop and Ma
+00003da0: 6368 696e 6520 4c65 6172 6e69 6e67 2061  chine Learning a
+00003db0: 6e64 2074 6865 2050 6879 7369 6361 6c20  nd the Physical 
+00003dc0: 5363 6965 6e63 6573 2077 6f72 6b73 686f  Sciences worksho
+00003dd0: 7020 6174 204e 6575 7249 5053 2032 3031  p at NeurIPS 201
+00003de0: 392e 2032 3032 302e 2068 7474 7073 3a2f  9. 2020. https:/
+00003df0: 2f61 7278 6976 2e6f 7267 2f61 6273 2f32  /arxiv.org/abs/2
+00003e00: 3030 322e 3038 3236 340a 0a20 2020 2045  002.08264..    E
+00003e10: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
+00003e20: 2d2d 2d2d 0a20 2020 203e 3e3e 2066 726f  ----.    >>> fro
+00003e30: 6d20 6465 6570 6368 656d 2e6d 6f64 656c  m deepchem.model
+00003e40: 732e 746f 7263 685f 6d6f 6465 6c73 2e6c  s.torch_models.l
+00003e50: 6179 6572 7320 696d 706f 7274 2053 6361  ayers import Sca
+00003e60: 6c65 4e6f 726d 0a20 2020 203e 3e3e 2073  leNorm.    >>> s
+00003e70: 6361 6c65 203d 2030 2e33 350a 2020 2020  cale = 0.35.    
+00003e80: 3e3e 3e20 6c61 7965 7220 3d20 5363 616c  >>> layer = Scal
+00003e90: 654e 6f72 6d28 7363 616c 6529 0a20 2020  eNorm(scale).   
+00003ea0: 203e 3e3e 2069 6e70 7574 5f74 656e 736f   >>> input_tenso
+00003eb0: 7220 3d20 746f 7263 682e 7465 6e73 6f72  r = torch.tensor
+00003ec0: 285b 5b31 2e32 3639 2c20 3339 2e33 365d  ([[1.269, 39.36]
+00003ed0: 2c20 5b30 2e30 3039 3138 2c20 2d39 2e31  , [0.00918, -9.1
+00003ee0: 325d 5d29 0a20 2020 203e 3e3e 206f 7574  2]]).    >>> out
+00003ef0: 7075 745f 7465 6e73 6f72 203d 206c 6179  put_tensor = lay
+00003f00: 6572 2869 6e70 7574 5f74 656e 736f 7229  er(input_tensor)
+00003f10: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00003f20: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00003f30: 2073 6361 6c65 3a20 666c 6f61 742c 2065   scale: float, e
+00003f40: 7073 3a20 666c 6f61 7420 3d20 3165 2d35  ps: float = 1e-5
+00003f50: 293a 0a20 2020 2020 2020 2022 2222 496e  ):.        """In
+00003f60: 6974 6961 6c69 7a65 2061 2053 6361 6c65  itialize a Scale
+00003f70: 4e6f 726d 206c 6179 6572 2e0a 0a20 2020  Norm layer...   
+00003f80: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00003f90: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00003fa0: 2d2d 0a20 2020 2020 2020 2073 6361 6c65  --.        scale
+00003fb0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00003fc0: 2020 2020 5363 616c 6520 6d61 676e 6974      Scale magnit
+00003fd0: 7564 652e 0a20 2020 2020 2020 2065 7073  ude..        eps
+00003fe0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00003ff0: 2020 2020 4570 7369 6c6f 6e20 7661 6c75      Epsilon valu
+00004000: 652e 2044 6566 6175 6c74 203d 2031 652d  e. Default = 1e-
+00004010: 352e 0a20 2020 2020 2020 2022 2222 0a20  5..        """. 
+00004020: 2020 2020 2020 2073 7570 6572 2853 6361         super(Sca
+00004030: 6c65 4e6f 726d 2c20 7365 6c66 292e 5f5f  leNorm, self).__
+00004040: 696e 6974 5f5f 2829 0a20 2020 2020 2020  init__().       
+00004050: 2073 656c 662e 7363 616c 6520 3d20 6e6e   self.scale = nn
+00004060: 2e50 6172 616d 6574 6572 2874 6f72 6368  .Parameter(torch
+00004070: 2e74 656e 736f 7228 6d61 7468 2e73 7172  .tensor(math.sqr
+00004080: 7428 7363 616c 6529 2929 0a20 2020 2020  t(scale))).     
+00004090: 2020 2073 656c 662e 6570 7320 3d20 6570     self.eps = ep
+000040a0: 730a 0a20 2020 2064 6566 2066 6f72 7761  s..    def forwa
+000040b0: 7264 2873 656c 662c 2078 3a20 746f 7263  rd(self, x: torc
+000040c0: 682e 5465 6e73 6f72 2920 2d3e 2074 6f72  h.Tensor) -> tor
+000040d0: 6368 2e54 656e 736f 723a 0a20 2020 2020  ch.Tensor:.     
+000040e0: 2020 206e 6f72 6d20 3d20 7365 6c66 2e73     norm = self.s
+000040f0: 6361 6c65 202f 2074 6f72 6368 2e6e 6f72  cale / torch.nor
+00004100: 6d28 782c 2064 696d 3d2d 312c 0a20 2020  m(x, dim=-1,.   
 00004110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004120: 2020 2020 2020 206b 6565 7064 696d 3d54         keepdim=T
-00004130: 7275 6529 2e63 6c61 6d70 286d 696e 3d73  rue).clamp(min=s
-00004140: 656c 662e 6570 7329 0a20 2020 2020 2020  elf.eps).       
-00004150: 2072 6574 7572 6e20 7820 2a20 6e6f 726d   return x * norm
-00004160: 0a0a 0a63 6c61 7373 204d 756c 7469 4865  ...class MultiHe
-00004170: 6164 6564 4d41 5441 7474 656e 7469 6f6e  adedMATAttention
-00004180: 286e 6e2e 4d6f 6475 6c65 293a 0a20 2020  (nn.Module):.   
-00004190: 2022 2222 4669 7273 7420 636f 6e73 7472   """First constr
-000041a0: 7563 7473 2061 6e20 6174 7465 6e74 696f  ucts an attentio
-000041b0: 6e20 6c61 7965 7220 7461 696c 6f72 6564  n layer tailored
-000041c0: 2074 6f20 7468 6520 4d6f 6c65 6375 6c61   to the Molecula
-000041d0: 7220 4174 7465 6e74 696f 6e20 5472 616e  r Attention Tran
-000041e0: 7366 6f72 6d65 7220 5b31 5d5f 2061 6e64  sformer [1]_ and
-000041f0: 2074 6865 6e20 636f 6e76 6572 7473 2069   then converts i
-00004200: 7420 696e 746f 204d 756c 7469 2d48 6561  t into Multi-Hea
-00004210: 6465 6420 4174 7465 6e74 696f 6e2e 0a0a  ded Attention...
-00004220: 2020 2020 496e 204d 756c 7469 2d48 6561      In Multi-Hea
-00004230: 6465 6420 6174 7465 6e74 696f 6e20 7468  ded attention th
-00004240: 6520 6174 7465 6e74 696f 6e20 6d65 6368  e attention mech
-00004250: 616e 6973 6d20 6d75 6c74 6970 6c65 2074  anism multiple t
-00004260: 696d 6573 2070 6172 616c 6c65 6c79 2074  imes parallely t
-00004270: 6872 6f75 6768 2074 6865 206d 756c 7469  hrough the multi
-00004280: 706c 6520 6174 7465 6e74 696f 6e20 6865  ple attention he
-00004290: 6164 732e 0a20 2020 2054 6875 732c 2064  ads..    Thus, d
-000042a0: 6966 6665 7265 6e74 2073 7562 7365 7175  ifferent subsequ
-000042b0: 656e 6365 7320 6f66 2061 2067 6976 656e  ences of a given
-000042c0: 2073 6571 7565 6e63 6573 2063 616e 2062   sequences can b
-000042d0: 6520 7072 6f63 6573 7365 6420 6469 6666  e processed diff
-000042e0: 6572 656e 746c 792e 0a20 2020 2054 6865  erently..    The
-000042f0: 2071 7565 7279 2c20 6b65 7920 616e 6420   query, key and 
-00004300: 7661 6c75 6520 7061 7261 6d65 7465 7273  value parameters
-00004310: 2061 7265 2073 706c 6974 206d 756c 7469   are split multi
-00004320: 706c 6520 7761 7973 2061 6e64 2065 6163  ple ways and eac
-00004330: 6820 7370 6c69 7420 6973 2070 6173 7365  h split is passe
-00004340: 6420 7365 7061 7261 7465 6c79 2074 6872  d separately thr
-00004350: 6f75 6768 2061 2064 6966 6665 7265 6e74  ough a different
-00004360: 2061 7474 656e 7469 6f6e 2068 6561 642e   attention head.
-00004370: 0a20 2020 2052 6566 6572 656e 6365 730a  .    References.
-00004380: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00004390: 2020 202e 2e20 5b31 5d20 4c75 6b61 737a     .. [1] Lukasz
-000043a0: 204d 617a 6961 726b 6120 6574 2061 6c2e   Maziarka et al.
-000043b0: 2022 4d6f 6c65 6375 6c65 2041 7474 656e   "Molecule Atten
-000043c0: 7469 6f6e 2054 7261 6e73 666f 726d 6572  tion Transformer
-000043d0: 2220 4772 6170 6820 5265 7072 6573 656e  " Graph Represen
-000043e0: 7461 7469 6f6e 204c 6561 726e 696e 6720  tation Learning 
-000043f0: 776f 726b 7368 6f70 2061 6e64 204d 6163  workshop and Mac
-00004400: 6869 6e65 204c 6561 726e 696e 6720 616e  hine Learning an
-00004410: 6420 7468 6520 5068 7973 6963 616c 2053  d the Physical S
-00004420: 6369 656e 6365 7320 776f 726b 7368 6f70  ciences workshop
-00004430: 2061 7420 4e65 7572 4950 5320 3230 3139   at NeurIPS 2019
-00004440: 2e20 3230 3230 2e20 6874 7470 733a 2f2f  . 2020. https://
-00004450: 6172 7869 762e 6f72 672f 6162 732f 3230  arxiv.org/abs/20
-00004460: 3032 2e30 3832 3634 0a20 2020 2045 7861  02.08264.    Exa
-00004470: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
-00004480: 2d2d 0a20 2020 203e 3e3e 2066 726f 6d20  --.    >>> from 
-00004490: 6465 6570 6368 656d 2e6d 6f64 656c 732e  deepchem.models.
-000044a0: 746f 7263 685f 6d6f 6465 6c73 2e6c 6179  torch_models.lay
-000044b0: 6572 7320 696d 706f 7274 204d 756c 7469  ers import Multi
-000044c0: 4865 6164 6564 4d41 5441 7474 656e 7469  HeadedMATAttenti
-000044d0: 6f6e 2c20 4d41 5445 6d62 6564 6469 6e67  on, MATEmbedding
-000044e0: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
-000044f0: 6465 6570 6368 656d 2061 7320 6463 0a20  deepchem as dc. 
-00004500: 2020 203e 3e3e 2069 6d70 6f72 7420 746f     >>> import to
-00004510: 7263 680a 2020 2020 3e3e 3e20 696e 7075  rch.    >>> inpu
-00004520: 745f 736d 696c 6520 3d20 2243 4322 0a20  t_smile = "CC". 
-00004530: 2020 203e 3e3e 2066 6561 7420 3d20 6463     >>> feat = dc
-00004540: 2e66 6561 742e 4d41 5446 6561 7475 7269  .feat.MATFeaturi
-00004550: 7a65 7228 290a 2020 2020 3e3e 3e20 696e  zer().    >>> in
-00004560: 7075 745f 736d 696c 6520 3d20 2243 4322  put_smile = "CC"
-00004570: 0a20 2020 203e 3e3e 206f 7574 203d 2066  .    >>> out = f
-00004580: 6561 742e 6665 6174 7572 697a 6528 696e  eat.featurize(in
-00004590: 7075 745f 736d 696c 6529 0a20 2020 203e  put_smile).    >
-000045a0: 3e3e 206e 6f64 6520 3d20 746f 7263 682e  >> node = torch.
-000045b0: 7465 6e73 6f72 286f 7574 5b30 5d2e 6e6f  tensor(out[0].no
-000045c0: 6465 5f66 6561 7475 7265 7329 2e66 6c6f  de_features).flo
-000045d0: 6174 2829 2e75 6e73 7175 6565 7a65 2830  at().unsqueeze(0
-000045e0: 290a 2020 2020 3e3e 3e20 6164 6a20 3d20  ).    >>> adj = 
-000045f0: 746f 7263 682e 7465 6e73 6f72 286f 7574  torch.tensor(out
-00004600: 5b30 5d2e 6164 6a61 6365 6e63 795f 6d61  [0].adjacency_ma
-00004610: 7472 6978 292e 666c 6f61 7428 292e 756e  trix).float().un
-00004620: 7371 7565 657a 6528 3029 0a20 2020 203e  squeeze(0).    >
-00004630: 3e3e 2064 6973 7420 3d20 746f 7263 682e  >> dist = torch.
-00004640: 7465 6e73 6f72 286f 7574 5b30 5d2e 6469  tensor(out[0].di
-00004650: 7374 616e 6365 5f6d 6174 7269 7829 2e66  stance_matrix).f
-00004660: 6c6f 6174 2829 2e75 6e73 7175 6565 7a65  loat().unsqueeze
-00004670: 2830 290a 2020 2020 3e3e 3e20 6d61 736b  (0).    >>> mask
-00004680: 203d 2074 6f72 6368 2e73 756d 2874 6f72   = torch.sum(tor
-00004690: 6368 2e61 6273 286e 6f64 6529 2c20 6469  ch.abs(node), di
-000046a0: 6d3d 2d31 2920 213d 2030 0a20 2020 203e  m=-1) != 0.    >
-000046b0: 3e3e 206c 6179 6572 203d 204d 756c 7469  >> layer = Multi
-000046c0: 4865 6164 6564 4d41 5441 7474 656e 7469  HeadedMATAttenti
-000046d0: 6f6e 280a 2020 2020 2e2e 2e20 2020 2064  on(.    ...    d
-000046e0: 6973 745f 6b65 726e 656c 3d27 736f 6674  ist_kernel='soft
-000046f0: 6d61 7827 2c0a 2020 2020 2e2e 2e20 2020  max',.    ...   
-00004700: 206c 616d 6264 615f 6174 7465 6e74 696f   lambda_attentio
-00004710: 6e3d 302e 3333 2c0a 2020 2020 2e2e 2e20  n=0.33,.    ... 
-00004720: 2020 206c 616d 6264 615f 6469 7374 616e     lambda_distan
-00004730: 6365 3d30 2e33 332c 0a20 2020 202e 2e2e  ce=0.33,.    ...
-00004740: 2020 2020 683d 3136 2c0a 2020 2020 2e2e      h=16,.    ..
-00004750: 2e20 2020 2068 7369 7a65 3d31 3032 342c  .    hsize=1024,
-00004760: 0a20 2020 202e 2e2e 2020 2020 6472 6f70  .    ...    drop
-00004770: 6f75 745f 703d 302e 3029 0a20 2020 203e  out_p=0.0).    >
-00004780: 3e3e 206f 7020 3d20 4d41 5445 6d62 6564  >> op = MATEmbed
-00004790: 6469 6e67 2829 286e 6f64 6529 0a20 2020  ding()(node).   
-000047a0: 203e 3e3e 206f 7574 7075 7420 3d20 6c61   >>> output = la
-000047b0: 7965 7228 6f70 2c20 6f70 2c20 6f70 2c20  yer(op, op, op, 
-000047c0: 6d61 736b 2c20 6164 6a2c 2064 6973 7429  mask, adj, dist)
-000047d0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-000047e0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-000047f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004800: 2020 6469 7374 5f6b 6572 6e65 6c3a 2073    dist_kernel: s
-00004810: 7472 203d 2027 736f 6674 6d61 7827 2c0a  tr = 'softmax',.
-00004820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004830: 206c 616d 6264 615f 6174 7465 6e74 696f   lambda_attentio
-00004840: 6e3a 2066 6c6f 6174 203d 2030 2e33 332c  n: float = 0.33,
-00004850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004860: 2020 6c61 6d62 6461 5f64 6973 7461 6e63    lambda_distanc
-00004870: 653a 2066 6c6f 6174 203d 2030 2e33 332c  e: float = 0.33,
-00004880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004890: 2020 683a 2069 6e74 203d 2031 362c 0a20    h: int = 16,. 
-000048a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048b0: 6873 697a 653a 2069 6e74 203d 2031 3032  hsize: int = 102
-000048c0: 342c 0a20 2020 2020 2020 2020 2020 2020  4,.             
-000048d0: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
-000048e0: 6c6f 6174 203d 2030 2e30 2c0a 2020 2020  loat = 0.0,.    
-000048f0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-00004900: 7075 745f 6269 6173 3a20 626f 6f6c 203d  put_bias: bool =
-00004910: 2054 7275 6529 3a0a 2020 2020 2020 2020   True):.        
-00004920: 2222 2249 6e69 7469 616c 697a 6520 6120  """Initialize a 
-00004930: 6d75 6c74 692d 6865 6164 6564 2061 7474  multi-headed att
-00004940: 656e 7469 6f6e 206c 6179 6572 2e0a 2020  ention layer..  
-00004950: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00004960: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00004970: 2d2d 2d0a 2020 2020 2020 2020 6469 7374  ---.        dist
-00004980: 5f6b 6572 6e65 6c3a 2073 7472 0a20 2020  _kernel: str.   
-00004990: 2020 2020 2020 2020 204b 6572 6e65 6c20           Kernel 
-000049a0: 6163 7469 7661 7469 6f6e 2074 6f20 6265  activation to be
-000049b0: 2075 7365 642e 2043 616e 2062 6520 6569   used. Can be ei
-000049c0: 7468 6572 2027 736f 6674 6d61 7827 2066  ther 'softmax' f
-000049d0: 6f72 2073 6f66 746d 6178 206f 7220 2765  or softmax or 'e
-000049e0: 7870 2720 666f 7220 6578 706f 6e65 6e74  xp' for exponent
-000049f0: 6961 6c2e 0a20 2020 2020 2020 206c 616d  ial..        lam
-00004a00: 6264 615f 6174 7465 6e74 696f 6e3a 2066  bda_attention: f
-00004a10: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-00004a20: 2043 6f6e 7374 616e 7420 746f 2062 6520   Constant to be 
-00004a30: 6d75 6c74 6970 6c69 6564 2077 6974 6820  multiplied with 
-00004a40: 7468 6520 6174 7465 6e74 696f 6e20 6d61  the attention ma
-00004a50: 7472 6978 2e0a 2020 2020 2020 2020 6c61  trix..        la
-00004a60: 6d62 6461 5f64 6973 7461 6e63 653a 2066  mbda_distance: f
-00004a70: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-00004a80: 2043 6f6e 7374 616e 7420 746f 2062 6520   Constant to be 
-00004a90: 6d75 6c74 6970 6c69 6564 2077 6974 6820  multiplied with 
-00004aa0: 7468 6520 6469 7374 616e 6365 206d 6174  the distance mat
-00004ab0: 7269 782e 0a20 2020 2020 2020 2068 3a20  rix..        h: 
-00004ac0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00004ad0: 4e75 6d62 6572 206f 6620 6174 7465 6e74  Number of attent
-00004ae0: 696f 6e20 6865 6164 732e 0a20 2020 2020  ion heads..     
-00004af0: 2020 2068 7369 7a65 3a20 696e 740a 2020     hsize: int.  
-00004b00: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
-00004b10: 6620 6465 6e73 6520 6c61 7965 722e 0a20  f dense layer.. 
-00004b20: 2020 2020 2020 2064 726f 706f 7574 5f70         dropout_p
-00004b30: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-00004b40: 2020 2020 4472 6f70 6f75 7420 7072 6f62      Dropout prob
-00004b50: 6162 696c 6974 792e 0a20 2020 2020 2020  ability..       
-00004b60: 206f 7574 7075 745f 6269 6173 3a20 626f   output_bias: bo
-00004b70: 6f6c 0a20 2020 2020 2020 2020 2020 2049  ol.            I
-00004b80: 6620 5472 7565 2c20 6465 6e73 6520 6c61  f True, dense la
-00004b90: 7965 7273 2077 696c 6c20 7573 6520 6269  yers will use bi
-00004ba0: 6173 2076 6563 746f 7273 2e0a 2020 2020  as vectors..    
-00004bb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00004bc0: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
-00004bd0: 2829 0a20 2020 2020 2020 2069 6620 6469  ().        if di
-00004be0: 7374 5f6b 6572 6e65 6c20 3d3d 2022 736f  st_kernel == "so
-00004bf0: 6674 6d61 7822 3a0a 2020 2020 2020 2020  ftmax":.        
-00004c00: 2020 2020 7365 6c66 2e64 6973 745f 6b65      self.dist_ke
-00004c10: 726e 656c 203d 206c 616d 6264 6120 783a  rnel = lambda x:
-00004c20: 2074 6f72 6368 2e73 6f66 746d 6178 282d   torch.softmax(-
-00004c30: 782c 2064 696d 3d2d 3129 0a20 2020 2020  x, dim=-1).     
-00004c40: 2020 2065 6c69 6620 6469 7374 5f6b 6572     elif dist_ker
-00004c50: 6e65 6c20 3d3d 2022 6578 7022 3a0a 2020  nel == "exp":.  
-00004c60: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00004c70: 6973 745f 6b65 726e 656c 203d 206c 616d  ist_kernel = lam
-00004c80: 6264 6120 783a 2074 6f72 6368 2e65 7870  bda x: torch.exp
-00004c90: 282d 7829 0a20 2020 2020 2020 2073 656c  (-x).        sel
-00004ca0: 662e 6c61 6d62 6461 5f61 7474 656e 7469  f.lambda_attenti
-00004cb0: 6f6e 203d 206c 616d 6264 615f 6174 7465  on = lambda_atte
-00004cc0: 6e74 696f 6e0a 2020 2020 2020 2020 7365  ntion.        se
-00004cd0: 6c66 2e6c 616d 6264 615f 6469 7374 616e  lf.lambda_distan
-00004ce0: 6365 203d 206c 616d 6264 615f 6469 7374  ce = lambda_dist
-00004cf0: 616e 6365 0a20 2020 2020 2020 2073 656c  ance.        sel
-00004d00: 662e 6c61 6d62 6461 5f61 646a 6163 656e  f.lambda_adjacen
-00004d10: 6379 203d 2031 2e30 202d 2073 656c 662e  cy = 1.0 - self.
-00004d20: 6c61 6d62 6461 5f61 7474 656e 7469 6f6e  lambda_attention
-00004d30: 202d 2073 656c 662e 6c61 6d62 6461 5f64   - self.lambda_d
-00004d40: 6973 7461 6e63 650a 2020 2020 2020 2020  istance.        
-00004d50: 7365 6c66 2e64 5f6b 203d 2068 7369 7a65  self.d_k = hsize
-00004d60: 202f 2f20 680a 2020 2020 2020 2020 7365   // h.        se
-00004d70: 6c66 2e68 203d 2068 0a20 2020 2020 2020  lf.h = h.       
-00004d80: 206c 696e 6561 725f 6c61 7965 7220 3d20   linear_layer = 
-00004d90: 6e6e 2e4c 696e 6561 7228 6873 697a 652c  nn.Linear(hsize,
-00004da0: 2068 7369 7a65 290a 2020 2020 2020 2020   hsize).        
-00004db0: 7365 6c66 2e6c 696e 6561 725f 6c61 7965  self.linear_laye
-00004dc0: 7273 203d 206e 6e2e 4d6f 6475 6c65 4c69  rs = nn.ModuleLi
-00004dd0: 7374 285b 6c69 6e65 6172 5f6c 6179 6572  st([linear_layer
-00004de0: 2066 6f72 205f 2069 6e20 7261 6e67 6528   for _ in range(
-00004df0: 3329 5d29 0a20 2020 2020 2020 2073 656c  3)]).        sel
-00004e00: 662e 6472 6f70 6f75 745f 7020 3d20 6e6e  f.dropout_p = nn
-00004e10: 2e44 726f 706f 7574 2864 726f 706f 7574  .Dropout(dropout
-00004e20: 5f70 290a 2020 2020 2020 2020 7365 6c66  _p).        self
-00004e30: 2e6f 7574 7075 745f 6c69 6e65 6172 203d  .output_linear =
-00004e40: 206e 6e2e 4c69 6e65 6172 2868 7369 7a65   nn.Linear(hsize
-00004e50: 2c20 6873 697a 652c 206f 7574 7075 745f  , hsize, output_
-00004e60: 6269 6173 290a 0a20 2020 2064 6566 205f  bias)..    def _
-00004e70: 7369 6e67 6c65 5f61 7474 656e 7469 6f6e  single_attention
-00004e80: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00004e90: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00004ea0: 7175 6572 793a 2074 6f72 6368 2e54 656e  query: torch.Ten
-00004eb0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
-00004ec0: 206b 6579 3a20 746f 7263 682e 5465 6e73   key: torch.Tens
-00004ed0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00004ee0: 7661 6c75 653a 2074 6f72 6368 2e54 656e  value: torch.Ten
-00004ef0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
-00004f00: 206d 6173 6b3a 2074 6f72 6368 2e54 656e   mask: torch.Ten
-00004f10: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
-00004f20: 2061 646a 5f6d 6174 7269 783a 2074 6f72   adj_matrix: tor
-00004f30: 6368 2e54 656e 736f 722c 0a20 2020 2020  ch.Tensor,.     
-00004f40: 2020 2020 2020 2064 6973 7461 6e63 655f         distance_
-00004f50: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
-00004f60: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
-00004f70: 2020 6472 6f70 6f75 745f 703a 2066 6c6f    dropout_p: flo
-00004f80: 6174 203d 2030 2e30 2c0a 2020 2020 2020  at = 0.0,.      
-00004f90: 2020 2020 2020 6570 733a 2066 6c6f 6174        eps: float
-00004fa0: 203d 2031 652d 362c 0a20 2020 2020 2020   = 1e-6,.       
-00004fb0: 2020 2020 2069 6e66 3a20 666c 6f61 7420       inf: float 
-00004fc0: 3d20 3165 3132 2920 2d3e 2054 7570 6c65  = 1e12) -> Tuple
-00004fd0: 5b74 6f72 6368 2e54 656e 736f 722c 2074  [torch.Tensor, t
-00004fe0: 6f72 6368 2e54 656e 736f 725d 3a0a 2020  orch.Tensor]:.  
-00004ff0: 2020 2020 2020 2222 2244 6566 696e 696e        """Definin
-00005000: 6720 616e 6420 636f 6d70 7574 696e 6720  g and computing 
-00005010: 6f75 7470 7574 2066 6f72 2061 2073 696e  output for a sin
-00005020: 676c 6520 4d41 5420 6174 7465 6e74 696f  gle MAT attentio
-00005030: 6e20 6c61 7965 722e 0a20 2020 2020 2020  n layer..       
-00005040: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00005050: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00005060: 2020 2020 2020 2071 7565 7279 3a20 746f         query: to
-00005070: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-00005080: 2020 2020 2020 2053 7461 6e64 6172 6420         Standard 
-00005090: 7175 6572 7920 7061 7261 6d65 7465 7220  query parameter 
-000050a0: 666f 7220 6174 7465 6e74 696f 6e2e 0a20  for attention.. 
-000050b0: 2020 2020 2020 206b 6579 3a20 746f 7263         key: torc
-000050c0: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-000050d0: 2020 2020 2053 7461 6e64 6172 6420 6b65       Standard ke
-000050e0: 7920 7061 7261 6d65 7465 7220 666f 7220  y parameter for 
-000050f0: 6174 7465 6e74 696f 6e2e 0a20 2020 2020  attention..     
-00005100: 2020 2076 616c 7565 3a20 746f 7263 682e     value: torch.
-00005110: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00005120: 2020 2053 7461 6e64 6172 6420 7661 6c75     Standard valu
-00005130: 6520 7061 7261 6d65 7465 7220 666f 7220  e parameter for 
-00005140: 6174 7465 6e74 696f 6e2e 0a20 2020 2020  attention..     
-00005150: 2020 206d 6173 6b3a 2074 6f72 6368 2e54     mask: torch.T
-00005160: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00005170: 2020 4d61 736b 7320 6f75 7420 7061 6464    Masks out padd
-00005180: 696e 6720 7661 6c75 6573 2073 6f20 7468  ing values so th
-00005190: 6174 2074 6865 7920 6172 6520 6e6f 7420  at they are not 
-000051a0: 7461 6b65 6e20 696e 746f 2061 6363 6f75  taken into accou
-000051b0: 6e74 2077 6865 6e20 636f 6d70 7574 696e  nt when computin
-000051c0: 6720 7468 6520 6174 7465 6e74 696f 6e20  g the attention 
-000051d0: 7363 6f72 652e 0a20 2020 2020 2020 2061  score..        a
-000051e0: 646a 5f6d 6174 7269 783a 2074 6f72 6368  dj_matrix: torch
-000051f0: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-00005200: 2020 2020 4164 6a61 6365 6e63 7920 6d61      Adjacency ma
-00005210: 7472 6978 206f 6620 7468 6520 696e 7075  trix of the inpu
-00005220: 7420 6d6f 6c65 6375 6c65 2c20 7265 7475  t molecule, retu
-00005230: 726e 6564 2066 726f 6d20 6463 2e66 6561  rned from dc.fea
-00005240: 742e 4d41 5446 6561 7475 7269 7a65 7228  t.MATFeaturizer(
-00005250: 290a 2020 2020 2020 2020 6469 7374 5f6d  ).        dist_m
-00005260: 6174 7269 783a 2074 6f72 6368 2e54 656e  atrix: torch.Ten
-00005270: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00005280: 4469 7374 616e 6365 206d 6174 7269 7820  Distance matrix 
-00005290: 6f66 2074 6865 2069 6e70 7574 206d 6f6c  of the input mol
-000052a0: 6563 756c 652c 2072 6574 7572 6e65 6420  ecule, returned 
-000052b0: 6672 6f6d 2064 632e 6665 6174 2e4d 4154  from dc.feat.MAT
-000052c0: 4665 6174 7572 697a 6572 2829 0a20 2020  Featurizer().   
-000052d0: 2020 2020 2064 726f 706f 7574 5f70 3a20       dropout_p: 
-000052e0: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-000052f0: 2020 4472 6f70 6f75 7420 7072 6f62 6162    Dropout probab
-00005300: 696c 6974 792e 0a20 2020 2020 2020 2065  ility..        e
-00005310: 7073 3a20 666c 6f61 740a 2020 2020 2020  ps: float.      
-00005320: 2020 2020 2020 4570 7369 6c6f 6e20 7661        Epsilon va
-00005330: 6c75 650a 2020 2020 2020 2020 696e 663a  lue.        inf:
-00005340: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
-00005350: 2020 2056 616c 7565 206f 6620 696e 6669     Value of infi
-00005360: 6e69 7479 2074 6f20 6265 2075 7365 642e  nity to be used.
-00005370: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00005380: 2020 2020 2064 5f6b 203d 2071 7565 7279       d_k = query
-00005390: 2e73 697a 6528 2d31 290a 0a20 2020 2020  .size(-1)..     
-000053a0: 2020 2073 636f 7265 7320 3d20 746f 7263     scores = torc
-000053b0: 682e 6d61 746d 756c 2871 7565 7279 2c20  h.matmul(query, 
-000053c0: 6b65 792e 7472 616e 7370 6f73 6528 2d32  key.transpose(-2
-000053d0: 2c20 2d31 2929 202f 206d 6174 682e 7371  , -1)) / math.sq
-000053e0: 7274 2864 5f6b 290a 0a20 2020 2020 2020  rt(d_k)..       
-000053f0: 2069 6620 6d61 736b 2069 7320 6e6f 7420   if mask is not 
-00005400: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00005410: 2020 7363 6f72 6573 203d 2073 636f 7265    scores = score
-00005420: 732e 6d61 736b 6564 5f66 696c 6c28 0a20  s.masked_fill(. 
-00005430: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00005440: 6173 6b2e 756e 7371 7565 657a 6528 3129  ask.unsqueeze(1)
-00005450: 2e72 6570 6561 7428 312c 2071 7565 7279  .repeat(1, query
-00005460: 2e73 6861 7065 5b31 5d2c 2071 7565 7279  .shape[1], query
-00005470: 2e73 6861 7065 5b32 5d2c 0a20 2020 2020  .shape[2],.     
-00005480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004130: 2020 2020 6b65 6570 6469 6d3d 5472 7565      keepdim=True
+00004140: 292e 636c 616d 7028 6d69 6e3d 7365 6c66  ).clamp(min=self
+00004150: 2e65 7073 290a 2020 2020 2020 2020 7265  .eps).        re
+00004160: 7475 726e 2078 202a 206e 6f72 6d0a 0a0a  turn x * norm...
+00004170: 636c 6173 7320 4d75 6c74 6948 6561 6465  class MultiHeade
+00004180: 644d 4154 4174 7465 6e74 696f 6e28 6e6e  dMATAttention(nn
+00004190: 2e4d 6f64 756c 6529 3a0a 2020 2020 2222  .Module):.    ""
+000041a0: 2246 6972 7374 2063 6f6e 7374 7275 6374  "First construct
+000041b0: 7320 616e 2061 7474 656e 7469 6f6e 206c  s an attention l
+000041c0: 6179 6572 2074 6169 6c6f 7265 6420 746f  ayer tailored to
+000041d0: 2074 6865 204d 6f6c 6563 756c 6172 2041   the Molecular A
+000041e0: 7474 656e 7469 6f6e 2054 7261 6e73 666f  ttention Transfo
+000041f0: 726d 6572 205b 315d 5f20 616e 6420 7468  rmer [1]_ and th
+00004200: 656e 2063 6f6e 7665 7274 7320 6974 2069  en converts it i
+00004210: 6e74 6f20 4d75 6c74 692d 4865 6164 6564  nto Multi-Headed
+00004220: 2041 7474 656e 7469 6f6e 2e0a 0a20 2020   Attention...   
+00004230: 2049 6e20 4d75 6c74 692d 4865 6164 6564   In Multi-Headed
+00004240: 2061 7474 656e 7469 6f6e 2074 6865 2061   attention the a
+00004250: 7474 656e 7469 6f6e 206d 6563 6861 6e69  ttention mechani
+00004260: 736d 206d 756c 7469 706c 6520 7469 6d65  sm multiple time
+00004270: 7320 7061 7261 6c6c 656c 7920 7468 726f  s parallely thro
+00004280: 7567 6820 7468 6520 6d75 6c74 6970 6c65  ugh the multiple
+00004290: 2061 7474 656e 7469 6f6e 2068 6561 6473   attention heads
+000042a0: 2e0a 2020 2020 5468 7573 2c20 6469 6666  ..    Thus, diff
+000042b0: 6572 656e 7420 7375 6273 6571 7565 6e63  erent subsequenc
+000042c0: 6573 206f 6620 6120 6769 7665 6e20 7365  es of a given se
+000042d0: 7175 656e 6365 7320 6361 6e20 6265 2070  quences can be p
+000042e0: 726f 6365 7373 6564 2064 6966 6665 7265  rocessed differe
+000042f0: 6e74 6c79 2e0a 2020 2020 5468 6520 7175  ntly..    The qu
+00004300: 6572 792c 206b 6579 2061 6e64 2076 616c  ery, key and val
+00004310: 7565 2070 6172 616d 6574 6572 7320 6172  ue parameters ar
+00004320: 6520 7370 6c69 7420 6d75 6c74 6970 6c65  e split multiple
+00004330: 2077 6179 7320 616e 6420 6561 6368 2073   ways and each s
+00004340: 706c 6974 2069 7320 7061 7373 6564 2073  plit is passed s
+00004350: 6570 6172 6174 656c 7920 7468 726f 7567  eparately throug
+00004360: 6820 6120 6469 6666 6572 656e 7420 6174  h a different at
+00004370: 7465 6e74 696f 6e20 6865 6164 2e0a 2020  tention head..  
+00004380: 2020 5265 6665 7265 6e63 6573 0a20 2020    References.   
+00004390: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+000043a0: 2e2e 205b 315d 204c 756b 6173 7a20 4d61  .. [1] Lukasz Ma
+000043b0: 7a69 6172 6b61 2065 7420 616c 2e20 224d  ziarka et al. "M
+000043c0: 6f6c 6563 756c 6520 4174 7465 6e74 696f  olecule Attentio
+000043d0: 6e20 5472 616e 7366 6f72 6d65 7222 2047  n Transformer" G
+000043e0: 7261 7068 2052 6570 7265 7365 6e74 6174  raph Representat
+000043f0: 696f 6e20 4c65 6172 6e69 6e67 2077 6f72  ion Learning wor
+00004400: 6b73 686f 7020 616e 6420 4d61 6368 696e  kshop and Machin
+00004410: 6520 4c65 6172 6e69 6e67 2061 6e64 2074  e Learning and t
+00004420: 6865 2050 6879 7369 6361 6c20 5363 6965  he Physical Scie
+00004430: 6e63 6573 2077 6f72 6b73 686f 7020 6174  nces workshop at
+00004440: 204e 6575 7249 5053 2032 3031 392e 2032   NeurIPS 2019. 2
+00004450: 3032 302e 2068 7474 7073 3a2f 2f61 7278  020. https://arx
+00004460: 6976 2e6f 7267 2f61 6273 2f32 3030 322e  iv.org/abs/2002.
+00004470: 3038 3236 340a 2020 2020 4578 616d 706c  08264.    Exampl
+00004480: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
+00004490: 2020 2020 3e3e 3e20 6672 6f6d 2064 6565      >>> from dee
+000044a0: 7063 6865 6d2e 6d6f 6465 6c73 2e74 6f72  pchem.models.tor
+000044b0: 6368 5f6d 6f64 656c 732e 6c61 7965 7273  ch_models.layers
+000044c0: 2069 6d70 6f72 7420 4d75 6c74 6948 6561   import MultiHea
+000044d0: 6465 644d 4154 4174 7465 6e74 696f 6e2c  dedMATAttention,
+000044e0: 204d 4154 456d 6265 6464 696e 670a 2020   MATEmbedding.  
+000044f0: 2020 3e3e 3e20 696d 706f 7274 2064 6565    >>> import dee
+00004500: 7063 6865 6d20 6173 2064 630a 2020 2020  pchem as dc.    
+00004510: 3e3e 3e20 696d 706f 7274 2074 6f72 6368  >>> import torch
+00004520: 0a20 2020 203e 3e3e 2069 6e70 7574 5f73  .    >>> input_s
+00004530: 6d69 6c65 203d 2022 4343 220a 2020 2020  mile = "CC".    
+00004540: 3e3e 3e20 6665 6174 203d 2064 632e 6665  >>> feat = dc.fe
+00004550: 6174 2e4d 4154 4665 6174 7572 697a 6572  at.MATFeaturizer
+00004560: 2829 0a20 2020 203e 3e3e 2069 6e70 7574  ().    >>> input
+00004570: 5f73 6d69 6c65 203d 2022 4343 220a 2020  _smile = "CC".  
+00004580: 2020 3e3e 3e20 6f75 7420 3d20 6665 6174    >>> out = feat
+00004590: 2e66 6561 7475 7269 7a65 2869 6e70 7574  .featurize(input
+000045a0: 5f73 6d69 6c65 290a 2020 2020 3e3e 3e20  _smile).    >>> 
+000045b0: 6e6f 6465 203d 2074 6f72 6368 2e74 656e  node = torch.ten
+000045c0: 736f 7228 6f75 745b 305d 2e6e 6f64 655f  sor(out[0].node_
+000045d0: 6665 6174 7572 6573 292e 666c 6f61 7428  features).float(
+000045e0: 292e 756e 7371 7565 657a 6528 3029 0a20  ).unsqueeze(0). 
+000045f0: 2020 203e 3e3e 2061 646a 203d 2074 6f72     >>> adj = tor
+00004600: 6368 2e74 656e 736f 7228 6f75 745b 305d  ch.tensor(out[0]
+00004610: 2e61 646a 6163 656e 6379 5f6d 6174 7269  .adjacency_matri
+00004620: 7829 2e66 6c6f 6174 2829 2e75 6e73 7175  x).float().unsqu
+00004630: 6565 7a65 2830 290a 2020 2020 3e3e 3e20  eeze(0).    >>> 
+00004640: 6469 7374 203d 2074 6f72 6368 2e74 656e  dist = torch.ten
+00004650: 736f 7228 6f75 745b 305d 2e64 6973 7461  sor(out[0].dista
+00004660: 6e63 655f 6d61 7472 6978 292e 666c 6f61  nce_matrix).floa
+00004670: 7428 292e 756e 7371 7565 657a 6528 3029  t().unsqueeze(0)
+00004680: 0a20 2020 203e 3e3e 206d 6173 6b20 3d20  .    >>> mask = 
+00004690: 746f 7263 682e 7375 6d28 746f 7263 682e  torch.sum(torch.
+000046a0: 6162 7328 6e6f 6465 292c 2064 696d 3d2d  abs(node), dim=-
+000046b0: 3129 2021 3d20 300a 2020 2020 3e3e 3e20  1) != 0.    >>> 
+000046c0: 6c61 7965 7220 3d20 4d75 6c74 6948 6561  layer = MultiHea
+000046d0: 6465 644d 4154 4174 7465 6e74 696f 6e28  dedMATAttention(
+000046e0: 0a20 2020 202e 2e2e 2020 2020 6469 7374  .    ...    dist
+000046f0: 5f6b 6572 6e65 6c3d 2773 6f66 746d 6178  _kernel='softmax
+00004700: 272c 0a20 2020 202e 2e2e 2020 2020 6c61  ',.    ...    la
+00004710: 6d62 6461 5f61 7474 656e 7469 6f6e 3d30  mbda_attention=0
+00004720: 2e33 332c 0a20 2020 202e 2e2e 2020 2020  .33,.    ...    
+00004730: 6c61 6d62 6461 5f64 6973 7461 6e63 653d  lambda_distance=
+00004740: 302e 3333 2c0a 2020 2020 2e2e 2e20 2020  0.33,.    ...   
+00004750: 2068 3d31 362c 0a20 2020 202e 2e2e 2020   h=16,.    ...  
+00004760: 2020 6873 697a 653d 3130 3234 2c0a 2020    hsize=1024,.  
+00004770: 2020 2e2e 2e20 2020 2064 726f 706f 7574    ...    dropout
+00004780: 5f70 3d30 2e30 290a 2020 2020 3e3e 3e20  _p=0.0).    >>> 
+00004790: 6f70 203d 204d 4154 456d 6265 6464 696e  op = MATEmbeddin
+000047a0: 6728 2928 6e6f 6465 290a 2020 2020 3e3e  g()(node).    >>
+000047b0: 3e20 6f75 7470 7574 203d 206c 6179 6572  > output = layer
+000047c0: 286f 702c 206f 702c 206f 702c 206d 6173  (op, op, op, mas
+000047d0: 6b2c 2061 646a 2c20 6469 7374 290a 2020  k, adj, dist).  
+000047e0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+000047f0: 5f69 6e69 745f 5f28 7365 6c66 2c0a 2020  _init__(self,.  
+00004800: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00004810: 6973 745f 6b65 726e 656c 3a20 7374 7220  ist_kernel: str 
+00004820: 3d20 2773 6f66 746d 6178 272c 0a20 2020  = 'softmax',.   
+00004830: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00004840: 6d62 6461 5f61 7474 656e 7469 6f6e 3a20  mbda_attention: 
+00004850: 666c 6f61 7420 3d20 302e 3333 2c0a 2020  float = 0.33,.  
+00004860: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00004870: 616d 6264 615f 6469 7374 616e 6365 3a20  ambda_distance: 
+00004880: 666c 6f61 7420 3d20 302e 3333 2c0a 2020  float = 0.33,.  
+00004890: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+000048a0: 3a20 696e 7420 3d20 3136 2c0a 2020 2020  : int = 16,.    
+000048b0: 2020 2020 2020 2020 2020 2020 2068 7369               hsi
+000048c0: 7a65 3a20 696e 7420 3d20 3130 3234 2c0a  ze: int = 1024,.
+000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048e0: 2064 726f 706f 7574 5f70 3a20 666c 6f61   dropout_p: floa
+000048f0: 7420 3d20 302e 302c 0a20 2020 2020 2020  t = 0.0,.       
+00004900: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00004910: 5f62 6961 733a 2062 6f6f 6c20 3d20 5472  _bias: bool = Tr
+00004920: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
+00004930: 496e 6974 6961 6c69 7a65 2061 206d 756c  Initialize a mul
+00004940: 7469 2d68 6561 6465 6420 6174 7465 6e74  ti-headed attent
+00004950: 696f 6e20 6c61 7965 722e 0a20 2020 2020  ion layer..     
+00004960: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00004970: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00004980: 0a20 2020 2020 2020 2064 6973 745f 6b65  .        dist_ke
+00004990: 726e 656c 3a20 7374 720a 2020 2020 2020  rnel: str.      
+000049a0: 2020 2020 2020 4b65 726e 656c 2061 6374        Kernel act
+000049b0: 6976 6174 696f 6e20 746f 2062 6520 7573  ivation to be us
+000049c0: 6564 2e20 4361 6e20 6265 2065 6974 6865  ed. Can be eithe
+000049d0: 7220 2773 6f66 746d 6178 2720 666f 7220  r 'softmax' for 
+000049e0: 736f 6674 6d61 7820 6f72 2027 6578 7027  softmax or 'exp'
+000049f0: 2066 6f72 2065 7870 6f6e 656e 7469 616c   for exponential
+00004a00: 2e0a 2020 2020 2020 2020 6c61 6d62 6461  ..        lambda
+00004a10: 5f61 7474 656e 7469 6f6e 3a20 666c 6f61  _attention: floa
+00004a20: 740a 2020 2020 2020 2020 2020 2020 436f  t.            Co
+00004a30: 6e73 7461 6e74 2074 6f20 6265 206d 756c  nstant to be mul
+00004a40: 7469 706c 6965 6420 7769 7468 2074 6865  tiplied with the
+00004a50: 2061 7474 656e 7469 6f6e 206d 6174 7269   attention matri
+00004a60: 782e 0a20 2020 2020 2020 206c 616d 6264  x..        lambd
+00004a70: 615f 6469 7374 616e 6365 3a20 666c 6f61  a_distance: floa
+00004a80: 740a 2020 2020 2020 2020 2020 2020 436f  t.            Co
+00004a90: 6e73 7461 6e74 2074 6f20 6265 206d 756c  nstant to be mul
+00004aa0: 7469 706c 6965 6420 7769 7468 2074 6865  tiplied with the
+00004ab0: 2064 6973 7461 6e63 6520 6d61 7472 6978   distance matrix
+00004ac0: 2e0a 2020 2020 2020 2020 683a 2069 6e74  ..        h: int
+00004ad0: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
+00004ae0: 6265 7220 6f66 2061 7474 656e 7469 6f6e  ber of attention
+00004af0: 2068 6561 6473 2e0a 2020 2020 2020 2020   heads..        
+00004b00: 6873 697a 653a 2069 6e74 0a20 2020 2020  hsize: int.     
+00004b10: 2020 2020 2020 2053 697a 6520 6f66 2064         Size of d
+00004b20: 656e 7365 206c 6179 6572 2e0a 2020 2020  ense layer..    
+00004b30: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
+00004b40: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00004b50: 2044 726f 706f 7574 2070 726f 6261 6269   Dropout probabi
+00004b60: 6c69 7479 2e0a 2020 2020 2020 2020 6f75  lity..        ou
+00004b70: 7470 7574 5f62 6961 733a 2062 6f6f 6c0a  tput_bias: bool.
+00004b80: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00004b90: 7275 652c 2064 656e 7365 206c 6179 6572  rue, dense layer
+00004ba0: 7320 7769 6c6c 2075 7365 2062 6961 7320  s will use bias 
+00004bb0: 7665 6374 6f72 732e 0a20 2020 2020 2020  vectors..       
+00004bc0: 2022 2222 0a20 2020 2020 2020 2073 7570   """.        sup
+00004bd0: 6572 2829 2e5f 5f69 6e69 745f 5f28 290a  er().__init__().
+00004be0: 2020 2020 2020 2020 6966 2064 6973 745f          if dist_
+00004bf0: 6b65 726e 656c 203d 3d20 2273 6f66 746d  kernel == "softm
+00004c00: 6178 223a 0a20 2020 2020 2020 2020 2020  ax":.           
+00004c10: 2073 656c 662e 6469 7374 5f6b 6572 6e65   self.dist_kerne
+00004c20: 6c20 3d20 6c61 6d62 6461 2078 3a20 746f  l = lambda x: to
+00004c30: 7263 682e 736f 6674 6d61 7828 2d78 2c20  rch.softmax(-x, 
+00004c40: 6469 6d3d 2d31 290a 2020 2020 2020 2020  dim=-1).        
+00004c50: 656c 6966 2064 6973 745f 6b65 726e 656c  elif dist_kernel
+00004c60: 203d 3d20 2265 7870 223a 0a20 2020 2020   == "exp":.     
+00004c70: 2020 2020 2020 2073 656c 662e 6469 7374         self.dist
+00004c80: 5f6b 6572 6e65 6c20 3d20 6c61 6d62 6461  _kernel = lambda
+00004c90: 2078 3a20 746f 7263 682e 6578 7028 2d78   x: torch.exp(-x
+00004ca0: 290a 2020 2020 2020 2020 7365 6c66 2e6c  ).        self.l
+00004cb0: 616d 6264 615f 6174 7465 6e74 696f 6e20  ambda_attention 
+00004cc0: 3d20 6c61 6d62 6461 5f61 7474 656e 7469  = lambda_attenti
+00004cd0: 6f6e 0a20 2020 2020 2020 2073 656c 662e  on.        self.
+00004ce0: 6c61 6d62 6461 5f64 6973 7461 6e63 6520  lambda_distance 
+00004cf0: 3d20 6c61 6d62 6461 5f64 6973 7461 6e63  = lambda_distanc
+00004d00: 650a 2020 2020 2020 2020 7365 6c66 2e6c  e.        self.l
+00004d10: 616d 6264 615f 6164 6a61 6365 6e63 7920  ambda_adjacency 
+00004d20: 3d20 312e 3020 2d20 7365 6c66 2e6c 616d  = 1.0 - self.lam
+00004d30: 6264 615f 6174 7465 6e74 696f 6e20 2d20  bda_attention - 
+00004d40: 7365 6c66 2e6c 616d 6264 615f 6469 7374  self.lambda_dist
+00004d50: 616e 6365 0a20 2020 2020 2020 2073 656c  ance.        sel
+00004d60: 662e 645f 6b20 3d20 6873 697a 6520 2f2f  f.d_k = hsize //
+00004d70: 2068 0a20 2020 2020 2020 2073 656c 662e   h.        self.
+00004d80: 6820 3d20 680a 2020 2020 2020 2020 6c69  h = h.        li
+00004d90: 6e65 6172 5f6c 6179 6572 203d 206e 6e2e  near_layer = nn.
+00004da0: 4c69 6e65 6172 2868 7369 7a65 2c20 6873  Linear(hsize, hs
+00004db0: 697a 6529 0a20 2020 2020 2020 2073 656c  ize).        sel
+00004dc0: 662e 6c69 6e65 6172 5f6c 6179 6572 7320  f.linear_layers 
+00004dd0: 3d20 6e6e 2e4d 6f64 756c 654c 6973 7428  = nn.ModuleList(
+00004de0: 5b6c 696e 6561 725f 6c61 7965 7220 666f  [linear_layer fo
+00004df0: 7220 5f20 696e 2072 616e 6765 2833 295d  r _ in range(3)]
+00004e00: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
+00004e10: 726f 706f 7574 5f70 203d 206e 6e2e 4472  ropout_p = nn.Dr
+00004e20: 6f70 6f75 7428 6472 6f70 6f75 745f 7029  opout(dropout_p)
+00004e30: 0a20 2020 2020 2020 2073 656c 662e 6f75  .        self.ou
+00004e40: 7470 7574 5f6c 696e 6561 7220 3d20 6e6e  tput_linear = nn
+00004e50: 2e4c 696e 6561 7228 6873 697a 652c 2068  .Linear(hsize, h
+00004e60: 7369 7a65 2c20 6f75 7470 7574 5f62 6961  size, output_bia
+00004e70: 7329 0a0a 2020 2020 6465 6620 5f73 696e  s)..    def _sin
+00004e80: 676c 655f 6174 7465 6e74 696f 6e28 0a20  gle_attention(. 
+00004e90: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00004ea0: 0a20 2020 2020 2020 2020 2020 2071 7565  .            que
+00004eb0: 7279 3a20 746f 7263 682e 5465 6e73 6f72  ry: torch.Tensor
+00004ec0: 2c0a 2020 2020 2020 2020 2020 2020 6b65  ,.            ke
+00004ed0: 793a 2074 6f72 6368 2e54 656e 736f 722c  y: torch.Tensor,
+00004ee0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00004ef0: 7565 3a20 746f 7263 682e 5465 6e73 6f72  ue: torch.Tensor
+00004f00: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
+00004f10: 736b 3a20 746f 7263 682e 5465 6e73 6f72  sk: torch.Tensor
+00004f20: 2c0a 2020 2020 2020 2020 2020 2020 6164  ,.            ad
+00004f30: 6a5f 6d61 7472 6978 3a20 746f 7263 682e  j_matrix: torch.
+00004f40: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
+00004f50: 2020 2020 6469 7374 616e 6365 5f6d 6174      distance_mat
+00004f60: 7269 783a 2074 6f72 6368 2e54 656e 736f  rix: torch.Tenso
+00004f70: 722c 0a20 2020 2020 2020 2020 2020 2064  r,.            d
+00004f80: 726f 706f 7574 5f70 3a20 666c 6f61 7420  ropout_p: float 
+00004f90: 3d20 302e 302c 0a20 2020 2020 2020 2020  = 0.0,.         
+00004fa0: 2020 2065 7073 3a20 666c 6f61 7420 3d20     eps: float = 
+00004fb0: 3165 2d36 2c0a 2020 2020 2020 2020 2020  1e-6,.          
+00004fc0: 2020 696e 663a 2066 6c6f 6174 203d 2031    inf: float = 1
+00004fd0: 6531 3229 202d 3e20 5475 706c 655b 746f  e12) -> Tuple[to
+00004fe0: 7263 682e 5465 6e73 6f72 2c20 746f 7263  rch.Tensor, torc
+00004ff0: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
+00005000: 2020 2022 2222 4465 6669 6e69 6e67 2061     """Defining a
+00005010: 6e64 2063 6f6d 7075 7469 6e67 206f 7574  nd computing out
+00005020: 7075 7420 666f 7220 6120 7369 6e67 6c65  put for a single
+00005030: 204d 4154 2061 7474 656e 7469 6f6e 206c   MAT attention l
+00005040: 6179 6572 2e0a 2020 2020 2020 2020 5061  ayer..        Pa
+00005050: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00005060: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00005070: 2020 2020 7175 6572 793a 2074 6f72 6368      query: torch
+00005080: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+00005090: 2020 2020 5374 616e 6461 7264 2071 7565      Standard que
+000050a0: 7279 2070 6172 616d 6574 6572 2066 6f72  ry parameter for
+000050b0: 2061 7474 656e 7469 6f6e 2e0a 2020 2020   attention..    
+000050c0: 2020 2020 6b65 793a 2074 6f72 6368 2e54      key: torch.T
+000050d0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+000050e0: 2020 5374 616e 6461 7264 206b 6579 2070    Standard key p
+000050f0: 6172 616d 6574 6572 2066 6f72 2061 7474  arameter for att
+00005100: 656e 7469 6f6e 2e0a 2020 2020 2020 2020  ention..        
+00005110: 7661 6c75 653a 2074 6f72 6368 2e54 656e  value: torch.Ten
+00005120: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00005130: 5374 616e 6461 7264 2076 616c 7565 2070  Standard value p
+00005140: 6172 616d 6574 6572 2066 6f72 2061 7474  arameter for att
+00005150: 656e 7469 6f6e 2e0a 2020 2020 2020 2020  ention..        
+00005160: 6d61 736b 3a20 746f 7263 682e 5465 6e73  mask: torch.Tens
+00005170: 6f72 0a20 2020 2020 2020 2020 2020 204d  or.            M
+00005180: 6173 6b73 206f 7574 2070 6164 6469 6e67  asks out padding
+00005190: 2076 616c 7565 7320 736f 2074 6861 7420   values so that 
+000051a0: 7468 6579 2061 7265 206e 6f74 2074 616b  they are not tak
+000051b0: 656e 2069 6e74 6f20 6163 636f 756e 7420  en into account 
+000051c0: 7768 656e 2063 6f6d 7075 7469 6e67 2074  when computing t
+000051d0: 6865 2061 7474 656e 7469 6f6e 2073 636f  he attention sco
+000051e0: 7265 2e0a 2020 2020 2020 2020 6164 6a5f  re..        adj_
+000051f0: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
+00005200: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+00005210: 2041 646a 6163 656e 6379 206d 6174 7269   Adjacency matri
+00005220: 7820 6f66 2074 6865 2069 6e70 7574 206d  x of the input m
+00005230: 6f6c 6563 756c 652c 2072 6574 7572 6e65  olecule, returne
+00005240: 6420 6672 6f6d 2064 632e 6665 6174 2e4d  d from dc.feat.M
+00005250: 4154 4665 6174 7572 697a 6572 2829 0a20  ATFeaturizer(). 
+00005260: 2020 2020 2020 2064 6973 745f 6d61 7472         dist_matr
+00005270: 6978 3a20 746f 7263 682e 5465 6e73 6f72  ix: torch.Tensor
+00005280: 0a20 2020 2020 2020 2020 2020 2044 6973  .            Dis
+00005290: 7461 6e63 6520 6d61 7472 6978 206f 6620  tance matrix of 
+000052a0: 7468 6520 696e 7075 7420 6d6f 6c65 6375  the input molecu
+000052b0: 6c65 2c20 7265 7475 726e 6564 2066 726f  le, returned fro
+000052c0: 6d20 6463 2e66 6561 742e 4d41 5446 6561  m dc.feat.MATFea
+000052d0: 7475 7269 7a65 7228 290a 2020 2020 2020  turizer().      
+000052e0: 2020 6472 6f70 6f75 745f 703a 2066 6c6f    dropout_p: flo
+000052f0: 6174 0a20 2020 2020 2020 2020 2020 2044  at.            D
+00005300: 726f 706f 7574 2070 726f 6261 6269 6c69  ropout probabili
+00005310: 7479 2e0a 2020 2020 2020 2020 6570 733a  ty..        eps:
+00005320: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+00005330: 2020 2045 7073 696c 6f6e 2076 616c 7565     Epsilon value
+00005340: 0a20 2020 2020 2020 2069 6e66 3a20 666c  .        inf: fl
+00005350: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00005360: 5661 6c75 6520 6f66 2069 6e66 696e 6974  Value of infinit
+00005370: 7920 746f 2062 6520 7573 6564 2e0a 2020  y to be used..  
+00005380: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00005390: 2020 645f 6b20 3d20 7175 6572 792e 7369    d_k = query.si
+000053a0: 7a65 282d 3129 0a0a 2020 2020 2020 2020  ze(-1)..        
+000053b0: 7363 6f72 6573 203d 2074 6f72 6368 2e6d  scores = torch.m
+000053c0: 6174 6d75 6c28 7175 6572 792c 206b 6579  atmul(query, key
+000053d0: 2e74 7261 6e73 706f 7365 282d 322c 202d  .transpose(-2, -
+000053e0: 3129 2920 2f20 6d61 7468 2e73 7172 7428  1)) / math.sqrt(
+000053f0: 645f 6b29 0a0a 2020 2020 2020 2020 6966  d_k)..        if
+00005400: 206d 6173 6b20 6973 206e 6f74 204e 6f6e   mask is not Non
+00005410: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00005420: 636f 7265 7320 3d20 7363 6f72 6573 2e6d  cores = scores.m
+00005430: 6173 6b65 645f 6669 6c6c 280a 2020 2020  asked_fill(.    
+00005440: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+00005450: 2e75 6e73 7175 6565 7a65 2831 292e 7265  .unsqueeze(1).re
+00005460: 7065 6174 2831 2c20 7175 6572 792e 7368  peat(1, query.sh
+00005470: 6170 655b 315d 2c20 7175 6572 792e 7368  ape[1], query.sh
+00005480: 6170 655b 325d 2c0a 2020 2020 2020 2020  ape[2],.        
 00005490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054a0: 2020 2020 3129 203d 3d20 302c 202d 696e      1) == 0, -in
-000054b0: 6629 0a20 2020 2020 2020 2070 5f61 7474  f).        p_att
-000054c0: 6e20 3d20 462e 736f 6674 6d61 7828 7363  n = F.softmax(sc
-000054d0: 6f72 6573 2c20 6469 6d3d 2d31 290a 0a20  ores, dim=-1).. 
-000054e0: 2020 2020 2020 2061 646a 5f6d 6174 7269         adj_matri
-000054f0: 7820 3d20 6164 6a5f 6d61 7472 6978 202f  x = adj_matrix /
-00005500: 2028 0a20 2020 2020 2020 2020 2020 2074   (.            t
-00005510: 6f72 6368 2e73 756d 2874 6f72 6368 2e74  orch.sum(torch.t
-00005520: 656e 736f 7228 6164 6a5f 6d61 7472 6978  ensor(adj_matrix
-00005530: 292c 2064 696d 3d2d 3129 2e75 6e73 7175  ), dim=-1).unsqu
-00005540: 6565 7a65 2832 2920 2b20 6570 7329 0a0a  eeze(2) + eps)..
-00005550: 2020 2020 2020 2020 6966 206c 656e 2861          if len(a
-00005560: 646a 5f6d 6174 7269 782e 7368 6170 6529  dj_matrix.shape)
-00005570: 203c 3d20 333a 0a20 2020 2020 2020 2020   <= 3:.         
-00005580: 2020 2070 5f61 646a 203d 2061 646a 5f6d     p_adj = adj_m
-00005590: 6174 7269 782e 756e 7371 7565 657a 6528  atrix.unsqueeze(
-000055a0: 3129 2e72 6570 6561 7428 312c 2071 7565  1).repeat(1, que
-000055b0: 7279 2e73 6861 7065 5b31 5d2c 2031 2c20  ry.shape[1], 1, 
-000055c0: 3129 0a20 2020 2020 2020 2065 6c73 653a  1).        else:
-000055d0: 0a20 2020 2020 2020 2020 2020 2070 5f61  .            p_a
-000055e0: 646a 203d 2061 646a 5f6d 6174 7269 782e  dj = adj_matrix.
-000055f0: 7265 7065 6174 2831 2c20 7175 6572 792e  repeat(1, query.
-00005600: 7368 6170 655b 315d 2c20 312c 2031 290a  shape[1], 1, 1).
-00005610: 0a20 2020 2020 2020 2064 6973 7461 6e63  .        distanc
-00005620: 655f 6d61 7472 6978 203d 2074 6f72 6368  e_matrix = torch
-00005630: 2e74 656e 736f 7228 6469 7374 616e 6365  .tensor(distance
-00005640: 5f6d 6174 7269 7829 2e73 7175 6565 7a65  _matrix).squeeze
-00005650: 2829 2e6d 6173 6b65 645f 6669 6c6c 280a  ().masked_fill(.
-00005660: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00005670: 2e72 6570 6561 7428 312c 206d 6173 6b2e  .repeat(1, mask.
-00005680: 7368 6170 655b 2d31 5d2c 2031 2920 3d3d  shape[-1], 1) ==
-00005690: 2030 2c20 6e70 2e69 6e66 290a 0a20 2020   0, np.inf)..   
-000056a0: 2020 2020 2064 6973 7461 6e63 655f 6d61       distance_ma
-000056b0: 7472 6978 203d 2073 656c 662e 6469 7374  trix = self.dist
-000056c0: 5f6b 6572 6e65 6c28 6469 7374 616e 6365  _kernel(distance
-000056d0: 5f6d 6174 7269 7829 0a0a 2020 2020 2020  _matrix)..      
-000056e0: 2020 705f 6469 7374 203d 2064 6973 7461    p_dist = dista
-000056f0: 6e63 655f 6d61 7472 6978 2e75 6e73 7175  nce_matrix.unsqu
-00005700: 6565 7a65 2831 292e 7265 7065 6174 2831  eeze(1).repeat(1
-00005710: 2c20 7175 6572 792e 7368 6170 655b 315d  , query.shape[1]
-00005720: 2c20 312c 2031 290a 0a20 2020 2020 2020  , 1, 1)..       
-00005730: 2070 5f77 6569 6768 7465 6420 3d20 7365   p_weighted = se
-00005740: 6c66 2e6c 616d 6264 615f 6174 7465 6e74  lf.lambda_attent
-00005750: 696f 6e20 2a20 705f 6174 746e 202b 2073  ion * p_attn + s
-00005760: 656c 662e 6c61 6d62 6461 5f64 6973 7461  elf.lambda_dista
-00005770: 6e63 6520 2a20 705f 6469 7374 202b 2073  nce * p_dist + s
-00005780: 656c 662e 6c61 6d62 6461 5f61 646a 6163  elf.lambda_adjac
-00005790: 656e 6379 202a 2070 5f61 646a 0a20 2020  ency * p_adj.   
-000057a0: 2020 2020 2070 5f77 6569 6768 7465 6420       p_weighted 
-000057b0: 3d20 7365 6c66 2e64 726f 706f 7574 5f70  = self.dropout_p
-000057c0: 2870 5f77 6569 6768 7465 6429 0a0a 2020  (p_weighted)..  
-000057d0: 2020 2020 2020 7265 7475 726e 2074 6f72        return tor
-000057e0: 6368 2e6d 6174 6d75 6c28 705f 7765 6967  ch.matmul(p_weig
-000057f0: 6874 6564 2e66 6c6f 6174 2829 2c20 7661  hted.float(), va
-00005800: 6c75 652e 666c 6f61 7428 2929 2c20 705f  lue.float()), p_
-00005810: 6174 746e 0a0a 2020 2020 6465 6620 666f  attn..    def fo
-00005820: 7277 6172 6428 7365 6c66 2c0a 2020 2020  rward(self,.    
-00005830: 2020 2020 2020 2020 2020 2020 7175 6572              quer
-00005840: 793a 2074 6f72 6368 2e54 656e 736f 722c  y: torch.Tensor,
-00005850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005860: 206b 6579 3a20 746f 7263 682e 5465 6e73   key: torch.Tens
-00005870: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00005880: 2020 2020 7661 6c75 653a 2074 6f72 6368      value: torch
-00005890: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
-000058a0: 2020 2020 2020 2020 206d 6173 6b3a 2074           mask: t
-000058b0: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
-000058c0: 2020 2020 2020 2020 2020 2020 2061 646a               adj
-000058d0: 5f6d 6174 7269 783a 2074 6f72 6368 2e54  _matrix: torch.T
-000058e0: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
-000058f0: 2020 2020 2020 2064 6973 7461 6e63 655f         distance_
-00005900: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
-00005910: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
-00005920: 2020 2020 2020 6472 6f70 6f75 745f 703a        dropout_p:
-00005930: 2066 6c6f 6174 203d 2030 2e30 2c0a 2020   float = 0.0,.  
-00005940: 2020 2020 2020 2020 2020 2020 2020 6570                ep
-00005950: 733a 2066 6c6f 6174 203d 2031 652d 362c  s: float = 1e-6,
-00005960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005970: 2069 6e66 3a20 666c 6f61 7420 3d20 3165   inf: float = 1e
-00005980: 3132 2920 2d3e 2074 6f72 6368 2e54 656e  12) -> torch.Ten
-00005990: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
-000059a0: 4f75 7470 7574 2063 6f6d 7075 7461 7469  Output computati
-000059b0: 6f6e 2066 6f72 2074 6865 204d 756c 7469  on for the Multi
-000059c0: 4865 6164 6564 4174 7465 6e74 696f 6e20  HeadedAttention 
-000059d0: 6c61 7965 722e 0a20 2020 2020 2020 2050  layer..        P
-000059e0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-000059f0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00005a00: 2020 2020 2071 7565 7279 3a20 746f 7263       query: torc
-00005a10: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00005a20: 2020 2020 2053 7461 6e64 6172 6420 7175       Standard qu
-00005a30: 6572 7920 7061 7261 6d65 7465 7220 666f  ery parameter fo
-00005a40: 7220 6174 7465 6e74 696f 6e2e 0a20 2020  r attention..   
-00005a50: 2020 2020 206b 6579 3a20 746f 7263 682e       key: torch.
-00005a60: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00005a70: 2020 2053 7461 6e64 6172 6420 6b65 7920     Standard key 
-00005a80: 7061 7261 6d65 7465 7220 666f 7220 6174  parameter for at
-00005a90: 7465 6e74 696f 6e2e 0a20 2020 2020 2020  tention..       
-00005aa0: 2076 616c 7565 3a20 746f 7263 682e 5465   value: torch.Te
-00005ab0: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-00005ac0: 2053 7461 6e64 6172 6420 7661 6c75 6520   Standard value 
-00005ad0: 7061 7261 6d65 7465 7220 666f 7220 6174  parameter for at
-00005ae0: 7465 6e74 696f 6e2e 0a20 2020 2020 2020  tention..       
-00005af0: 206d 6173 6b3a 2074 6f72 6368 2e54 656e   mask: torch.Ten
-00005b00: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00005b10: 4d61 736b 7320 6f75 7420 7061 6464 696e  Masks out paddin
-00005b20: 6720 7661 6c75 6573 2073 6f20 7468 6174  g values so that
-00005b30: 2074 6865 7920 6172 6520 6e6f 7420 7461   they are not ta
-00005b40: 6b65 6e20 696e 746f 2061 6363 6f75 6e74  ken into account
-00005b50: 2077 6865 6e20 636f 6d70 7574 696e 6720   when computing 
-00005b60: 7468 6520 6174 7465 6e74 696f 6e20 7363  the attention sc
-00005b70: 6f72 652e 0a20 2020 2020 2020 2061 646a  ore..        adj
-00005b80: 5f6d 6174 7269 783a 2074 6f72 6368 2e54  _matrix: torch.T
-00005b90: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00005ba0: 2020 4164 6a61 6365 6e63 7920 6d61 7472    Adjacency matr
-00005bb0: 6978 206f 6620 7468 6520 696e 7075 7420  ix of the input 
-00005bc0: 6d6f 6c65 6375 6c65 2c20 7265 7475 726e  molecule, return
-00005bd0: 6564 2066 726f 6d20 6463 2e66 6561 742e  ed from dc.feat.
-00005be0: 4d41 5446 6561 7475 7269 7a65 7228 290a  MATFeaturizer().
-00005bf0: 2020 2020 2020 2020 6469 7374 5f6d 6174          dist_mat
-00005c00: 7269 783a 2074 6f72 6368 2e54 656e 736f  rix: torch.Tenso
-00005c10: 720a 2020 2020 2020 2020 2020 2020 4469  r.            Di
-00005c20: 7374 616e 6365 206d 6174 7269 7820 6f66  stance matrix of
-00005c30: 2074 6865 2069 6e70 7574 206d 6f6c 6563   the input molec
-00005c40: 756c 652c 2072 6574 7572 6e65 6420 6672  ule, returned fr
-00005c50: 6f6d 2064 632e 6665 6174 2e4d 4154 4665  om dc.feat.MATFe
-00005c60: 6174 7572 697a 6572 2829 0a20 2020 2020  aturizer().     
-00005c70: 2020 2064 726f 706f 7574 5f70 3a20 666c     dropout_p: fl
-00005c80: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
-00005c90: 4472 6f70 6f75 7420 7072 6f62 6162 696c  Dropout probabil
-00005ca0: 6974 792e 0a20 2020 2020 2020 2065 7073  ity..        eps
-00005cb0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-00005cc0: 2020 2020 4570 7369 6c6f 6e20 7661 6c75      Epsilon valu
-00005cd0: 650a 2020 2020 2020 2020 696e 663a 2066  e.        inf: f
-00005ce0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-00005cf0: 2056 616c 7565 206f 6620 696e 6669 6e69   Value of infini
-00005d00: 7479 2074 6f20 6265 2075 7365 642e 0a20  ty to be used.. 
-00005d10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00005d20: 2020 2069 6620 6d61 736b 2069 7320 6e6f     if mask is no
-00005d30: 7420 4e6f 6e65 2061 6e64 206c 656e 286d  t None and len(m
-00005d40: 6173 6b2e 7368 6170 6529 203c 3d20 323a  ask.shape) <= 2:
-00005d50: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-00005d60: 6b20 3d20 6d61 736b 2e75 6e73 7175 6565  k = mask.unsquee
-00005d70: 7a65 2831 290a 0a20 2020 2020 2020 2062  ze(1)..        b
-00005d80: 6174 6368 5f73 697a 6520 3d20 7175 6572  atch_size = quer
-00005d90: 792e 7369 7a65 2830 290a 2020 2020 2020  y.size(0).      
-00005da0: 2020 7175 6572 792c 206b 6579 2c20 7661    query, key, va
-00005db0: 6c75 6520 3d20 5b0a 2020 2020 2020 2020  lue = [.        
-00005dc0: 2020 2020 6c61 7965 7228 7829 2e76 6965      layer(x).vie
-00005dd0: 7728 6261 7463 685f 7369 7a65 2c20 2d31  w(batch_size, -1
-00005de0: 2c20 7365 6c66 2e68 2c20 7365 6c66 2e64  , self.h, self.d
-00005df0: 5f6b 292e 7472 616e 7370 6f73 6528 312c  _k).transpose(1,
-00005e00: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
-00005e10: 666f 7220 6c61 7965 722c 2078 2069 6e20  for layer, x in 
-00005e20: 7a69 7028 7365 6c66 2e6c 696e 6561 725f  zip(self.linear_
-00005e30: 6c61 7965 7273 2c20 2871 7565 7279 2c20  layers, (query, 
-00005e40: 6b65 792c 2076 616c 7565 2929 0a20 2020  key, value)).   
-00005e50: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
-00005e60: 782c 205f 203d 2073 656c 662e 5f73 696e  x, _ = self._sin
-00005e70: 676c 655f 6174 7465 6e74 696f 6e28 7175  gle_attention(qu
-00005e80: 6572 792c 206b 6579 2c20 7661 6c75 652c  ery, key, value,
-00005e90: 206d 6173 6b2c 2061 646a 5f6d 6174 7269   mask, adj_matri
-00005ea0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+000054a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054b0: 2031 2920 3d3d 2030 2c20 2d69 6e66 290a   1) == 0, -inf).
+000054c0: 2020 2020 2020 2020 705f 6174 746e 203d          p_attn =
+000054d0: 2046 2e73 6f66 746d 6178 2873 636f 7265   F.softmax(score
+000054e0: 732c 2064 696d 3d2d 3129 0a0a 2020 2020  s, dim=-1)..    
+000054f0: 2020 2020 6164 6a5f 6d61 7472 6978 203d      adj_matrix =
+00005500: 2061 646a 5f6d 6174 7269 7820 2f20 280a   adj_matrix / (.
+00005510: 2020 2020 2020 2020 2020 2020 746f 7263              torc
+00005520: 682e 7375 6d28 746f 7263 682e 7465 6e73  h.sum(torch.tens
+00005530: 6f72 2861 646a 5f6d 6174 7269 7829 2c20  or(adj_matrix), 
+00005540: 6469 6d3d 2d31 292e 756e 7371 7565 657a  dim=-1).unsqueez
+00005550: 6528 3229 202b 2065 7073 290a 0a20 2020  e(2) + eps)..   
+00005560: 2020 2020 2069 6620 6c65 6e28 6164 6a5f       if len(adj_
+00005570: 6d61 7472 6978 2e73 6861 7065 2920 3c3d  matrix.shape) <=
+00005580: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
+00005590: 705f 6164 6a20 3d20 6164 6a5f 6d61 7472  p_adj = adj_matr
+000055a0: 6978 2e75 6e73 7175 6565 7a65 2831 292e  ix.unsqueeze(1).
+000055b0: 7265 7065 6174 2831 2c20 7175 6572 792e  repeat(1, query.
+000055c0: 7368 6170 655b 315d 2c20 312c 2031 290a  shape[1], 1, 1).
+000055d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000055e0: 2020 2020 2020 2020 2020 705f 6164 6a20            p_adj 
+000055f0: 3d20 6164 6a5f 6d61 7472 6978 2e72 6570  = adj_matrix.rep
+00005600: 6561 7428 312c 2071 7565 7279 2e73 6861  eat(1, query.sha
+00005610: 7065 5b31 5d2c 2031 2c20 3129 0a0a 2020  pe[1], 1, 1)..  
+00005620: 2020 2020 2020 6469 7374 616e 6365 5f6d        distance_m
+00005630: 6174 7269 7820 3d20 746f 7263 682e 7465  atrix = torch.te
+00005640: 6e73 6f72 2864 6973 7461 6e63 655f 6d61  nsor(distance_ma
+00005650: 7472 6978 292e 7371 7565 657a 6528 292e  trix).squeeze().
+00005660: 6d61 736b 6564 5f66 696c 6c28 0a20 2020  masked_fill(.   
+00005670: 2020 2020 2020 2020 206d 6173 6b2e 7265           mask.re
+00005680: 7065 6174 2831 2c20 6d61 736b 2e73 6861  peat(1, mask.sha
+00005690: 7065 5b2d 315d 2c20 3129 203d 3d20 302c  pe[-1], 1) == 0,
+000056a0: 206e 702e 696e 6629 0a0a 2020 2020 2020   np.inf)..      
+000056b0: 2020 6469 7374 616e 6365 5f6d 6174 7269    distance_matri
+000056c0: 7820 3d20 7365 6c66 2e64 6973 745f 6b65  x = self.dist_ke
+000056d0: 726e 656c 2864 6973 7461 6e63 655f 6d61  rnel(distance_ma
+000056e0: 7472 6978 290a 0a20 2020 2020 2020 2070  trix)..        p
+000056f0: 5f64 6973 7420 3d20 6469 7374 616e 6365  _dist = distance
+00005700: 5f6d 6174 7269 782e 756e 7371 7565 657a  _matrix.unsqueez
+00005710: 6528 3129 2e72 6570 6561 7428 312c 2071  e(1).repeat(1, q
+00005720: 7565 7279 2e73 6861 7065 5b31 5d2c 2031  uery.shape[1], 1
+00005730: 2c20 3129 0a0a 2020 2020 2020 2020 705f  , 1)..        p_
+00005740: 7765 6967 6874 6564 203d 2073 656c 662e  weighted = self.
+00005750: 6c61 6d62 6461 5f61 7474 656e 7469 6f6e  lambda_attention
+00005760: 202a 2070 5f61 7474 6e20 2b20 7365 6c66   * p_attn + self
+00005770: 2e6c 616d 6264 615f 6469 7374 616e 6365  .lambda_distance
+00005780: 202a 2070 5f64 6973 7420 2b20 7365 6c66   * p_dist + self
+00005790: 2e6c 616d 6264 615f 6164 6a61 6365 6e63  .lambda_adjacenc
+000057a0: 7920 2a20 705f 6164 6a0a 2020 2020 2020  y * p_adj.      
+000057b0: 2020 705f 7765 6967 6874 6564 203d 2073    p_weighted = s
+000057c0: 656c 662e 6472 6f70 6f75 745f 7028 705f  elf.dropout_p(p_
+000057d0: 7765 6967 6874 6564 290a 0a20 2020 2020  weighted)..     
+000057e0: 2020 2072 6574 7572 6e20 746f 7263 682e     return torch.
+000057f0: 6d61 746d 756c 2870 5f77 6569 6768 7465  matmul(p_weighte
+00005800: 642e 666c 6f61 7428 292c 2076 616c 7565  d.float(), value
+00005810: 2e66 6c6f 6174 2829 292c 2070 5f61 7474  .float()), p_att
+00005820: 6e0a 0a20 2020 2064 6566 2066 6f72 7761  n..    def forwa
+00005830: 7264 2873 656c 662c 0a20 2020 2020 2020  rd(self,.       
+00005840: 2020 2020 2020 2020 2071 7565 7279 3a20           query: 
+00005850: 746f 7263 682e 5465 6e73 6f72 2c0a 2020  torch.Tensor,.  
+00005860: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+00005870: 793a 2074 6f72 6368 2e54 656e 736f 722c  y: torch.Tensor,
+00005880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005890: 2076 616c 7565 3a20 746f 7263 682e 5465   value: torch.Te
+000058a0: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
+000058b0: 2020 2020 2020 6d61 736b 3a20 746f 7263        mask: torc
+000058c0: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
+000058d0: 2020 2020 2020 2020 2020 6164 6a5f 6d61            adj_ma
+000058e0: 7472 6978 3a20 746f 7263 682e 5465 6e73  trix: torch.Tens
+000058f0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+00005900: 2020 2020 6469 7374 616e 6365 5f6d 6174      distance_mat
+00005910: 7269 783a 2074 6f72 6368 2e54 656e 736f  rix: torch.Tenso
+00005920: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00005930: 2020 2064 726f 706f 7574 5f70 3a20 666c     dropout_p: fl
+00005940: 6f61 7420 3d20 302e 302c 0a20 2020 2020  oat = 0.0,.     
+00005950: 2020 2020 2020 2020 2020 2065 7073 3a20             eps: 
+00005960: 666c 6f61 7420 3d20 3165 2d36 2c0a 2020  float = 1e-6,.  
+00005970: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00005980: 663a 2066 6c6f 6174 203d 2031 6531 3229  f: float = 1e12)
+00005990: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
+000059a0: 3a0a 2020 2020 2020 2020 2222 224f 7574  :.        """Out
+000059b0: 7075 7420 636f 6d70 7574 6174 696f 6e20  put computation 
+000059c0: 666f 7220 7468 6520 4d75 6c74 6948 6561  for the MultiHea
+000059d0: 6465 6441 7474 656e 7469 6f6e 206c 6179  dedAttention lay
+000059e0: 6572 2e0a 2020 2020 2020 2020 5061 7261  er..        Para
+000059f0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00005a00: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00005a10: 2020 7175 6572 793a 2074 6f72 6368 2e54    query: torch.T
+00005a20: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00005a30: 2020 5374 616e 6461 7264 2071 7565 7279    Standard query
+00005a40: 2070 6172 616d 6574 6572 2066 6f72 2061   parameter for a
+00005a50: 7474 656e 7469 6f6e 2e0a 2020 2020 2020  ttention..      
+00005a60: 2020 6b65 793a 2074 6f72 6368 2e54 656e    key: torch.Ten
+00005a70: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00005a80: 5374 616e 6461 7264 206b 6579 2070 6172  Standard key par
+00005a90: 616d 6574 6572 2066 6f72 2061 7474 656e  ameter for atten
+00005aa0: 7469 6f6e 2e0a 2020 2020 2020 2020 7661  tion..        va
+00005ab0: 6c75 653a 2074 6f72 6368 2e54 656e 736f  lue: torch.Tenso
+00005ac0: 720a 2020 2020 2020 2020 2020 2020 5374  r.            St
+00005ad0: 616e 6461 7264 2076 616c 7565 2070 6172  andard value par
+00005ae0: 616d 6574 6572 2066 6f72 2061 7474 656e  ameter for atten
+00005af0: 7469 6f6e 2e0a 2020 2020 2020 2020 6d61  tion..        ma
+00005b00: 736b 3a20 746f 7263 682e 5465 6e73 6f72  sk: torch.Tensor
+00005b10: 0a20 2020 2020 2020 2020 2020 204d 6173  .            Mas
+00005b20: 6b73 206f 7574 2070 6164 6469 6e67 2076  ks out padding v
+00005b30: 616c 7565 7320 736f 2074 6861 7420 7468  alues so that th
+00005b40: 6579 2061 7265 206e 6f74 2074 616b 656e  ey are not taken
+00005b50: 2069 6e74 6f20 6163 636f 756e 7420 7768   into account wh
+00005b60: 656e 2063 6f6d 7075 7469 6e67 2074 6865  en computing the
+00005b70: 2061 7474 656e 7469 6f6e 2073 636f 7265   attention score
+00005b80: 2e0a 2020 2020 2020 2020 6164 6a5f 6d61  ..        adj_ma
+00005b90: 7472 6978 3a20 746f 7263 682e 5465 6e73  trix: torch.Tens
+00005ba0: 6f72 0a20 2020 2020 2020 2020 2020 2041  or.            A
+00005bb0: 646a 6163 656e 6379 206d 6174 7269 7820  djacency matrix 
+00005bc0: 6f66 2074 6865 2069 6e70 7574 206d 6f6c  of the input mol
+00005bd0: 6563 756c 652c 2072 6574 7572 6e65 6420  ecule, returned 
+00005be0: 6672 6f6d 2064 632e 6665 6174 2e4d 4154  from dc.feat.MAT
+00005bf0: 4665 6174 7572 697a 6572 2829 0a20 2020  Featurizer().   
+00005c00: 2020 2020 2064 6973 745f 6d61 7472 6978       dist_matrix
+00005c10: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+00005c20: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
+00005c30: 6e63 6520 6d61 7472 6978 206f 6620 7468  nce matrix of th
+00005c40: 6520 696e 7075 7420 6d6f 6c65 6375 6c65  e input molecule
+00005c50: 2c20 7265 7475 726e 6564 2066 726f 6d20  , returned from 
+00005c60: 6463 2e66 6561 742e 4d41 5446 6561 7475  dc.feat.MATFeatu
+00005c70: 7269 7a65 7228 290a 2020 2020 2020 2020  rizer().        
+00005c80: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
+00005c90: 0a20 2020 2020 2020 2020 2020 2044 726f  .            Dro
+00005ca0: 706f 7574 2070 726f 6261 6269 6c69 7479  pout probability
+00005cb0: 2e0a 2020 2020 2020 2020 6570 733a 2066  ..        eps: f
+00005cc0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00005cd0: 2045 7073 696c 6f6e 2076 616c 7565 0a20   Epsilon value. 
+00005ce0: 2020 2020 2020 2069 6e66 3a20 666c 6f61         inf: floa
+00005cf0: 740a 2020 2020 2020 2020 2020 2020 5661  t.            Va
+00005d00: 6c75 6520 6f66 2069 6e66 696e 6974 7920  lue of infinity 
+00005d10: 746f 2062 6520 7573 6564 2e0a 2020 2020  to be used..    
+00005d20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00005d30: 6966 206d 6173 6b20 6973 206e 6f74 204e  if mask is not N
+00005d40: 6f6e 6520 616e 6420 6c65 6e28 6d61 736b  one and len(mask
+00005d50: 2e73 6861 7065 2920 3c3d 2032 3a0a 2020  .shape) <= 2:.  
+00005d60: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
+00005d70: 206d 6173 6b2e 756e 7371 7565 657a 6528   mask.unsqueeze(
+00005d80: 3129 0a0a 2020 2020 2020 2020 6261 7463  1)..        batc
+00005d90: 685f 7369 7a65 203d 2071 7565 7279 2e73  h_size = query.s
+00005da0: 697a 6528 3029 0a20 2020 2020 2020 2071  ize(0).        q
+00005db0: 7565 7279 2c20 6b65 792c 2076 616c 7565  uery, key, value
+00005dc0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00005dd0: 206c 6179 6572 2878 292e 7669 6577 2862   layer(x).view(b
+00005de0: 6174 6368 5f73 697a 652c 202d 312c 2073  atch_size, -1, s
+00005df0: 656c 662e 682c 2073 656c 662e 645f 6b29  elf.h, self.d_k)
+00005e00: 2e74 7261 6e73 706f 7365 2831 2c20 3229  .transpose(1, 2)
+00005e10: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00005e20: 206c 6179 6572 2c20 7820 696e 207a 6970   layer, x in zip
+00005e30: 2873 656c 662e 6c69 6e65 6172 5f6c 6179  (self.linear_lay
+00005e40: 6572 732c 2028 7175 6572 792c 206b 6579  ers, (query, key
+00005e50: 2c20 7661 6c75 6529 290a 2020 2020 2020  , value)).      
+00005e60: 2020 5d0a 0a20 2020 2020 2020 2078 2c20    ]..        x, 
+00005e70: 5f20 3d20 7365 6c66 2e5f 7369 6e67 6c65  _ = self._single
+00005e80: 5f61 7474 656e 7469 6f6e 2871 7565 7279  _attention(query
+00005e90: 2c20 6b65 792c 2076 616c 7565 2c20 6d61  , key, value, ma
+00005ea0: 736b 2c20 6164 6a5f 6d61 7472 6978 2c0a  sk, adj_matrix,.
 00005eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ec0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
-00005ed0: 655f 6d61 7472 6978 2c20 6472 6f70 6f75  e_matrix, dropou
-00005ee0: 745f 702c 2065 7073 2c20 696e 6629 0a20  t_p, eps, inf). 
-00005ef0: 2020 2020 2020 2078 203d 2078 2e74 7261         x = x.tra
-00005f00: 6e73 706f 7365 2831 2c20 3229 2e63 6f6e  nspose(1, 2).con
-00005f10: 7469 6775 6f75 7328 292e 7669 6577 2862  tiguous().view(b
-00005f20: 6174 6368 5f73 697a 652c 202d 312c 0a20  atch_size, -1,. 
-00005f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ed0: 2020 2020 2020 6469 7374 616e 6365 5f6d        distance_m
+00005ee0: 6174 7269 782c 2064 726f 706f 7574 5f70  atrix, dropout_p
+00005ef0: 2c20 6570 732c 2069 6e66 290a 2020 2020  , eps, inf).    
+00005f00: 2020 2020 7820 3d20 782e 7472 616e 7370      x = x.transp
+00005f10: 6f73 6528 312c 2032 292e 636f 6e74 6967  ose(1, 2).contig
+00005f20: 756f 7573 2829 2e76 6965 7728 6261 7463  uous().view(batc
+00005f30: 685f 7369 7a65 2c20 2d31 2c0a 2020 2020  h_size, -1,.    
 00005f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00005f60: 656c 662e 6820 2a20 7365 6c66 2e64 5f6b  elf.h * self.d_k
-00005f70: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00005f80: 6e20 7365 6c66 2e6f 7574 7075 745f 6c69  n self.output_li
-00005f90: 6e65 6172 2878 290a 0a0a 636c 6173 7320  near(x)...class 
-00005fa0: 4d41 5445 6e63 6f64 6572 4c61 7965 7228  MATEncoderLayer(
-00005fb0: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
-00005fc0: 2222 2245 6e63 6f64 6572 206c 6179 6572  """Encoder layer
-00005fd0: 2066 6f72 2075 7365 2069 6e20 7468 6520   for use in the 
-00005fe0: 4d6f 6c65 6375 6c61 7220 4174 7465 6e74  Molecular Attent
-00005ff0: 696f 6e20 5472 616e 7366 6f72 6d65 7220  ion Transformer 
-00006000: 5b31 5d5f 2e0a 0a20 2020 2054 6865 204d  [1]_...    The M
-00006010: 4154 456e 636f 6465 7220 6c61 7965 7220  ATEncoder layer 
-00006020: 7072 696d 6172 696c 7920 636f 6e73 6973  primarily consis
-00006030: 7473 206f 6620 6120 7365 6c66 2d61 7474  ts of a self-att
-00006040: 656e 7469 6f6e 206c 6179 6572 2028 4d75  ention layer (Mu
-00006050: 6c74 6948 6561 6465 644d 4154 4174 7465  ltiHeadedMATAtte
-00006060: 6e74 696f 6e29 2061 6e64 2061 2066 6565  ntion) and a fee
-00006070: 642d 666f 7277 6172 6420 6c61 7965 7220  d-forward layer 
-00006080: 2850 6f73 6974 696f 6e77 6973 6546 6565  (PositionwiseFee
-00006090: 6446 6f72 7761 7264 292e 0a20 2020 2054  dForward)..    T
-000060a0: 6869 7320 6c61 7965 7220 6361 6e20 6265  his layer can be
-000060b0: 2073 7461 636b 6564 206d 756c 7469 706c   stacked multipl
-000060c0: 6520 7469 6d65 7320 746f 2066 6f72 6d20  e times to form 
-000060d0: 616e 2065 6e63 6f64 6572 2e0a 0a20 2020  an encoder...   
-000060e0: 2052 6566 6572 656e 6365 730a 2020 2020   References.    
-000060f0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 202e  ----------.    .
-00006100: 2e20 5b31 5d20 4c75 6b61 737a 204d 617a  . [1] Lukasz Maz
-00006110: 6961 726b 6120 6574 2061 6c2e 2022 4d6f  iarka et al. "Mo
-00006120: 6c65 6375 6c65 2041 7474 656e 7469 6f6e  lecule Attention
-00006130: 2054 7261 6e73 666f 726d 6572 2220 4772   Transformer" Gr
-00006140: 6170 6820 5265 7072 6573 656e 7461 7469  aph Representati
-00006150: 6f6e 204c 6561 726e 696e 6720 776f 726b  on Learning work
-00006160: 7368 6f70 2061 6e64 204d 6163 6869 6e65  shop and Machine
-00006170: 204c 6561 726e 696e 6720 616e 6420 7468   Learning and th
-00006180: 6520 5068 7973 6963 616c 2053 6369 656e  e Physical Scien
-00006190: 6365 7320 776f 726b 7368 6f70 2061 7420  ces workshop at 
-000061a0: 4e65 7572 4950 5320 3230 3139 2e20 3230  NeurIPS 2019. 20
-000061b0: 3230 2e20 6874 7470 733a 2f2f 6172 7869  20. https://arxi
-000061c0: 762e 6f72 672f 6162 732f 3230 3032 2e30  v.org/abs/2002.0
-000061d0: 3832 3634 0a0a 2020 2020 4578 616d 706c  8264..    Exampl
-000061e0: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
-000061f0: 2020 2020 3e3e 3e20 6672 6f6d 2072 646b      >>> from rdk
-00006200: 6974 2069 6d70 6f72 7420 4368 656d 0a20  it import Chem. 
-00006210: 2020 203e 3e3e 2069 6d70 6f72 7420 746f     >>> import to
-00006220: 7263 680a 2020 2020 3e3e 3e20 696d 706f  rch.    >>> impo
-00006230: 7274 2064 6565 7063 6865 6d0a 2020 2020  rt deepchem.    
-00006240: 3e3e 3e20 6672 6f6d 2064 6565 7063 6865  >>> from deepche
-00006250: 6d2e 6d6f 6465 6c73 2e74 6f72 6368 5f6d  m.models.torch_m
-00006260: 6f64 656c 732e 6c61 7965 7273 2069 6d70  odels.layers imp
-00006270: 6f72 7420 4d41 5445 6d62 6564 6469 6e67  ort MATEmbedding
-00006280: 2c20 4d41 5445 6e63 6f64 6572 4c61 7965  , MATEncoderLaye
-00006290: 720a 2020 2020 3e3e 3e20 696e 7075 745f  r.    >>> input_
-000062a0: 736d 696c 6520 3d20 2243 4322 0a20 2020  smile = "CC".   
-000062b0: 203e 3e3e 2066 6561 7420 3d20 6465 6570   >>> feat = deep
-000062c0: 6368 656d 2e66 6561 742e 4d41 5446 6561  chem.feat.MATFea
-000062d0: 7475 7269 7a65 7228 290a 2020 2020 3e3e  turizer().    >>
-000062e0: 3e20 6f75 7420 3d20 6665 6174 2e66 6561  > out = feat.fea
-000062f0: 7475 7269 7a65 2869 6e70 7574 5f73 6d69  turize(input_smi
-00006300: 6c65 290a 2020 2020 3e3e 3e20 6e6f 6465  le).    >>> node
-00006310: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
-00006320: 6f75 745b 305d 2e6e 6f64 655f 6665 6174  out[0].node_feat
-00006330: 7572 6573 292e 666c 6f61 7428 292e 756e  ures).float().un
-00006340: 7371 7565 657a 6528 3029 0a20 2020 203e  squeeze(0).    >
-00006350: 3e3e 2061 646a 203d 2074 6f72 6368 2e74  >> adj = torch.t
-00006360: 656e 736f 7228 6f75 745b 305d 2e61 646a  ensor(out[0].adj
-00006370: 6163 656e 6379 5f6d 6174 7269 7829 2e66  acency_matrix).f
-00006380: 6c6f 6174 2829 2e75 6e73 7175 6565 7a65  loat().unsqueeze
-00006390: 2830 290a 2020 2020 3e3e 3e20 6469 7374  (0).    >>> dist
-000063a0: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
-000063b0: 6f75 745b 305d 2e64 6973 7461 6e63 655f  out[0].distance_
-000063c0: 6d61 7472 6978 292e 666c 6f61 7428 292e  matrix).float().
-000063d0: 756e 7371 7565 657a 6528 3029 0a20 2020  unsqueeze(0).   
-000063e0: 203e 3e3e 206d 6173 6b20 3d20 746f 7263   >>> mask = torc
-000063f0: 682e 7375 6d28 746f 7263 682e 6162 7328  h.sum(torch.abs(
-00006400: 6e6f 6465 292c 2064 696d 3d2d 3129 2021  node), dim=-1) !
-00006410: 3d20 300a 2020 2020 3e3e 3e20 6c61 7965  = 0.    >>> laye
-00006420: 7220 3d20 4d41 5445 6e63 6f64 6572 4c61  r = MATEncoderLa
-00006430: 7965 7228 290a 2020 2020 3e3e 3e20 6f70  yer().    >>> op
-00006440: 203d 204d 4154 456d 6265 6464 696e 6728   = MATEmbedding(
-00006450: 2928 6e6f 6465 290a 2020 2020 3e3e 3e20  )(node).    >>> 
-00006460: 6f75 7470 7574 203d 206c 6179 6572 286f  output = layer(o
-00006470: 702c 206d 6173 6b2c 2061 646a 2c20 6469  p, mask, adj, di
-00006480: 7374 290a 2020 2020 2222 220a 0a20 2020  st).    """..   
-00006490: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-000064a0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-000064b0: 2020 2020 2064 6973 745f 6b65 726e 656c       dist_kernel
-000064c0: 3a20 7374 7220 3d20 2773 6f66 746d 6178  : str = 'softmax
-000064d0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-000064e0: 2020 2020 6c61 6d62 6461 5f61 7474 656e      lambda_atten
-000064f0: 7469 6f6e 3a20 666c 6f61 7420 3d20 302e  tion: float = 0.
-00006500: 3333 2c0a 2020 2020 2020 2020 2020 2020  33,.            
-00006510: 2020 2020 206c 616d 6264 615f 6469 7374       lambda_dist
-00006520: 616e 6365 3a20 666c 6f61 7420 3d20 302e  ance: float = 0.
-00006530: 3333 2c0a 2020 2020 2020 2020 2020 2020  33,.            
-00006540: 2020 2020 2068 3a20 696e 7420 3d20 3136       h: int = 16
-00006550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006560: 2020 2073 615f 6873 697a 653a 2069 6e74     sa_hsize: int
-00006570: 203d 2031 3032 342c 0a20 2020 2020 2020   = 1024,.       
-00006580: 2020 2020 2020 2020 2020 7361 5f64 726f            sa_dro
-00006590: 706f 7574 5f70 3a20 666c 6f61 7420 3d20  pout_p: float = 
-000065a0: 302e 302c 0a20 2020 2020 2020 2020 2020  0.0,.           
-000065b0: 2020 2020 2020 6f75 7470 7574 5f62 6961        output_bia
-000065c0: 733a 2062 6f6f 6c20 3d20 5472 7565 2c0a  s: bool = True,.
-000065d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065e0: 2064 5f69 6e70 7574 3a20 696e 7420 3d20   d_input: int = 
-000065f0: 3130 3234 2c0a 2020 2020 2020 2020 2020  1024,.          
-00006600: 2020 2020 2020 2064 5f68 6964 6465 6e3a         d_hidden:
-00006610: 2069 6e74 203d 2031 3032 342c 0a20 2020   int = 1024,.   
-00006620: 2020 2020 2020 2020 2020 2020 2020 645f                d_
-00006630: 6f75 7470 7574 3a20 696e 7420 3d20 3130  output: int = 10
-00006640: 3234 2c0a 2020 2020 2020 2020 2020 2020  24,.            
-00006650: 2020 2020 2061 6374 6976 6174 696f 6e3a       activation:
-00006660: 2073 7472 203d 2027 6c65 616b 7972 656c   str = 'leakyrel
-00006670: 7527 2c0a 2020 2020 2020 2020 2020 2020  u',.            
-00006680: 2020 2020 206e 5f6c 6179 6572 733a 2069       n_layers: i
-00006690: 6e74 203d 2031 2c0a 2020 2020 2020 2020  nt = 1,.        
-000066a0: 2020 2020 2020 2020 2066 665f 6472 6f70           ff_drop
-000066b0: 6f75 745f 703a 2066 6c6f 6174 203d 2030  out_p: float = 0
-000066c0: 2e30 2c0a 2020 2020 2020 2020 2020 2020  .0,.            
-000066d0: 2020 2020 2065 6e63 6f64 6572 5f68 7369       encoder_hsi
-000066e0: 7a65 3a20 696e 7420 3d20 3130 3234 2c0a  ze: int = 1024,.
-000066f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006700: 2065 6e63 6f64 6572 5f64 726f 706f 7574   encoder_dropout
-00006710: 5f70 3a20 666c 6f61 7420 3d20 302e 3029  _p: float = 0.0)
-00006720: 3a0a 2020 2020 2020 2020 2222 2249 6e69  :.        """Ini
-00006730: 7469 616c 697a 6520 6120 4d41 5445 6e63  tialize a MATEnc
-00006740: 6f64 6572 206c 6179 6572 2e0a 0a20 2020  oder layer...   
-00006750: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00006760: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00006770: 2d2d 0a20 2020 2020 2020 2064 6973 745f  --.        dist_
-00006780: 6b65 726e 656c 3a20 7374 720a 2020 2020  kernel: str.    
-00006790: 2020 2020 2020 2020 4b65 726e 656c 2061          Kernel a
-000067a0: 6374 6976 6174 696f 6e20 746f 2062 6520  ctivation to be 
-000067b0: 7573 6564 2e20 4361 6e20 6265 2065 6974  used. Can be eit
-000067c0: 6865 7220 2773 6f66 746d 6178 2720 666f  her 'softmax' fo
-000067d0: 7220 736f 6674 6d61 7820 6f72 2027 6578  r softmax or 'ex
-000067e0: 7027 2066 6f72 2065 7870 6f6e 656e 7469  p' for exponenti
-000067f0: 616c 2c20 666f 7220 7468 6520 7365 6c66  al, for the self
-00006800: 2d61 7474 656e 7469 6f6e 206c 6179 6572  -attention layer
-00006810: 2e0a 2020 2020 2020 2020 6c61 6d62 6461  ..        lambda
-00006820: 5f61 7474 656e 7469 6f6e 3a20 666c 6f61  _attention: floa
-00006830: 740a 2020 2020 2020 2020 2020 2020 436f  t.            Co
-00006840: 6e73 7461 6e74 2074 6f20 6265 206d 756c  nstant to be mul
-00006850: 7469 706c 6965 6420 7769 7468 2074 6865  tiplied with the
-00006860: 2061 7474 656e 7469 6f6e 206d 6174 7269   attention matri
-00006870: 7820 696e 2074 6865 2073 656c 662d 6174  x in the self-at
-00006880: 7465 6e74 696f 6e20 6c61 7965 722e 0a20  tention layer.. 
-00006890: 2020 2020 2020 206c 616d 6264 615f 6469         lambda_di
-000068a0: 7374 616e 6365 3a20 666c 6f61 740a 2020  stance: float.  
-000068b0: 2020 2020 2020 2020 2020 436f 6e73 7461            Consta
-000068c0: 6e74 2074 6f20 6265 206d 756c 7469 706c  nt to be multipl
-000068d0: 6965 6420 7769 7468 2074 6865 2064 6973  ied with the dis
-000068e0: 7461 6e63 6520 6d61 7472 6978 2069 6e20  tance matrix in 
-000068f0: 7468 6520 7365 6c66 2d61 7474 656e 7469  the self-attenti
-00006900: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
-00006910: 2020 683a 2069 6e74 0a20 2020 2020 2020    h: int.       
-00006920: 2020 2020 204e 756d 6265 7220 6f66 2061       Number of a
-00006930: 7474 656e 7469 6f6e 2068 6561 6473 2066  ttention heads f
-00006940: 6f72 2074 6865 2073 656c 662d 6174 7465  or the self-atte
-00006950: 6e74 696f 6e20 6c61 7965 722e 0a20 2020  ntion layer..   
-00006960: 2020 2020 2073 615f 6873 697a 653a 2069       sa_hsize: i
-00006970: 6e74 0a20 2020 2020 2020 2020 2020 2053  nt.            S
-00006980: 697a 6520 6f66 2064 656e 7365 206c 6179  ize of dense lay
-00006990: 6572 2069 6e20 7468 6520 7365 6c66 2d61  er in the self-a
-000069a0: 7474 656e 7469 6f6e 206c 6179 6572 2e0a  ttention layer..
-000069b0: 2020 2020 2020 2020 7361 5f64 726f 706f          sa_dropo
-000069c0: 7574 5f70 3a20 666c 6f61 740a 2020 2020  ut_p: float.    
-000069d0: 2020 2020 2020 2020 4472 6f70 6f75 7420          Dropout 
-000069e0: 7072 6f62 6162 696c 6974 7920 666f 7220  probability for 
-000069f0: 7468 6520 7365 6c66 2d61 7474 656e 7469  the self-attenti
-00006a00: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
-00006a10: 2020 6f75 7470 7574 5f62 6961 733a 2062    output_bias: b
-00006a20: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
-00006a30: 4966 2054 7275 652c 2064 656e 7365 206c  If True, dense l
-00006a40: 6179 6572 7320 7769 6c6c 2075 7365 2062  ayers will use b
-00006a50: 6961 7320 7665 6374 6f72 7320 696e 2074  ias vectors in t
-00006a60: 6865 2073 656c 662d 6174 7465 6e74 696f  he self-attentio
-00006a70: 6e20 6c61 7965 722e 0a20 2020 2020 2020  n layer..       
-00006a80: 2064 5f69 6e70 7574 3a20 696e 740a 2020   d_input: int.  
-00006a90: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
-00006aa0: 6620 696e 7075 7420 6c61 7965 7220 696e  f input layer in
-00006ab0: 2074 6865 2066 6565 642d 666f 7277 6172   the feed-forwar
-00006ac0: 6420 6c61 7965 722e 0a20 2020 2020 2020  d layer..       
-00006ad0: 2064 5f68 6964 6465 6e3a 2069 6e74 0a20   d_hidden: int. 
-00006ae0: 2020 2020 2020 2020 2020 2053 697a 6520             Size 
-00006af0: 6f66 2068 6964 6465 6e20 6c61 7965 7220  of hidden layer 
-00006b00: 696e 2074 6865 2066 6565 642d 666f 7277  in the feed-forw
-00006b10: 6172 6420 6c61 7965 722e 0a20 2020 2020  ard layer..     
-00006b20: 2020 2064 5f6f 7574 7075 743a 2069 6e74     d_output: int
-00006b30: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
-00006b40: 6520 6f66 206f 7574 7075 7420 6c61 7965  e of output laye
-00006b50: 7220 696e 2074 6865 2066 6565 642d 666f  r in the feed-fo
-00006b60: 7277 6172 6420 6c61 7965 722e 0a20 2020  rward layer..   
-00006b70: 2020 2020 2061 6374 6976 6174 696f 6e3a       activation:
-00006b80: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
-00006b90: 2041 6374 6976 6174 696f 6e20 6675 6e63   Activation func
-00006ba0: 7469 6f6e 2074 6f20 6265 2075 7365 6420  tion to be used 
-00006bb0: 696e 2074 6865 2066 6565 642d 666f 7277  in the feed-forw
-00006bc0: 6172 6420 6c61 7965 722e 0a20 2020 2020  ard layer..     
-00006bd0: 2020 2020 2020 2043 616e 2063 686f 6f73         Can choos
-00006be0: 6520 6265 7477 6565 6e20 2772 656c 7527  e between 'relu'
-00006bf0: 2066 6f72 2052 654c 552c 2027 6c65 616b   for ReLU, 'leak
-00006c00: 7972 656c 7527 2066 6f72 204c 6561 6b79  yrelu' for Leaky
-00006c10: 5265 4c55 2c20 2770 7265 6c75 2720 666f  ReLU, 'prelu' fo
-00006c20: 7220 5052 654c 552c 0a20 2020 2020 2020  r PReLU,.       
-00006c30: 2020 2020 2027 7461 6e68 2720 666f 7220       'tanh' for 
-00006c40: 5461 6e48 2c20 2773 656c 7527 2066 6f72  TanH, 'selu' for
-00006c50: 2053 454c 552c 2027 656c 7527 2066 6f72   SELU, 'elu' for
-00006c60: 2045 4c55 2061 6e64 2027 6c69 6e65 6172   ELU and 'linear
-00006c70: 2720 666f 7220 6c69 6e65 6172 2061 6374  ' for linear act
-00006c80: 6976 6174 696f 6e2e 0a20 2020 2020 2020  ivation..       
-00006c90: 206e 5f6c 6179 6572 733a 2069 6e74 0a20   n_layers: int. 
-00006ca0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
-00006cb0: 7220 6f66 206c 6179 6572 7320 696e 2074  r of layers in t
-00006cc0: 6865 2066 6565 642d 666f 7277 6172 6420  he feed-forward 
-00006cd0: 6c61 7965 722e 0a20 2020 2020 2020 2064  layer..        d
-00006ce0: 726f 706f 7574 5f70 3a20 666c 6f61 740a  ropout_p: float.
-00006cf0: 2020 2020 2020 2020 2020 2020 4472 6f70              Drop
-00006d00: 6f75 7420 7072 6f62 6162 696c 6974 7920  out probability 
-00006d10: 696e 2074 6865 2066 6565 6564 2d66 6f72  in the feeed-for
-00006d20: 7761 7264 206c 6179 6572 2e0a 2020 2020  ward layer..    
-00006d30: 2020 2020 656e 636f 6465 725f 6873 697a      encoder_hsiz
-00006d40: 653a 2069 6e74 0a20 2020 2020 2020 2020  e: int.         
-00006d50: 2020 2053 697a 6520 6f66 2044 656e 7365     Size of Dense
-00006d60: 206c 6179 6572 2066 6f72 2074 6865 2065   layer for the e
-00006d70: 6e63 6f64 6572 2069 7473 656c 662e 0a20  ncoder itself.. 
-00006d80: 2020 2020 2020 2065 6e63 6f64 6572 5f64         encoder_d
-00006d90: 726f 706f 7574 5f70 3a20 666c 6f61 740a  ropout_p: float.
-00006da0: 2020 2020 2020 2020 2020 2020 4472 6f70              Drop
-00006db0: 6f75 7420 7072 6f62 6162 696c 6974 7920  out probability 
-00006dc0: 666f 7220 636f 6e6e 6563 7469 6f6e 7320  for connections 
-00006dd0: 696e 2074 6865 2065 6e63 6f64 6572 206c  in the encoder l
-00006de0: 6179 6572 2e0a 2020 2020 2020 2020 2222  ayer..        ""
-00006df0: 220a 2020 2020 2020 2020 7375 7065 7228  ".        super(
-00006e00: 4d41 5445 6e63 6f64 6572 4c61 7965 722c  MATEncoderLayer,
-00006e10: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-00006e20: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
-00006e30: 656c 665f 6174 746e 203d 204d 756c 7469  elf_attn = Multi
-00006e40: 4865 6164 6564 4d41 5441 7474 656e 7469  HeadedMATAttenti
-00006e50: 6f6e 2864 6973 745f 6b65 726e 656c 2c20  on(dist_kernel, 
-00006e60: 6c61 6d62 6461 5f61 7474 656e 7469 6f6e  lambda_attention
-00006e70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00005f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005f70: 2e68 202a 2073 656c 662e 645f 6b29 0a0a  .h * self.d_k)..
+00005f80: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00005f90: 656c 662e 6f75 7470 7574 5f6c 696e 6561  elf.output_linea
+00005fa0: 7228 7829 0a0a 0a63 6c61 7373 204d 4154  r(x)...class MAT
+00005fb0: 456e 636f 6465 724c 6179 6572 286e 6e2e  EncoderLayer(nn.
+00005fc0: 4d6f 6475 6c65 293a 0a20 2020 2022 2222  Module):.    """
+00005fd0: 456e 636f 6465 7220 6c61 7965 7220 666f  Encoder layer fo
+00005fe0: 7220 7573 6520 696e 2074 6865 204d 6f6c  r use in the Mol
+00005ff0: 6563 756c 6172 2041 7474 656e 7469 6f6e  ecular Attention
+00006000: 2054 7261 6e73 666f 726d 6572 205b 315d   Transformer [1]
+00006010: 5f2e 0a0a 2020 2020 5468 6520 4d41 5445  _...    The MATE
+00006020: 6e63 6f64 6572 206c 6179 6572 2070 7269  ncoder layer pri
+00006030: 6d61 7269 6c79 2063 6f6e 7369 7374 7320  marily consists 
+00006040: 6f66 2061 2073 656c 662d 6174 7465 6e74  of a self-attent
+00006050: 696f 6e20 6c61 7965 7220 284d 756c 7469  ion layer (Multi
+00006060: 4865 6164 6564 4d41 5441 7474 656e 7469  HeadedMATAttenti
+00006070: 6f6e 2920 616e 6420 6120 6665 6564 2d66  on) and a feed-f
+00006080: 6f72 7761 7264 206c 6179 6572 2028 506f  orward layer (Po
+00006090: 7369 7469 6f6e 7769 7365 4665 6564 466f  sitionwiseFeedFo
+000060a0: 7277 6172 6429 2e0a 2020 2020 5468 6973  rward)..    This
+000060b0: 206c 6179 6572 2063 616e 2062 6520 7374   layer can be st
+000060c0: 6163 6b65 6420 6d75 6c74 6970 6c65 2074  acked multiple t
+000060d0: 696d 6573 2074 6f20 666f 726d 2061 6e20  imes to form an 
+000060e0: 656e 636f 6465 722e 0a0a 2020 2020 5265  encoder...    Re
+000060f0: 6665 7265 6e63 6573 0a20 2020 202d 2d2d  ferences.    ---
+00006100: 2d2d 2d2d 2d2d 2d0a 2020 2020 2e2e 205b  -------.    .. [
+00006110: 315d 204c 756b 6173 7a20 4d61 7a69 6172  1] Lukasz Maziar
+00006120: 6b61 2065 7420 616c 2e20 224d 6f6c 6563  ka et al. "Molec
+00006130: 756c 6520 4174 7465 6e74 696f 6e20 5472  ule Attention Tr
+00006140: 616e 7366 6f72 6d65 7222 2047 7261 7068  ansformer" Graph
+00006150: 2052 6570 7265 7365 6e74 6174 696f 6e20   Representation 
+00006160: 4c65 6172 6e69 6e67 2077 6f72 6b73 686f  Learning worksho
+00006170: 7020 616e 6420 4d61 6368 696e 6520 4c65  p and Machine Le
+00006180: 6172 6e69 6e67 2061 6e64 2074 6865 2050  arning and the P
+00006190: 6879 7369 6361 6c20 5363 6965 6e63 6573  hysical Sciences
+000061a0: 2077 6f72 6b73 686f 7020 6174 204e 6575   workshop at Neu
+000061b0: 7249 5053 2032 3031 392e 2032 3032 302e  rIPS 2019. 2020.
+000061c0: 2068 7474 7073 3a2f 2f61 7278 6976 2e6f   https://arxiv.o
+000061d0: 7267 2f61 6273 2f32 3030 322e 3038 3236  rg/abs/2002.0826
+000061e0: 340a 0a20 2020 2045 7861 6d70 6c65 730a  4..    Examples.
+000061f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00006200: 203e 3e3e 2066 726f 6d20 7264 6b69 7420   >>> from rdkit 
+00006210: 696d 706f 7274 2043 6865 6d0a 2020 2020  import Chem.    
+00006220: 3e3e 3e20 696d 706f 7274 2074 6f72 6368  >>> import torch
+00006230: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
+00006240: 6465 6570 6368 656d 0a20 2020 203e 3e3e  deepchem.    >>>
+00006250: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
+00006260: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
+00006270: 6c73 2e6c 6179 6572 7320 696d 706f 7274  ls.layers import
+00006280: 204d 4154 456d 6265 6464 696e 672c 204d   MATEmbedding, M
+00006290: 4154 456e 636f 6465 724c 6179 6572 0a20  ATEncoderLayer. 
+000062a0: 2020 203e 3e3e 2069 6e70 7574 5f73 6d69     >>> input_smi
+000062b0: 6c65 203d 2022 4343 220a 2020 2020 3e3e  le = "CC".    >>
+000062c0: 3e20 6665 6174 203d 2064 6565 7063 6865  > feat = deepche
+000062d0: 6d2e 6665 6174 2e4d 4154 4665 6174 7572  m.feat.MATFeatur
+000062e0: 697a 6572 2829 0a20 2020 203e 3e3e 206f  izer().    >>> o
+000062f0: 7574 203d 2066 6561 742e 6665 6174 7572  ut = feat.featur
+00006300: 697a 6528 696e 7075 745f 736d 696c 6529  ize(input_smile)
+00006310: 0a20 2020 203e 3e3e 206e 6f64 6520 3d20  .    >>> node = 
+00006320: 746f 7263 682e 7465 6e73 6f72 286f 7574  torch.tensor(out
+00006330: 5b30 5d2e 6e6f 6465 5f66 6561 7475 7265  [0].node_feature
+00006340: 7329 2e66 6c6f 6174 2829 2e75 6e73 7175  s).float().unsqu
+00006350: 6565 7a65 2830 290a 2020 2020 3e3e 3e20  eeze(0).    >>> 
+00006360: 6164 6a20 3d20 746f 7263 682e 7465 6e73  adj = torch.tens
+00006370: 6f72 286f 7574 5b30 5d2e 6164 6a61 6365  or(out[0].adjace
+00006380: 6e63 795f 6d61 7472 6978 292e 666c 6f61  ncy_matrix).floa
+00006390: 7428 292e 756e 7371 7565 657a 6528 3029  t().unsqueeze(0)
+000063a0: 0a20 2020 203e 3e3e 2064 6973 7420 3d20  .    >>> dist = 
+000063b0: 746f 7263 682e 7465 6e73 6f72 286f 7574  torch.tensor(out
+000063c0: 5b30 5d2e 6469 7374 616e 6365 5f6d 6174  [0].distance_mat
+000063d0: 7269 7829 2e66 6c6f 6174 2829 2e75 6e73  rix).float().uns
+000063e0: 7175 6565 7a65 2830 290a 2020 2020 3e3e  queeze(0).    >>
+000063f0: 3e20 6d61 736b 203d 2074 6f72 6368 2e73  > mask = torch.s
+00006400: 756d 2874 6f72 6368 2e61 6273 286e 6f64  um(torch.abs(nod
+00006410: 6529 2c20 6469 6d3d 2d31 2920 213d 2030  e), dim=-1) != 0
+00006420: 0a20 2020 203e 3e3e 206c 6179 6572 203d  .    >>> layer =
+00006430: 204d 4154 456e 636f 6465 724c 6179 6572   MATEncoderLayer
+00006440: 2829 0a20 2020 203e 3e3e 206f 7020 3d20  ().    >>> op = 
+00006450: 4d41 5445 6d62 6564 6469 6e67 2829 286e  MATEmbedding()(n
+00006460: 6f64 6529 0a20 2020 203e 3e3e 206f 7574  ode).    >>> out
+00006470: 7075 7420 3d20 6c61 7965 7228 6f70 2c20  put = layer(op, 
+00006480: 6d61 736b 2c20 6164 6a2c 2064 6973 7429  mask, adj, dist)
+00006490: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+000064a0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+000064b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000064c0: 2020 6469 7374 5f6b 6572 6e65 6c3a 2073    dist_kernel: s
+000064d0: 7472 203d 2027 736f 6674 6d61 7827 2c0a  tr = 'softmax',.
+000064e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064f0: 206c 616d 6264 615f 6174 7465 6e74 696f   lambda_attentio
+00006500: 6e3a 2066 6c6f 6174 203d 2030 2e33 332c  n: float = 0.33,
+00006510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006520: 2020 6c61 6d62 6461 5f64 6973 7461 6e63    lambda_distanc
+00006530: 653a 2066 6c6f 6174 203d 2030 2e33 332c  e: float = 0.33,
+00006540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006550: 2020 683a 2069 6e74 203d 2031 362c 0a20    h: int = 16,. 
+00006560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006570: 7361 5f68 7369 7a65 3a20 696e 7420 3d20  sa_hsize: int = 
+00006580: 3130 3234 2c0a 2020 2020 2020 2020 2020  1024,.          
+00006590: 2020 2020 2020 2073 615f 6472 6f70 6f75         sa_dropou
+000065a0: 745f 703a 2066 6c6f 6174 203d 2030 2e30  t_p: float = 0.0
+000065b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000065c0: 2020 206f 7574 7075 745f 6269 6173 3a20     output_bias: 
+000065d0: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+000065e0: 2020 2020 2020 2020 2020 2020 2020 645f                d_
+000065f0: 696e 7075 743a 2069 6e74 203d 2031 3032  input: int = 102
+00006600: 342c 0a20 2020 2020 2020 2020 2020 2020  4,.             
+00006610: 2020 2020 645f 6869 6464 656e 3a20 696e      d_hidden: in
+00006620: 7420 3d20 3130 3234 2c0a 2020 2020 2020  t = 1024,.      
+00006630: 2020 2020 2020 2020 2020 2064 5f6f 7574             d_out
+00006640: 7075 743a 2069 6e74 203d 2031 3032 342c  put: int = 1024,
+00006650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006660: 2020 6163 7469 7661 7469 6f6e 3a20 7374    activation: st
+00006670: 7220 3d20 276c 6561 6b79 7265 6c75 272c  r = 'leakyrelu',
+00006680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006690: 2020 6e5f 6c61 7965 7273 3a20 696e 7420    n_layers: int 
+000066a0: 3d20 312c 0a20 2020 2020 2020 2020 2020  = 1,.           
+000066b0: 2020 2020 2020 6666 5f64 726f 706f 7574        ff_dropout
+000066c0: 5f70 3a20 666c 6f61 7420 3d20 302e 302c  _p: float = 0.0,
+000066d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000066e0: 2020 656e 636f 6465 725f 6873 697a 653a    encoder_hsize:
+000066f0: 2069 6e74 203d 2031 3032 342c 0a20 2020   int = 1024,.   
+00006700: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00006710: 636f 6465 725f 6472 6f70 6f75 745f 703a  coder_dropout_p:
+00006720: 2066 6c6f 6174 203d 2030 2e30 293a 0a20   float = 0.0):. 
+00006730: 2020 2020 2020 2022 2222 496e 6974 6961         """Initia
+00006740: 6c69 7a65 2061 204d 4154 456e 636f 6465  lize a MATEncode
+00006750: 7220 6c61 7965 722e 0a0a 2020 2020 2020  r layer...      
+00006760: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00006770: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00006780: 2020 2020 2020 2020 6469 7374 5f6b 6572          dist_ker
+00006790: 6e65 6c3a 2073 7472 0a20 2020 2020 2020  nel: str.       
+000067a0: 2020 2020 204b 6572 6e65 6c20 6163 7469       Kernel acti
+000067b0: 7661 7469 6f6e 2074 6f20 6265 2075 7365  vation to be use
+000067c0: 642e 2043 616e 2062 6520 6569 7468 6572  d. Can be either
+000067d0: 2027 736f 6674 6d61 7827 2066 6f72 2073   'softmax' for s
+000067e0: 6f66 746d 6178 206f 7220 2765 7870 2720  oftmax or 'exp' 
+000067f0: 666f 7220 6578 706f 6e65 6e74 6961 6c2c  for exponential,
+00006800: 2066 6f72 2074 6865 2073 656c 662d 6174   for the self-at
+00006810: 7465 6e74 696f 6e20 6c61 7965 722e 0a20  tention layer.. 
+00006820: 2020 2020 2020 206c 616d 6264 615f 6174         lambda_at
+00006830: 7465 6e74 696f 6e3a 2066 6c6f 6174 0a20  tention: float. 
+00006840: 2020 2020 2020 2020 2020 2043 6f6e 7374             Const
+00006850: 616e 7420 746f 2062 6520 6d75 6c74 6970  ant to be multip
+00006860: 6c69 6564 2077 6974 6820 7468 6520 6174  lied with the at
+00006870: 7465 6e74 696f 6e20 6d61 7472 6978 2069  tention matrix i
+00006880: 6e20 7468 6520 7365 6c66 2d61 7474 656e  n the self-atten
+00006890: 7469 6f6e 206c 6179 6572 2e0a 2020 2020  tion layer..    
+000068a0: 2020 2020 6c61 6d62 6461 5f64 6973 7461      lambda_dista
+000068b0: 6e63 653a 2066 6c6f 6174 0a20 2020 2020  nce: float.     
+000068c0: 2020 2020 2020 2043 6f6e 7374 616e 7420         Constant 
+000068d0: 746f 2062 6520 6d75 6c74 6970 6c69 6564  to be multiplied
+000068e0: 2077 6974 6820 7468 6520 6469 7374 616e   with the distan
+000068f0: 6365 206d 6174 7269 7820 696e 2074 6865  ce matrix in the
+00006900: 2073 656c 662d 6174 7465 6e74 696f 6e20   self-attention 
+00006910: 6c61 7965 722e 0a20 2020 2020 2020 2068  layer..        h
+00006920: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+00006930: 2020 4e75 6d62 6572 206f 6620 6174 7465    Number of atte
+00006940: 6e74 696f 6e20 6865 6164 7320 666f 7220  ntion heads for 
+00006950: 7468 6520 7365 6c66 2d61 7474 656e 7469  the self-attenti
+00006960: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
+00006970: 2020 7361 5f68 7369 7a65 3a20 696e 740a    sa_hsize: int.
+00006980: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
+00006990: 206f 6620 6465 6e73 6520 6c61 7965 7220   of dense layer 
+000069a0: 696e 2074 6865 2073 656c 662d 6174 7465  in the self-atte
+000069b0: 6e74 696f 6e20 6c61 7965 722e 0a20 2020  ntion layer..   
+000069c0: 2020 2020 2073 615f 6472 6f70 6f75 745f       sa_dropout_
+000069d0: 703a 2066 6c6f 6174 0a20 2020 2020 2020  p: float.       
+000069e0: 2020 2020 2044 726f 706f 7574 2070 726f       Dropout pro
+000069f0: 6261 6269 6c69 7479 2066 6f72 2074 6865  bability for the
+00006a00: 2073 656c 662d 6174 7465 6e74 696f 6e20   self-attention 
+00006a10: 6c61 7965 722e 0a20 2020 2020 2020 206f  layer..        o
+00006a20: 7574 7075 745f 6269 6173 3a20 626f 6f6c  utput_bias: bool
+00006a30: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00006a40: 5472 7565 2c20 6465 6e73 6520 6c61 7965  True, dense laye
+00006a50: 7273 2077 696c 6c20 7573 6520 6269 6173  rs will use bias
+00006a60: 2076 6563 746f 7273 2069 6e20 7468 6520   vectors in the 
+00006a70: 7365 6c66 2d61 7474 656e 7469 6f6e 206c  self-attention l
+00006a80: 6179 6572 2e0a 2020 2020 2020 2020 645f  ayer..        d_
+00006a90: 696e 7075 743a 2069 6e74 0a20 2020 2020  input: int.     
+00006aa0: 2020 2020 2020 2053 697a 6520 6f66 2069         Size of i
+00006ab0: 6e70 7574 206c 6179 6572 2069 6e20 7468  nput layer in th
+00006ac0: 6520 6665 6564 2d66 6f72 7761 7264 206c  e feed-forward l
+00006ad0: 6179 6572 2e0a 2020 2020 2020 2020 645f  ayer..        d_
+00006ae0: 6869 6464 656e 3a20 696e 740a 2020 2020  hidden: int.    
+00006af0: 2020 2020 2020 2020 5369 7a65 206f 6620          Size of 
+00006b00: 6869 6464 656e 206c 6179 6572 2069 6e20  hidden layer in 
+00006b10: 7468 6520 6665 6564 2d66 6f72 7761 7264  the feed-forward
+00006b20: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+00006b30: 645f 6f75 7470 7574 3a20 696e 740a 2020  d_output: int.  
+00006b40: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
+00006b50: 6620 6f75 7470 7574 206c 6179 6572 2069  f output layer i
+00006b60: 6e20 7468 6520 6665 6564 2d66 6f72 7761  n the feed-forwa
+00006b70: 7264 206c 6179 6572 2e0a 2020 2020 2020  rd layer..      
+00006b80: 2020 6163 7469 7661 7469 6f6e 3a20 7374    activation: st
+00006b90: 720a 2020 2020 2020 2020 2020 2020 4163  r.            Ac
+00006ba0: 7469 7661 7469 6f6e 2066 756e 6374 696f  tivation functio
+00006bb0: 6e20 746f 2062 6520 7573 6564 2069 6e20  n to be used in 
+00006bc0: 7468 6520 6665 6564 2d66 6f72 7761 7264  the feed-forward
+00006bd0: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+00006be0: 2020 2020 4361 6e20 6368 6f6f 7365 2062      Can choose b
+00006bf0: 6574 7765 656e 2027 7265 6c75 2720 666f  etween 'relu' fo
+00006c00: 7220 5265 4c55 2c20 276c 6561 6b79 7265  r ReLU, 'leakyre
+00006c10: 6c75 2720 666f 7220 4c65 616b 7952 654c  lu' for LeakyReL
+00006c20: 552c 2027 7072 656c 7527 2066 6f72 2050  U, 'prelu' for P
+00006c30: 5265 4c55 2c0a 2020 2020 2020 2020 2020  ReLU,.          
+00006c40: 2020 2774 616e 6827 2066 6f72 2054 616e    'tanh' for Tan
+00006c50: 482c 2027 7365 6c75 2720 666f 7220 5345  H, 'selu' for SE
+00006c60: 4c55 2c20 2765 6c75 2720 666f 7220 454c  LU, 'elu' for EL
+00006c70: 5520 616e 6420 276c 696e 6561 7227 2066  U and 'linear' f
+00006c80: 6f72 206c 696e 6561 7220 6163 7469 7661  or linear activa
+00006c90: 7469 6f6e 2e0a 2020 2020 2020 2020 6e5f  tion..        n_
+00006ca0: 6c61 7965 7273 3a20 696e 740a 2020 2020  layers: int.    
+00006cb0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+00006cc0: 6620 6c61 7965 7273 2069 6e20 7468 6520  f layers in the 
+00006cd0: 6665 6564 2d66 6f72 7761 7264 206c 6179  feed-forward lay
+00006ce0: 6572 2e0a 2020 2020 2020 2020 6472 6f70  er..        drop
+00006cf0: 6f75 745f 703a 2066 6c6f 6174 0a20 2020  out_p: float.   
+00006d00: 2020 2020 2020 2020 2044 726f 706f 7574           Dropout
+00006d10: 2070 726f 6261 6269 6c69 7479 2069 6e20   probability in 
+00006d20: 7468 6520 6665 6565 642d 666f 7277 6172  the feeed-forwar
+00006d30: 6420 6c61 7965 722e 0a20 2020 2020 2020  d layer..       
+00006d40: 2065 6e63 6f64 6572 5f68 7369 7a65 3a20   encoder_hsize: 
+00006d50: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00006d60: 5369 7a65 206f 6620 4465 6e73 6520 6c61  Size of Dense la
+00006d70: 7965 7220 666f 7220 7468 6520 656e 636f  yer for the enco
+00006d80: 6465 7220 6974 7365 6c66 2e0a 2020 2020  der itself..    
+00006d90: 2020 2020 656e 636f 6465 725f 6472 6f70      encoder_drop
+00006da0: 6f75 745f 703a 2066 6c6f 6174 0a20 2020  out_p: float.   
+00006db0: 2020 2020 2020 2020 2044 726f 706f 7574           Dropout
+00006dc0: 2070 726f 6261 6269 6c69 7479 2066 6f72   probability for
+00006dd0: 2063 6f6e 6e65 6374 696f 6e73 2069 6e20   connections in 
+00006de0: 7468 6520 656e 636f 6465 7220 6c61 7965  the encoder laye
+00006df0: 722e 0a20 2020 2020 2020 2022 2222 0a20  r..        """. 
+00006e00: 2020 2020 2020 2073 7570 6572 284d 4154         super(MAT
+00006e10: 456e 636f 6465 724c 6179 6572 2c20 7365  EncoderLayer, se
+00006e20: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a20  lf).__init__(). 
+00006e30: 2020 2020 2020 2073 656c 662e 7365 6c66         self.self
+00006e40: 5f61 7474 6e20 3d20 4d75 6c74 6948 6561  _attn = MultiHea
+00006e50: 6465 644d 4154 4174 7465 6e74 696f 6e28  dedMATAttention(
+00006e60: 6469 7374 5f6b 6572 6e65 6c2c 206c 616d  dist_kernel, lam
+00006e70: 6264 615f 6174 7465 6e74 696f 6e2c 0a20  bda_attention,. 
 00006e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00006e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ea0: 2020 206c 616d 6264 615f 6469 7374 616e     lambda_distan
-00006eb0: 6365 2c20 682c 2073 615f 6873 697a 652c  ce, h, sa_hsize,
-00006ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006eb0: 6c61 6d62 6461 5f64 6973 7461 6e63 652c  lambda_distance,
+00006ec0: 2068 2c20 7361 5f68 7369 7a65 2c0a 2020   h, sa_hsize,.  
 00006ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00006ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ef0: 2020 7361 5f64 726f 706f 7574 5f70 2c20    sa_dropout_p, 
-00006f00: 6f75 7470 7574 5f62 6961 7329 0a20 2020  output_bias).   
-00006f10: 2020 2020 2073 656c 662e 6665 6564 5f66       self.feed_f
-00006f20: 6f72 7761 7264 203d 2050 6f73 6974 696f  orward = Positio
-00006f30: 6e77 6973 6546 6565 6446 6f72 7761 7264  nwiseFeedForward
-00006f40: 2864 5f69 6e70 7574 2c20 645f 6869 6464  (d_input, d_hidd
-00006f50: 656e 2c20 645f 6f75 7470 7574 2c0a 2020  en, d_output,.  
-00006f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ef0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00006f00: 615f 6472 6f70 6f75 745f 702c 206f 7574  a_dropout_p, out
+00006f10: 7075 745f 6269 6173 290a 2020 2020 2020  put_bias).      
+00006f20: 2020 7365 6c66 2e66 6565 645f 666f 7277    self.feed_forw
+00006f30: 6172 6420 3d20 506f 7369 7469 6f6e 7769  ard = Positionwi
+00006f40: 7365 4665 6564 466f 7277 6172 6428 645f  seFeedForward(d_
+00006f50: 696e 7075 742c 2064 5f68 6964 6465 6e2c  input, d_hidden,
+00006f60: 2064 5f6f 7574 7075 742c 0a20 2020 2020   d_output,.     
 00006f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f90: 2020 6163 7469 7661 7469 6f6e 2c20 6e5f    activation, n_
-00006fa0: 6c61 7965 7273 2c0a 2020 2020 2020 2020  layers,.        
-00006fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f90: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00006fa0: 6374 6976 6174 696f 6e2c 206e 5f6c 6179  ctivation, n_lay
+00006fb0: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
 00006fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fd0: 2020 2020 2020 2020 2020 2020 6666 5f64              ff_d
-00006fe0: 726f 706f 7574 5f70 290a 2020 2020 2020  ropout_p).      
-00006ff0: 2020 6c61 7965 7220 3d20 5375 626c 6179    layer = Sublay
-00007000: 6572 436f 6e6e 6563 7469 6f6e 2873 697a  erConnection(siz
-00007010: 653d 656e 636f 6465 725f 6873 697a 652c  e=encoder_hsize,
-00007020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fe0: 2020 2020 2020 2020 2066 665f 6472 6f70           ff_drop
+00006ff0: 6f75 745f 7029 0a20 2020 2020 2020 206c  out_p).        l
+00007000: 6179 6572 203d 2053 7562 6c61 7965 7243  ayer = SublayerC
+00007010: 6f6e 6e65 6374 696f 6e28 7369 7a65 3d65  onnection(size=e
+00007020: 6e63 6f64 6572 5f68 7369 7a65 2c0a 2020  ncoder_hsize,.  
 00007030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007040: 2020 2020 6472 6f70 6f75 745f 703d 656e      dropout_p=en
-00007050: 636f 6465 725f 6472 6f70 6f75 745f 7029  coder_dropout_p)
-00007060: 0a20 2020 2020 2020 2073 656c 662e 7375  .        self.su
-00007070: 626c 6179 6572 203d 206e 6e2e 4d6f 6475  blayer = nn.Modu
-00007080: 6c65 4c69 7374 285b 6c61 7965 7220 666f  leList([layer fo
-00007090: 7220 5f20 696e 2072 616e 6765 2832 295d  r _ in range(2)]
-000070a0: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
-000070b0: 697a 6520 3d20 656e 636f 6465 725f 6873  ize = encoder_hs
-000070c0: 697a 650a 0a20 2020 2064 6566 2066 6f72  ize..    def for
-000070d0: 7761 7264 2873 656c 662c 0a20 2020 2020  ward(self,.     
-000070e0: 2020 2020 2020 2020 2020 2078 3a20 746f             x: to
-000070f0: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
-00007100: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00007110: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
-00007120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007130: 6164 6a5f 6d61 7472 6978 3a20 746f 7263  adj_matrix: torc
-00007140: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
-00007150: 2020 2020 2020 2020 2020 6469 7374 616e            distan
-00007160: 6365 5f6d 6174 7269 783a 2074 6f72 6368  ce_matrix: torch
-00007170: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
-00007180: 2020 2020 2020 2020 2073 615f 6472 6f70           sa_drop
-00007190: 6f75 745f 703a 2066 6c6f 6174 203d 2030  out_p: float = 0
-000071a0: 2e30 2920 2d3e 2074 6f72 6368 2e54 656e  .0) -> torch.Ten
-000071b0: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
-000071c0: 4f75 7470 7574 2063 6f6d 7075 7461 7469  Output computati
-000071d0: 6f6e 2066 6f72 2074 6865 204d 4154 456e  on for the MATEn
-000071e0: 636f 6465 7220 6c61 7965 722e 0a0a 2020  coder layer...  
-000071f0: 2020 2020 2020 496e 2074 6865 204d 4154        In the MAT
-00007200: 456e 636f 6465 724c 6179 6572 2069 6e74  EncoderLayer int
-00007210: 6961 6c69 7a61 7469 6f6e 2c20 7365 6c66  ialization, self
-00007220: 2e73 7562 6c61 7965 7220 6973 2064 6566  .sublayer is def
-00007230: 696e 6564 2061 7320 616e 206e 6e2e 4d6f  ined as an nn.Mo
-00007240: 6475 6c65 4c69 7374 206f 6620 3220 6c61  duleList of 2 la
-00007250: 7965 7273 2e20 5765 2077 696c 6c20 6265  yers. We will be
-00007260: 2070 6173 7369 6e67 206f 7572 2063 6f6d   passing our com
-00007270: 7075 7461 7469 6f6e 2074 6872 6f75 6768  putation through
-00007280: 2074 6865 7365 206c 6179 6572 7320 7365   these layers se
-00007290: 7175 656e 7469 616c 6c79 2e0a 2020 2020  quentially..    
-000072a0: 2020 2020 6e6e 2e4d 6f64 756c 654c 6973      nn.ModuleLis
-000072b0: 7420 6973 2073 7562 7363 7269 7074 6162  t is subscriptab
-000072c0: 6c65 2061 6e64 2074 6875 7320 7765 2063  le and thus we c
-000072d0: 616e 2061 6363 6573 7320 6974 2061 7320  an access it as 
-000072e0: 7365 6c66 2e73 7562 6c61 7965 725b 305d  self.sublayer[0]
-000072f0: 2c20 666f 7220 6578 616d 706c 652e 0a0a  , for example...
-00007300: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00007310: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00007320: 2d2d 2d2d 2d0a 2020 2020 2020 2020 783a  -----.        x:
-00007330: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-00007340: 2020 2020 2020 2020 2020 496e 7075 7420            Input 
-00007350: 7465 6e73 6f72 2e0a 2020 2020 2020 2020  tensor..        
-00007360: 6d61 736b 3a20 746f 7263 682e 5465 6e73  mask: torch.Tens
-00007370: 6f72 0a20 2020 2020 2020 2020 2020 204d  or.            M
-00007380: 6173 6b73 206f 7574 2070 6164 6469 6e67  asks out padding
-00007390: 2076 616c 7565 7320 736f 2074 6861 7420   values so that 
-000073a0: 7468 6579 2061 7265 206e 6f74 2074 616b  they are not tak
-000073b0: 656e 2069 6e74 6f20 6163 636f 756e 7420  en into account 
-000073c0: 7768 656e 2063 6f6d 7075 7469 6e67 2074  when computing t
-000073d0: 6865 2061 7474 656e 7469 6f6e 2073 636f  he attention sco
-000073e0: 7265 2e0a 2020 2020 2020 2020 6164 6a5f  re..        adj_
-000073f0: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
-00007400: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-00007410: 2041 646a 6163 656e 6379 206d 6174 7269   Adjacency matri
-00007420: 7820 6f66 2061 206d 6f6c 6563 756c 652e  x of a molecule.
-00007430: 0a20 2020 2020 2020 2064 6973 7461 6e63  .        distanc
-00007440: 655f 6d61 7472 6978 3a20 746f 7263 682e  e_matrix: torch.
-00007450: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00007460: 2020 2044 6973 7461 6e63 6520 6d61 7472     Distance matr
-00007470: 6978 206f 6620 6120 6d6f 6c65 6375 6c65  ix of a molecule
-00007480: 2e0a 2020 2020 2020 2020 7361 5f64 726f  ..        sa_dro
-00007490: 706f 7574 5f70 3a20 666c 6f61 740a 2020  pout_p: float.  
-000074a0: 2020 2020 2020 2020 2020 4472 6f70 6f75            Dropou
-000074b0: 7420 7072 6f62 6162 696c 6974 7920 666f  t probability fo
-000074c0: 7220 7468 6520 7365 6c66 2d61 7474 656e  r the self-atten
-000074d0: 7469 6f6e 206c 6179 6572 2028 4d75 6c74  tion layer (Mult
-000074e0: 6948 6561 6465 644d 4154 4174 7465 6e74  iHeadedMATAttent
-000074f0: 696f 6e29 2e0a 2020 2020 2020 2020 2222  ion)..        ""
-00007500: 220a 2020 2020 2020 2020 7820 3d20 7365  ".        x = se
-00007510: 6c66 2e73 7562 6c61 7965 725b 305d 2878  lf.sublayer[0](x
-00007520: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007530: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00007540: 656c 662e 7365 6c66 5f61 7474 6e28 782c  elf.self_attn(x,
-00007550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007050: 2064 726f 706f 7574 5f70 3d65 6e63 6f64   dropout_p=encod
+00007060: 6572 5f64 726f 706f 7574 5f70 290a 2020  er_dropout_p).  
+00007070: 2020 2020 2020 7365 6c66 2e73 7562 6c61        self.subla
+00007080: 7965 7220 3d20 6e6e 2e4d 6f64 756c 654c  yer = nn.ModuleL
+00007090: 6973 7428 5b6c 6179 6572 2066 6f72 205f  ist([layer for _
+000070a0: 2069 6e20 7261 6e67 6528 3229 5d29 0a20   in range(2)]). 
+000070b0: 2020 2020 2020 2073 656c 662e 7369 7a65         self.size
+000070c0: 203d 2065 6e63 6f64 6572 5f68 7369 7a65   = encoder_hsize
+000070d0: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
+000070e0: 6428 7365 6c66 2c0a 2020 2020 2020 2020  d(self,.        
+000070f0: 2020 2020 2020 2020 783a 2074 6f72 6368          x: torch
+00007100: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
+00007110: 2020 2020 2020 2020 206d 6173 6b3a 2074           mask: t
+00007120: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
+00007130: 2020 2020 2020 2020 2020 2020 2061 646a               adj
+00007140: 5f6d 6174 7269 783a 2074 6f72 6368 2e54  _matrix: torch.T
+00007150: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
+00007160: 2020 2020 2020 2064 6973 7461 6e63 655f         distance_
+00007170: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
+00007180: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
+00007190: 2020 2020 2020 7361 5f64 726f 706f 7574        sa_dropout
+000071a0: 5f70 3a20 666c 6f61 7420 3d20 302e 3029  _p: float = 0.0)
+000071b0: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
+000071c0: 3a0a 2020 2020 2020 2020 2222 224f 7574  :.        """Out
+000071d0: 7075 7420 636f 6d70 7574 6174 696f 6e20  put computation 
+000071e0: 666f 7220 7468 6520 4d41 5445 6e63 6f64  for the MATEncod
+000071f0: 6572 206c 6179 6572 2e0a 0a20 2020 2020  er layer...     
+00007200: 2020 2049 6e20 7468 6520 4d41 5445 6e63     In the MATEnc
+00007210: 6f64 6572 4c61 7965 7220 696e 7469 616c  oderLayer intial
+00007220: 697a 6174 696f 6e2c 2073 656c 662e 7375  ization, self.su
+00007230: 626c 6179 6572 2069 7320 6465 6669 6e65  blayer is define
+00007240: 6420 6173 2061 6e20 6e6e 2e4d 6f64 756c  d as an nn.Modul
+00007250: 654c 6973 7420 6f66 2032 206c 6179 6572  eList of 2 layer
+00007260: 732e 2057 6520 7769 6c6c 2062 6520 7061  s. We will be pa
+00007270: 7373 696e 6720 6f75 7220 636f 6d70 7574  ssing our comput
+00007280: 6174 696f 6e20 7468 726f 7567 6820 7468  ation through th
+00007290: 6573 6520 6c61 7965 7273 2073 6571 7565  ese layers seque
+000072a0: 6e74 6961 6c6c 792e 0a20 2020 2020 2020  ntially..       
+000072b0: 206e 6e2e 4d6f 6475 6c65 4c69 7374 2069   nn.ModuleList i
+000072c0: 7320 7375 6273 6372 6970 7461 626c 6520  s subscriptable 
+000072d0: 616e 6420 7468 7573 2077 6520 6361 6e20  and thus we can 
+000072e0: 6163 6365 7373 2069 7420 6173 2073 656c  access it as sel
+000072f0: 662e 7375 626c 6179 6572 5b30 5d2c 2066  f.sublayer[0], f
+00007300: 6f72 2065 7861 6d70 6c65 2e0a 0a20 2020  or example...   
+00007310: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00007320: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00007330: 2d2d 0a20 2020 2020 2020 2078 3a20 746f  --.        x: to
+00007340: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+00007350: 2020 2020 2020 2049 6e70 7574 2074 656e         Input ten
+00007360: 736f 722e 0a20 2020 2020 2020 206d 6173  sor..        mas
+00007370: 6b3a 2074 6f72 6368 2e54 656e 736f 720a  k: torch.Tensor.
+00007380: 2020 2020 2020 2020 2020 2020 4d61 736b              Mask
+00007390: 7320 6f75 7420 7061 6464 696e 6720 7661  s out padding va
+000073a0: 6c75 6573 2073 6f20 7468 6174 2074 6865  lues so that the
+000073b0: 7920 6172 6520 6e6f 7420 7461 6b65 6e20  y are not taken 
+000073c0: 696e 746f 2061 6363 6f75 6e74 2077 6865  into account whe
+000073d0: 6e20 636f 6d70 7574 696e 6720 7468 6520  n computing the 
+000073e0: 6174 7465 6e74 696f 6e20 7363 6f72 652e  attention score.
+000073f0: 0a20 2020 2020 2020 2061 646a 5f6d 6174  .        adj_mat
+00007400: 7269 783a 2074 6f72 6368 2e54 656e 736f  rix: torch.Tenso
+00007410: 720a 2020 2020 2020 2020 2020 2020 4164  r.            Ad
+00007420: 6a61 6365 6e63 7920 6d61 7472 6978 206f  jacency matrix o
+00007430: 6620 6120 6d6f 6c65 6375 6c65 2e0a 2020  f a molecule..  
+00007440: 2020 2020 2020 6469 7374 616e 6365 5f6d        distance_m
+00007450: 6174 7269 783a 2074 6f72 6368 2e54 656e  atrix: torch.Ten
+00007460: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00007470: 4469 7374 616e 6365 206d 6174 7269 7820  Distance matrix 
+00007480: 6f66 2061 206d 6f6c 6563 756c 652e 0a20  of a molecule.. 
+00007490: 2020 2020 2020 2073 615f 6472 6f70 6f75         sa_dropou
+000074a0: 745f 703a 2066 6c6f 6174 0a20 2020 2020  t_p: float.     
+000074b0: 2020 2020 2020 2044 726f 706f 7574 2070         Dropout p
+000074c0: 726f 6261 6269 6c69 7479 2066 6f72 2074  robability for t
+000074d0: 6865 2073 656c 662d 6174 7465 6e74 696f  he self-attentio
+000074e0: 6e20 6c61 7965 7220 284d 756c 7469 4865  n layer (MultiHe
+000074f0: 6164 6564 4d41 5441 7474 656e 7469 6f6e  adedMATAttention
+00007500: 292e 0a20 2020 2020 2020 2022 2222 0a20  )..        """. 
+00007510: 2020 2020 2020 2078 203d 2073 656c 662e         x = self.
+00007520: 7375 626c 6179 6572 5b30 5d28 782c 0a20  sublayer[0](x,. 
+00007530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007540: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007550: 2e73 656c 665f 6174 746e 2878 2c0a 2020  .self_attn(x,.  
 00007560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007570: 2020 2020 2020 2020 2020 2020 2078 2c0a               x,.
-00007580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007580: 2020 2020 2020 2020 2020 782c 0a20 2020            x,.   
 00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075a0: 2020 2020 2020 2020 2020 2020 782c 0a20              x,. 
-000075b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075b0: 2020 2020 2020 2020 2078 2c0a 2020 2020           x,.    
 000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075d0: 2020 2020 2020 2020 2020 206d 6173 6b3d             mask=
-000075e0: 6d61 736b 2c0a 2020 2020 2020 2020 2020  mask,.          
-000075f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075e0: 2020 2020 2020 2020 6d61 736b 3d6d 6173          mask=mas
+000075f0: 6b2c 0a20 2020 2020 2020 2020 2020 2020  k,.             
 00007600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007610: 2020 6472 6f70 6f75 745f 703d 7361 5f64    dropout_p=sa_d
-00007620: 726f 706f 7574 5f70 2c0a 2020 2020 2020  ropout_p,.      
-00007630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007610: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00007620: 726f 706f 7574 5f70 3d73 615f 6472 6f70  ropout_p=sa_drop
+00007630: 6f75 745f 702c 0a20 2020 2020 2020 2020  out_p,.         
 00007640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007650: 2020 2020 2020 6164 6a5f 6d61 7472 6978        adj_matrix
-00007660: 3d61 646a 5f6d 6174 7269 782c 0a20 2020  =adj_matrix,.   
-00007670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007660: 2020 2061 646a 5f6d 6174 7269 783d 6164     adj_matrix=ad
+00007670: 6a5f 6d61 7472 6978 2c0a 2020 2020 2020  j_matrix,.      
 00007680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007690: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
-000076a0: 655f 6d61 7472 6978 3d64 6973 7461 6e63  e_matrix=distanc
-000076b0: 655f 6d61 7472 6978 2929 0a20 2020 2020  e_matrix)).     
-000076c0: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
-000076d0: 7562 6c61 7965 725b 315d 2878 2c20 7365  ublayer[1](x, se
-000076e0: 6c66 2e66 6565 645f 666f 7277 6172 6428  lf.feed_forward(
-000076f0: 7829 290a 0a0a 636c 6173 7320 5375 626c  x))...class Subl
-00007700: 6179 6572 436f 6e6e 6563 7469 6f6e 286e  ayerConnection(n
-00007710: 6e2e 4d6f 6475 6c65 293a 0a20 2020 2022  n.Module):.    "
-00007720: 2222 5375 626c 6179 6572 436f 6e6e 6563  ""SublayerConnec
-00007730: 7469 6f6e 206c 6179 6572 2062 6173 6564  tion layer based
-00007740: 206f 6e20 7468 6520 7061 7065 7220 6041   on the paper `A
-00007750: 7474 656e 7469 6f6e 2049 7320 416c 6c20  ttention Is All 
-00007760: 596f 7520 4e65 6564 203c 6874 7470 733a  You Need <https:
-00007770: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
-00007780: 3137 3036 2e30 3337 3632 3e60 5f2e 0a0a  1706.03762>`_...
-00007790: 2020 2020 5468 6520 5375 626c 6179 6572      The Sublayer
-000077a0: 436f 6e6e 6563 7469 6f6e 206e 6f72 6d61  Connection norma
-000077b0: 6c69 7a65 7320 616e 6420 6164 6473 2064  lizes and adds d
-000077c0: 726f 706f 7574 2074 6f20 6f75 7470 7574  ropout to output
-000077d0: 2074 656e 736f 7220 6f66 2061 6e20 6172   tensor of an ar
-000077e0: 6269 7461 7279 206c 6179 6572 2e0a 2020  bitary layer..  
-000077f0: 2020 4974 2066 7572 7468 6572 2061 6464    It further add
-00007800: 7320 6120 7265 7369 6475 616c 206c 6179  s a residual lay
-00007810: 6572 2063 6f6e 6e65 6374 696f 6e20 6265  er connection be
-00007820: 7477 6565 6e20 7468 6520 696e 7075 7420  tween the input 
-00007830: 6f66 2074 6865 2061 7262 6974 6172 7920  of the arbitary 
-00007840: 6c61 7965 7220 616e 6420 7468 6520 6472  layer and the dr
-00007850: 6f70 6f75 742d 6164 6a75 7374 6564 206c  opout-adjusted l
-00007860: 6179 6572 206f 7574 7075 742e 0a0a 2020  ayer output...  
-00007870: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
-00007880: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
-00007890: 6672 6f6d 2064 6565 7063 6865 6d2e 6d6f  from deepchem.mo
-000078a0: 6465 6c73 2e74 6f72 6368 5f6d 6f64 656c  dels.torch_model
-000078b0: 732e 6c61 7965 7273 2069 6d70 6f72 7420  s.layers import 
-000078c0: 5375 626c 6179 6572 436f 6e6e 6563 7469  SublayerConnecti
-000078d0: 6f6e 0a20 2020 203e 3e3e 2073 6361 6c65  on.    >>> scale
-000078e0: 203d 2030 2e33 350a 2020 2020 3e3e 3e20   = 0.35.    >>> 
-000078f0: 6c61 7965 7220 3d20 5375 626c 6179 6572  layer = Sublayer
-00007900: 436f 6e6e 6563 7469 6f6e 2832 2c20 302e  Connection(2, 0.
-00007910: 290a 2020 2020 3e3e 3e20 696e 7075 745f  ).    >>> input_
-00007920: 6172 203d 2074 6f72 6368 2e74 656e 736f  ar = torch.tenso
-00007930: 7228 5b5b 312e 2c20 322e 5d2c 205b 352e  r([[1., 2.], [5.
-00007940: 2c20 362e 5d5d 290a 2020 2020 3e3e 3e20  , 6.]]).    >>> 
-00007950: 6f75 7470 7574 203d 206c 6179 6572 2869  output = layer(i
-00007960: 6e70 7574 5f61 722c 2069 6e70 7574 5f61  nput_ar, input_a
-00007970: 7229 0a20 2022 2222 0a0a 2020 2020 6465  r).  """..    de
-00007980: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00007990: 2073 697a 653a 2069 6e74 2c20 6472 6f70   size: int, drop
-000079a0: 6f75 745f 703a 2066 6c6f 6174 203d 2030  out_p: float = 0
-000079b0: 2e30 293a 0a20 2020 2020 2020 2022 2222  .0):.        """
-000079c0: 496e 6974 6961 6c69 7a65 2061 2053 7562  Initialize a Sub
-000079d0: 6c61 7965 7243 6f6e 6e65 6374 696f 6e20  layerConnection 
-000079e0: 4c61 7965 722e 0a0a 2020 2020 2020 2020  Layer...        
-000079f0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00007a00: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00007a10: 2020 2020 2020 7369 7a65 3a20 696e 740a        size: int.
-00007a20: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
-00007a30: 206f 6620 6c61 7965 722e 0a20 2020 2020   of layer..     
-00007a40: 2020 2064 726f 706f 7574 5f70 3a20 666c     dropout_p: fl
-00007a50: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
-00007a60: 4472 6f70 6f75 7420 7072 6f62 6162 696c  Dropout probabil
-00007a70: 6974 792e 0a20 2020 2020 2020 2022 2222  ity..        """
-00007a80: 0a20 2020 2020 2020 2073 7570 6572 2853  .        super(S
-00007a90: 7562 6c61 7965 7243 6f6e 6e65 6374 696f  ublayerConnectio
-00007aa0: 6e2c 2073 656c 6629 2e5f 5f69 6e69 745f  n, self).__init_
-00007ab0: 5f28 290a 2020 2020 2020 2020 7365 6c66  _().        self
-00007ac0: 2e6e 6f72 6d20 3d20 6e6e 2e4c 6179 6572  .norm = nn.Layer
-00007ad0: 4e6f 726d 2873 697a 6529 0a20 2020 2020  Norm(size).     
-00007ae0: 2020 2073 656c 662e 6472 6f70 6f75 745f     self.dropout_
-00007af0: 7020 3d20 6e6e 2e44 726f 706f 7574 2864  p = nn.Dropout(d
-00007b00: 726f 706f 7574 5f70 290a 0a20 2020 2064  ropout_p)..    d
-00007b10: 6566 2066 6f72 7761 7264 2873 656c 662c  ef forward(self,
-00007b20: 2078 3a20 746f 7263 682e 5465 6e73 6f72   x: torch.Tensor
-00007b30: 2c20 6f75 7470 7574 3a20 746f 7263 682e  , output: torch.
-00007b40: 5465 6e73 6f72 2920 2d3e 2074 6f72 6368  Tensor) -> torch
-00007b50: 2e54 656e 736f 723a 0a20 2020 2020 2020  .Tensor:.       
-00007b60: 2022 2222 4f75 7470 7574 2063 6f6d 7075   """Output compu
-00007b70: 7461 7469 6f6e 2066 6f72 2074 6865 2053  tation for the S
-00007b80: 7562 6c61 7965 7243 6f6e 6e65 6374 696f  ublayerConnectio
-00007b90: 6e20 6c61 7965 722e 0a0a 2020 2020 2020  n layer...      
-00007ba0: 2020 5461 6b65 7320 616e 2069 6e70 7574    Takes an input
-00007bb0: 2074 656e 736f 7220 782c 2074 6865 6e20   tensor x, then 
-00007bc0: 6164 6473 2074 6865 2064 726f 706f 7574  adds the dropout
-00007bd0: 2d61 646a 7573 7465 6420 7375 626c 6179  -adjusted sublay
-00007be0: 6572 206f 7574 7075 7420 666f 7220 6e6f  er output for no
-00007bf0: 726d 616c 697a 6564 2078 2074 6f20 6974  rmalized x to it
-00007c00: 2e0a 2020 2020 2020 2020 5468 6973 2069  ..        This i
-00007c10: 7320 646f 6e65 2074 6f20 6164 6420 6120  s done to add a 
-00007c20: 7265 7369 6475 616c 2063 6f6e 6e65 6374  residual connect
-00007c30: 696f 6e20 666f 6c6c 6f77 6564 2062 7920  ion followed by 
-00007c40: 4c61 7965 724e 6f72 6d2e 0a0a 2020 2020  LayerNorm...    
-00007c50: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00007c60: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00007c70: 2d0a 2020 2020 2020 2020 783a 2074 6f72  -.        x: tor
-00007c80: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00007c90: 2020 2020 2020 496e 7075 7420 7465 6e73        Input tens
-00007ca0: 6f72 2e0a 2020 2020 2020 2020 6f75 7470  or..        outp
-00007cb0: 7574 3a20 746f 7263 682e 5465 6e73 6f72  ut: torch.Tensor
-00007cc0: 0a20 2020 2020 2020 2020 2020 204c 6179  .            Lay
-00007cd0: 6572 2077 686f 7365 206e 6f72 6d61 6c69  er whose normali
-00007ce0: 7a65 6420 6f75 7470 7574 2077 696c 6c20  zed output will 
-00007cf0: 6265 2061 6464 6564 2074 6f20 782e 0a20  be added to x.. 
-00007d00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00007d10: 2020 2069 6620 7820 6973 204e 6f6e 653a     if x is None:
-00007d20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00007d30: 7572 6e20 7365 6c66 2e64 726f 706f 7574  urn self.dropout
-00007d40: 5f70 2873 656c 662e 6e6f 726d 286f 7574  _p(self.norm(out
-00007d50: 7075 7429 290a 2020 2020 2020 2020 7265  put)).        re
-00007d60: 7475 726e 2078 202b 2073 656c 662e 6472  turn x + self.dr
-00007d70: 6f70 6f75 745f 7028 7365 6c66 2e6e 6f72  opout_p(self.nor
-00007d80: 6d28 6f75 7470 7574 2929 0a0a 0a63 6c61  m(output))...cla
-00007d90: 7373 2050 6f73 6974 696f 6e77 6973 6546  ss PositionwiseF
-00007da0: 6565 6446 6f72 7761 7264 286e 6e2e 4d6f  eedForward(nn.Mo
-00007db0: 6475 6c65 293a 0a20 2020 2022 2222 506f  dule):.    """Po
-00007dc0: 7369 7469 6f6e 7769 7365 4665 6564 466f  sitionwiseFeedFo
-00007dd0: 7277 6172 6420 6973 2061 206c 6179 6572  rward is a layer
-00007de0: 2075 7365 6420 746f 2064 6566 696e 6520   used to define 
-00007df0: 7468 6520 706f 7369 7469 6f6e 2d77 6973  the position-wis
-00007e00: 6520 6665 6564 2d66 6f72 7761 7264 2028  e feed-forward (
-00007e10: 4646 4e29 2061 6c67 6f72 6974 686d 2066  FFN) algorithm f
-00007e20: 6f72 2074 6865 204d 6f6c 6563 756c 6172  or the Molecular
-00007e30: 2041 7474 656e 7469 6f6e 2054 7261 6e73   Attention Trans
-00007e40: 666f 726d 6572 205b 315d 5f0a 0a20 2020  former [1]_..   
-00007e50: 2045 6163 6820 6c61 7965 7220 696e 2074   Each layer in t
-00007e60: 6865 204d 4154 2065 6e63 6f64 6572 2063  he MAT encoder c
-00007e70: 6f6e 7461 696e 7320 6120 6675 6c6c 7920  ontains a fully 
-00007e80: 636f 6e6e 6563 7465 6420 6665 6564 2d66  connected feed-f
-00007e90: 6f72 7761 7264 206e 6574 776f 726b 2077  orward network w
-00007ea0: 6869 6368 2061 7070 6c69 6573 2074 776f  hich applies two
-00007eb0: 206c 696e 6561 7220 7472 616e 7366 6f72   linear transfor
-00007ec0: 6d61 7469 6f6e 7320 616e 6420 7468 6520  mations and the 
-00007ed0: 6769 7665 6e20 6163 7469 7661 7469 6f6e  given activation
-00007ee0: 2066 756e 6374 696f 6e2e 0a20 2020 2054   function..    T
-00007ef0: 6869 7320 6973 2064 6f6e 6520 696e 2061  his is done in a
-00007f00: 6464 6974 696f 6e20 746f 2074 6865 2053  ddition to the S
-00007f10: 7562 6c61 7965 7243 6f6e 6e65 6374 696f  ublayerConnectio
-00007f20: 6e20 6d6f 6475 6c65 2e0a 0a20 2020 204e  n module...    N
-00007f30: 6f74 653a 2054 6869 7320 6d6f 6469 6669  ote: This modifi
-00007f40: 6564 2076 6572 7369 6f6e 206f 6620 6050  ed version of `P
-00007f50: 6f73 6974 696f 6e77 6973 6546 6565 6446  ositionwiseFeedF
-00007f60: 6f72 7761 7264 6020 636c 6173 7320 636f  orward` class co
-00007f70: 6e74 6169 6e73 2060 6472 6f70 6f75 745f  ntains `dropout_
-00007f80: 6174 5f69 6e70 7574 5f6e 6f5f 6163 7460  at_input_no_act`
-00007f90: 2063 6f6e 6469 7469 6f6e 2074 6f20 6661   condition to fa
-00007fa0: 6369 6c69 7461 7465 2069 7473 2075 7365  cilitate its use
-00007fb0: 2069 6e20 6465 6669 6e69 6e67 0a20 2020   in defining.   
-00007fc0: 2020 2020 2074 6865 2066 6565 642d 666f       the feed-fo
-00007fd0: 7277 6172 6420 2846 464e 2920 616c 676f  rward (FFN) algo
-00007fe0: 7269 7468 6d20 666f 7220 7468 6520 4469  rithm for the Di
-00007ff0: 7265 6374 6564 204d 6573 7361 6765 2050  rected Message P
-00008000: 6173 7369 6e67 204e 6575 7261 6c20 4e65  assing Neural Ne
-00008010: 7477 6f72 6b20 2844 2d4d 504e 4e29 205b  twork (D-MPNN) [
-00008020: 325d 5f0a 0a20 2020 2052 6566 6572 656e  2]_..    Referen
-00008030: 6365 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ces.    --------
-00008040: 2d2d 0a20 2020 202e 2e20 5b31 5d20 4c75  --.    .. [1] Lu
-00008050: 6b61 737a 204d 617a 6961 726b 6120 6574  kasz Maziarka et
-00008060: 2061 6c2e 2022 4d6f 6c65 6375 6c65 2041   al. "Molecule A
-00008070: 7474 656e 7469 6f6e 2054 7261 6e73 666f  ttention Transfo
-00008080: 726d 6572 2220 4772 6170 6820 5265 7072  rmer" Graph Repr
-00008090: 6573 656e 7461 7469 6f6e 204c 6561 726e  esentation Learn
-000080a0: 696e 6720 776f 726b 7368 6f70 2061 6e64  ing workshop and
-000080b0: 204d 6163 6869 6e65 204c 6561 726e 696e   Machine Learnin
-000080c0: 6720 616e 6420 7468 6520 5068 7973 6963  g and the Physic
-000080d0: 616c 2053 6369 656e 6365 7320 776f 726b  al Sciences work
-000080e0: 7368 6f70 2061 7420 4e65 7572 4950 5320  shop at NeurIPS 
-000080f0: 3230 3139 2e20 3230 3230 2e20 6874 7470  2019. 2020. http
-00008100: 733a 2f2f 6172 7869 762e 6f72 672f 6162  s://arxiv.org/ab
-00008110: 732f 3230 3032 2e30 3832 3634 0a20 2020  s/2002.08264.   
-00008120: 202e 2e20 5b32 5d20 416e 616c 797a 696e   .. [2] Analyzin
-00008130: 6720 4c65 6172 6e65 6420 4d6f 6c65 6375  g Learned Molecu
-00008140: 6c61 7220 5265 7072 6573 656e 7461 7469  lar Representati
-00008150: 6f6e 7320 666f 7220 5072 6f70 6572 7479  ons for Property
-00008160: 2050 7265 6469 6374 696f 6e20 6874 7470   Prediction http
-00008170: 733a 2f2f 6172 7869 762e 6f72 672f 7064  s://arxiv.org/pd
-00008180: 662f 3139 3034 2e30 3135 3631 2e70 6466  f/1904.01561.pdf
-00008190: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
-000081a0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-000081b0: 3e3e 3e20 6672 6f6d 2064 6565 7063 6865  >>> from deepche
-000081c0: 6d2e 6d6f 6465 6c73 2e74 6f72 6368 5f6d  m.models.torch_m
-000081d0: 6f64 656c 732e 6c61 7965 7273 2069 6d70  odels.layers imp
-000081e0: 6f72 7420 506f 7369 7469 6f6e 7769 7365  ort Positionwise
-000081f0: 4665 6564 466f 7277 6172 640a 2020 2020  FeedForward.    
-00008200: 3e3e 3e20 6665 6564 5f66 7764 5f6c 6179  >>> feed_fwd_lay
-00008210: 6572 203d 2050 6f73 6974 696f 6e77 6973  er = Positionwis
-00008220: 6546 6565 6446 6f72 7761 7264 2864 5f69  eFeedForward(d_i
-00008230: 6e70 7574 203d 2032 2c20 645f 6869 6464  nput = 2, d_hidd
-00008240: 656e 203d 2032 2c20 645f 6f75 7470 7574  en = 2, d_output
-00008250: 203d 2032 2c20 6163 7469 7661 7469 6f6e   = 2, activation
-00008260: 203d 2027 7265 6c75 272c 206e 5f6c 6179   = 'relu', n_lay
-00008270: 6572 7320 3d20 312c 2064 726f 706f 7574  ers = 1, dropout
-00008280: 5f70 203d 2030 2e31 290a 2020 2020 3e3e  _p = 0.1).    >>
-00008290: 3e20 696e 7075 745f 7465 6e73 6f72 203d  > input_tensor =
-000082a0: 2074 6f72 6368 2e74 656e 736f 7228 5b5b   torch.tensor([[
-000082b0: 312e 2c20 322e 5d2c 205b 352e 2c20 362e  1., 2.], [5., 6.
-000082c0: 5d5d 290a 2020 2020 3e3e 3e20 6f75 7470  ]]).    >>> outp
-000082d0: 7574 5f74 656e 736f 7220 3d20 6665 6564  ut_tensor = feed
-000082e0: 5f66 7764 5f6c 6179 6572 2869 6e70 7574  _fwd_layer(input
-000082f0: 5f74 656e 736f 7229 0a20 2022 2222 0a0a  _tensor).  """..
-00008300: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00008310: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
-00008320: 2020 2020 2020 2020 645f 696e 7075 743a          d_input:
-00008330: 2069 6e74 203d 2031 3032 342c 0a20 2020   int = 1024,.   
-00008340: 2020 2020 2020 2020 2020 2020 2020 645f                d_
-00008350: 6869 6464 656e 3a20 696e 7420 3d20 3130  hidden: int = 10
-00008360: 3234 2c0a 2020 2020 2020 2020 2020 2020  24,.            
-00008370: 2020 2020 2064 5f6f 7574 7075 743a 2069       d_output: i
-00008380: 6e74 203d 2031 3032 342c 0a20 2020 2020  nt = 1024,.     
-00008390: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-000083a0: 7661 7469 6f6e 3a20 7374 7220 3d20 276c  vation: str = 'l
-000083b0: 6561 6b79 7265 6c75 272c 0a20 2020 2020  eakyrelu',.     
-000083c0: 2020 2020 2020 2020 2020 2020 6e5f 6c61              n_la
-000083d0: 7965 7273 3a20 696e 7420 3d20 312c 0a20  yers: int = 1,. 
-000083e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000083f0: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
-00008400: 203d 2030 2e30 2c0a 2020 2020 2020 2020   = 0.0,.        
-00008410: 2020 2020 2020 2020 2064 726f 706f 7574           dropout
-00008420: 5f61 745f 696e 7075 745f 6e6f 5f61 6374  _at_input_no_act
-00008430: 3a20 626f 6f6c 203d 2046 616c 7365 293a  : bool = False):
-00008440: 0a20 2020 2020 2020 2022 2222 496e 6974  .        """Init
-00008450: 6961 6c69 7a65 2061 2050 6f73 6974 696f  ialize a Positio
-00008460: 6e77 6973 6546 6565 6446 6f72 7761 7264  nwiseFeedForward
-00008470: 206c 6179 6572 2e0a 0a20 2020 2020 2020   layer...       
-00008480: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00008490: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000084a0: 2020 2020 2020 2064 5f69 6e70 7574 3a20         d_input: 
-000084b0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-000084c0: 5369 7a65 206f 6620 696e 7075 7420 6c61  Size of input la
-000084d0: 7965 722e 0a20 2020 2020 2020 2064 5f68  yer..        d_h
-000084e0: 6964 6465 6e3a 2069 6e74 2028 7361 6d65  idden: int (same
-000084f0: 2061 7320 645f 696e 7075 7420 6966 2064   as d_input if d
-00008500: 5f6f 7574 7075 7420 3d20 3029 0a20 2020  _output = 0).   
-00008510: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
-00008520: 2068 6964 6465 6e20 6c61 7965 722e 0a20   hidden layer.. 
-00008530: 2020 2020 2020 2064 5f6f 7574 7075 743a         d_output:
-00008540: 2069 6e74 2028 7361 6d65 2061 7320 645f   int (same as d_
-00008550: 696e 7075 7420 6966 2064 5f6f 7574 7075  input if d_outpu
-00008560: 7420 3d20 3029 0a20 2020 2020 2020 2020  t = 0).         
-00008570: 2020 2053 697a 6520 6f66 206f 7574 7075     Size of outpu
-00008580: 7420 6c61 7965 722e 0a20 2020 2020 2020  t layer..       
-00008590: 2061 6374 6976 6174 696f 6e3a 2073 7472   activation: str
-000085a0: 0a20 2020 2020 2020 2020 2020 2041 6374  .            Act
-000085b0: 6976 6174 696f 6e20 6675 6e63 7469 6f6e  ivation function
-000085c0: 2074 6f20 6265 2075 7365 642e 2043 616e   to be used. Can
-000085d0: 2063 686f 6f73 6520 6265 7477 6565 6e20   choose between 
-000085e0: 2772 656c 7527 2066 6f72 2052 654c 552c  'relu' for ReLU,
-000085f0: 2027 6c65 616b 7972 656c 7527 2066 6f72   'leakyrelu' for
-00008600: 204c 6561 6b79 5265 4c55 2c20 2770 7265   LeakyReLU, 'pre
-00008610: 6c75 2720 666f 7220 5052 654c 552c 0a20  lu' for PReLU,. 
-00008620: 2020 2020 2020 2020 2020 2027 7461 6e68             'tanh
-00008630: 2720 666f 7220 5461 6e48 2c20 2773 656c  ' for TanH, 'sel
-00008640: 7527 2066 6f72 2053 454c 552c 2027 656c  u' for SELU, 'el
-00008650: 7527 2066 6f72 2045 4c55 2061 6e64 2027  u' for ELU and '
-00008660: 6c69 6e65 6172 2720 666f 7220 6c69 6e65  linear' for line
-00008670: 6172 2061 6374 6976 6174 696f 6e2e 0a20  ar activation.. 
-00008680: 2020 2020 2020 206e 5f6c 6179 6572 733a         n_layers:
-00008690: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-000086a0: 204e 756d 6265 7220 6f66 206c 6179 6572   Number of layer
-000086b0: 732e 0a20 2020 2020 2020 2064 726f 706f  s..        dropo
-000086c0: 7574 5f70 3a20 666c 6f61 740a 2020 2020  ut_p: float.    
-000086d0: 2020 2020 2020 2020 4472 6f70 6f75 7420          Dropout 
-000086e0: 7072 6f62 6162 696c 6974 792e 0a20 2020  probability..   
-000086f0: 2020 2020 2064 726f 706f 7574 5f61 745f       dropout_at_
-00008700: 696e 7075 745f 6e6f 5f61 6374 3a20 626f  input_no_act: bo
-00008710: 6f6c 0a20 2020 2020 2020 2020 2020 2049  ol.            I
-00008720: 6620 7472 7565 2c20 6472 6f70 6f75 7420  f true, dropout 
-00008730: 6973 2061 7070 6c69 6564 206f 6e20 7468  is applied on th
-00008740: 6520 696e 7075 7420 7465 6e73 6f72 2e20  e input tensor. 
-00008750: 466f 7220 7369 6e67 6c65 206c 6179 6572  For single layer
-00008760: 2c20 6974 2069 7320 6e6f 7420 7061 7373  , it is not pass
-00008770: 6564 2074 6f20 616e 2061 6374 6976 6174  ed to an activat
-00008780: 696f 6e20 6675 6e63 7469 6f6e 2e0a 2020  ion function..  
-00008790: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000087a0: 2020 7375 7065 7228 506f 7369 7469 6f6e    super(Position
-000087b0: 7769 7365 4665 6564 466f 7277 6172 642c  wiseFeedForward,
-000087c0: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-000087d0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000087e0: 6472 6f70 6f75 745f 6174 5f69 6e70 7574  dropout_at_input
-000087f0: 5f6e 6f5f 6163 743a 2062 6f6f 6c20 3d20  _no_act: bool = 
-00008800: 6472 6f70 6f75 745f 6174 5f69 6e70 7574  dropout_at_input
-00008810: 5f6e 6f5f 6163 740a 0a20 2020 2020 2020  _no_act..       
-00008820: 2069 6620 6163 7469 7661 7469 6f6e 203d   if activation =
-00008830: 3d20 2772 656c 7527 3a0a 2020 2020 2020  = 'relu':.      
-00008840: 2020 2020 2020 7365 6c66 2e61 6374 6976        self.activ
-00008850: 6174 696f 6e3a 2041 6e79 203d 206e 6e2e  ation: Any = nn.
-00008860: 5265 4c55 2829 0a0a 2020 2020 2020 2020  ReLU()..        
-00008870: 656c 6966 2061 6374 6976 6174 696f 6e20  elif activation 
-00008880: 3d3d 2027 6c65 616b 7972 656c 7527 3a0a  == 'leakyrelu':.
-00008890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000088a0: 2e61 6374 6976 6174 696f 6e20 3d20 6e6e  .activation = nn
-000088b0: 2e4c 6561 6b79 5265 4c55 2830 2e31 290a  .LeakyReLU(0.1).
-000088c0: 0a20 2020 2020 2020 2065 6c69 6620 6163  .        elif ac
-000088d0: 7469 7661 7469 6f6e 203d 3d20 2770 7265  tivation == 'pre
-000088e0: 6c75 273a 0a20 2020 2020 2020 2020 2020  lu':.           
-000088f0: 2073 656c 662e 6163 7469 7661 7469 6f6e   self.activation
-00008900: 203d 206e 6e2e 5052 654c 5528 290a 0a20   = nn.PReLU().. 
-00008910: 2020 2020 2020 2065 6c69 6620 6163 7469         elif acti
-00008920: 7661 7469 6f6e 203d 3d20 2774 616e 6827  vation == 'tanh'
-00008930: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00008940: 6c66 2e61 6374 6976 6174 696f 6e20 3d20  lf.activation = 
-00008950: 6e6e 2e54 616e 6828 290a 0a20 2020 2020  nn.Tanh()..     
-00008960: 2020 2065 6c69 6620 6163 7469 7661 7469     elif activati
-00008970: 6f6e 203d 3d20 2773 656c 7527 3a0a 2020  on == 'selu':.  
-00008980: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00008990: 6374 6976 6174 696f 6e20 3d20 6e6e 2e53  ctivation = nn.S
-000089a0: 454c 5528 290a 0a20 2020 2020 2020 2065  ELU()..        e
-000089b0: 6c69 6620 6163 7469 7661 7469 6f6e 203d  lif activation =
-000089c0: 3d20 2765 6c75 273a 0a20 2020 2020 2020  = 'elu':.       
-000089d0: 2020 2020 2073 656c 662e 6163 7469 7661       self.activa
-000089e0: 7469 6f6e 203d 206e 6e2e 454c 5528 290a  tion = nn.ELU().
-000089f0: 0a20 2020 2020 2020 2065 6c69 6620 6163  .        elif ac
-00008a00: 7469 7661 7469 6f6e 203d 3d20 226c 696e  tivation == "lin
-00008a10: 6561 7222 3a0a 2020 2020 2020 2020 2020  ear":.          
-00008a20: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
-00008a30: 6e20 3d20 6c61 6d62 6461 2078 3a20 780a  n = lambda x: x.
-00008a40: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
-00008a50: 6c61 7965 7273 3a20 696e 7420 3d20 6e5f  layers: int = n_
-00008a60: 6c61 7965 7273 0a20 2020 2020 2020 2064  layers.        d
-00008a70: 5f6f 7574 7075 7420 3d20 645f 6f75 7470  _output = d_outp
-00008a80: 7574 2069 6620 645f 6f75 7470 7574 2021  ut if d_output !
-00008a90: 3d20 3020 656c 7365 2064 5f69 6e70 7574  = 0 else d_input
-00008aa0: 0a20 2020 2020 2020 2064 5f68 6964 6465  .        d_hidde
-00008ab0: 6e20 3d20 645f 6869 6464 656e 2069 6620  n = d_hidden if 
-00008ac0: 645f 6869 6464 656e 2021 3d20 3020 656c  d_hidden != 0 el
-00008ad0: 7365 2064 5f69 6e70 7574 0a0a 2020 2020  se d_input..    
-00008ae0: 2020 2020 6966 206e 5f6c 6179 6572 7320      if n_layers 
-00008af0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-00008b00: 2020 7365 6c66 2e6c 696e 6561 7273 3a20    self.linears: 
-00008b10: 416e 7920 3d20 5b6e 6e2e 4c69 6e65 6172  Any = [nn.Linear
-00008b20: 2864 5f69 6e70 7574 2c20 645f 6f75 7470  (d_input, d_outp
-00008b30: 7574 295d 0a0a 2020 2020 2020 2020 656c  ut)]..        el
-00008b40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00008b50: 7365 6c66 2e6c 696e 6561 7273 203d 205b  self.linears = [
-00008b60: 6e6e 2e4c 696e 6561 7228 645f 696e 7075  nn.Linear(d_inpu
-00008b70: 742c 2064 5f68 6964 6465 6e29 5d20 2b20  t, d_hidden)] + 
-00008b80: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00008b90: 2020 2020 2020 2020 2020 2020 2020 5b6e                [n
-00008ba0: 6e2e 4c69 6e65 6172 2864 5f68 6964 6465  n.Linear(d_hidde
-00008bb0: 6e2c 2064 5f68 6964 6465 6e29 2066 6f72  n, d_hidden) for
-00008bc0: 205f 2069 6e20 7261 6e67 6528 6e5f 6c61   _ in range(n_la
-00008bd0: 7965 7273 202d 2032 295d 202b 205c 0a20  yers - 2)] + \. 
-00008be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008bf0: 2020 2020 2020 2020 2020 205b 6e6e 2e4c             [nn.L
-00008c00: 696e 6561 7228 645f 6869 6464 656e 2c20  inear(d_hidden, 
-00008c10: 645f 6f75 7470 7574 295d 0a0a 2020 2020  d_output)]..    
-00008c20: 2020 2020 7365 6c66 2e6c 696e 6561 7273      self.linears
-00008c30: 203d 206e 6e2e 4d6f 6475 6c65 4c69 7374   = nn.ModuleList
-00008c40: 2873 656c 662e 6c69 6e65 6172 7329 0a20  (self.linears). 
-00008c50: 2020 2020 2020 2064 726f 706f 7574 5f6c         dropout_l
-00008c60: 6179 6572 203d 206e 6e2e 4472 6f70 6f75  ayer = nn.Dropou
-00008c70: 7428 6472 6f70 6f75 745f 7029 0a20 2020  t(dropout_p).   
-00008c80: 2020 2020 2073 656c 662e 6472 6f70 6f75       self.dropou
-00008c90: 745f 7020 3d20 6e6e 2e4d 6f64 756c 654c  t_p = nn.ModuleL
-00008ca0: 6973 7428 5b64 726f 706f 7574 5f6c 6179  ist([dropout_lay
-00008cb0: 6572 2066 6f72 205f 2069 6e20 7261 6e67  er for _ in rang
-00008cc0: 6528 6e5f 6c61 7965 7273 295d 290a 0a20  e(n_layers)]).. 
-00008cd0: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
-00008ce0: 656c 662c 2078 3a20 746f 7263 682e 5465  elf, x: torch.Te
-00008cf0: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
-00008d00: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
-00008d10: 2222 4f75 7470 7574 2043 6f6d 7075 7461  ""Output Computa
-00008d20: 7469 6f6e 2066 6f72 2074 6865 2050 6f73  tion for the Pos
-00008d30: 6974 696f 6e77 6973 6546 6565 6446 6f72  itionwiseFeedFor
-00008d40: 7761 7264 206c 6179 6572 2e0a 0a20 2020  ward layer...   
-00008d50: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00008d60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00008d70: 2d2d 0a20 2020 2020 2020 2078 3a20 746f  --.        x: to
-00008d80: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-00008d90: 2020 2020 2020 2049 6e70 7574 2074 656e         Input ten
-00008da0: 736f 722e 0a20 2020 2020 2020 2022 2222  sor..        """
-00008db0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00008dc0: 7365 6c66 2e6e 5f6c 6179 6572 733a 0a20  self.n_layers:. 
-00008dd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008de0: 6e20 780a 0a20 2020 2020 2020 2069 6620  n x..        if 
-00008df0: 7365 6c66 2e6e 5f6c 6179 6572 7320 3d3d  self.n_layers ==
-00008e00: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00008e10: 6966 2073 656c 662e 6472 6f70 6f75 745f  if self.dropout_
-00008e20: 6174 5f69 6e70 7574 5f6e 6f5f 6163 743a  at_input_no_act:
-00008e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008e40: 2072 6574 7572 6e20 7365 6c66 2e6c 696e   return self.lin
-00008e50: 6561 7273 5b30 5d28 7365 6c66 2e64 726f  ears[0](self.dro
-00008e60: 706f 7574 5f70 5b30 5d28 7829 290a 2020  pout_p[0](x)).  
-00008e70: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00008e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e90: 7265 7475 726e 2073 656c 662e 6472 6f70  return self.drop
-00008ea0: 6f75 745f 705b 305d 2873 656c 662e 6163  out_p[0](self.ac
-00008eb0: 7469 7661 7469 6f6e 2873 656c 662e 6c69  tivation(self.li
-00008ec0: 6e65 6172 735b 305d 2878 2929 290a 0a20  nears[0](x))).. 
-00008ed0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00008ee0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00008ef0: 2e64 726f 706f 7574 5f61 745f 696e 7075  .dropout_at_inpu
-00008f00: 745f 6e6f 5f61 6374 3a0a 2020 2020 2020  t_no_act:.      
-00008f10: 2020 2020 2020 2020 2020 7820 3d20 7365            x = se
-00008f20: 6c66 2e64 726f 706f 7574 5f70 5b30 5d28  lf.dropout_p[0](
-00008f30: 7829 0a20 2020 2020 2020 2020 2020 2066  x).            f
-00008f40: 6f72 2069 2069 6e20 7261 6e67 6528 7365  or i in range(se
-00008f50: 6c66 2e6e 5f6c 6179 6572 7320 2d20 3129  lf.n_layers - 1)
-00008f60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008f70: 2020 7820 3d20 7365 6c66 2e64 726f 706f    x = self.dropo
-00008f80: 7574 5f70 5b69 5d28 7365 6c66 2e61 6374  ut_p[i](self.act
-00008f90: 6976 6174 696f 6e28 7365 6c66 2e6c 696e  ivation(self.lin
-00008fa0: 6561 7273 5b69 5d28 7829 2929 0a20 2020  ears[i](x))).   
-00008fb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00008fc0: 7365 6c66 2e6c 696e 6561 7273 5b2d 315d  self.linears[-1]
-00008fd0: 2878 290a 0a0a 636c 6173 7320 4d41 5445  (x)...class MATE
-00008fe0: 6d62 6564 6469 6e67 286e 6e2e 4d6f 6475  mbedding(nn.Modu
-00008ff0: 6c65 293a 0a20 2020 2022 2222 456d 6265  le):.    """Embe
-00009000: 6464 696e 6720 6c61 7965 7220 746f 2063  dding layer to c
-00009010: 7265 6174 6520 656d 6265 6464 696e 6720  reate embedding 
-00009020: 666f 7220 696e 7075 7473 2e0a 0a20 2020  for inputs...   
-00009030: 2049 6e20 616e 2065 6d62 6564 6469 6e67   In an embedding
-00009040: 206c 6179 6572 2c20 696e 7075 7420 6973   layer, input is
-00009050: 2074 616b 656e 2061 6e64 2063 6f6e 7665   taken and conve
-00009060: 7274 6564 2074 6f20 6120 7665 6374 6f72  rted to a vector
-00009070: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
-00009080: 666f 7220 6561 6368 2069 6e70 7574 2e0a  for each input..
-00009090: 2020 2020 496e 2074 6865 204d 4154 456d      In the MATEm
-000090a0: 6265 6464 696e 6720 6c61 7965 722c 2061  bedding layer, a
-000090b0: 6e20 696e 7075 7420 7465 6e73 6f72 2069  n input tensor i
-000090c0: 7320 7072 6f63 6573 7365 6420 7468 726f  s processed thro
-000090d0: 7567 6820 6120 6472 6f70 6f75 742d 6164  ugh a dropout-ad
-000090e0: 6a75 7374 6564 206c 696e 6561 7220 6c61  justed linear la
-000090f0: 7965 7220 616e 6420 7468 6520 7265 7375  yer and the resu
-00009100: 6c74 616e 7420 7665 6374 6f72 2069 7320  ltant vector is 
-00009110: 7265 7475 726e 6564 2e0a 0a20 2020 2052  returned...    R
-00009120: 6566 6572 656e 6365 730a 2020 2020 2d2d  eferences.    --
-00009130: 2d2d 2d2d 2d2d 2d2d 0a20 2020 202e 2e20  --------.    .. 
-00009140: 5b31 5d20 4c75 6b61 737a 204d 617a 6961  [1] Lukasz Mazia
-00009150: 726b 6120 6574 2061 6c2e 2022 4d6f 6c65  rka et al. "Mole
-00009160: 6375 6c65 2041 7474 656e 7469 6f6e 2054  cule Attention T
-00009170: 7261 6e73 666f 726d 6572 2220 4772 6170  ransformer" Grap
-00009180: 6820 5265 7072 6573 656e 7461 7469 6f6e  h Representation
-00009190: 204c 6561 726e 696e 6720 776f 726b 7368   Learning worksh
-000091a0: 6f70 2061 6e64 204d 6163 6869 6e65 204c  op and Machine L
-000091b0: 6561 726e 696e 6720 616e 6420 7468 6520  earning and the 
-000091c0: 5068 7973 6963 616c 2053 6369 656e 6365  Physical Science
-000091d0: 7320 776f 726b 7368 6f70 2061 7420 4e65  s workshop at Ne
-000091e0: 7572 4950 5320 3230 3139 2e20 3230 3230  urIPS 2019. 2020
-000091f0: 2e20 6874 7470 733a 2f2f 6172 7869 762e  . https://arxiv.
-00009200: 6f72 672f 6162 732f 3230 3032 2e30 3832  org/abs/2002.082
-00009210: 3634 0a0a 2020 2020 4578 616d 706c 6573  64..    Examples
-00009220: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-00009230: 2020 3e3e 3e20 6672 6f6d 2064 6565 7063    >>> from deepc
-00009240: 6865 6d2e 6d6f 6465 6c73 2e74 6f72 6368  hem.models.torch
-00009250: 5f6d 6f64 656c 732e 6c61 7965 7273 2069  _models.layers i
-00009260: 6d70 6f72 7420 4d41 5445 6d62 6564 6469  mport MATEmbeddi
-00009270: 6e67 0a20 2020 203e 3e3e 206c 6179 6572  ng.    >>> layer
-00009280: 203d 204d 4154 456d 6265 6464 696e 6728   = MATEmbedding(
-00009290: 645f 696e 7075 7420 3d20 332c 2064 5f6f  d_input = 3, d_o
-000092a0: 7574 7075 7420 3d20 332c 2064 726f 706f  utput = 3, dropo
-000092b0: 7574 5f70 203d 2030 2e32 290a 2020 2020  ut_p = 0.2).    
-000092c0: 3e3e 3e20 696e 7075 745f 7465 6e73 6f72  >>> input_tensor
-000092d0: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
-000092e0: 5b31 2e2c 2032 2e2c 2033 2e5d 290a 2020  [1., 2., 3.]).  
-000092f0: 2020 3e3e 3e20 6f75 7470 7574 203d 206c    >>> output = l
-00009300: 6179 6572 2869 6e70 7574 5f74 656e 736f  ayer(input_tenso
-00009310: 7229 0a20 2020 2022 2222 0a0a 2020 2020  r).    """..    
-00009320: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00009330: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-00009340: 2020 2020 645f 696e 7075 743a 2069 6e74      d_input: int
-00009350: 203d 2033 362c 0a20 2020 2020 2020 2020   = 36,.         
-00009360: 2020 2020 2020 2020 645f 6f75 7470 7574          d_output
-00009370: 3a20 696e 7420 3d20 3130 3234 2c0a 2020  : int = 1024,.  
-00009380: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00009390: 726f 706f 7574 5f70 3a20 666c 6f61 7420  ropout_p: float 
-000093a0: 3d20 302e 3029 3a0a 2020 2020 2020 2020  = 0.0):.        
-000093b0: 2222 2249 6e69 7469 616c 697a 6520 6120  """Initialize a 
-000093c0: 4d41 5445 6d62 6564 6469 6e67 206c 6179  MATEmbedding lay
-000093d0: 6572 2e0a 0a20 2020 2020 2020 2050 6172  er...        Par
-000093e0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-000093f0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00009400: 2020 2064 5f69 6e70 7574 3a20 696e 740a     d_input: int.
-00009410: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
-00009420: 206f 6620 696e 7075 7420 6c61 7965 722e   of input layer.
-00009430: 0a20 2020 2020 2020 2064 5f6f 7574 7075  .        d_outpu
-00009440: 743a 2069 6e74 0a20 2020 2020 2020 2020  t: int.         
-00009450: 2020 2053 697a 6520 6f66 206f 7574 7075     Size of outpu
-00009460: 7420 6c61 7965 722e 0a20 2020 2020 2020  t layer..       
-00009470: 2064 726f 706f 7574 5f70 3a20 666c 6f61   dropout_p: floa
-00009480: 740a 2020 2020 2020 2020 2020 2020 4472  t.            Dr
-00009490: 6f70 6f75 7420 7072 6f62 6162 696c 6974  opout probabilit
-000094a0: 7920 666f 7220 6c61 7965 722e 0a20 2020  y for layer..   
-000094b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000094c0: 2073 7570 6572 284d 4154 456d 6265 6464   super(MATEmbedd
-000094d0: 696e 672c 2073 656c 6629 2e5f 5f69 6e69  ing, self).__ini
-000094e0: 745f 5f28 290a 2020 2020 2020 2020 7365  t__().        se
-000094f0: 6c66 2e6c 696e 6561 725f 756e 6974 203d  lf.linear_unit =
-00009500: 206e 6e2e 4c69 6e65 6172 2864 5f69 6e70   nn.Linear(d_inp
-00009510: 7574 2c20 645f 6f75 7470 7574 290a 2020  ut, d_output).  
-00009520: 2020 2020 2020 7365 6c66 2e64 726f 706f        self.dropo
-00009530: 7574 203d 206e 6e2e 4472 6f70 6f75 7428  ut = nn.Dropout(
-00009540: 6472 6f70 6f75 745f 7029 0a0a 2020 2020  dropout_p)..    
-00009550: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
-00009560: 2c20 783a 2074 6f72 6368 2e54 656e 736f  , x: torch.Tenso
-00009570: 7229 202d 3e20 746f 7263 682e 5465 6e73  r) -> torch.Tens
-00009580: 6f72 3a0a 2020 2020 2020 2020 2222 2243  or:.        """C
-00009590: 6f6d 7075 7461 7469 6f6e 2066 6f72 2074  omputation for t
-000095a0: 6865 204d 4154 456d 6265 6464 696e 6720  he MATEmbedding 
-000095b0: 6c61 7965 722e 0a0a 2020 2020 2020 2020  layer...        
-000095c0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-000095d0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-000095e0: 2020 2020 2020 783a 2074 6f72 6368 2e54        x: torch.T
-000095f0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00009600: 2020 496e 7075 7420 7465 6e73 6f72 2074    Input tensor t
-00009610: 6f20 6265 2063 6f6e 7665 7274 6564 2069  o be converted i
-00009620: 6e74 6f20 6120 7665 6374 6f72 2e0a 2020  nto a vector..  
-00009630: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00009640: 2020 7265 7475 726e 2073 656c 662e 6472    return self.dr
-00009650: 6f70 6f75 7428 7365 6c66 2e6c 696e 6561  opout(self.linea
-00009660: 725f 756e 6974 2878 2929 0a0a 0a63 6c61  r_unit(x))...cla
-00009670: 7373 204d 4154 4765 6e65 7261 746f 7228  ss MATGenerator(
-00009680: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
-00009690: 2222 224d 4154 4765 6e65 7261 746f 7220  """MATGenerator 
-000096a0: 6465 6669 6e65 7320 7468 6520 6c69 6e65  defines the line
-000096b0: 6172 2061 6e64 2073 6f66 746d 6178 2067  ar and softmax g
-000096c0: 656e 6572 6174 6f72 2073 7465 7020 666f  enerator step fo
-000096d0: 7220 7468 6520 4d6f 6c65 6375 6c61 7220  r the Molecular 
-000096e0: 4174 7465 6e74 696f 6e20 5472 616e 7366  Attention Transf
-000096f0: 6f72 6d65 7220 5b31 5d5f 2e0a 0a20 2020  ormer [1]_...   
-00009700: 2049 6e20 7468 6520 4d41 5447 656e 6572   In the MATGener
-00009710: 6174 6f72 2c20 6120 4765 6e65 7261 746f  ator, a Generato
-00009720: 7220 6973 2064 6566 696e 6564 2077 6869  r is defined whi
-00009730: 6368 2070 6572 666f 726d 7320 7468 6520  ch performs the 
-00009740: 4c69 6e65 6172 202b 2053 6f66 746d 6178  Linear + Softmax
-00009750: 2067 656e 6572 6174 696f 6e20 7374 6570   generation step
-00009760: 2e0a 2020 2020 4465 7065 6e64 696e 6720  ..    Depending 
-00009770: 6f6e 2074 6865 2074 7970 6520 6f66 2061  on the type of a
-00009780: 6767 7265 6761 7469 6f6e 2073 656c 6563  ggregation selec
-00009790: 7465 642c 2074 6865 2061 7474 656e 7469  ted, the attenti
-000097a0: 6f6e 206f 7574 7075 7420 6c61 7965 7220  on output layer 
-000097b0: 7065 7266 6f72 6d73 2064 6966 6665 7265  performs differe
-000097c0: 6e74 206f 7065 7261 7469 6f6e 732e 0a0a  nt operations...
-000097d0: 2020 2020 5265 6665 7265 6e63 6573 0a20      References. 
-000097e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-000097f0: 2020 2e2e 205b 315d 204c 756b 6173 7a20    .. [1] Lukasz 
-00009800: 4d61 7a69 6172 6b61 2065 7420 616c 2e20  Maziarka et al. 
-00009810: 224d 6f6c 6563 756c 6520 4174 7465 6e74  "Molecule Attent
-00009820: 696f 6e20 5472 616e 7366 6f72 6d65 7222  ion Transformer"
-00009830: 2047 7261 7068 2052 6570 7265 7365 6e74   Graph Represent
-00009840: 6174 696f 6e20 4c65 6172 6e69 6e67 2077  ation Learning w
-00009850: 6f72 6b73 686f 7020 616e 6420 4d61 6368  orkshop and Mach
-00009860: 696e 6520 4c65 6172 6e69 6e67 2061 6e64  ine Learning and
-00009870: 2074 6865 2050 6879 7369 6361 6c20 5363   the Physical Sc
-00009880: 6965 6e63 6573 2077 6f72 6b73 686f 7020  iences workshop 
-00009890: 6174 204e 6575 7249 5053 2032 3031 392e  at NeurIPS 2019.
-000098a0: 2032 3032 302e 2068 7474 7073 3a2f 2f61   2020. https://a
-000098b0: 7278 6976 2e6f 7267 2f61 6273 2f32 3030  rxiv.org/abs/200
-000098c0: 322e 3038 3236 340a 0a20 2020 2045 7861  2.08264..    Exa
-000098d0: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
-000098e0: 2d2d 0a20 2020 203e 3e3e 2066 726f 6d20  --.    >>> from 
-000098f0: 6465 6570 6368 656d 2e6d 6f64 656c 732e  deepchem.models.
-00009900: 746f 7263 685f 6d6f 6465 6c73 2e6c 6179  torch_models.lay
-00009910: 6572 7320 696d 706f 7274 204d 4154 4765  ers import MATGe
-00009920: 6e65 7261 746f 720a 2020 2020 3e3e 3e20  nerator.    >>> 
-00009930: 6c61 7965 7220 3d20 4d41 5447 656e 6572  layer = MATGener
-00009940: 6174 6f72 2868 7369 7a65 203d 2033 2c20  ator(hsize = 3, 
-00009950: 6167 6772 6567 6174 696f 6e5f 7479 7065  aggregation_type
-00009960: 203d 2027 6d65 616e 272c 2064 5f6f 7574   = 'mean', d_out
-00009970: 7075 7420 3d20 312c 206e 5f6c 6179 6572  put = 1, n_layer
-00009980: 7320 3d20 312c 2064 726f 706f 7574 5f70  s = 1, dropout_p
-00009990: 203d 2030 2e33 2c20 6174 746e 5f68 6964   = 0.3, attn_hid
-000099a0: 6465 6e20 3d20 3132 382c 2061 7474 6e5f  den = 128, attn_
-000099b0: 6f75 7420 3d20 3429 0a20 2020 203e 3e3e  out = 4).    >>>
-000099c0: 2069 6e70 7574 5f74 656e 736f 7220 3d20   input_tensor = 
-000099d0: 746f 7263 682e 7465 6e73 6f72 285b 312e  torch.tensor([1.
-000099e0: 2c20 322e 2c20 332e 5d29 0a20 2020 203e  , 2., 3.]).    >
-000099f0: 3e3e 206d 6173 6b20 3d20 746f 7263 682e  >> mask = torch.
-00009a00: 7465 6e73 6f72 285b 312e 2c20 312e 2c20  tensor([1., 1., 
-00009a10: 312e 5d29 0a20 2020 203e 3e3e 206f 7574  1.]).    >>> out
-00009a20: 7075 7420 3d20 6c61 7965 7228 696e 7075  put = layer(inpu
-00009a30: 745f 7465 6e73 6f72 2c20 6d61 736b 290a  t_tensor, mask).
-00009a40: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-00009a50: 205f 5f69 6e69 745f 5f28 7365 6c66 2c0a   __init__(self,.
-00009a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a70: 2068 7369 7a65 3a20 696e 7420 3d20 3130   hsize: int = 10
-00009a80: 3234 2c0a 2020 2020 2020 2020 2020 2020  24,.            
-00009a90: 2020 2020 2061 6767 7265 6761 7469 6f6e       aggregation
-00009aa0: 5f74 7970 653a 2073 7472 203d 2027 6d65  _type: str = 'me
-00009ab0: 616e 272c 0a20 2020 2020 2020 2020 2020  an',.           
-00009ac0: 2020 2020 2020 645f 6f75 7470 7574 3a20        d_output: 
-00009ad0: 696e 7420 3d20 312c 0a20 2020 2020 2020  int = 1,.       
-00009ae0: 2020 2020 2020 2020 2020 6e5f 6c61 7965            n_laye
-00009af0: 7273 3a20 696e 7420 3d20 312c 0a20 2020  rs: int = 1,.   
-00009b00: 2020 2020 2020 2020 2020 2020 2020 6472                dr
-00009b10: 6f70 6f75 745f 703a 2066 6c6f 6174 203d  opout_p: float =
-00009b20: 2030 2e30 2c0a 2020 2020 2020 2020 2020   0.0,.          
-00009b30: 2020 2020 2020 2061 7474 6e5f 6869 6464         attn_hidd
-00009b40: 656e 3a20 696e 7420 3d20 3132 382c 0a20  en: int = 128,. 
-00009b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b60: 6174 746e 5f6f 7574 3a20 696e 7420 3d20  attn_out: int = 
-00009b70: 3429 3a0a 2020 2020 2020 2020 2222 2249  4):.        """I
-00009b80: 6e69 7469 616c 697a 6520 6120 4d41 5447  nitialize a MATG
-00009b90: 656e 6572 6174 6f72 2e0a 0a20 2020 2020  enerator...     
-00009ba0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00009bb0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00009bc0: 0a20 2020 2020 2020 2068 7369 7a65 3a20  .        hsize: 
-00009bd0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00009be0: 5369 7a65 206f 6620 696e 7075 7420 6c61  Size of input la
-00009bf0: 7965 722e 0a20 2020 2020 2020 2061 6767  yer..        agg
-00009c00: 7265 6761 7469 6f6e 5f74 7970 653a 2073  regation_type: s
-00009c10: 7472 0a20 2020 2020 2020 2020 2020 2054  tr.            T
-00009c20: 7970 6520 6f66 2061 6767 7265 6761 7469  ype of aggregati
-00009c30: 6f6e 2074 6f20 6265 2075 7365 642e 2043  on to be used. C
-00009c40: 616e 2062 6520 2767 726f 7665 7227 2c20  an be 'grover', 
-00009c50: 276d 6561 6e27 206f 7220 2763 6f6e 7465  'mean' or 'conte
-00009c60: 7874 7561 6c27 2e0a 2020 2020 2020 2020  xtual'..        
-00009c70: 645f 6f75 7470 7574 3a20 696e 740a 2020  d_output: int.  
-00009c80: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
-00009c90: 6620 6f75 7470 7574 206c 6179 6572 2e0a  f output layer..
-00009ca0: 2020 2020 2020 2020 6e5f 6c61 7965 7273          n_layers
-00009cb0: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
-00009cc0: 2020 4e75 6d62 6572 206f 6620 6c61 7965    Number of laye
-00009cd0: 7273 2069 6e20 4d41 5447 656e 6572 6174  rs in MATGenerat
-00009ce0: 6f72 2e0a 2020 2020 2020 2020 6472 6f70  or..        drop
-00009cf0: 6f75 745f 703a 2066 6c6f 6174 0a20 2020  out_p: float.   
-00009d00: 2020 2020 2020 2020 2044 726f 706f 7574           Dropout
-00009d10: 2070 726f 6261 6269 6c69 7479 2066 6f72   probability for
-00009d20: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-00009d30: 6174 746e 5f68 6964 6465 6e3a 2069 6e74  attn_hidden: int
-00009d40: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
-00009d50: 6520 6f66 2068 6964 6465 6e20 6174 7465  e of hidden atte
-00009d60: 6e74 696f 6e20 6c61 7965 722e 0a20 2020  ntion layer..   
-00009d70: 2020 2020 2061 7474 6e5f 6f75 743a 2069       attn_out: i
-00009d80: 6e74 0a20 2020 2020 2020 2020 2020 2053  nt.            S
-00009d90: 697a 6520 6f66 206f 7574 7075 7420 6174  ize of output at
-00009da0: 7465 6e74 696f 6e20 6c61 7965 722e 0a20  tention layer.. 
-00009db0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00009dc0: 2020 2073 7570 6572 284d 4154 4765 6e65     super(MATGene
-00009dd0: 7261 746f 722c 2073 656c 6629 2e5f 5f69  rator, self).__i
-00009de0: 6e69 745f 5f28 290a 0a20 2020 2020 2020  nit__()..       
-00009df0: 2069 6620 6167 6772 6567 6174 696f 6e5f   if aggregation_
-00009e00: 7479 7065 203d 3d20 2767 726f 7665 7227  type == 'grover'
-00009e10: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00009e20: 6c66 2e61 7474 5f6e 6574 203d 206e 6e2e  lf.att_net = nn.
-00009e30: 5365 7175 656e 7469 616c 280a 2020 2020  Sequential(.    
-00009e40: 2020 2020 2020 2020 2020 2020 6e6e 2e4c              nn.L
-00009e50: 696e 6561 7228 6873 697a 652c 2061 7474  inear(hsize, att
-00009e60: 6e5f 6869 6464 656e 2c20 6269 6173 3d46  n_hidden, bias=F
-00009e70: 616c 7365 292c 0a20 2020 2020 2020 2020  alse),.         
-00009e80: 2020 2020 2020 206e 6e2e 5461 6e68 2829         nn.Tanh()
-00009e90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009ea0: 2020 6e6e 2e4c 696e 6561 7228 6174 746e    nn.Linear(attn
-00009eb0: 5f68 6964 6465 6e2c 2061 7474 6e5f 6f75  _hidden, attn_ou
-00009ec0: 742c 2062 6961 733d 4661 6c73 6529 2c0a  t, bias=False),.
-00009ed0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00009ee0: 2020 2020 2020 2020 2020 6873 697a 6520            hsize 
-00009ef0: 2a3d 2061 7474 6e5f 6f75 740a 0a20 2020  *= attn_out..   
-00009f00: 2020 2020 2069 6620 6e5f 6c61 7965 7273       if n_layers
-00009f10: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00009f20: 2020 2073 656c 662e 7072 6f6a 3a20 416e     self.proj: An
-00009f30: 7920 3d20 6e6e 2e4c 696e 6561 7228 6873  y = nn.Linear(hs
-00009f40: 697a 652c 2064 5f6f 7574 7075 7429 0a0a  ize, d_output)..
-00009f50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00009f60: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00009f70: 726f 6a20 3d20 5b5d 0a0a 2020 2020 2020  roj = []..      
-00009f80: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00009f90: 616e 6765 286e 5f6c 6179 6572 7320 2d20  ange(n_layers - 
-00009fa0: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
-00009fb0: 2020 2020 7365 6c66 2e70 726f 6a2e 6170      self.proj.ap
-00009fc0: 7065 6e64 286e 6e2e 4c69 6e65 6172 2868  pend(nn.Linear(h
-00009fd0: 7369 7a65 2c20 6174 746e 5f68 6964 6465  size, attn_hidde
-00009fe0: 6e29 290a 2020 2020 2020 2020 2020 2020  n)).            
-00009ff0: 2020 2020 7365 6c66 2e70 726f 6a2e 6170      self.proj.ap
-0000a000: 7065 6e64 286e 6e2e 4c65 616b 7952 654c  pend(nn.LeakyReL
-0000a010: 5528 6e65 6761 7469 7665 5f73 6c6f 7065  U(negative_slope
-0000a020: 3d30 2e31 2929 0a20 2020 2020 2020 2020  =0.1)).         
-0000a030: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
-0000a040: 2e61 7070 656e 6428 6e6e 2e4c 6179 6572  .append(nn.Layer
-0000a050: 4e6f 726d 2861 7474 6e5f 6869 6464 656e  Norm(attn_hidden
-0000a060: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0000a070: 2020 2073 656c 662e 7072 6f6a 2e61 7070     self.proj.app
-0000a080: 656e 6428 6e6e 2e44 726f 706f 7574 2864  end(nn.Dropout(d
-0000a090: 726f 706f 7574 5f70 2929 0a20 2020 2020  ropout_p)).     
-0000a0a0: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
-0000a0b0: 2e61 7070 656e 6428 6e6e 2e4c 696e 6561  .append(nn.Linea
-0000a0c0: 7228 6174 746e 5f68 6964 6465 6e2c 2064  r(attn_hidden, d
-0000a0d0: 5f6f 7574 7075 7429 290a 2020 2020 2020  _output)).      
-0000a0e0: 2020 2020 2020 7365 6c66 2e70 726f 6a20        self.proj 
-0000a0f0: 3d20 746f 7263 682e 6e6e 2e53 6571 7565  = torch.nn.Seque
-0000a100: 6e74 6961 6c28 2a73 656c 662e 7072 6f6a  ntial(*self.proj
-0000a110: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000a120: 6767 7265 6761 7469 6f6e 5f74 7970 6520  ggregation_type 
-0000a130: 3d20 6167 6772 6567 6174 696f 6e5f 7479  = aggregation_ty
-0000a140: 7065 0a0a 2020 2020 6465 6620 666f 7277  pe..    def forw
-0000a150: 6172 6428 7365 6c66 2c20 783a 2074 6f72  ard(self, x: tor
-0000a160: 6368 2e54 656e 736f 722c 206d 6173 6b3a  ch.Tensor, mask:
-0000a170: 2074 6f72 6368 2e54 656e 736f 7229 202d   torch.Tensor) -
-0000a180: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
-0000a190: 2020 2020 2020 2020 2222 2243 6f6d 7075          """Compu
-0000a1a0: 7461 7469 6f6e 2066 6f72 2074 6865 204d  tation for the M
-0000a1b0: 4154 4765 6e65 7261 746f 7220 6c61 7965  ATGenerator laye
-0000a1c0: 722e 0a0a 2020 2020 2020 2020 5061 7261  r...        Para
-0000a1d0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-0000a1e0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-0000a1f0: 2020 783a 2074 6f72 6368 2e54 656e 736f    x: torch.Tenso
-0000a200: 720a 2020 2020 2020 2020 2020 2020 496e  r.            In
-0000a210: 7075 7420 7465 6e73 6f72 2e0a 2020 2020  put tensor..    
-0000a220: 2020 2020 6d61 736b 3a20 746f 7263 682e      mask: torch.
-0000a230: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-0000a240: 2020 204d 6173 6b20 666f 7220 7061 6464     Mask for padd
-0000a250: 696e 6720 736f 2074 6861 7420 7061 6464  ing so that padd
-0000a260: 6564 2076 616c 7565 7320 646f 206e 6f74  ed values do not
-0000a270: 2067 6574 2069 6e63 6c75 6465 6420 696e   get included in
-0000a280: 2061 7474 656e 7469 6f6e 2073 636f 7265   attention score
-0000a290: 2063 616c 6375 6c61 7469 6f6e 2e0a 2020   calculation..  
-0000a2a0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000a2b0: 2020 206d 6173 6b20 3d20 6d61 736b 2e75     mask = mask.u
-0000a2c0: 6e73 7175 6565 7a65 282d 3129 2e66 6c6f  nsqueeze(-1).flo
-0000a2d0: 6174 2829 0a20 2020 2020 2020 206f 7574  at().        out
-0000a2e0: 5f6d 6173 6b65 6420 3d20 7820 2a20 6d61  _masked = x * ma
-0000a2f0: 736b 0a0a 2020 2020 2020 2020 6966 2073  sk..        if s
-0000a300: 656c 662e 6167 6772 6567 6174 696f 6e5f  elf.aggregation_
-0000a310: 7479 7065 203d 3d20 276d 6561 6e27 3a0a  type == 'mean':.
-0000a320: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-0000a330: 7375 6d20 3d20 6f75 745f 6d61 736b 6564  sum = out_masked
-0000a340: 2e73 756d 2864 696d 3d31 290a 2020 2020  .sum(dim=1).    
-0000a350: 2020 2020 2020 2020 6d61 736b 5f73 756d          mask_sum
-0000a360: 203d 206d 6173 6b2e 7375 6d28 6469 6d3d   = mask.sum(dim=
-0000a370: 2831 2929 0a20 2020 2020 2020 2020 2020  (1)).           
-0000a380: 206f 7574 5f61 7667 5f70 6f6f 6c69 6e67   out_avg_pooling
-0000a390: 203d 206f 7574 5f73 756d 202f 206d 6173   = out_sum / mas
-0000a3a0: 6b5f 7375 6d0a 0a20 2020 2020 2020 2065  k_sum..        e
-0000a3b0: 6c69 6620 7365 6c66 2e61 6767 7265 6761  lif self.aggrega
-0000a3c0: 7469 6f6e 5f74 7970 6520 3d3d 2027 6772  tion_type == 'gr
-0000a3d0: 6f76 6572 273a 0a20 2020 2020 2020 2020  over':.         
-0000a3e0: 2020 206f 7574 5f61 7474 6e20 3d20 7365     out_attn = se
-0000a3f0: 6c66 2e61 7474 5f6e 6574 286f 7574 5f6d  lf.att_net(out_m
-0000a400: 6173 6b65 6429 0a20 2020 2020 2020 2020  asked).         
-0000a410: 2020 206f 7574 5f61 7474 6e20 3d20 6f75     out_attn = ou
-0000a420: 745f 6174 746e 2e6d 6173 6b65 645f 6669  t_attn.masked_fi
-0000a430: 6c6c 286d 6173 6b20 3d3d 2030 2c20 2d31  ll(mask == 0, -1
-0000a440: 6539 290a 2020 2020 2020 2020 2020 2020  e9).            
-0000a450: 6f75 745f 6174 746e 203d 2046 2e73 6f66  out_attn = F.sof
-0000a460: 746d 6178 286f 7574 5f61 7474 6e2c 2064  tmax(out_attn, d
-0000a470: 696d 3d31 290a 2020 2020 2020 2020 2020  im=1).          
-0000a480: 2020 6f75 745f 6176 675f 706f 6f6c 696e    out_avg_poolin
-0000a490: 6720 3d20 746f 7263 682e 6d61 746d 756c  g = torch.matmul
-0000a4a0: 2874 6f72 6368 2e74 7261 6e73 706f 7365  (torch.transpose
-0000a4b0: 286f 7574 5f61 7474 6e2c 202d 312c 202d  (out_attn, -1, -
-0000a4c0: 3229 2c0a 2020 2020 2020 2020 2020 2020  2),.            
-0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000a4f0: 7574 5f6d 6173 6b65 6429 0a20 2020 2020  ut_masked).     
-0000a500: 2020 2020 2020 206f 7574 5f61 7667 5f70         out_avg_p
-0000a510: 6f6f 6c69 6e67 203d 206f 7574 5f61 7667  ooling = out_avg
-0000a520: 5f70 6f6f 6c69 6e67 2e76 6965 7728 6f75  _pooling.view(ou
-0000a530: 745f 6176 675f 706f 6f6c 696e 672e 7369  t_avg_pooling.si
-0000a540: 7a65 2830 292c 202d 3129 0a0a 2020 2020  ze(0), -1)..    
-0000a550: 2020 2020 656c 6966 2073 656c 662e 6167      elif self.ag
-0000a560: 6772 6567 6174 696f 6e5f 7479 7065 203d  gregation_type =
-0000a570: 3d20 2763 6f6e 7465 7874 7561 6c27 3a0a  = 'contextual':.
-0000a580: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-0000a590: 6176 675f 706f 6f6c 696e 6720 3d20 780a  avg_pooling = x.
-0000a5a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000a5b0: 7365 6c66 2e70 726f 6a28 6f75 745f 6176  self.proj(out_av
-0000a5c0: 675f 706f 6f6c 696e 6729 0a0a 0a63 6c61  g_pooling)...cla
-0000a5d0: 7373 2047 7261 7068 4e65 7477 6f72 6b28  ss GraphNetwork(
-0000a5e0: 746f 7263 682e 6e6e 2e4d 6f64 756c 6529  torch.nn.Module)
-0000a5f0: 3a0a 2020 2020 2222 2247 7261 7068 204e  :.    """Graph N
-0000a600: 6574 776f 726b 730a 0a20 2020 2041 2047  etworks..    A G
-0000a610: 7261 7068 204e 6574 776f 726b 205b 315d  raph Network [1]
-0000a620: 5f20 7461 6b65 7320 6120 6772 6170 6820  _ takes a graph 
-0000a630: 6173 2069 6e70 7574 2061 6e64 2072 6574  as input and ret
-0000a640: 7572 6e73 2061 6e20 7570 6461 7465 6420  urns an updated 
-0000a650: 6772 6170 680a 2020 2020 6173 206f 7574  graph.    as out
-0000a660: 7075 742e 2054 6865 206f 7574 7075 7420  put. The output 
-0000a670: 6772 6170 6820 6861 7320 7361 6d65 2073  graph has same s
-0000a680: 7472 7563 7475 7265 2061 7320 696e 7075  tructure as inpu
-0000a690: 7420 6772 6170 6820 6275 7420 6974 0a20  t graph but it. 
-0000a6a0: 2020 2068 6173 2075 7064 6174 6564 206e     has updated n
-0000a6b0: 6f64 6520 6665 6174 7572 6573 2c20 6564  ode features, ed
-0000a6c0: 6765 2066 6561 7475 7265 7320 616e 6420  ge features and 
-0000a6d0: 676c 6f62 616c 2073 7461 7465 2066 6561  global state fea
-0000a6e0: 7475 7265 732e 0a0a 2020 2020 5061 7261  tures...    Para
-0000a6f0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-0000a700: 2d2d 2d2d 2d0a 2020 2020 6e5f 6e6f 6465  -----.    n_node
-0000a710: 5f66 6561 7475 7265 733a 2069 6e74 0a20  _features: int. 
-0000a720: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-0000a730: 2066 6561 7475 7265 7320 696e 2061 206e   features in a n
-0000a740: 6f64 650a 2020 2020 6e5f 6564 6765 5f66  ode.    n_edge_f
-0000a750: 6561 7475 7265 733a 2069 6e74 0a20 2020  eatures: int.   
-0000a760: 2020 2020 204e 756d 6265 7220 6f66 2066       Number of f
-0000a770: 6561 7475 7265 7320 696e 2061 2065 6467  eatures in a edg
-0000a780: 650a 2020 2020 6e5f 676c 6f62 616c 5f66  e.    n_global_f
-0000a790: 6561 7475 7265 733a 2069 6e74 0a20 2020  eatures: int.   
-0000a7a0: 2020 2020 204e 756d 6265 7220 6f66 2067       Number of g
-0000a7b0: 6c6f 6261 6c20 6665 6174 7572 6573 0a20  lobal features. 
-0000a7c0: 2020 2069 735f 756e 6469 7265 6374 6564     is_undirected
-0000a7d0: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
-0000a7e0: 2028 6465 6661 756c 7420 5472 7565 290a   (default True).
-0000a7f0: 2020 2020 2020 2020 4469 7265 6374 6564          Directed
-0000a800: 206f 7220 756e 6469 7265 6374 6564 2067   or undirected g
-0000a810: 7261 7068 0a20 2020 2072 6573 6964 7561  raph.    residua
-0000a820: 6c5f 636f 6e6e 6563 7469 6f6e 3a20 626f  l_connection: bo
-0000a830: 6f6c 2c20 6f70 7469 6f6e 616c 2028 6465  ol, optional (de
-0000a840: 6661 756c 7420 5472 7565 290a 2020 2020  fault True).    
-0000a850: 2020 2020 4966 2054 7275 652c 2074 6865      If True, the
-0000a860: 206c 6179 6572 2075 7365 7320 6120 7265   layer uses a re
-0000a870: 7369 6475 616c 2063 6f6e 6e65 6374 696f  sidual connectio
-0000a880: 6e20 6475 7269 6e67 2074 7261 696e 696e  n during trainin
-0000a890: 670a 0a20 2020 2045 7861 6d70 6c65 0a20  g..    Example. 
-0000a8a0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 203e     -------.    >
-0000a8b0: 3e3e 2069 6d70 6f72 7420 746f 7263 680a  >> import torch.
-0000a8c0: 2020 2020 3e3e 3e20 6672 6f6d 2064 6565      >>> from dee
-0000a8d0: 7063 6865 6d2e 6d6f 6465 6c73 2e74 6f72  pchem.models.tor
-0000a8e0: 6368 5f6d 6f64 656c 732e 6c61 7965 7273  ch_models.layers
-0000a8f0: 2069 6d70 6f72 7420 4772 6170 684e 6574   import GraphNet
-0000a900: 776f 726b 2061 7320 474e 0a20 2020 203e  work as GN.    >
-0000a910: 3e3e 206e 5f6e 6f64 6573 2c20 6e5f 6e6f  >> n_nodes, n_no
-0000a920: 6465 5f66 6561 7475 7265 7320 3d20 352c  de_features = 5,
-0000a930: 2031 300a 2020 2020 3e3e 3e20 6e5f 6564   10.    >>> n_ed
-0000a940: 6765 732c 206e 5f65 6467 655f 6665 6174  ges, n_edge_feat
-0000a950: 7572 6573 203d 2035 2c20 320a 2020 2020  ures = 5, 2.    
-0000a960: 3e3e 3e20 6e5f 676c 6f62 616c 5f66 6561  >>> n_global_fea
-0000a970: 7475 7265 7320 3d20 340a 2020 2020 3e3e  tures = 4.    >>
-0000a980: 3e20 6e6f 6465 5f66 6561 7475 7265 7320  > node_features 
-0000a990: 3d20 746f 7263 682e 7261 6e64 6e28 6e5f  = torch.randn(n_
-0000a9a0: 6e6f 6465 732c 206e 5f6e 6f64 655f 6665  nodes, n_node_fe
-0000a9b0: 6174 7572 6573 290a 2020 2020 3e3e 3e20  atures).    >>> 
-0000a9c0: 6564 6765 5f66 6561 7475 7265 7320 3d20  edge_features = 
-0000a9d0: 746f 7263 682e 7261 6e64 6e28 6e5f 6564  torch.randn(n_ed
-0000a9e0: 6765 732c 206e 5f65 6467 655f 6665 6174  ges, n_edge_feat
-0000a9f0: 7572 6573 290a 2020 2020 3e3e 3e20 6564  ures).    >>> ed
-0000aa00: 6765 5f69 6e64 6578 203d 2074 6f72 6368  ge_index = torch
-0000aa10: 2e74 656e 736f 7228 5b5b 302c 2031 2c20  .tensor([[0, 1, 
-0000aa20: 322c 2033 2c20 345d 2c20 5b31 2c20 322c  2, 3, 4], [1, 2,
-0000aa30: 2033 2c20 342c 2030 5d5d 292e 6c6f 6e67   3, 4, 0]]).long
-0000aa40: 2829 0a20 2020 203e 3e3e 2067 6c6f 6261  ().    >>> globa
-0000aa50: 6c5f 6665 6174 7572 6573 203d 2074 6f72  l_features = tor
-0000aa60: 6368 2e72 616e 646e 2831 2c20 6e5f 676c  ch.randn(1, n_gl
-0000aa70: 6f62 616c 5f66 6561 7475 7265 7329 0a20  obal_features). 
-0000aa80: 2020 203e 3e3e 2067 6e20 3d20 474e 286e     >>> gn = GN(n
-0000aa90: 5f6e 6f64 655f 6665 6174 7572 6573 3d6e  _node_features=n
-0000aaa0: 5f6e 6f64 655f 6665 6174 7572 6573 2c20  _node_features, 
-0000aab0: 6e5f 6564 6765 5f66 6561 7475 7265 733d  n_edge_features=
-0000aac0: 6e5f 6564 6765 5f66 6561 7475 7265 732c  n_edge_features,
-0000aad0: 206e 5f67 6c6f 6261 6c5f 6665 6174 7572   n_global_featur
-0000aae0: 6573 3d6e 5f67 6c6f 6261 6c5f 6665 6174  es=n_global_feat
-0000aaf0: 7572 6573 290a 2020 2020 3e3e 3e20 6e6f  ures).    >>> no
-0000ab00: 6465 5f66 6561 7475 7265 732c 2065 6467  de_features, edg
-0000ab10: 655f 6665 6174 7572 6573 2c20 676c 6f62  e_features, glob
-0000ab20: 616c 5f66 6561 7475 7265 7320 3d20 676e  al_features = gn
-0000ab30: 286e 6f64 655f 6665 6174 7572 6573 2c20  (node_features, 
-0000ab40: 6564 6765 5f69 6e64 6578 2c20 6564 6765  edge_index, edge
-0000ab50: 5f66 6561 7475 7265 732c 2067 6c6f 6261  _features, globa
-0000ab60: 6c5f 6665 6174 7572 6573 290a 0a20 2020  l_features)..   
-0000ab70: 2052 6566 6572 656e 6365 730a 2020 2020   References.    
-0000ab80: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 202e  ----------.    .
-0000ab90: 2e20 5b31 5d20 4261 7474 6167 6c69 6120  . [1] Battaglia 
-0000aba0: 6574 2061 6c2c 2052 656c 6174 696f 6e61  et al, Relationa
-0000abb0: 6c20 696e 6475 6374 6976 6520 6269 6173  l inductive bias
-0000abc0: 6573 2c20 6465 6570 206c 6561 726e 696e  es, deep learnin
-0000abd0: 672c 2061 6e64 2067 7261 7068 206e 6574  g, and graph net
-0000abe0: 776f 726b 732e 2068 7474 7073 3a2f 2f61  works. https://a
-0000abf0: 7278 6976 2e6f 7267 2f61 6273 2f31 3830  rxiv.org/abs/180
-0000ac00: 362e 3031 3236 3120 2832 3031 3829 0a20  6.01261 (2018). 
-0000ac10: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
-0000ac20: 696e 6974 5f5f 2873 656c 662c 0a20 2020  init__(self,.   
-0000ac30: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
-0000ac40: 6e6f 6465 5f66 6561 7475 7265 733a 2069  node_features: i
-0000ac50: 6e74 203d 2033 322c 0a20 2020 2020 2020  nt = 32,.       
-0000ac60: 2020 2020 2020 2020 2020 6e5f 6564 6765            n_edge
-0000ac70: 5f66 6561 7475 7265 733a 2069 6e74 203d  _features: int =
-0000ac80: 2033 322c 0a20 2020 2020 2020 2020 2020   32,.           
-0000ac90: 2020 2020 2020 6e5f 676c 6f62 616c 5f66        n_global_f
-0000aca0: 6561 7475 7265 733a 2069 6e74 203d 2033  eatures: int = 3
-0000acb0: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
-0000acc0: 2020 2020 6973 5f75 6e64 6972 6563 7465      is_undirecte
-0000acd0: 643a 2062 6f6f 6c20 3d20 5472 7565 2c0a  d: bool = True,.
-0000ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acf0: 2072 6573 6964 7561 6c5f 636f 6e6e 6563   residual_connec
-0000ad00: 7469 6f6e 3a20 626f 6f6c 203d 2054 7275  tion: bool = Tru
-0000ad10: 6529 3a0a 2020 2020 2020 2020 7375 7065  e):.        supe
-0000ad20: 7228 292e 5f5f 696e 6974 5f5f 2829 0a20  r().__init__(). 
-0000ad30: 2020 2020 2020 2073 656c 662e 6e5f 6e6f         self.n_no
-0000ad40: 6465 5f66 6561 7475 7265 7320 3d20 6e5f  de_features = n_
-0000ad50: 6e6f 6465 5f66 6561 7475 7265 730a 2020  node_features.  
-0000ad60: 2020 2020 2020 7365 6c66 2e6e 5f65 6467        self.n_edg
-0000ad70: 655f 6665 6174 7572 6573 203d 206e 5f65  e_features = n_e
-0000ad80: 6467 655f 6665 6174 7572 6573 0a20 2020  dge_features.   
-0000ad90: 2020 2020 2073 656c 662e 6e5f 676c 6f62       self.n_glob
-0000ada0: 616c 5f66 6561 7475 7265 7320 3d20 6e5f  al_features = n_
-0000adb0: 676c 6f62 616c 5f66 6561 7475 7265 730a  global_features.
-0000adc0: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
-0000add0: 756e 6469 7265 6374 6564 203d 2069 735f  undirected = is_
-0000ade0: 756e 6469 7265 6374 6564 0a20 2020 2020  undirected.     
-0000adf0: 2020 2073 656c 662e 7265 7369 6475 616c     self.residual
-0000ae00: 5f63 6f6e 6e65 6374 696f 6e20 3d20 7265  _connection = re
-0000ae10: 7369 6475 616c 5f63 6f6e 6e65 6374 696f  sidual_connectio
-0000ae20: 6e0a 0a20 2020 2020 2020 2073 656c 662e  n..        self.
-0000ae30: 6564 6765 5f6d 6f64 656c 732c 2073 656c  edge_models, sel
-0000ae40: 662e 6e6f 6465 5f6d 6f64 656c 732c 2073  f.node_models, s
-0000ae50: 656c 662e 676c 6f62 616c 5f6d 6f64 656c  elf.global_model
-0000ae60: 7320 3d20 746f 7263 682e 6e6e 2e4d 6f64  s = torch.nn.Mod
-0000ae70: 756c 654c 6973 7428 0a20 2020 2020 2020  uleList(.       
-0000ae80: 2029 2c20 746f 7263 682e 6e6e 2e4d 6f64   ), torch.nn.Mod
-0000ae90: 756c 654c 6973 7428 292c 2074 6f72 6368  uleList(), torch
-0000aea0: 2e6e 6e2e 4d6f 6475 6c65 4c69 7374 2829  .nn.ModuleList()
-0000aeb0: 0a20 2020 2020 2020 2073 656c 662e 6564  .        self.ed
-0000aec0: 6765 5f6d 6f64 656c 732e 6170 7065 6e64  ge_models.append
-0000aed0: 280a 2020 2020 2020 2020 2020 2020 6e6e  (.            nn
-0000aee0: 2e4c 696e 6561 7228 696e 5f66 6561 7475  .Linear(in_featu
-0000aef0: 7265 733d 6e5f 6e6f 6465 5f66 6561 7475  res=n_node_featu
-0000af00: 7265 7320 2a20 3220 2b20 6e5f 6564 6765  res * 2 + n_edge
-0000af10: 5f66 6561 7475 7265 7320 2b0a 2020 2020  _features +.    
-0000af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af30: 2020 6e5f 676c 6f62 616c 5f66 6561 7475    n_global_featu
-0000af40: 7265 732c 0a20 2020 2020 2020 2020 2020  res,.           
-0000af50: 2020 2020 2020 2020 2020 206f 7574 5f66             out_f
-0000af60: 6561 7475 7265 733d 3332 2929 0a20 2020  eatures=32)).   
-0000af70: 2020 2020 2073 656c 662e 6e6f 6465 5f6d       self.node_m
-0000af80: 6f64 656c 732e 6170 7065 6e64 280a 2020  odels.append(.  
-0000af90: 2020 2020 2020 2020 2020 6e6e 2e4c 696e            nn.Lin
-0000afa0: 6561 7228 696e 5f66 6561 7475 7265 733d  ear(in_features=
-0000afb0: 6e5f 6e6f 6465 5f66 6561 7475 7265 7320  n_node_features 
-0000afc0: 2b20 6e5f 6564 6765 5f66 6561 7475 7265  + n_edge_feature
-0000afd0: 7320 2b0a 2020 2020 2020 2020 2020 2020  s +.            
-0000afe0: 2020 2020 2020 2020 2020 6e5f 676c 6f62            n_glob
-0000aff0: 616c 5f66 6561 7475 7265 732c 0a20 2020  al_features,.   
-0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b010: 2020 206f 7574 5f66 6561 7475 7265 733d     out_features=
-0000b020: 3332 2929 0a20 2020 2020 2020 2073 656c  32)).        sel
-0000b030: 662e 676c 6f62 616c 5f6d 6f64 656c 732e  f.global_models.
-0000b040: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
-0000b050: 2020 2020 6e6e 2e4c 696e 6561 7228 696e      nn.Linear(in
-0000b060: 5f66 6561 7475 7265 733d 6e5f 6e6f 6465  _features=n_node
-0000b070: 5f66 6561 7475 7265 7320 2b20 6e5f 6564  _features + n_ed
-0000b080: 6765 5f66 6561 7475 7265 7320 2b0a 2020  ge_features +.  
-0000b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0a0: 2020 2020 6e5f 676c 6f62 616c 5f66 6561      n_global_fea
-0000b0b0: 7475 7265 732c 0a20 2020 2020 2020 2020  tures,.         
-0000b0c0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-0000b0d0: 5f66 6561 7475 7265 733d 3332 2929 0a0a  _features=32))..
-0000b0e0: 2020 2020 2020 2020 2320 5573 6564 2066          # Used f
-0000b0f0: 6f72 2063 6f6e 7665 7274 696e 6720 6564  or converting ed
-0000b100: 6765 7320 6261 636b 2074 6f20 7468 6569  ges back to thei
-0000b110: 7220 6f72 6967 696e 616c 2073 6861 7065  r original shape
-0000b120: 0a20 2020 2020 2020 2073 656c 662e 6564  .        self.ed
-0000b130: 6765 5f64 656e 7365 203d 206e 6e2e 4c69  ge_dense = nn.Li
-0000b140: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
-0000b150: 3d33 322c 0a20 2020 2020 2020 2020 2020  =32,.           
-0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b170: 2020 2020 2020 2020 206f 7574 5f66 6561           out_fea
-0000b180: 7475 7265 733d 6e5f 6564 6765 5f66 6561  tures=n_edge_fea
-0000b190: 7475 7265 7329 0a20 2020 2020 2020 2073  tures).        s
-0000b1a0: 656c 662e 6e6f 6465 5f64 656e 7365 203d  elf.node_dense =
-0000b1b0: 206e 6e2e 4c69 6e65 6172 2869 6e5f 6665   nn.Linear(in_fe
-0000b1c0: 6174 7572 6573 3d33 322c 0a20 2020 2020  atures=32,.     
-0000b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000b1f0: 7574 5f66 6561 7475 7265 733d 6e5f 6e6f  ut_features=n_no
-0000b200: 6465 5f66 6561 7475 7265 7329 0a20 2020  de_features).   
-0000b210: 2020 2020 2073 656c 662e 676c 6f62 616c       self.global
-0000b220: 5f64 656e 7365 203d 206e 6e2e 4c69 6e65  _dense = nn.Line
-0000b230: 6172 2869 6e5f 6665 6174 7572 6573 3d33  ar(in_features=3
-0000b240: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
+00007690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076a0: 2020 2020 2020 6469 7374 616e 6365 5f6d        distance_m
+000076b0: 6174 7269 783d 6469 7374 616e 6365 5f6d  atrix=distance_m
+000076c0: 6174 7269 7829 290a 2020 2020 2020 2020  atrix)).        
+000076d0: 7265 7475 726e 2073 656c 662e 7375 626c  return self.subl
+000076e0: 6179 6572 5b31 5d28 782c 2073 656c 662e  ayer[1](x, self.
+000076f0: 6665 6564 5f66 6f72 7761 7264 2878 2929  feed_forward(x))
+00007700: 0a0a 0a63 6c61 7373 2053 7562 6c61 7965  ...class Sublaye
+00007710: 7243 6f6e 6e65 6374 696f 6e28 6e6e 2e4d  rConnection(nn.M
+00007720: 6f64 756c 6529 3a0a 2020 2020 2222 2253  odule):.    """S
+00007730: 7562 6c61 7965 7243 6f6e 6e65 6374 696f  ublayerConnectio
+00007740: 6e20 6c61 7965 7220 6261 7365 6420 6f6e  n layer based on
+00007750: 2074 6865 2070 6170 6572 2060 4174 7465   the paper `Atte
+00007760: 6e74 696f 6e20 4973 2041 6c6c 2059 6f75  ntion Is All You
+00007770: 204e 6565 6420 3c68 7474 7073 3a2f 2f61   Need <https://a
+00007780: 7278 6976 2e6f 7267 2f61 6273 2f31 3730  rxiv.org/abs/170
+00007790: 362e 3033 3736 323e 605f 2e0a 0a20 2020  6.03762>`_...   
+000077a0: 2054 6865 2053 7562 6c61 7965 7243 6f6e   The SublayerCon
+000077b0: 6e65 6374 696f 6e20 6e6f 726d 616c 697a  nection normaliz
+000077c0: 6573 2061 6e64 2061 6464 7320 6472 6f70  es and adds drop
+000077d0: 6f75 7420 746f 206f 7574 7075 7420 7465  out to output te
+000077e0: 6e73 6f72 206f 6620 616e 2061 7262 6974  nsor of an arbit
+000077f0: 6172 7920 6c61 7965 722e 0a20 2020 2049  ary layer..    I
+00007800: 7420 6675 7274 6865 7220 6164 6473 2061  t further adds a
+00007810: 2072 6573 6964 7561 6c20 6c61 7965 7220   residual layer 
+00007820: 636f 6e6e 6563 7469 6f6e 2062 6574 7765  connection betwe
+00007830: 656e 2074 6865 2069 6e70 7574 206f 6620  en the input of 
+00007840: 7468 6520 6172 6269 7461 7279 206c 6179  the arbitary lay
+00007850: 6572 2061 6e64 2074 6865 2064 726f 706f  er and the dropo
+00007860: 7574 2d61 646a 7573 7465 6420 6c61 7965  ut-adjusted laye
+00007870: 7220 6f75 7470 7574 2e0a 0a20 2020 2045  r output...    E
+00007880: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
+00007890: 2d2d 2d2d 0a20 2020 203e 3e3e 2066 726f  ----.    >>> fro
+000078a0: 6d20 6465 6570 6368 656d 2e6d 6f64 656c  m deepchem.model
+000078b0: 732e 746f 7263 685f 6d6f 6465 6c73 2e6c  s.torch_models.l
+000078c0: 6179 6572 7320 696d 706f 7274 2053 7562  ayers import Sub
+000078d0: 6c61 7965 7243 6f6e 6e65 6374 696f 6e0a  layerConnection.
+000078e0: 2020 2020 3e3e 3e20 7363 616c 6520 3d20      >>> scale = 
+000078f0: 302e 3335 0a20 2020 203e 3e3e 206c 6179  0.35.    >>> lay
+00007900: 6572 203d 2053 7562 6c61 7965 7243 6f6e  er = SublayerCon
+00007910: 6e65 6374 696f 6e28 322c 2030 2e29 0a20  nection(2, 0.). 
+00007920: 2020 203e 3e3e 2069 6e70 7574 5f61 7220     >>> input_ar 
+00007930: 3d20 746f 7263 682e 7465 6e73 6f72 285b  = torch.tensor([
+00007940: 5b31 2e2c 2032 2e5d 2c20 5b35 2e2c 2036  [1., 2.], [5., 6
+00007950: 2e5d 5d29 0a20 2020 203e 3e3e 206f 7574  .]]).    >>> out
+00007960: 7075 7420 3d20 6c61 7965 7228 696e 7075  put = layer(inpu
+00007970: 745f 6172 2c20 696e 7075 745f 6172 290a  t_ar, input_ar).
+00007980: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00007990: 5f69 6e69 745f 5f28 7365 6c66 2c20 7369  _init__(self, si
+000079a0: 7a65 3a20 696e 742c 2064 726f 706f 7574  ze: int, dropout
+000079b0: 5f70 3a20 666c 6f61 7420 3d20 302e 3029  _p: float = 0.0)
+000079c0: 3a0a 2020 2020 2020 2020 2222 2249 6e69  :.        """Ini
+000079d0: 7469 616c 697a 6520 6120 5375 626c 6179  tialize a Sublay
+000079e0: 6572 436f 6e6e 6563 7469 6f6e 204c 6179  erConnection Lay
+000079f0: 6572 2e0a 0a20 2020 2020 2020 2050 6172  er...        Par
+00007a00: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+00007a10: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00007a20: 2020 2073 697a 653a 2069 6e74 0a20 2020     size: int.   
+00007a30: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
+00007a40: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+00007a50: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
+00007a60: 0a20 2020 2020 2020 2020 2020 2044 726f  .            Dro
+00007a70: 706f 7574 2070 726f 6261 6269 6c69 7479  pout probability
+00007a80: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00007a90: 2020 2020 2020 7375 7065 7228 5375 626c        super(Subl
+00007aa0: 6179 6572 436f 6e6e 6563 7469 6f6e 2c20  ayerConnection, 
+00007ab0: 7365 6c66 292e 5f5f 696e 6974 5f5f 2829  self).__init__()
+00007ac0: 0a20 2020 2020 2020 2073 656c 662e 6e6f  .        self.no
+00007ad0: 726d 203d 206e 6e2e 4c61 7965 724e 6f72  rm = nn.LayerNor
+00007ae0: 6d28 7369 7a65 290a 2020 2020 2020 2020  m(size).        
+00007af0: 7365 6c66 2e64 726f 706f 7574 5f70 203d  self.dropout_p =
+00007b00: 206e 6e2e 4472 6f70 6f75 7428 6472 6f70   nn.Dropout(drop
+00007b10: 6f75 745f 7029 0a0a 2020 2020 6465 6620  out_p)..    def 
+00007b20: 666f 7277 6172 6428 7365 6c66 2c20 783a  forward(self, x:
+00007b30: 2074 6f72 6368 2e54 656e 736f 722c 206f   torch.Tensor, o
+00007b40: 7574 7075 743a 2074 6f72 6368 2e54 656e  utput: torch.Ten
+00007b50: 736f 7229 202d 3e20 746f 7263 682e 5465  sor) -> torch.Te
+00007b60: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
+00007b70: 224f 7574 7075 7420 636f 6d70 7574 6174  "Output computat
+00007b80: 696f 6e20 666f 7220 7468 6520 5375 626c  ion for the Subl
+00007b90: 6179 6572 436f 6e6e 6563 7469 6f6e 206c  ayerConnection l
+00007ba0: 6179 6572 2e0a 0a20 2020 2020 2020 2054  ayer...        T
+00007bb0: 616b 6573 2061 6e20 696e 7075 7420 7465  akes an input te
+00007bc0: 6e73 6f72 2078 2c20 7468 656e 2061 6464  nsor x, then add
+00007bd0: 7320 7468 6520 6472 6f70 6f75 742d 6164  s the dropout-ad
+00007be0: 6a75 7374 6564 2073 7562 6c61 7965 7220  justed sublayer 
+00007bf0: 6f75 7470 7574 2066 6f72 206e 6f72 6d61  output for norma
+00007c00: 6c69 7a65 6420 7820 746f 2069 742e 0a20  lized x to it.. 
+00007c10: 2020 2020 2020 2054 6869 7320 6973 2064         This is d
+00007c20: 6f6e 6520 746f 2061 6464 2061 2072 6573  one to add a res
+00007c30: 6964 7561 6c20 636f 6e6e 6563 7469 6f6e  idual connection
+00007c40: 2066 6f6c 6c6f 7765 6420 6279 204c 6179   followed by Lay
+00007c50: 6572 4e6f 726d 2e0a 0a20 2020 2020 2020  erNorm...       
+00007c60: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00007c70: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00007c80: 2020 2020 2020 2078 3a20 746f 7263 682e         x: torch.
+00007c90: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00007ca0: 2020 2049 6e70 7574 2074 656e 736f 722e     Input tensor.
+00007cb0: 0a20 2020 2020 2020 206f 7574 7075 743a  .        output:
+00007cc0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+00007cd0: 2020 2020 2020 2020 2020 4c61 7965 7220            Layer 
+00007ce0: 7768 6f73 6520 6e6f 726d 616c 697a 6564  whose normalized
+00007cf0: 206f 7574 7075 7420 7769 6c6c 2062 6520   output will be 
+00007d00: 6164 6465 6420 746f 2078 2e0a 2020 2020  added to x..    
+00007d10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00007d20: 6966 2078 2069 7320 4e6f 6e65 3a0a 2020  if x is None:.  
+00007d30: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007d40: 2073 656c 662e 6472 6f70 6f75 745f 7028   self.dropout_p(
+00007d50: 7365 6c66 2e6e 6f72 6d28 6f75 7470 7574  self.norm(output
+00007d60: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
+00007d70: 6e20 7820 2b20 7365 6c66 2e64 726f 706f  n x + self.dropo
+00007d80: 7574 5f70 2873 656c 662e 6e6f 726d 286f  ut_p(self.norm(o
+00007d90: 7574 7075 7429 290a 0a0a 636c 6173 7320  utput))...class 
+00007da0: 506f 7369 7469 6f6e 7769 7365 4665 6564  PositionwiseFeed
+00007db0: 466f 7277 6172 6428 6e6e 2e4d 6f64 756c  Forward(nn.Modul
+00007dc0: 6529 3a0a 2020 2020 2222 2250 6f73 6974  e):.    """Posit
+00007dd0: 696f 6e77 6973 6546 6565 6446 6f72 7761  ionwiseFeedForwa
+00007de0: 7264 2069 7320 6120 6c61 7965 7220 7573  rd is a layer us
+00007df0: 6564 2074 6f20 6465 6669 6e65 2074 6865  ed to define the
+00007e00: 2070 6f73 6974 696f 6e2d 7769 7365 2066   position-wise f
+00007e10: 6565 642d 666f 7277 6172 6420 2846 464e  eed-forward (FFN
+00007e20: 2920 616c 676f 7269 7468 6d20 666f 7220  ) algorithm for 
+00007e30: 7468 6520 4d6f 6c65 6375 6c61 7220 4174  the Molecular At
+00007e40: 7465 6e74 696f 6e20 5472 616e 7366 6f72  tention Transfor
+00007e50: 6d65 7220 5b31 5d5f 0a0a 2020 2020 4561  mer [1]_..    Ea
+00007e60: 6368 206c 6179 6572 2069 6e20 7468 6520  ch layer in the 
+00007e70: 4d41 5420 656e 636f 6465 7220 636f 6e74  MAT encoder cont
+00007e80: 6169 6e73 2061 2066 756c 6c79 2063 6f6e  ains a fully con
+00007e90: 6e65 6374 6564 2066 6565 642d 666f 7277  nected feed-forw
+00007ea0: 6172 6420 6e65 7477 6f72 6b20 7768 6963  ard network whic
+00007eb0: 6820 6170 706c 6965 7320 7477 6f20 6c69  h applies two li
+00007ec0: 6e65 6172 2074 7261 6e73 666f 726d 6174  near transformat
+00007ed0: 696f 6e73 2061 6e64 2074 6865 2067 6976  ions and the giv
+00007ee0: 656e 2061 6374 6976 6174 696f 6e20 6675  en activation fu
+00007ef0: 6e63 7469 6f6e 2e0a 2020 2020 5468 6973  nction..    This
+00007f00: 2069 7320 646f 6e65 2069 6e20 6164 6469   is done in addi
+00007f10: 7469 6f6e 2074 6f20 7468 6520 5375 626c  tion to the Subl
+00007f20: 6179 6572 436f 6e6e 6563 7469 6f6e 206d  ayerConnection m
+00007f30: 6f64 756c 652e 0a0a 2020 2020 4e6f 7465  odule...    Note
+00007f40: 3a20 5468 6973 206d 6f64 6966 6965 6420  : This modified 
+00007f50: 7665 7273 696f 6e20 6f66 2060 506f 7369  version of `Posi
+00007f60: 7469 6f6e 7769 7365 4665 6564 466f 7277  tionwiseFeedForw
+00007f70: 6172 6460 2063 6c61 7373 2063 6f6e 7461  ard` class conta
+00007f80: 696e 7320 6064 726f 706f 7574 5f61 745f  ins `dropout_at_
+00007f90: 696e 7075 745f 6e6f 5f61 6374 6020 636f  input_no_act` co
+00007fa0: 6e64 6974 696f 6e20 746f 2066 6163 696c  ndition to facil
+00007fb0: 6974 6174 6520 6974 7320 7573 6520 696e  itate its use in
+00007fc0: 2064 6566 696e 696e 670a 2020 2020 2020   defining.      
+00007fd0: 2020 7468 6520 6665 6564 2d66 6f72 7761    the feed-forwa
+00007fe0: 7264 2028 4646 4e29 2061 6c67 6f72 6974  rd (FFN) algorit
+00007ff0: 686d 2066 6f72 2074 6865 2044 6972 6563  hm for the Direc
+00008000: 7465 6420 4d65 7373 6167 6520 5061 7373  ted Message Pass
+00008010: 696e 6720 4e65 7572 616c 204e 6574 776f  ing Neural Netwo
+00008020: 726b 2028 442d 4d50 4e4e 2920 5b32 5d5f  rk (D-MPNN) [2]_
+00008030: 0a0a 2020 2020 5265 6665 7265 6e63 6573  ..    References
+00008040: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+00008050: 2020 2020 2e2e 205b 315d 204c 756b 6173      .. [1] Lukas
+00008060: 7a20 4d61 7a69 6172 6b61 2065 7420 616c  z Maziarka et al
+00008070: 2e20 224d 6f6c 6563 756c 6520 4174 7465  . "Molecule Atte
+00008080: 6e74 696f 6e20 5472 616e 7366 6f72 6d65  ntion Transforme
+00008090: 7222 2047 7261 7068 2052 6570 7265 7365  r" Graph Represe
+000080a0: 6e74 6174 696f 6e20 4c65 6172 6e69 6e67  ntation Learning
+000080b0: 2077 6f72 6b73 686f 7020 616e 6420 4d61   workshop and Ma
+000080c0: 6368 696e 6520 4c65 6172 6e69 6e67 2061  chine Learning a
+000080d0: 6e64 2074 6865 2050 6879 7369 6361 6c20  nd the Physical 
+000080e0: 5363 6965 6e63 6573 2077 6f72 6b73 686f  Sciences worksho
+000080f0: 7020 6174 204e 6575 7249 5053 2032 3031  p at NeurIPS 201
+00008100: 392e 2032 3032 302e 2068 7474 7073 3a2f  9. 2020. https:/
+00008110: 2f61 7278 6976 2e6f 7267 2f61 6273 2f32  /arxiv.org/abs/2
+00008120: 3030 322e 3038 3236 340a 2020 2020 2e2e  002.08264.    ..
+00008130: 205b 325d 2041 6e61 6c79 7a69 6e67 204c   [2] Analyzing L
+00008140: 6561 726e 6564 204d 6f6c 6563 756c 6172  earned Molecular
+00008150: 2052 6570 7265 7365 6e74 6174 696f 6e73   Representations
+00008160: 2066 6f72 2050 726f 7065 7274 7920 5072   for Property Pr
+00008170: 6564 6963 7469 6f6e 2068 7474 7073 3a2f  ediction https:/
+00008180: 2f61 7278 6976 2e6f 7267 2f70 6466 2f31  /arxiv.org/pdf/1
+00008190: 3930 342e 3031 3536 312e 7064 660a 0a20  904.01561.pdf.. 
+000081a0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+000081b0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
+000081c0: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
+000081d0: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
+000081e0: 6c73 2e6c 6179 6572 7320 696d 706f 7274  ls.layers import
+000081f0: 2050 6f73 6974 696f 6e77 6973 6546 6565   PositionwiseFee
+00008200: 6446 6f72 7761 7264 0a20 2020 203e 3e3e  dForward.    >>>
+00008210: 2066 6565 645f 6677 645f 6c61 7965 7220   feed_fwd_layer 
+00008220: 3d20 506f 7369 7469 6f6e 7769 7365 4665  = PositionwiseFe
+00008230: 6564 466f 7277 6172 6428 645f 696e 7075  edForward(d_inpu
+00008240: 7420 3d20 322c 2064 5f68 6964 6465 6e20  t = 2, d_hidden 
+00008250: 3d20 322c 2064 5f6f 7574 7075 7420 3d20  = 2, d_output = 
+00008260: 322c 2061 6374 6976 6174 696f 6e20 3d20  2, activation = 
+00008270: 2772 656c 7527 2c20 6e5f 6c61 7965 7273  'relu', n_layers
+00008280: 203d 2031 2c20 6472 6f70 6f75 745f 7020   = 1, dropout_p 
+00008290: 3d20 302e 3129 0a20 2020 203e 3e3e 2069  = 0.1).    >>> i
+000082a0: 6e70 7574 5f74 656e 736f 7220 3d20 746f  nput_tensor = to
+000082b0: 7263 682e 7465 6e73 6f72 285b 5b31 2e2c  rch.tensor([[1.,
+000082c0: 2032 2e5d 2c20 5b35 2e2c 2036 2e5d 5d29   2.], [5., 6.]])
+000082d0: 0a20 2020 203e 3e3e 206f 7574 7075 745f  .    >>> output_
+000082e0: 7465 6e73 6f72 203d 2066 6565 645f 6677  tensor = feed_fw
+000082f0: 645f 6c61 7965 7228 696e 7075 745f 7465  d_layer(input_te
+00008300: 6e73 6f72 290a 2020 2222 220a 0a20 2020  nsor).  """..   
+00008310: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00008320: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00008330: 2020 2020 2064 5f69 6e70 7574 3a20 696e       d_input: in
+00008340: 7420 3d20 3130 3234 2c0a 2020 2020 2020  t = 1024,.      
+00008350: 2020 2020 2020 2020 2020 2064 5f68 6964             d_hid
+00008360: 6465 6e3a 2069 6e74 203d 2031 3032 342c  den: int = 1024,
+00008370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008380: 2020 645f 6f75 7470 7574 3a20 696e 7420    d_output: int 
+00008390: 3d20 3130 3234 2c0a 2020 2020 2020 2020  = 1024,.        
+000083a0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+000083b0: 696f 6e3a 2073 7472 203d 2027 6c65 616b  ion: str = 'leak
+000083c0: 7972 656c 7527 2c0a 2020 2020 2020 2020  yrelu',.        
+000083d0: 2020 2020 2020 2020 206e 5f6c 6179 6572           n_layer
+000083e0: 733a 2069 6e74 203d 2031 2c0a 2020 2020  s: int = 1,.    
+000083f0: 2020 2020 2020 2020 2020 2020 2064 726f               dro
+00008400: 706f 7574 5f70 3a20 666c 6f61 7420 3d20  pout_p: float = 
+00008410: 302e 302c 0a20 2020 2020 2020 2020 2020  0.0,.           
+00008420: 2020 2020 2020 6472 6f70 6f75 745f 6174        dropout_at
+00008430: 5f69 6e70 7574 5f6e 6f5f 6163 743a 2062  _input_no_act: b
+00008440: 6f6f 6c20 3d20 4661 6c73 6529 3a0a 2020  ool = False):.  
+00008450: 2020 2020 2020 2222 2249 6e69 7469 616c        """Initial
+00008460: 697a 6520 6120 506f 7369 7469 6f6e 7769  ize a Positionwi
+00008470: 7365 4665 6564 466f 7277 6172 6420 6c61  seFeedForward la
+00008480: 7965 722e 0a0a 2020 2020 2020 2020 5061  yer...        Pa
+00008490: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+000084a0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+000084b0: 2020 2020 645f 696e 7075 743a 2069 6e74      d_input: int
+000084c0: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
+000084d0: 6520 6f66 2069 6e70 7574 206c 6179 6572  e of input layer
+000084e0: 2e0a 2020 2020 2020 2020 645f 6869 6464  ..        d_hidd
+000084f0: 656e 3a20 696e 7420 2873 616d 6520 6173  en: int (same as
+00008500: 2064 5f69 6e70 7574 2069 6620 645f 6f75   d_input if d_ou
+00008510: 7470 7574 203d 2030 290a 2020 2020 2020  tput = 0).      
+00008520: 2020 2020 2020 5369 7a65 206f 6620 6869        Size of hi
+00008530: 6464 656e 206c 6179 6572 2e0a 2020 2020  dden layer..    
+00008540: 2020 2020 645f 6f75 7470 7574 3a20 696e      d_output: in
+00008550: 7420 2873 616d 6520 6173 2064 5f69 6e70  t (same as d_inp
+00008560: 7574 2069 6620 645f 6f75 7470 7574 203d  ut if d_output =
+00008570: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
+00008580: 5369 7a65 206f 6620 6f75 7470 7574 206c  Size of output l
+00008590: 6179 6572 2e0a 2020 2020 2020 2020 6163  ayer..        ac
+000085a0: 7469 7661 7469 6f6e 3a20 7374 720a 2020  tivation: str.  
+000085b0: 2020 2020 2020 2020 2020 4163 7469 7661            Activa
+000085c0: 7469 6f6e 2066 756e 6374 696f 6e20 746f  tion function to
+000085d0: 2062 6520 7573 6564 2e20 4361 6e20 6368   be used. Can ch
+000085e0: 6f6f 7365 2062 6574 7765 656e 2027 7265  oose between 're
+000085f0: 6c75 2720 666f 7220 5265 4c55 2c20 276c  lu' for ReLU, 'l
+00008600: 6561 6b79 7265 6c75 2720 666f 7220 4c65  eakyrelu' for Le
+00008610: 616b 7952 654c 552c 2027 7072 656c 7527  akyReLU, 'prelu'
+00008620: 2066 6f72 2050 5265 4c55 2c0a 2020 2020   for PReLU,.    
+00008630: 2020 2020 2020 2020 2774 616e 6827 2066          'tanh' f
+00008640: 6f72 2054 616e 482c 2027 7365 6c75 2720  or TanH, 'selu' 
+00008650: 666f 7220 5345 4c55 2c20 2765 6c75 2720  for SELU, 'elu' 
+00008660: 666f 7220 454c 5520 616e 6420 276c 696e  for ELU and 'lin
+00008670: 6561 7227 2066 6f72 206c 696e 6561 7220  ear' for linear 
+00008680: 6163 7469 7661 7469 6f6e 2e0a 2020 2020  activation..    
+00008690: 2020 2020 6e5f 6c61 7965 7273 3a20 696e      n_layers: in
+000086a0: 740a 2020 2020 2020 2020 2020 2020 4e75  t.            Nu
+000086b0: 6d62 6572 206f 6620 6c61 7965 7273 2e0a  mber of layers..
+000086c0: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
+000086d0: 703a 2066 6c6f 6174 0a20 2020 2020 2020  p: float.       
+000086e0: 2020 2020 2044 726f 706f 7574 2070 726f       Dropout pro
+000086f0: 6261 6269 6c69 7479 2e0a 2020 2020 2020  bability..      
+00008700: 2020 6472 6f70 6f75 745f 6174 5f69 6e70    dropout_at_inp
+00008710: 7574 5f6e 6f5f 6163 743a 2062 6f6f 6c0a  ut_no_act: bool.
+00008720: 2020 2020 2020 2020 2020 2020 4966 2074              If t
+00008730: 7275 652c 2064 726f 706f 7574 2069 7320  rue, dropout is 
+00008740: 6170 706c 6965 6420 6f6e 2074 6865 2069  applied on the i
+00008750: 6e70 7574 2074 656e 736f 722e 2046 6f72  nput tensor. For
+00008760: 2073 696e 676c 6520 6c61 7965 722c 2069   single layer, i
+00008770: 7420 6973 206e 6f74 2070 6173 7365 6420  t is not passed 
+00008780: 746f 2061 6e20 6163 7469 7661 7469 6f6e  to an activation
+00008790: 2066 756e 6374 696f 6e2e 0a20 2020 2020   function..     
+000087a0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+000087b0: 7570 6572 2850 6f73 6974 696f 6e77 6973  uper(Positionwis
+000087c0: 6546 6565 6446 6f72 7761 7264 2c20 7365  eFeedForward, se
+000087d0: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a0a  lf).__init__()..
+000087e0: 2020 2020 2020 2020 7365 6c66 2e64 726f          self.dro
+000087f0: 706f 7574 5f61 745f 696e 7075 745f 6e6f  pout_at_input_no
+00008800: 5f61 6374 3a20 626f 6f6c 203d 2064 726f  _act: bool = dro
+00008810: 706f 7574 5f61 745f 696e 7075 745f 6e6f  pout_at_input_no
+00008820: 5f61 6374 0a0a 2020 2020 2020 2020 6966  _act..        if
+00008830: 2061 6374 6976 6174 696f 6e20 3d3d 2027   activation == '
+00008840: 7265 6c75 273a 0a20 2020 2020 2020 2020  relu':.         
+00008850: 2020 2073 656c 662e 6163 7469 7661 7469     self.activati
+00008860: 6f6e 3a20 416e 7920 3d20 6e6e 2e52 654c  on: Any = nn.ReL
+00008870: 5528 290a 0a20 2020 2020 2020 2065 6c69  U()..        eli
+00008880: 6620 6163 7469 7661 7469 6f6e 203d 3d20  f activation == 
+00008890: 276c 6561 6b79 7265 6c75 273a 0a20 2020  'leakyrelu':.   
+000088a0: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
+000088b0: 7469 7661 7469 6f6e 203d 206e 6e2e 4c65  tivation = nn.Le
+000088c0: 616b 7952 654c 5528 302e 3129 0a0a 2020  akyReLU(0.1)..  
+000088d0: 2020 2020 2020 656c 6966 2061 6374 6976        elif activ
+000088e0: 6174 696f 6e20 3d3d 2027 7072 656c 7527  ation == 'prelu'
+000088f0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00008900: 6c66 2e61 6374 6976 6174 696f 6e20 3d20  lf.activation = 
+00008910: 6e6e 2e50 5265 4c55 2829 0a0a 2020 2020  nn.PReLU()..    
+00008920: 2020 2020 656c 6966 2061 6374 6976 6174      elif activat
+00008930: 696f 6e20 3d3d 2027 7461 6e68 273a 0a20  ion == 'tanh':. 
+00008940: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008950: 6163 7469 7661 7469 6f6e 203d 206e 6e2e  activation = nn.
+00008960: 5461 6e68 2829 0a0a 2020 2020 2020 2020  Tanh()..        
+00008970: 656c 6966 2061 6374 6976 6174 696f 6e20  elif activation 
+00008980: 3d3d 2027 7365 6c75 273a 0a20 2020 2020  == 'selu':.     
+00008990: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
+000089a0: 7661 7469 6f6e 203d 206e 6e2e 5345 4c55  vation = nn.SELU
+000089b0: 2829 0a0a 2020 2020 2020 2020 656c 6966  ()..        elif
+000089c0: 2061 6374 6976 6174 696f 6e20 3d3d 2027   activation == '
+000089d0: 656c 7527 3a0a 2020 2020 2020 2020 2020  elu':.          
+000089e0: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
+000089f0: 6e20 3d20 6e6e 2e45 4c55 2829 0a0a 2020  n = nn.ELU()..  
+00008a00: 2020 2020 2020 656c 6966 2061 6374 6976        elif activ
+00008a10: 6174 696f 6e20 3d3d 2022 6c69 6e65 6172  ation == "linear
+00008a20: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
+00008a30: 656c 662e 6163 7469 7661 7469 6f6e 203d  elf.activation =
+00008a40: 206c 616d 6264 6120 783a 2078 0a0a 2020   lambda x: x..  
+00008a50: 2020 2020 2020 7365 6c66 2e6e 5f6c 6179        self.n_lay
+00008a60: 6572 733a 2069 6e74 203d 206e 5f6c 6179  ers: int = n_lay
+00008a70: 6572 730a 2020 2020 2020 2020 645f 6f75  ers.        d_ou
+00008a80: 7470 7574 203d 2064 5f6f 7574 7075 7420  tput = d_output 
+00008a90: 6966 2064 5f6f 7574 7075 7420 213d 2030  if d_output != 0
+00008aa0: 2065 6c73 6520 645f 696e 7075 740a 2020   else d_input.  
+00008ab0: 2020 2020 2020 645f 6869 6464 656e 203d        d_hidden =
+00008ac0: 2064 5f68 6964 6465 6e20 6966 2064 5f68   d_hidden if d_h
+00008ad0: 6964 6465 6e20 213d 2030 2065 6c73 6520  idden != 0 else 
+00008ae0: 645f 696e 7075 740a 0a20 2020 2020 2020  d_input..       
+00008af0: 2069 6620 6e5f 6c61 7965 7273 203d 3d20   if n_layers == 
+00008b00: 313a 0a20 2020 2020 2020 2020 2020 2073  1:.            s
+00008b10: 656c 662e 6c69 6e65 6172 733a 2041 6e79  elf.linears: Any
+00008b20: 203d 205b 6e6e 2e4c 696e 6561 7228 645f   = [nn.Linear(d_
+00008b30: 696e 7075 742c 2064 5f6f 7574 7075 7429  input, d_output)
+00008b40: 5d0a 0a20 2020 2020 2020 2065 6c73 653a  ]..        else:
+00008b50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008b60: 662e 6c69 6e65 6172 7320 3d20 5b6e 6e2e  f.linears = [nn.
+00008b70: 4c69 6e65 6172 2864 5f69 6e70 7574 2c20  Linear(d_input, 
+00008b80: 645f 6869 6464 656e 295d 202b 205c 0a20  d_hidden)] + \. 
+00008b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ba0: 2020 2020 2020 2020 2020 205b 6e6e 2e4c             [nn.L
+00008bb0: 696e 6561 7228 645f 6869 6464 656e 2c20  inear(d_hidden, 
+00008bc0: 645f 6869 6464 656e 2920 666f 7220 5f20  d_hidden) for _ 
+00008bd0: 696e 2072 616e 6765 286e 5f6c 6179 6572  in range(n_layer
+00008be0: 7320 2d20 3229 5d20 2b20 5c0a 2020 2020  s - 2)] + \.    
+00008bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c00: 2020 2020 2020 2020 5b6e 6e2e 4c69 6e65          [nn.Line
+00008c10: 6172 2864 5f68 6964 6465 6e2c 2064 5f6f  ar(d_hidden, d_o
+00008c20: 7574 7075 7429 5d0a 0a20 2020 2020 2020  utput)]..       
+00008c30: 2073 656c 662e 6c69 6e65 6172 7320 3d20   self.linears = 
+00008c40: 6e6e 2e4d 6f64 756c 654c 6973 7428 7365  nn.ModuleList(se
+00008c50: 6c66 2e6c 696e 6561 7273 290a 2020 2020  lf.linears).    
+00008c60: 2020 2020 6472 6f70 6f75 745f 6c61 7965      dropout_laye
+00008c70: 7220 3d20 6e6e 2e44 726f 706f 7574 2864  r = nn.Dropout(d
+00008c80: 726f 706f 7574 5f70 290a 2020 2020 2020  ropout_p).      
+00008c90: 2020 7365 6c66 2e64 726f 706f 7574 5f70    self.dropout_p
+00008ca0: 203d 206e 6e2e 4d6f 6475 6c65 4c69 7374   = nn.ModuleList
+00008cb0: 285b 6472 6f70 6f75 745f 6c61 7965 7220  ([dropout_layer 
+00008cc0: 666f 7220 5f20 696e 2072 616e 6765 286e  for _ in range(n
+00008cd0: 5f6c 6179 6572 7329 5d29 0a0a 2020 2020  _layers)])..    
+00008ce0: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
+00008cf0: 2c20 783a 2074 6f72 6368 2e54 656e 736f  , x: torch.Tenso
+00008d00: 7229 202d 3e20 746f 7263 682e 5465 6e73  r) -> torch.Tens
+00008d10: 6f72 3a0a 2020 2020 2020 2020 2222 224f  or:.        """O
+00008d20: 7574 7075 7420 436f 6d70 7574 6174 696f  utput Computatio
+00008d30: 6e20 666f 7220 7468 6520 506f 7369 7469  n for the Positi
+00008d40: 6f6e 7769 7365 4665 6564 466f 7277 6172  onwiseFeedForwar
+00008d50: 6420 6c61 7965 722e 0a0a 2020 2020 2020  d layer...      
+00008d60: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00008d70: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00008d80: 2020 2020 2020 2020 783a 2074 6f72 6368          x: torch
+00008d90: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+00008da0: 2020 2020 496e 7075 7420 7465 6e73 6f72      Input tensor
+00008db0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00008dc0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00008dd0: 662e 6e5f 6c61 7965 7273 3a0a 2020 2020  f.n_layers:.    
+00008de0: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+00008df0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00008e00: 662e 6e5f 6c61 7965 7273 203d 3d20 313a  f.n_layers == 1:
+00008e10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00008e20: 7365 6c66 2e64 726f 706f 7574 5f61 745f  self.dropout_at_
+00008e30: 696e 7075 745f 6e6f 5f61 6374 3a0a 2020  input_no_act:.  
+00008e40: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00008e50: 7475 726e 2073 656c 662e 6c69 6e65 6172  turn self.linear
+00008e60: 735b 305d 2873 656c 662e 6472 6f70 6f75  s[0](self.dropou
+00008e70: 745f 705b 305d 2878 2929 0a20 2020 2020  t_p[0](x)).     
+00008e80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00008e90: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00008ea0: 7572 6e20 7365 6c66 2e64 726f 706f 7574  urn self.dropout
+00008eb0: 5f70 5b30 5d28 7365 6c66 2e61 6374 6976  _p[0](self.activ
+00008ec0: 6174 696f 6e28 7365 6c66 2e6c 696e 6561  ation(self.linea
+00008ed0: 7273 5b30 5d28 7829 2929 0a0a 2020 2020  rs[0](x)))..    
+00008ee0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00008ef0: 2020 2020 2020 6966 2073 656c 662e 6472        if self.dr
+00008f00: 6f70 6f75 745f 6174 5f69 6e70 7574 5f6e  opout_at_input_n
+00008f10: 6f5f 6163 743a 0a20 2020 2020 2020 2020  o_act:.         
+00008f20: 2020 2020 2020 2078 203d 2073 656c 662e         x = self.
+00008f30: 6472 6f70 6f75 745f 705b 305d 2878 290a  dropout_p[0](x).
+00008f40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00008f50: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
+00008f60: 6e5f 6c61 7965 7273 202d 2031 293a 0a20  n_layers - 1):. 
+00008f70: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00008f80: 203d 2073 656c 662e 6472 6f70 6f75 745f   = self.dropout_
+00008f90: 705b 695d 2873 656c 662e 6163 7469 7661  p[i](self.activa
+00008fa0: 7469 6f6e 2873 656c 662e 6c69 6e65 6172  tion(self.linear
+00008fb0: 735b 695d 2878 2929 290a 2020 2020 2020  s[i](x))).      
+00008fc0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00008fd0: 662e 6c69 6e65 6172 735b 2d31 5d28 7829  f.linears[-1](x)
+00008fe0: 0a0a 0a63 6c61 7373 204d 4154 456d 6265  ...class MATEmbe
+00008ff0: 6464 696e 6728 6e6e 2e4d 6f64 756c 6529  dding(nn.Module)
+00009000: 3a0a 2020 2020 2222 2245 6d62 6564 6469  :.    """Embeddi
+00009010: 6e67 206c 6179 6572 2074 6f20 6372 6561  ng layer to crea
+00009020: 7465 2065 6d62 6564 6469 6e67 2066 6f72  te embedding for
+00009030: 2069 6e70 7574 732e 0a0a 2020 2020 496e   inputs...    In
+00009040: 2061 6e20 656d 6265 6464 696e 6720 6c61   an embedding la
+00009050: 7965 722c 2069 6e70 7574 2069 7320 7461  yer, input is ta
+00009060: 6b65 6e20 616e 6420 636f 6e76 6572 7465  ken and converte
+00009070: 6420 746f 2061 2076 6563 746f 7220 7265  d to a vector re
+00009080: 7072 6573 656e 7461 7469 6f6e 2066 6f72  presentation for
+00009090: 2065 6163 6820 696e 7075 742e 0a20 2020   each input..   
+000090a0: 2049 6e20 7468 6520 4d41 5445 6d62 6564   In the MATEmbed
+000090b0: 6469 6e67 206c 6179 6572 2c20 616e 2069  ding layer, an i
+000090c0: 6e70 7574 2074 656e 736f 7220 6973 2070  nput tensor is p
+000090d0: 726f 6365 7373 6564 2074 6872 6f75 6768  rocessed through
+000090e0: 2061 2064 726f 706f 7574 2d61 646a 7573   a dropout-adjus
+000090f0: 7465 6420 6c69 6e65 6172 206c 6179 6572  ted linear layer
+00009100: 2061 6e64 2074 6865 2072 6573 756c 7461   and the resulta
+00009110: 6e74 2076 6563 746f 7220 6973 2072 6574  nt vector is ret
+00009120: 7572 6e65 642e 0a0a 2020 2020 5265 6665  urned...    Refe
+00009130: 7265 6e63 6573 0a20 2020 202d 2d2d 2d2d  rences.    -----
+00009140: 2d2d 2d2d 2d0a 2020 2020 2e2e 205b 315d  -----.    .. [1]
+00009150: 204c 756b 6173 7a20 4d61 7a69 6172 6b61   Lukasz Maziarka
+00009160: 2065 7420 616c 2e20 224d 6f6c 6563 756c   et al. "Molecul
+00009170: 6520 4174 7465 6e74 696f 6e20 5472 616e  e Attention Tran
+00009180: 7366 6f72 6d65 7222 2047 7261 7068 2052  sformer" Graph R
+00009190: 6570 7265 7365 6e74 6174 696f 6e20 4c65  epresentation Le
+000091a0: 6172 6e69 6e67 2077 6f72 6b73 686f 7020  arning workshop 
+000091b0: 616e 6420 4d61 6368 696e 6520 4c65 6172  and Machine Lear
+000091c0: 6e69 6e67 2061 6e64 2074 6865 2050 6879  ning and the Phy
+000091d0: 7369 6361 6c20 5363 6965 6e63 6573 2077  sical Sciences w
+000091e0: 6f72 6b73 686f 7020 6174 204e 6575 7249  orkshop at NeurI
+000091f0: 5053 2032 3031 392e 2032 3032 302e 2068  PS 2019. 2020. h
+00009200: 7474 7073 3a2f 2f61 7278 6976 2e6f 7267  ttps://arxiv.org
+00009210: 2f61 6273 2f32 3030 322e 3038 3236 340a  /abs/2002.08264.
+00009220: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+00009230: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
+00009240: 3e3e 2066 726f 6d20 6465 6570 6368 656d  >> from deepchem
+00009250: 2e6d 6f64 656c 732e 746f 7263 685f 6d6f  .models.torch_mo
+00009260: 6465 6c73 2e6c 6179 6572 7320 696d 706f  dels.layers impo
+00009270: 7274 204d 4154 456d 6265 6464 696e 670a  rt MATEmbedding.
+00009280: 2020 2020 3e3e 3e20 6c61 7965 7220 3d20      >>> layer = 
+00009290: 4d41 5445 6d62 6564 6469 6e67 2864 5f69  MATEmbedding(d_i
+000092a0: 6e70 7574 203d 2033 2c20 645f 6f75 7470  nput = 3, d_outp
+000092b0: 7574 203d 2033 2c20 6472 6f70 6f75 745f  ut = 3, dropout_
+000092c0: 7020 3d20 302e 3229 0a20 2020 203e 3e3e  p = 0.2).    >>>
+000092d0: 2069 6e70 7574 5f74 656e 736f 7220 3d20   input_tensor = 
+000092e0: 746f 7263 682e 7465 6e73 6f72 285b 312e  torch.tensor([1.
+000092f0: 2c20 322e 2c20 332e 5d29 0a20 2020 203e  , 2., 3.]).    >
+00009300: 3e3e 206f 7574 7075 7420 3d20 6c61 7965  >> output = laye
+00009310: 7228 696e 7075 745f 7465 6e73 6f72 290a  r(input_tensor).
+00009320: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00009330: 205f 5f69 6e69 745f 5f28 7365 6c66 2c0a   __init__(self,.
+00009340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009350: 2064 5f69 6e70 7574 3a20 696e 7420 3d20   d_input: int = 
+00009360: 3336 2c0a 2020 2020 2020 2020 2020 2020  36,.            
+00009370: 2020 2020 2064 5f6f 7574 7075 743a 2069       d_output: i
+00009380: 6e74 203d 2031 3032 342c 0a20 2020 2020  nt = 1024,.     
+00009390: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
+000093a0: 6f75 745f 703a 2066 6c6f 6174 203d 2030  out_p: float = 0
+000093b0: 2e30 293a 0a20 2020 2020 2020 2022 2222  .0):.        """
+000093c0: 496e 6974 6961 6c69 7a65 2061 204d 4154  Initialize a MAT
+000093d0: 456d 6265 6464 696e 6720 6c61 7965 722e  Embedding layer.
+000093e0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+000093f0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+00009400: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00009410: 645f 696e 7075 743a 2069 6e74 0a20 2020  d_input: int.   
+00009420: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
+00009430: 2069 6e70 7574 206c 6179 6572 2e0a 2020   input layer..  
+00009440: 2020 2020 2020 645f 6f75 7470 7574 3a20        d_output: 
+00009450: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00009460: 5369 7a65 206f 6620 6f75 7470 7574 206c  Size of output l
+00009470: 6179 6572 2e0a 2020 2020 2020 2020 6472  ayer..        dr
+00009480: 6f70 6f75 745f 703a 2066 6c6f 6174 0a20  opout_p: float. 
+00009490: 2020 2020 2020 2020 2020 2044 726f 706f             Dropo
+000094a0: 7574 2070 726f 6261 6269 6c69 7479 2066  ut probability f
+000094b0: 6f72 206c 6179 6572 2e0a 2020 2020 2020  or layer..      
+000094c0: 2020 2222 220a 2020 2020 2020 2020 7375    """.        su
+000094d0: 7065 7228 4d41 5445 6d62 6564 6469 6e67  per(MATEmbedding
+000094e0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
+000094f0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+00009500: 6c69 6e65 6172 5f75 6e69 7420 3d20 6e6e  linear_unit = nn
+00009510: 2e4c 696e 6561 7228 645f 696e 7075 742c  .Linear(d_input,
+00009520: 2064 5f6f 7574 7075 7429 0a20 2020 2020   d_output).     
+00009530: 2020 2073 656c 662e 6472 6f70 6f75 7420     self.dropout 
+00009540: 3d20 6e6e 2e44 726f 706f 7574 2864 726f  = nn.Dropout(dro
+00009550: 706f 7574 5f70 290a 0a20 2020 2064 6566  pout_p)..    def
+00009560: 2066 6f72 7761 7264 2873 656c 662c 2078   forward(self, x
+00009570: 3a20 746f 7263 682e 5465 6e73 6f72 2920  : torch.Tensor) 
+00009580: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
+00009590: 0a20 2020 2020 2020 2022 2222 436f 6d70  .        """Comp
+000095a0: 7574 6174 696f 6e20 666f 7220 7468 6520  utation for the 
+000095b0: 4d41 5445 6d62 6564 6469 6e67 206c 6179  MATEmbedding lay
+000095c0: 6572 2e0a 0a20 2020 2020 2020 2050 6172  er...        Par
+000095d0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+000095e0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+000095f0: 2020 2078 3a20 746f 7263 682e 5465 6e73     x: torch.Tens
+00009600: 6f72 0a20 2020 2020 2020 2020 2020 2049  or.            I
+00009610: 6e70 7574 2074 656e 736f 7220 746f 2062  nput tensor to b
+00009620: 6520 636f 6e76 6572 7465 6420 696e 746f  e converted into
+00009630: 2061 2076 6563 746f 722e 0a20 2020 2020   a vector..     
+00009640: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00009650: 6574 7572 6e20 7365 6c66 2e64 726f 706f  eturn self.dropo
+00009660: 7574 2873 656c 662e 6c69 6e65 6172 5f75  ut(self.linear_u
+00009670: 6e69 7428 7829 290a 0a0a 636c 6173 7320  nit(x))...class 
+00009680: 4d41 5447 656e 6572 6174 6f72 286e 6e2e  MATGenerator(nn.
+00009690: 4d6f 6475 6c65 293a 0a20 2020 2022 2222  Module):.    """
+000096a0: 4d41 5447 656e 6572 6174 6f72 2064 6566  MATGenerator def
+000096b0: 696e 6573 2074 6865 206c 696e 6561 7220  ines the linear 
+000096c0: 616e 6420 736f 6674 6d61 7820 6765 6e65  and softmax gene
+000096d0: 7261 746f 7220 7374 6570 2066 6f72 2074  rator step for t
+000096e0: 6865 204d 6f6c 6563 756c 6172 2041 7474  he Molecular Att
+000096f0: 656e 7469 6f6e 2054 7261 6e73 666f 726d  ention Transform
+00009700: 6572 205b 315d 5f2e 0a0a 2020 2020 496e  er [1]_...    In
+00009710: 2074 6865 204d 4154 4765 6e65 7261 746f   the MATGenerato
+00009720: 722c 2061 2047 656e 6572 6174 6f72 2069  r, a Generator i
+00009730: 7320 6465 6669 6e65 6420 7768 6963 6820  s defined which 
+00009740: 7065 7266 6f72 6d73 2074 6865 204c 696e  performs the Lin
+00009750: 6561 7220 2b20 536f 6674 6d61 7820 6765  ear + Softmax ge
+00009760: 6e65 7261 7469 6f6e 2073 7465 702e 0a20  neration step.. 
+00009770: 2020 2044 6570 656e 6469 6e67 206f 6e20     Depending on 
+00009780: 7468 6520 7479 7065 206f 6620 6167 6772  the type of aggr
+00009790: 6567 6174 696f 6e20 7365 6c65 6374 6564  egation selected
+000097a0: 2c20 7468 6520 6174 7465 6e74 696f 6e20  , the attention 
+000097b0: 6f75 7470 7574 206c 6179 6572 2070 6572  output layer per
+000097c0: 666f 726d 7320 6469 6666 6572 656e 7420  forms different 
+000097d0: 6f70 6572 6174 696f 6e73 2e0a 0a20 2020  operations...   
+000097e0: 2052 6566 6572 656e 6365 730a 2020 2020   References.    
+000097f0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 202e  ----------.    .
+00009800: 2e20 5b31 5d20 4c75 6b61 737a 204d 617a  . [1] Lukasz Maz
+00009810: 6961 726b 6120 6574 2061 6c2e 2022 4d6f  iarka et al. "Mo
+00009820: 6c65 6375 6c65 2041 7474 656e 7469 6f6e  lecule Attention
+00009830: 2054 7261 6e73 666f 726d 6572 2220 4772   Transformer" Gr
+00009840: 6170 6820 5265 7072 6573 656e 7461 7469  aph Representati
+00009850: 6f6e 204c 6561 726e 696e 6720 776f 726b  on Learning work
+00009860: 7368 6f70 2061 6e64 204d 6163 6869 6e65  shop and Machine
+00009870: 204c 6561 726e 696e 6720 616e 6420 7468   Learning and th
+00009880: 6520 5068 7973 6963 616c 2053 6369 656e  e Physical Scien
+00009890: 6365 7320 776f 726b 7368 6f70 2061 7420  ces workshop at 
+000098a0: 4e65 7572 4950 5320 3230 3139 2e20 3230  NeurIPS 2019. 20
+000098b0: 3230 2e20 6874 7470 733a 2f2f 6172 7869  20. https://arxi
+000098c0: 762e 6f72 672f 6162 732f 3230 3032 2e30  v.org/abs/2002.0
+000098d0: 3832 3634 0a0a 2020 2020 4578 616d 706c  8264..    Exampl
+000098e0: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
+000098f0: 2020 2020 3e3e 3e20 6672 6f6d 2064 6565      >>> from dee
+00009900: 7063 6865 6d2e 6d6f 6465 6c73 2e74 6f72  pchem.models.tor
+00009910: 6368 5f6d 6f64 656c 732e 6c61 7965 7273  ch_models.layers
+00009920: 2069 6d70 6f72 7420 4d41 5447 656e 6572   import MATGener
+00009930: 6174 6f72 0a20 2020 203e 3e3e 206c 6179  ator.    >>> lay
+00009940: 6572 203d 204d 4154 4765 6e65 7261 746f  er = MATGenerato
+00009950: 7228 6873 697a 6520 3d20 332c 2061 6767  r(hsize = 3, agg
+00009960: 7265 6761 7469 6f6e 5f74 7970 6520 3d20  regation_type = 
+00009970: 276d 6561 6e27 2c20 645f 6f75 7470 7574  'mean', d_output
+00009980: 203d 2031 2c20 6e5f 6c61 7965 7273 203d   = 1, n_layers =
+00009990: 2031 2c20 6472 6f70 6f75 745f 7020 3d20   1, dropout_p = 
+000099a0: 302e 332c 2061 7474 6e5f 6869 6464 656e  0.3, attn_hidden
+000099b0: 203d 2031 3238 2c20 6174 746e 5f6f 7574   = 128, attn_out
+000099c0: 203d 2034 290a 2020 2020 3e3e 3e20 696e   = 4).    >>> in
+000099d0: 7075 745f 7465 6e73 6f72 203d 2074 6f72  put_tensor = tor
+000099e0: 6368 2e74 656e 736f 7228 5b31 2e2c 2032  ch.tensor([1., 2
+000099f0: 2e2c 2033 2e5d 290a 2020 2020 3e3e 3e20  ., 3.]).    >>> 
+00009a00: 6d61 736b 203d 2074 6f72 6368 2e74 656e  mask = torch.ten
+00009a10: 736f 7228 5b31 2e2c 2031 2e2c 2031 2e5d  sor([1., 1., 1.]
+00009a20: 290a 2020 2020 3e3e 3e20 6f75 7470 7574  ).    >>> output
+00009a30: 203d 206c 6179 6572 2869 6e70 7574 5f74   = layer(input_t
+00009a40: 656e 736f 722c 206d 6173 6b29 0a20 2020  ensor, mask).   
+00009a50: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+00009a60: 696e 6974 5f5f 2873 656c 662c 0a20 2020  init__(self,.   
+00009a70: 2020 2020 2020 2020 2020 2020 2020 6873                hs
+00009a80: 697a 653a 2069 6e74 203d 2031 3032 342c  ize: int = 1024,
+00009a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009aa0: 2020 6167 6772 6567 6174 696f 6e5f 7479    aggregation_ty
+00009ab0: 7065 3a20 7374 7220 3d20 276d 6561 6e27  pe: str = 'mean'
+00009ac0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009ad0: 2020 2064 5f6f 7574 7075 743a 2069 6e74     d_output: int
+00009ae0: 203d 2031 2c0a 2020 2020 2020 2020 2020   = 1,.          
+00009af0: 2020 2020 2020 206e 5f6c 6179 6572 733a         n_layers:
+00009b00: 2069 6e74 203d 2031 2c0a 2020 2020 2020   int = 1,.      
+00009b10: 2020 2020 2020 2020 2020 2064 726f 706f             dropo
+00009b20: 7574 5f70 3a20 666c 6f61 7420 3d20 302e  ut_p: float = 0.
+00009b30: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+00009b40: 2020 2020 6174 746e 5f68 6964 6465 6e3a      attn_hidden:
+00009b50: 2069 6e74 203d 2031 3238 2c0a 2020 2020   int = 128,.    
+00009b60: 2020 2020 2020 2020 2020 2020 2061 7474               att
+00009b70: 6e5f 6f75 743a 2069 6e74 203d 2034 293a  n_out: int = 4):
+00009b80: 0a20 2020 2020 2020 2022 2222 496e 6974  .        """Init
+00009b90: 6961 6c69 7a65 2061 204d 4154 4765 6e65  ialize a MATGene
+00009ba0: 7261 746f 722e 0a0a 2020 2020 2020 2020  rator...        
+00009bb0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00009bc0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00009bd0: 2020 2020 2020 6873 697a 653a 2069 6e74        hsize: int
+00009be0: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
+00009bf0: 6520 6f66 2069 6e70 7574 206c 6179 6572  e of input layer
+00009c00: 2e0a 2020 2020 2020 2020 6167 6772 6567  ..        aggreg
+00009c10: 6174 696f 6e5f 7479 7065 3a20 7374 720a  ation_type: str.
+00009c20: 2020 2020 2020 2020 2020 2020 5479 7065              Type
+00009c30: 206f 6620 6167 6772 6567 6174 696f 6e20   of aggregation 
+00009c40: 746f 2062 6520 7573 6564 2e20 4361 6e20  to be used. Can 
+00009c50: 6265 2027 6772 6f76 6572 272c 2027 6d65  be 'grover', 'me
+00009c60: 616e 2720 6f72 2027 636f 6e74 6578 7475  an' or 'contextu
+00009c70: 616c 272e 0a20 2020 2020 2020 2064 5f6f  al'..        d_o
+00009c80: 7574 7075 743a 2069 6e74 0a20 2020 2020  utput: int.     
+00009c90: 2020 2020 2020 2053 697a 6520 6f66 206f         Size of o
+00009ca0: 7574 7075 7420 6c61 7965 722e 0a20 2020  utput layer..   
+00009cb0: 2020 2020 206e 5f6c 6179 6572 733a 2069       n_layers: i
+00009cc0: 6e74 0a20 2020 2020 2020 2020 2020 204e  nt.            N
+00009cd0: 756d 6265 7220 6f66 206c 6179 6572 7320  umber of layers 
+00009ce0: 696e 204d 4154 4765 6e65 7261 746f 722e  in MATGenerator.
+00009cf0: 0a20 2020 2020 2020 2064 726f 706f 7574  .        dropout
+00009d00: 5f70 3a20 666c 6f61 740a 2020 2020 2020  _p: float.      
+00009d10: 2020 2020 2020 4472 6f70 6f75 7420 7072        Dropout pr
+00009d20: 6f62 6162 696c 6974 7920 666f 7220 6c61  obability for la
+00009d30: 7965 722e 0a20 2020 2020 2020 2061 7474  yer..        att
+00009d40: 6e5f 6869 6464 656e 3a20 696e 740a 2020  n_hidden: int.  
+00009d50: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
+00009d60: 6620 6869 6464 656e 2061 7474 656e 7469  f hidden attenti
+00009d70: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
+00009d80: 2020 6174 746e 5f6f 7574 3a20 696e 740a    attn_out: int.
+00009d90: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
+00009da0: 206f 6620 6f75 7470 7574 2061 7474 656e   of output atten
+00009db0: 7469 6f6e 206c 6179 6572 2e0a 2020 2020  tion layer..    
+00009dc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00009dd0: 7375 7065 7228 4d41 5447 656e 6572 6174  super(MATGenerat
+00009de0: 6f72 2c20 7365 6c66 292e 5f5f 696e 6974  or, self).__init
+00009df0: 5f5f 2829 0a0a 2020 2020 2020 2020 6966  __()..        if
+00009e00: 2061 6767 7265 6761 7469 6f6e 5f74 7970   aggregation_typ
+00009e10: 6520 3d3d 2027 6772 6f76 6572 273a 0a20  e == 'grover':. 
+00009e20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009e30: 6174 745f 6e65 7420 3d20 6e6e 2e53 6571  att_net = nn.Seq
+00009e40: 7565 6e74 6961 6c28 0a20 2020 2020 2020  uential(.       
+00009e50: 2020 2020 2020 2020 206e 6e2e 4c69 6e65           nn.Line
+00009e60: 6172 2868 7369 7a65 2c20 6174 746e 5f68  ar(hsize, attn_h
+00009e70: 6964 6465 6e2c 2062 6961 733d 4661 6c73  idden, bias=Fals
+00009e80: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+00009e90: 2020 2020 6e6e 2e54 616e 6828 292c 0a20      nn.Tanh(),. 
+00009ea0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00009eb0: 6e2e 4c69 6e65 6172 2861 7474 6e5f 6869  n.Linear(attn_hi
+00009ec0: 6464 656e 2c20 6174 746e 5f6f 7574 2c20  dden, attn_out, 
+00009ed0: 6269 6173 3d46 616c 7365 292c 0a20 2020  bias=False),.   
+00009ee0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00009ef0: 2020 2020 2020 2068 7369 7a65 202a 3d20         hsize *= 
+00009f00: 6174 746e 5f6f 7574 0a0a 2020 2020 2020  attn_out..      
+00009f10: 2020 6966 206e 5f6c 6179 6572 7320 3d3d    if n_layers ==
+00009f20: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00009f30: 7365 6c66 2e70 726f 6a3a 2041 6e79 203d  self.proj: Any =
+00009f40: 206e 6e2e 4c69 6e65 6172 2868 7369 7a65   nn.Linear(hsize
+00009f50: 2c20 645f 6f75 7470 7574 290a 0a20 2020  , d_output)..   
+00009f60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00009f70: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
+00009f80: 203d 205b 5d0a 0a20 2020 2020 2020 2020   = []..         
+00009f90: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00009fa0: 6528 6e5f 6c61 7965 7273 202d 2031 293a  e(n_layers - 1):
+00009fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009fc0: 2073 656c 662e 7072 6f6a 2e61 7070 656e   self.proj.appen
+00009fd0: 6428 6e6e 2e4c 696e 6561 7228 6873 697a  d(nn.Linear(hsiz
+00009fe0: 652c 2061 7474 6e5f 6869 6464 656e 2929  e, attn_hidden))
+00009ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a000: 2073 656c 662e 7072 6f6a 2e61 7070 656e   self.proj.appen
+0000a010: 6428 6e6e 2e4c 6561 6b79 5265 4c55 286e  d(nn.LeakyReLU(n
+0000a020: 6567 6174 6976 655f 736c 6f70 653d 302e  egative_slope=0.
+0000a030: 3129 290a 2020 2020 2020 2020 2020 2020  1)).            
+0000a040: 2020 2020 7365 6c66 2e70 726f 6a2e 6170      self.proj.ap
+0000a050: 7065 6e64 286e 6e2e 4c61 7965 724e 6f72  pend(nn.LayerNor
+0000a060: 6d28 6174 746e 5f68 6964 6465 6e29 290a  m(attn_hidden)).
+0000a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a080: 7365 6c66 2e70 726f 6a2e 6170 7065 6e64  self.proj.append
+0000a090: 286e 6e2e 4472 6f70 6f75 7428 6472 6f70  (nn.Dropout(drop
+0000a0a0: 6f75 745f 7029 290a 2020 2020 2020 2020  out_p)).        
+0000a0b0: 2020 2020 7365 6c66 2e70 726f 6a2e 6170      self.proj.ap
+0000a0c0: 7065 6e64 286e 6e2e 4c69 6e65 6172 2861  pend(nn.Linear(a
+0000a0d0: 7474 6e5f 6869 6464 656e 2c20 645f 6f75  ttn_hidden, d_ou
+0000a0e0: 7470 7574 2929 0a20 2020 2020 2020 2020  tput)).         
+0000a0f0: 2020 2073 656c 662e 7072 6f6a 203d 2074     self.proj = t
+0000a100: 6f72 6368 2e6e 6e2e 5365 7175 656e 7469  orch.nn.Sequenti
+0000a110: 616c 282a 7365 6c66 2e70 726f 6a29 0a20  al(*self.proj). 
+0000a120: 2020 2020 2020 2073 656c 662e 6167 6772         self.aggr
+0000a130: 6567 6174 696f 6e5f 7479 7065 203d 2061  egation_type = a
+0000a140: 6767 7265 6761 7469 6f6e 5f74 7970 650a  ggregation_type.
+0000a150: 0a20 2020 2064 6566 2066 6f72 7761 7264  .    def forward
+0000a160: 2873 656c 662c 2078 3a20 746f 7263 682e  (self, x: torch.
+0000a170: 5465 6e73 6f72 2c20 6d61 736b 3a20 746f  Tensor, mask: to
+0000a180: 7263 682e 5465 6e73 6f72 2920 2d3e 2074  rch.Tensor) -> t
+0000a190: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
+0000a1a0: 2020 2020 2022 2222 436f 6d70 7574 6174       """Computat
+0000a1b0: 696f 6e20 666f 7220 7468 6520 4d41 5447  ion for the MATG
+0000a1c0: 656e 6572 6174 6f72 206c 6179 6572 2e0a  enerator layer..
+0000a1d0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0000a1e0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+0000a1f0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2078  ------.        x
+0000a200: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+0000a210: 2020 2020 2020 2020 2020 2049 6e70 7574             Input
+0000a220: 2074 656e 736f 722e 0a20 2020 2020 2020   tensor..       
+0000a230: 206d 6173 6b3a 2074 6f72 6368 2e54 656e   mask: torch.Ten
+0000a240: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+0000a250: 4d61 736b 2066 6f72 2070 6164 6469 6e67  Mask for padding
+0000a260: 2073 6f20 7468 6174 2070 6164 6465 6420   so that padded 
+0000a270: 7661 6c75 6573 2064 6f20 6e6f 7420 6765  values do not ge
+0000a280: 7420 696e 636c 7564 6564 2069 6e20 6174  t included in at
+0000a290: 7465 6e74 696f 6e20 7363 6f72 6520 6361  tention score ca
+0000a2a0: 6c63 756c 6174 696f 6e2e 0a20 2020 2020  lculation..     
+0000a2b0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0000a2c0: 6d61 736b 203d 206d 6173 6b2e 756e 7371  mask = mask.unsq
+0000a2d0: 7565 657a 6528 2d31 292e 666c 6f61 7428  ueeze(-1).float(
+0000a2e0: 290a 2020 2020 2020 2020 6f75 745f 6d61  ).        out_ma
+0000a2f0: 736b 6564 203d 2078 202a 206d 6173 6b0a  sked = x * mask.
+0000a300: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000a310: 2e61 6767 7265 6761 7469 6f6e 5f74 7970  .aggregation_typ
+0000a320: 6520 3d3d 2027 6d65 616e 273a 0a20 2020  e == 'mean':.   
+0000a330: 2020 2020 2020 2020 206f 7574 5f73 756d           out_sum
+0000a340: 203d 206f 7574 5f6d 6173 6b65 642e 7375   = out_masked.su
+0000a350: 6d28 6469 6d3d 3129 0a20 2020 2020 2020  m(dim=1).       
+0000a360: 2020 2020 206d 6173 6b5f 7375 6d20 3d20       mask_sum = 
+0000a370: 6d61 736b 2e73 756d 2864 696d 3d28 3129  mask.sum(dim=(1)
+0000a380: 290a 2020 2020 2020 2020 2020 2020 6f75  ).            ou
+0000a390: 745f 6176 675f 706f 6f6c 696e 6720 3d20  t_avg_pooling = 
+0000a3a0: 6f75 745f 7375 6d20 2f20 6d61 736b 5f73  out_sum / mask_s
+0000a3b0: 756d 0a0a 2020 2020 2020 2020 656c 6966  um..        elif
+0000a3c0: 2073 656c 662e 6167 6772 6567 6174 696f   self.aggregatio
+0000a3d0: 6e5f 7479 7065 203d 3d20 2767 726f 7665  n_type == 'grove
+0000a3e0: 7227 3a0a 2020 2020 2020 2020 2020 2020  r':.            
+0000a3f0: 6f75 745f 6174 746e 203d 2073 656c 662e  out_attn = self.
+0000a400: 6174 745f 6e65 7428 6f75 745f 6d61 736b  att_net(out_mask
+0000a410: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
+0000a420: 6f75 745f 6174 746e 203d 206f 7574 5f61  out_attn = out_a
+0000a430: 7474 6e2e 6d61 736b 6564 5f66 696c 6c28  ttn.masked_fill(
+0000a440: 6d61 736b 203d 3d20 302c 202d 3165 3929  mask == 0, -1e9)
+0000a450: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0000a460: 5f61 7474 6e20 3d20 462e 736f 6674 6d61  _attn = F.softma
+0000a470: 7828 6f75 745f 6174 746e 2c20 6469 6d3d  x(out_attn, dim=
+0000a480: 3129 0a20 2020 2020 2020 2020 2020 206f  1).            o
+0000a490: 7574 5f61 7667 5f70 6f6f 6c69 6e67 203d  ut_avg_pooling =
+0000a4a0: 2074 6f72 6368 2e6d 6174 6d75 6c28 746f   torch.matmul(to
+0000a4b0: 7263 682e 7472 616e 7370 6f73 6528 6f75  rch.transpose(ou
+0000a4c0: 745f 6174 746e 2c20 2d31 2c20 2d32 292c  t_attn, -1, -2),
+0000a4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4f0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0000a500: 6d61 736b 6564 290a 2020 2020 2020 2020  masked).        
+0000a510: 2020 2020 6f75 745f 6176 675f 706f 6f6c      out_avg_pool
+0000a520: 696e 6720 3d20 6f75 745f 6176 675f 706f  ing = out_avg_po
+0000a530: 6f6c 696e 672e 7669 6577 286f 7574 5f61  oling.view(out_a
+0000a540: 7667 5f70 6f6f 6c69 6e67 2e73 697a 6528  vg_pooling.size(
+0000a550: 3029 2c20 2d31 290a 0a20 2020 2020 2020  0), -1)..       
+0000a560: 2065 6c69 6620 7365 6c66 2e61 6767 7265   elif self.aggre
+0000a570: 6761 7469 6f6e 5f74 7970 6520 3d3d 2027  gation_type == '
+0000a580: 636f 6e74 6578 7475 616c 273a 0a20 2020  contextual':.   
+0000a590: 2020 2020 2020 2020 206f 7574 5f61 7667           out_avg
+0000a5a0: 5f70 6f6f 6c69 6e67 203d 2078 0a0a 2020  _pooling = x..  
+0000a5b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000a5c0: 662e 7072 6f6a 286f 7574 5f61 7667 5f70  f.proj(out_avg_p
+0000a5d0: 6f6f 6c69 6e67 290a 0a0a 636c 6173 7320  ooling)...class 
+0000a5e0: 4772 6170 684e 6574 776f 726b 2874 6f72  GraphNetwork(tor
+0000a5f0: 6368 2e6e 6e2e 4d6f 6475 6c65 293a 0a20  ch.nn.Module):. 
+0000a600: 2020 2022 2222 4772 6170 6820 4e65 7477     """Graph Netw
+0000a610: 6f72 6b73 0a0a 2020 2020 4120 4772 6170  orks..    A Grap
+0000a620: 6820 4e65 7477 6f72 6b20 5b31 5d5f 2074  h Network [1]_ t
+0000a630: 616b 6573 2061 2067 7261 7068 2061 7320  akes a graph as 
+0000a640: 696e 7075 7420 616e 6420 7265 7475 726e  input and return
+0000a650: 7320 616e 2075 7064 6174 6564 2067 7261  s an updated gra
+0000a660: 7068 0a20 2020 2061 7320 6f75 7470 7574  ph.    as output
+0000a670: 2e20 5468 6520 6f75 7470 7574 2067 7261  . The output gra
+0000a680: 7068 2068 6173 2073 616d 6520 7374 7275  ph has same stru
+0000a690: 6374 7572 6520 6173 2069 6e70 7574 2067  cture as input g
+0000a6a0: 7261 7068 2062 7574 2069 740a 2020 2020  raph but it.    
+0000a6b0: 6861 7320 7570 6461 7465 6420 6e6f 6465  has updated node
+0000a6c0: 2066 6561 7475 7265 732c 2065 6467 6520   features, edge 
+0000a6d0: 6665 6174 7572 6573 2061 6e64 2067 6c6f  features and glo
+0000a6e0: 6261 6c20 7374 6174 6520 6665 6174 7572  bal state featur
+0000a6f0: 6573 2e0a 0a20 2020 2050 6172 616d 6574  es...    Paramet
+0000a700: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+0000a710: 2d2d 0a20 2020 206e 5f6e 6f64 655f 6665  --.    n_node_fe
+0000a720: 6174 7572 6573 3a20 696e 740a 2020 2020  atures: int.    
+0000a730: 2020 2020 4e75 6d62 6572 206f 6620 6665      Number of fe
+0000a740: 6174 7572 6573 2069 6e20 6120 6e6f 6465  atures in a node
+0000a750: 0a20 2020 206e 5f65 6467 655f 6665 6174  .    n_edge_feat
+0000a760: 7572 6573 3a20 696e 740a 2020 2020 2020  ures: int.      
+0000a770: 2020 4e75 6d62 6572 206f 6620 6665 6174    Number of feat
+0000a780: 7572 6573 2069 6e20 6120 6564 6765 0a20  ures in a edge. 
+0000a790: 2020 206e 5f67 6c6f 6261 6c5f 6665 6174     n_global_feat
+0000a7a0: 7572 6573 3a20 696e 740a 2020 2020 2020  ures: int.      
+0000a7b0: 2020 4e75 6d62 6572 206f 6620 676c 6f62    Number of glob
+0000a7c0: 616c 2066 6561 7475 7265 730a 2020 2020  al features.    
+0000a7d0: 6973 5f75 6e64 6972 6563 7465 643a 2062  is_undirected: b
+0000a7e0: 6f6f 6c2c 206f 7074 696f 6e61 6c20 2864  ool, optional (d
+0000a7f0: 6566 6175 6c74 2054 7275 6529 0a20 2020  efault True).   
+0000a800: 2020 2020 2044 6972 6563 7465 6420 6f72       Directed or
+0000a810: 2075 6e64 6972 6563 7465 6420 6772 6170   undirected grap
+0000a820: 680a 2020 2020 7265 7369 6475 616c 5f63  h.    residual_c
+0000a830: 6f6e 6e65 6374 696f 6e3a 2062 6f6f 6c2c  onnection: bool,
+0000a840: 206f 7074 696f 6e61 6c20 2864 6566 6175   optional (defau
+0000a850: 6c74 2054 7275 6529 0a20 2020 2020 2020  lt True).       
+0000a860: 2049 6620 5472 7565 2c20 7468 6520 6c61   If True, the la
+0000a870: 7965 7220 7573 6573 2061 2072 6573 6964  yer uses a resid
+0000a880: 7561 6c20 636f 6e6e 6563 7469 6f6e 2064  ual connection d
+0000a890: 7572 696e 6720 7472 6169 6e69 6e67 0a0a  uring training..
+0000a8a0: 2020 2020 4578 616d 706c 650a 2020 2020      Example.    
+0000a8b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+0000a8c0: 696d 706f 7274 2074 6f72 6368 0a20 2020  import torch.   
+0000a8d0: 203e 3e3e 2066 726f 6d20 6465 6570 6368   >>> from deepch
+0000a8e0: 656d 2e6d 6f64 656c 732e 746f 7263 685f  em.models.torch_
+0000a8f0: 6d6f 6465 6c73 2e6c 6179 6572 7320 696d  models.layers im
+0000a900: 706f 7274 2047 7261 7068 4e65 7477 6f72  port GraphNetwor
+0000a910: 6b20 6173 2047 4e0a 2020 2020 3e3e 3e20  k as GN.    >>> 
+0000a920: 6e5f 6e6f 6465 732c 206e 5f6e 6f64 655f  n_nodes, n_node_
+0000a930: 6665 6174 7572 6573 203d 2035 2c20 3130  features = 5, 10
+0000a940: 0a20 2020 203e 3e3e 206e 5f65 6467 6573  .    >>> n_edges
+0000a950: 2c20 6e5f 6564 6765 5f66 6561 7475 7265  , n_edge_feature
+0000a960: 7320 3d20 352c 2032 0a20 2020 203e 3e3e  s = 5, 2.    >>>
+0000a970: 206e 5f67 6c6f 6261 6c5f 6665 6174 7572   n_global_featur
+0000a980: 6573 203d 2034 0a20 2020 203e 3e3e 206e  es = 4.    >>> n
+0000a990: 6f64 655f 6665 6174 7572 6573 203d 2074  ode_features = t
+0000a9a0: 6f72 6368 2e72 616e 646e 286e 5f6e 6f64  orch.randn(n_nod
+0000a9b0: 6573 2c20 6e5f 6e6f 6465 5f66 6561 7475  es, n_node_featu
+0000a9c0: 7265 7329 0a20 2020 203e 3e3e 2065 6467  res).    >>> edg
+0000a9d0: 655f 6665 6174 7572 6573 203d 2074 6f72  e_features = tor
+0000a9e0: 6368 2e72 616e 646e 286e 5f65 6467 6573  ch.randn(n_edges
+0000a9f0: 2c20 6e5f 6564 6765 5f66 6561 7475 7265  , n_edge_feature
+0000aa00: 7329 0a20 2020 203e 3e3e 2065 6467 655f  s).    >>> edge_
+0000aa10: 696e 6465 7820 3d20 746f 7263 682e 7465  index = torch.te
+0000aa20: 6e73 6f72 285b 5b30 2c20 312c 2032 2c20  nsor([[0, 1, 2, 
+0000aa30: 332c 2034 5d2c 205b 312c 2032 2c20 332c  3, 4], [1, 2, 3,
+0000aa40: 2034 2c20 305d 5d29 2e6c 6f6e 6728 290a   4, 0]]).long().
+0000aa50: 2020 2020 3e3e 3e20 676c 6f62 616c 5f66      >>> global_f
+0000aa60: 6561 7475 7265 7320 3d20 746f 7263 682e  eatures = torch.
+0000aa70: 7261 6e64 6e28 312c 206e 5f67 6c6f 6261  randn(1, n_globa
+0000aa80: 6c5f 6665 6174 7572 6573 290a 2020 2020  l_features).    
+0000aa90: 3e3e 3e20 676e 203d 2047 4e28 6e5f 6e6f  >>> gn = GN(n_no
+0000aaa0: 6465 5f66 6561 7475 7265 733d 6e5f 6e6f  de_features=n_no
+0000aab0: 6465 5f66 6561 7475 7265 732c 206e 5f65  de_features, n_e
+0000aac0: 6467 655f 6665 6174 7572 6573 3d6e 5f65  dge_features=n_e
+0000aad0: 6467 655f 6665 6174 7572 6573 2c20 6e5f  dge_features, n_
+0000aae0: 676c 6f62 616c 5f66 6561 7475 7265 733d  global_features=
+0000aaf0: 6e5f 676c 6f62 616c 5f66 6561 7475 7265  n_global_feature
+0000ab00: 7329 0a20 2020 203e 3e3e 206e 6f64 655f  s).    >>> node_
+0000ab10: 6665 6174 7572 6573 2c20 6564 6765 5f66  features, edge_f
+0000ab20: 6561 7475 7265 732c 2067 6c6f 6261 6c5f  eatures, global_
+0000ab30: 6665 6174 7572 6573 203d 2067 6e28 6e6f  features = gn(no
+0000ab40: 6465 5f66 6561 7475 7265 732c 2065 6467  de_features, edg
+0000ab50: 655f 696e 6465 782c 2065 6467 655f 6665  e_index, edge_fe
+0000ab60: 6174 7572 6573 2c20 676c 6f62 616c 5f66  atures, global_f
+0000ab70: 6561 7475 7265 7329 0a0a 2020 2020 5265  eatures)..    Re
+0000ab80: 6665 7265 6e63 6573 0a20 2020 202d 2d2d  ferences.    ---
+0000ab90: 2d2d 2d2d 2d2d 2d0a 2020 2020 2e2e 205b  -------.    .. [
+0000aba0: 315d 2042 6174 7461 676c 6961 2065 7420  1] Battaglia et 
+0000abb0: 616c 2c20 5265 6c61 7469 6f6e 616c 2069  al, Relational i
+0000abc0: 6e64 7563 7469 7665 2062 6961 7365 732c  nductive biases,
+0000abd0: 2064 6565 7020 6c65 6172 6e69 6e67 2c20   deep learning, 
+0000abe0: 616e 6420 6772 6170 6820 6e65 7477 6f72  and graph networ
+0000abf0: 6b73 2e20 6874 7470 733a 2f2f 6172 7869  ks. https://arxi
+0000ac00: 762e 6f72 672f 6162 732f 3138 3036 2e30  v.org/abs/1806.0
+0000ac10: 3132 3631 2028 3230 3138 290a 2020 2222  1261 (2018).  ""
+0000ac20: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+0000ac30: 745f 5f28 7365 6c66 2c0a 2020 2020 2020  t__(self,.      
+0000ac40: 2020 2020 2020 2020 2020 206e 5f6e 6f64             n_nod
+0000ac50: 655f 6665 6174 7572 6573 3a20 696e 7420  e_features: int 
+0000ac60: 3d20 3332 2c0a 2020 2020 2020 2020 2020  = 32,.          
+0000ac70: 2020 2020 2020 206e 5f65 6467 655f 6665         n_edge_fe
+0000ac80: 6174 7572 6573 3a20 696e 7420 3d20 3332  atures: int = 32
+0000ac90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000aca0: 2020 206e 5f67 6c6f 6261 6c5f 6665 6174     n_global_feat
+0000acb0: 7572 6573 3a20 696e 7420 3d20 3332 2c0a  ures: int = 32,.
+0000acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000acd0: 2069 735f 756e 6469 7265 6374 6564 3a20   is_undirected: 
+0000ace0: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+0000acf0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000ad00: 7369 6475 616c 5f63 6f6e 6e65 6374 696f  sidual_connectio
+0000ad10: 6e3a 2062 6f6f 6c20 3d20 5472 7565 293a  n: bool = True):
+0000ad20: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+0000ad30: 2e5f 5f69 6e69 745f 5f28 290a 2020 2020  .__init__().    
+0000ad40: 2020 2020 7365 6c66 2e6e 5f6e 6f64 655f      self.n_node_
+0000ad50: 6665 6174 7572 6573 203d 206e 5f6e 6f64  features = n_nod
+0000ad60: 655f 6665 6174 7572 6573 0a20 2020 2020  e_features.     
+0000ad70: 2020 2073 656c 662e 6e5f 6564 6765 5f66     self.n_edge_f
+0000ad80: 6561 7475 7265 7320 3d20 6e5f 6564 6765  eatures = n_edge
+0000ad90: 5f66 6561 7475 7265 730a 2020 2020 2020  _features.      
+0000ada0: 2020 7365 6c66 2e6e 5f67 6c6f 6261 6c5f    self.n_global_
+0000adb0: 6665 6174 7572 6573 203d 206e 5f67 6c6f  features = n_glo
+0000adc0: 6261 6c5f 6665 6174 7572 6573 0a20 2020  bal_features.   
+0000add0: 2020 2020 2073 656c 662e 6973 5f75 6e64       self.is_und
+0000ade0: 6972 6563 7465 6420 3d20 6973 5f75 6e64  irected = is_und
+0000adf0: 6972 6563 7465 640a 2020 2020 2020 2020  irected.        
+0000ae00: 7365 6c66 2e72 6573 6964 7561 6c5f 636f  self.residual_co
+0000ae10: 6e6e 6563 7469 6f6e 203d 2072 6573 6964  nnection = resid
+0000ae20: 7561 6c5f 636f 6e6e 6563 7469 6f6e 0a0a  ual_connection..
+0000ae30: 2020 2020 2020 2020 7365 6c66 2e65 6467          self.edg
+0000ae40: 655f 6d6f 6465 6c73 2c20 7365 6c66 2e6e  e_models, self.n
+0000ae50: 6f64 655f 6d6f 6465 6c73 2c20 7365 6c66  ode_models, self
+0000ae60: 2e67 6c6f 6261 6c5f 6d6f 6465 6c73 203d  .global_models =
+0000ae70: 2074 6f72 6368 2e6e 6e2e 4d6f 6475 6c65   torch.nn.Module
+0000ae80: 4c69 7374 280a 2020 2020 2020 2020 292c  List(.        ),
+0000ae90: 2074 6f72 6368 2e6e 6e2e 4d6f 6475 6c65   torch.nn.Module
+0000aea0: 4c69 7374 2829 2c20 746f 7263 682e 6e6e  List(), torch.nn
+0000aeb0: 2e4d 6f64 756c 654c 6973 7428 290a 2020  .ModuleList().  
+0000aec0: 2020 2020 2020 7365 6c66 2e65 6467 655f        self.edge_
+0000aed0: 6d6f 6465 6c73 2e61 7070 656e 6428 0a20  models.append(. 
+0000aee0: 2020 2020 2020 2020 2020 206e 6e2e 4c69             nn.Li
+0000aef0: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
+0000af00: 3d6e 5f6e 6f64 655f 6665 6174 7572 6573  =n_node_features
+0000af10: 202a 2032 202b 206e 5f65 6467 655f 6665   * 2 + n_edge_fe
+0000af20: 6174 7572 6573 202b 0a20 2020 2020 2020  atures +.       
+0000af30: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000af40: 5f67 6c6f 6261 6c5f 6665 6174 7572 6573  _global_features
+0000af50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000af60: 2020 2020 2020 2020 6f75 745f 6665 6174          out_feat
+0000af70: 7572 6573 3d33 3229 290a 2020 2020 2020  ures=32)).      
+0000af80: 2020 7365 6c66 2e6e 6f64 655f 6d6f 6465    self.node_mode
+0000af90: 6c73 2e61 7070 656e 6428 0a20 2020 2020  ls.append(.     
+0000afa0: 2020 2020 2020 206e 6e2e 4c69 6e65 6172         nn.Linear
+0000afb0: 2869 6e5f 6665 6174 7572 6573 3d6e 5f6e  (in_features=n_n
+0000afc0: 6f64 655f 6665 6174 7572 6573 202b 206e  ode_features + n
+0000afd0: 5f65 6467 655f 6665 6174 7572 6573 202b  _edge_features +
+0000afe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aff0: 2020 2020 2020 206e 5f67 6c6f 6261 6c5f         n_global_
+0000b000: 6665 6174 7572 6573 2c0a 2020 2020 2020  features,.      
+0000b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b020: 6f75 745f 6665 6174 7572 6573 3d33 3229  out_features=32)
+0000b030: 290a 2020 2020 2020 2020 7365 6c66 2e67  ).        self.g
+0000b040: 6c6f 6261 6c5f 6d6f 6465 6c73 2e61 7070  lobal_models.app
+0000b050: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+0000b060: 206e 6e2e 4c69 6e65 6172 2869 6e5f 6665   nn.Linear(in_fe
+0000b070: 6174 7572 6573 3d6e 5f6e 6f64 655f 6665  atures=n_node_fe
+0000b080: 6174 7572 6573 202b 206e 5f65 6467 655f  atures + n_edge_
+0000b090: 6665 6174 7572 6573 202b 0a20 2020 2020  features +.     
+0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0b0: 206e 5f67 6c6f 6261 6c5f 6665 6174 7572   n_global_featur
+0000b0c0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0000b0d0: 2020 2020 2020 2020 2020 6f75 745f 6665            out_fe
+0000b0e0: 6174 7572 6573 3d33 3229 290a 0a20 2020  atures=32))..   
+0000b0f0: 2020 2020 2023 2055 7365 6420 666f 7220       # Used for 
+0000b100: 636f 6e76 6572 7469 6e67 2065 6467 6573  converting edges
+0000b110: 2062 6163 6b20 746f 2074 6865 6972 206f   back to their o
+0000b120: 7269 6769 6e61 6c20 7368 6170 650a 2020  riginal shape.  
+0000b130: 2020 2020 2020 7365 6c66 2e65 6467 655f        self.edge_
+0000b140: 6465 6e73 6520 3d20 6e6e 2e4c 696e 6561  dense = nn.Linea
+0000b150: 7228 696e 5f66 6561 7475 7265 733d 3332  r(in_features=32
+0000b160: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b180: 2020 2020 2020 6f75 745f 6665 6174 7572        out_featur
+0000b190: 6573 3d6e 5f65 6467 655f 6665 6174 7572  es=n_edge_featur
+0000b1a0: 6573 290a 2020 2020 2020 2020 7365 6c66  es).        self
+0000b1b0: 2e6e 6f64 655f 6465 6e73 6520 3d20 6e6e  .node_dense = nn
+0000b1c0: 2e4c 696e 6561 7228 696e 5f66 6561 7475  .Linear(in_featu
+0000b1d0: 7265 733d 3332 2c0a 2020 2020 2020 2020  res=32,.        
+0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1f0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0000b200: 6665 6174 7572 6573 3d6e 5f6e 6f64 655f  features=n_node_
+0000b210: 6665 6174 7572 6573 290a 2020 2020 2020  features).      
+0000b220: 2020 7365 6c66 2e67 6c6f 6261 6c5f 6465    self.global_de
+0000b230: 6e73 6520 3d20 6e6e 2e4c 696e 6561 7228  nse = nn.Linear(
+0000b240: 696e 5f66 6561 7475 7265 733d 3332 2c0a  in_features=32,.
 0000b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b260: 2020 2020 2020 2020 206f 7574 5f66 6561           out_fea
-0000b270: 7475 7265 733d 6e5f 676c 6f62 616c 5f66  tures=n_global_f
-0000b280: 6561 7475 7265 7329 0a0a 2020 2020 6465  eatures)..    de
-0000b290: 6620 7265 7365 745f 7061 7261 6d65 7465  f reset_paramete
-0000b2a0: 7273 2873 656c 6629 202d 3e20 4e6f 6e65  rs(self) -> None
-0000b2b0: 3a0a 2020 2020 2020 2020 7365 6c66 2e65  :.        self.e
-0000b2c0: 6467 655f 6465 6e73 652e 7265 7365 745f  dge_dense.reset_
-0000b2d0: 7061 7261 6d65 7465 7273 2829 0a20 2020  parameters().   
-0000b2e0: 2020 2020 2073 656c 662e 6e6f 6465 5f64       self.node_d
-0000b2f0: 656e 7365 2e72 6573 6574 5f70 6172 616d  ense.reset_param
-0000b300: 6574 6572 7328 290a 2020 2020 2020 2020  eters().        
-0000b310: 7365 6c66 2e67 6c6f 6261 6c5f 6465 6e73  self.global_dens
-0000b320: 652e 7265 7365 745f 7061 7261 6d65 7465  e.reset_paramete
-0000b330: 7273 2829 0a20 2020 2020 2020 2066 6f72  rs().        for
-0000b340: 2069 2069 6e20 7261 6e67 6528 302c 206c   i in range(0, l
-0000b350: 656e 2873 656c 662e 6564 6765 5f6d 6f64  en(self.edge_mod
-0000b360: 656c 7329 293a 0a20 2020 2020 2020 2020  els)):.         
-0000b370: 2020 2073 656c 662e 6564 6765 5f6d 6f64     self.edge_mod
-0000b380: 656c 735b 695d 2e72 6573 6574 5f70 6172  els[i].reset_par
-0000b390: 616d 6574 6572 7328 290a 2020 2020 2020  ameters().      
-0000b3a0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-0000b3b0: 2830 2c20 6c65 6e28 7365 6c66 2e6e 6f64  (0, len(self.nod
-0000b3c0: 655f 6d6f 6465 6c73 2929 3a0a 2020 2020  e_models)):.    
-0000b3d0: 2020 2020 2020 2020 7365 6c66 2e6e 6f64          self.nod
-0000b3e0: 655f 6d6f 6465 6c73 5b69 5d2e 7265 7365  e_models[i].rese
-0000b3f0: 745f 7061 7261 6d65 7465 7273 2829 0a20  t_parameters(). 
-0000b400: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0000b410: 7261 6e67 6528 302c 206c 656e 2873 656c  range(0, len(sel
-0000b420: 662e 676c 6f62 616c 5f6d 6f64 656c 7329  f.global_models)
-0000b430: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000b440: 656c 662e 676c 6f62 616c 5f6d 6f64 656c  elf.global_model
-0000b450: 735b 695d 2e72 6573 6574 5f70 6172 616d  s[i].reset_param
-0000b460: 6574 6572 7328 290a 0a20 2020 2064 6566  eters()..    def
-0000b470: 205f 7570 6461 7465 5f65 6467 655f 6665   _update_edge_fe
-0000b480: 6174 7572 6573 2873 656c 662c 206e 6f64  atures(self, nod
-0000b490: 655f 6665 6174 7572 6573 2c20 6564 6765  e_features, edge
-0000b4a0: 5f69 6e64 6578 2c20 6564 6765 5f66 6561  _index, edge_fea
-0000b4b0: 7475 7265 732c 0a20 2020 2020 2020 2020  tures,.         
-0000b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4d0: 2020 2020 2067 6c6f 6261 6c5f 6665 6174       global_feat
-0000b4e0: 7572 6573 2c20 6261 7463 6829 3a0a 2020  ures, batch):.  
-0000b4f0: 2020 2020 2020 7372 635f 696e 6465 782c        src_index,
-0000b500: 2064 7374 5f69 6e64 6578 203d 2065 6467   dst_index = edg
-0000b510: 655f 696e 6465 780a 2020 2020 2020 2020  e_index.        
-0000b520: 6f75 7420 3d20 746f 7263 682e 6361 7428  out = torch.cat(
-0000b530: 286e 6f64 655f 6665 6174 7572 6573 5b73  (node_features[s
-0000b540: 7263 5f69 6e64 6578 5d2c 206e 6f64 655f  rc_index], node_
-0000b550: 6665 6174 7572 6573 5b64 7374 5f69 6e64  features[dst_ind
-0000b560: 6578 5d2c 0a20 2020 2020 2020 2020 2020  ex],.           
-0000b570: 2020 2020 2020 2020 2020 2020 2020 6564                ed
-0000b580: 6765 5f66 6561 7475 7265 732c 2067 6c6f  ge_features, glo
-0000b590: 6261 6c5f 6665 6174 7572 6573 5b62 6174  bal_features[bat
-0000b5a0: 6368 5d29 2c0a 2020 2020 2020 2020 2020  ch]),.          
-0000b5b0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-0000b5c0: 6d3d 3129 0a20 2020 2020 2020 2061 7373  m=1).        ass
-0000b5d0: 6572 7420 6f75 742e 7368 6170 655b 0a20  ert out.shape[. 
-0000b5e0: 2020 2020 2020 2020 2020 2031 5d20 3d3d             1] ==
-0000b5f0: 2073 656c 662e 6e5f 6e6f 6465 5f66 6561   self.n_node_fea
-0000b600: 7475 7265 7320 2a20 3220 2b20 7365 6c66  tures * 2 + self
-0000b610: 2e6e 5f65 6467 655f 6665 6174 7572 6573  .n_edge_features
-0000b620: 202b 2073 656c 662e 6e5f 676c 6f62 616c   + self.n_global
-0000b630: 5f66 6561 7475 7265 730a 2020 2020 2020  _features.      
-0000b640: 2020 666f 7220 6d6f 6465 6c20 696e 2073    for model in s
-0000b650: 656c 662e 6564 6765 5f6d 6f64 656c 733a  elf.edge_models:
-0000b660: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0000b670: 203d 206d 6f64 656c 286f 7574 290a 2020   = model(out).  
-0000b680: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000b690: 662e 6564 6765 5f64 656e 7365 286f 7574  f.edge_dense(out
-0000b6a0: 290a 0a20 2020 2064 6566 205f 7570 6461  )..    def _upda
-0000b6b0: 7465 5f6e 6f64 655f 6665 6174 7572 6573  te_node_features
-0000b6c0: 2873 656c 662c 206e 6f64 655f 6665 6174  (self, node_feat
-0000b6d0: 7572 6573 2c20 6564 6765 5f69 6e64 6578  ures, edge_index
-0000b6e0: 2c20 6564 6765 5f66 6561 7475 7265 732c  , edge_features,
-0000b6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b700: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000b710: 6c6f 6261 6c5f 6665 6174 7572 6573 2c20  lobal_features, 
-0000b720: 6261 7463 6829 3a0a 0a20 2020 2020 2020  batch):..       
-0000b730: 2073 7263 5f69 6e64 6578 2c20 6473 745f   src_index, dst_
-0000b740: 696e 6465 7820 3d20 6564 6765 5f69 6e64  index = edge_ind
-0000b750: 6578 0a20 2020 2020 2020 2023 2043 6f6d  ex.        # Com
-0000b760: 7075 7465 206d 6561 6e20 6564 6765 2066  pute mean edge f
-0000b770: 6561 7475 7265 7320 666f 7220 6561 6368  eatures for each
-0000b780: 206e 6f64 6520 6279 2064 7374 5f69 6e64   node by dst_ind
-0000b790: 6578 2028 6561 6368 206e 6f64 650a 2020  ex (each node.  
-0000b7a0: 2020 2020 2020 2320 7265 6365 6976 6573        # receives
-0000b7b0: 2069 6e66 6f72 6d61 7469 6f6e 2066 726f   information fro
-0000b7c0: 6d20 6564 6765 7320 7768 6963 6820 6861  m edges which ha
-0000b7d0: 7665 2074 6861 7420 6e6f 6465 2061 7320  ve that node as 
-0000b7e0: 6974 7320 6465 7374 696e 6174 696f 6e2c  its destination,
-0000b7f0: 0a20 2020 2020 2020 2023 2068 656e 6365  .        # hence
-0000b800: 2074 6865 2063 6f6d 7075 7461 7469 6f6e   the computation
-0000b810: 2075 7365 7320 6473 745f 696e 6465 7820   uses dst_index 
-0000b820: 746f 2061 6767 7265 6761 7465 2069 6e66  to aggregate inf
-0000b830: 6f72 6d61 7469 6f6e 290a 2020 2020 2020  ormation).      
-0000b840: 2020 6564 6765 5f66 6561 7475 7265 735f    edge_features_
-0000b850: 6d65 616e 5f62 795f 6e6f 6465 203d 2073  mean_by_node = s
-0000b860: 6361 7474 6572 2873 7263 3d65 6467 655f  catter(src=edge_
-0000b870: 6665 6174 7572 6573 2c0a 2020 2020 2020  features,.      
-0000b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b270: 2020 2020 2020 6f75 745f 6665 6174 7572        out_featur
+0000b280: 6573 3d6e 5f67 6c6f 6261 6c5f 6665 6174  es=n_global_feat
+0000b290: 7572 6573 290a 0a20 2020 2064 6566 2072  ures)..    def r
+0000b2a0: 6573 6574 5f70 6172 616d 6574 6572 7328  eset_parameters(
+0000b2b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000b2c0: 2020 2020 2020 2073 656c 662e 6564 6765         self.edge
+0000b2d0: 5f64 656e 7365 2e72 6573 6574 5f70 6172  _dense.reset_par
+0000b2e0: 616d 6574 6572 7328 290a 2020 2020 2020  ameters().      
+0000b2f0: 2020 7365 6c66 2e6e 6f64 655f 6465 6e73    self.node_dens
+0000b300: 652e 7265 7365 745f 7061 7261 6d65 7465  e.reset_paramete
+0000b310: 7273 2829 0a20 2020 2020 2020 2073 656c  rs().        sel
+0000b320: 662e 676c 6f62 616c 5f64 656e 7365 2e72  f.global_dense.r
+0000b330: 6573 6574 5f70 6172 616d 6574 6572 7328  eset_parameters(
+0000b340: 290a 2020 2020 2020 2020 666f 7220 6920  ).        for i 
+0000b350: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
+0000b360: 7365 6c66 2e65 6467 655f 6d6f 6465 6c73  self.edge_models
+0000b370: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0000b380: 7365 6c66 2e65 6467 655f 6d6f 6465 6c73  self.edge_models
+0000b390: 5b69 5d2e 7265 7365 745f 7061 7261 6d65  [i].reset_parame
+0000b3a0: 7465 7273 2829 0a20 2020 2020 2020 2066  ters().        f
+0000b3b0: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
+0000b3c0: 206c 656e 2873 656c 662e 6e6f 6465 5f6d   len(self.node_m
+0000b3d0: 6f64 656c 7329 293a 0a20 2020 2020 2020  odels)):.       
+0000b3e0: 2020 2020 2073 656c 662e 6e6f 6465 5f6d       self.node_m
+0000b3f0: 6f64 656c 735b 695d 2e72 6573 6574 5f70  odels[i].reset_p
+0000b400: 6172 616d 6574 6572 7328 290a 2020 2020  arameters().    
+0000b410: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0000b420: 6765 2830 2c20 6c65 6e28 7365 6c66 2e67  ge(0, len(self.g
+0000b430: 6c6f 6261 6c5f 6d6f 6465 6c73 2929 3a0a  lobal_models)):.
+0000b440: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b450: 2e67 6c6f 6261 6c5f 6d6f 6465 6c73 5b69  .global_models[i
+0000b460: 5d2e 7265 7365 745f 7061 7261 6d65 7465  ].reset_paramete
+0000b470: 7273 2829 0a0a 2020 2020 6465 6620 5f75  rs()..    def _u
+0000b480: 7064 6174 655f 6564 6765 5f66 6561 7475  pdate_edge_featu
+0000b490: 7265 7328 7365 6c66 2c20 6e6f 6465 5f66  res(self, node_f
+0000b4a0: 6561 7475 7265 732c 2065 6467 655f 696e  eatures, edge_in
+0000b4b0: 6465 782c 2065 6467 655f 6665 6174 7572  dex, edge_featur
+0000b4c0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0000b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4e0: 2020 676c 6f62 616c 5f66 6561 7475 7265    global_feature
+0000b4f0: 732c 2062 6174 6368 293a 0a20 2020 2020  s, batch):.     
+0000b500: 2020 2073 7263 5f69 6e64 6578 2c20 6473     src_index, ds
+0000b510: 745f 696e 6465 7820 3d20 6564 6765 5f69  t_index = edge_i
+0000b520: 6e64 6578 0a20 2020 2020 2020 206f 7574  ndex.        out
+0000b530: 203d 2074 6f72 6368 2e63 6174 2828 6e6f   = torch.cat((no
+0000b540: 6465 5f66 6561 7475 7265 735b 7372 635f  de_features[src_
+0000b550: 696e 6465 785d 2c20 6e6f 6465 5f66 6561  index], node_fea
+0000b560: 7475 7265 735b 6473 745f 696e 6465 785d  tures[dst_index]
+0000b570: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b580: 2020 2020 2020 2020 2020 2065 6467 655f             edge_
+0000b590: 6665 6174 7572 6573 2c20 676c 6f62 616c  features, global
+0000b5a0: 5f66 6561 7475 7265 735b 6261 7463 685d  _features[batch]
+0000b5b0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000b5c0: 2020 2020 2020 2020 2020 2064 696d 3d31             dim=1
+0000b5d0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+0000b5e0: 206f 7574 2e73 6861 7065 5b0a 2020 2020   out.shape[.    
+0000b5f0: 2020 2020 2020 2020 315d 203d 3d20 7365          1] == se
+0000b600: 6c66 2e6e 5f6e 6f64 655f 6665 6174 7572  lf.n_node_featur
+0000b610: 6573 202a 2032 202b 2073 656c 662e 6e5f  es * 2 + self.n_
+0000b620: 6564 6765 5f66 6561 7475 7265 7320 2b20  edge_features + 
+0000b630: 7365 6c66 2e6e 5f67 6c6f 6261 6c5f 6665  self.n_global_fe
+0000b640: 6174 7572 6573 0a20 2020 2020 2020 2066  atures.        f
+0000b650: 6f72 206d 6f64 656c 2069 6e20 7365 6c66  or model in self
+0000b660: 2e65 6467 655f 6d6f 6465 6c73 3a0a 2020  .edge_models:.  
+0000b670: 2020 2020 2020 2020 2020 6f75 7420 3d20            out = 
+0000b680: 6d6f 6465 6c28 6f75 7429 0a20 2020 2020  model(out).     
+0000b690: 2020 2072 6574 7572 6e20 7365 6c66 2e65     return self.e
+0000b6a0: 6467 655f 6465 6e73 6528 6f75 7429 0a0a  dge_dense(out)..
+0000b6b0: 2020 2020 6465 6620 5f75 7064 6174 655f      def _update_
+0000b6c0: 6e6f 6465 5f66 6561 7475 7265 7328 7365  node_features(se
+0000b6d0: 6c66 2c20 6e6f 6465 5f66 6561 7475 7265  lf, node_feature
+0000b6e0: 732c 2065 6467 655f 696e 6465 782c 2065  s, edge_index, e
+0000b6f0: 6467 655f 6665 6174 7572 6573 2c0a 2020  dge_features,.  
+0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b710: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
+0000b720: 616c 5f66 6561 7475 7265 732c 2062 6174  al_features, bat
+0000b730: 6368 293a 0a0a 2020 2020 2020 2020 7372  ch):..        sr
+0000b740: 635f 696e 6465 782c 2064 7374 5f69 6e64  c_index, dst_ind
+0000b750: 6578 203d 2065 6467 655f 696e 6465 780a  ex = edge_index.
+0000b760: 2020 2020 2020 2020 2320 436f 6d70 7574          # Comput
+0000b770: 6520 6d65 616e 2065 6467 6520 6665 6174  e mean edge feat
+0000b780: 7572 6573 2066 6f72 2065 6163 6820 6e6f  ures for each no
+0000b790: 6465 2062 7920 6473 745f 696e 6465 7820  de by dst_index 
+0000b7a0: 2865 6163 6820 6e6f 6465 0a20 2020 2020  (each node.     
+0000b7b0: 2020 2023 2072 6563 6569 7665 7320 696e     # receives in
+0000b7c0: 666f 726d 6174 696f 6e20 6672 6f6d 2065  formation from e
+0000b7d0: 6467 6573 2077 6869 6368 2068 6176 6520  dges which have 
+0000b7e0: 7468 6174 206e 6f64 6520 6173 2069 7473  that node as its
+0000b7f0: 2064 6573 7469 6e61 7469 6f6e 2c0a 2020   destination,.  
+0000b800: 2020 2020 2020 2320 6865 6e63 6520 7468        # hence th
+0000b810: 6520 636f 6d70 7574 6174 696f 6e20 7573  e computation us
+0000b820: 6573 2064 7374 5f69 6e64 6578 2074 6f20  es dst_index to 
+0000b830: 6167 6772 6567 6174 6520 696e 666f 726d  aggregate inform
+0000b840: 6174 696f 6e29 0a20 2020 2020 2020 2065  ation).        e
+0000b850: 6467 655f 6665 6174 7572 6573 5f6d 6561  dge_features_mea
+0000b860: 6e5f 6279 5f6e 6f64 6520 3d20 7363 6174  n_by_node = scat
+0000b870: 7465 7228 7372 633d 6564 6765 5f66 6561  ter(src=edge_fea
+0000b880: 7475 7265 732c 0a20 2020 2020 2020 2020  tures,.         
 0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8a0: 2020 2020 2020 2069 6e64 6578 3d64 7374         index=dst
-0000b8b0: 5f69 6e64 6578 2c0a 2020 2020 2020 2020  _index,.        
-0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8b0: 2020 2020 696e 6465 783d 6473 745f 696e      index=dst_in
+0000b8c0: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
 0000b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8e0: 2020 2020 2064 696d 3d30 2c0a 2020 2020       dim=0,.    
-0000b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8f0: 2020 6469 6d3d 302c 0a20 2020 2020 2020    dim=0,.       
 0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b910: 2020 2020 2020 2020 2072 6564 7563 653d           reduce=
-0000b920: 276d 6561 6e27 290a 2020 2020 2020 2020  'mean').        
-0000b930: 6f75 7420 3d20 746f 7263 682e 6361 7428  out = torch.cat(
-0000b940: 0a20 2020 2020 2020 2020 2020 2028 6e6f  .            (no
-0000b950: 6465 5f66 6561 7475 7265 732c 2065 6467  de_features, edg
-0000b960: 655f 6665 6174 7572 6573 5f6d 6561 6e5f  e_features_mean_
-0000b970: 6279 5f6e 6f64 652c 2067 6c6f 6261 6c5f  by_node, global_
-0000b980: 6665 6174 7572 6573 5b62 6174 6368 5d29  features[batch])
-0000b990: 2c0a 2020 2020 2020 2020 2020 2020 6469  ,.            di
-0000b9a0: 6d3d 3129 0a20 2020 2020 2020 2066 6f72  m=1).        for
-0000b9b0: 206d 6f64 656c 2069 6e20 7365 6c66 2e6e   model in self.n
-0000b9c0: 6f64 655f 6d6f 6465 6c73 3a0a 2020 2020  ode_models:.    
-0000b9d0: 2020 2020 2020 2020 6f75 7420 3d20 6d6f          out = mo
-0000b9e0: 6465 6c28 6f75 7429 0a20 2020 2020 2020  del(out).       
-0000b9f0: 2072 6574 7572 6e20 7365 6c66 2e6e 6f64   return self.nod
-0000ba00: 655f 6465 6e73 6528 6f75 7429 0a0a 2020  e_dense(out)..  
-0000ba10: 2020 6465 6620 5f75 7064 6174 655f 676c    def _update_gl
-0000ba20: 6f62 616c 5f66 6561 7475 7265 7328 7365  obal_features(se
-0000ba30: 6c66 2c20 6e6f 6465 5f66 6561 7475 7265  lf, node_feature
-0000ba40: 732c 2065 6467 655f 6665 6174 7572 6573  s, edge_features
-0000ba50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b920: 2020 2020 2020 7265 6475 6365 3d27 6d65        reduce='me
+0000b930: 616e 2729 0a20 2020 2020 2020 206f 7574  an').        out
+0000b940: 203d 2074 6f72 6368 2e63 6174 280a 2020   = torch.cat(.  
+0000b950: 2020 2020 2020 2020 2020 286e 6f64 655f            (node_
+0000b960: 6665 6174 7572 6573 2c20 6564 6765 5f66  features, edge_f
+0000b970: 6561 7475 7265 735f 6d65 616e 5f62 795f  eatures_mean_by_
+0000b980: 6e6f 6465 2c20 676c 6f62 616c 5f66 6561  node, global_fea
+0000b990: 7475 7265 735b 6261 7463 685d 292c 0a20  tures[batch]),. 
+0000b9a0: 2020 2020 2020 2020 2020 2064 696d 3d31             dim=1
+0000b9b0: 290a 2020 2020 2020 2020 666f 7220 6d6f  ).        for mo
+0000b9c0: 6465 6c20 696e 2073 656c 662e 6e6f 6465  del in self.node
+0000b9d0: 5f6d 6f64 656c 733a 0a20 2020 2020 2020  _models:.       
+0000b9e0: 2020 2020 206f 7574 203d 206d 6f64 656c       out = model
+0000b9f0: 286f 7574 290a 2020 2020 2020 2020 7265  (out).        re
+0000ba00: 7475 726e 2073 656c 662e 6e6f 6465 5f64  turn self.node_d
+0000ba10: 656e 7365 286f 7574 290a 0a20 2020 2064  ense(out)..    d
+0000ba20: 6566 205f 7570 6461 7465 5f67 6c6f 6261  ef _update_globa
+0000ba30: 6c5f 6665 6174 7572 6573 2873 656c 662c  l_features(self,
+0000ba40: 206e 6f64 655f 6665 6174 7572 6573 2c20   node_features, 
+0000ba50: 6564 6765 5f66 6561 7475 7265 732c 0a20  edge_features,. 
 0000ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba70: 2020 676c 6f62 616c 5f66 6561 7475 7265    global_feature
-0000ba80: 732c 206e 6f64 655f 6261 7463 685f 6d61  s, node_batch_ma
-0000ba90: 702c 0a20 2020 2020 2020 2020 2020 2020  p,.             
+0000ba70: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0000ba80: 6c6f 6261 6c5f 6665 6174 7572 6573 2c20  lobal_features, 
+0000ba90: 6e6f 6465 5f62 6174 6368 5f6d 6170 2c0a  node_batch_map,.
 0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bab0: 2020 2065 6467 655f 6261 7463 685f 6d61     edge_batch_ma
-0000bac0: 7029 3a0a 2020 2020 2020 2020 6564 6765  p):.        edge
-0000bad0: 5f66 6561 7475 7265 735f 6d65 616e 203d  _features_mean =
-0000bae0: 2073 6361 7474 6572 2873 7263 3d65 6467   scatter(src=edg
-0000baf0: 655f 6665 6174 7572 6573 2c0a 2020 2020  e_features,.    
-0000bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bac0: 6564 6765 5f62 6174 6368 5f6d 6170 293a  edge_batch_map):
+0000bad0: 0a20 2020 2020 2020 2065 6467 655f 6665  .        edge_fe
+0000bae0: 6174 7572 6573 5f6d 6561 6e20 3d20 7363  atures_mean = sc
+0000baf0: 6174 7465 7228 7372 633d 6564 6765 5f66  atter(src=edge_f
+0000bb00: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
 0000bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb20: 2069 6e64 6578 3d65 6467 655f 6261 7463   index=edge_batc
-0000bb30: 685f 6d61 702c 0a20 2020 2020 2020 2020  h_map,.         
-0000bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb50: 2020 2020 2020 2020 2020 2020 6469 6d3d              dim=
-0000bb60: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000bb30: 6465 783d 6564 6765 5f62 6174 6368 5f6d  dex=edge_batch_m
+0000bb40: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb60: 2020 2020 2020 2020 2064 696d 3d30 2c0a           dim=0,.
 0000bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb80: 2020 2020 2020 2020 7265 6475 6365 3d27          reduce='
-0000bb90: 6d65 616e 2729 0a20 2020 2020 2020 206e  mean').        n
-0000bba0: 6f64 655f 6665 6174 7572 6573 5f6d 6561  ode_features_mea
-0000bbb0: 6e20 3d20 7363 6174 7465 7228 7372 633d  n = scatter(src=
-0000bbc0: 6e6f 6465 5f66 6561 7475 7265 732c 0a20  node_features,. 
-0000bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb90: 2020 2020 2072 6564 7563 653d 276d 6561       reduce='mea
+0000bba0: 6e27 290a 2020 2020 2020 2020 6e6f 6465  n').        node
+0000bbb0: 5f66 6561 7475 7265 735f 6d65 616e 203d  _features_mean =
+0000bbc0: 2073 6361 7474 6572 2873 7263 3d6e 6f64   scatter(src=nod
+0000bbd0: 655f 6665 6174 7572 6573 2c0a 2020 2020  e_features,.    
 0000bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbf0: 2020 2020 696e 6465 783d 6e6f 6465 5f62      index=node_b
-0000bc00: 6174 6368 5f6d 6170 2c0a 2020 2020 2020  atch_map,.      
-0000bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc20: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000bc30: 696d 3d30 2c0a 2020 2020 2020 2020 2020  im=0,.          
-0000bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc50: 2020 2020 2020 2020 2020 2072 6564 7563             reduc
-0000bc60: 653d 276d 6561 6e27 290a 2020 2020 2020  e='mean').      
-0000bc70: 2020 6f75 7420 3d20 746f 7263 682e 6361    out = torch.ca
-0000bc80: 7428 0a20 2020 2020 2020 2020 2020 2028  t(.            (
-0000bc90: 6564 6765 5f66 6561 7475 7265 735f 6d65  edge_features_me
-0000bca0: 616e 2c20 6e6f 6465 5f66 6561 7475 7265  an, node_feature
-0000bcb0: 735f 6d65 616e 2c20 676c 6f62 616c 5f66  s_mean, global_f
-0000bcc0: 6561 7475 7265 7329 2c20 6469 6d3d 3129  eatures), dim=1)
-0000bcd0: 0a20 2020 2020 2020 2066 6f72 206d 6f64  .        for mod
-0000bce0: 656c 2069 6e20 7365 6c66 2e67 6c6f 6261  el in self.globa
-0000bcf0: 6c5f 6d6f 6465 6c73 3a0a 2020 2020 2020  l_models:.      
-0000bd00: 2020 2020 2020 6f75 7420 3d20 6d6f 6465        out = mode
-0000bd10: 6c28 6f75 7429 0a20 2020 2020 2020 2072  l(out).        r
-0000bd20: 6574 7572 6e20 7365 6c66 2e67 6c6f 6261  eturn self.globa
-0000bd30: 6c5f 6465 6e73 6528 6f75 7429 0a0a 2020  l_dense(out)..  
-0000bd40: 2020 6465 6620 666f 7277 6172 6428 0a20    def forward(. 
-0000bd50: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-0000bd60: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
-0000bd70: 655f 6665 6174 7572 6573 3a20 5465 6e73  e_features: Tens
-0000bd80: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-0000bd90: 6564 6765 5f69 6e64 6578 3a20 5465 6e73  edge_index: Tens
-0000bda0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-0000bdb0: 6564 6765 5f66 6561 7475 7265 733a 2054  edge_features: T
-0000bdc0: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
-0000bdd0: 2020 2067 6c6f 6261 6c5f 6665 6174 7572     global_featur
-0000bde0: 6573 3a20 5465 6e73 6f72 2c0a 2020 2020  es: Tensor,.    
-0000bdf0: 2020 2020 2020 2020 6261 7463 683a 204f          batch: O
-0000be00: 7074 696f 6e61 6c5b 5465 6e73 6f72 5d20  ptional[Tensor] 
-0000be10: 3d20 4e6f 6e65 2920 2d3e 2054 7570 6c65  = None) -> Tuple
-0000be20: 5b54 656e 736f 722c 2054 656e 736f 722c  [Tensor, Tensor,
-0000be30: 2054 656e 736f 725d 3a0a 2020 2020 2020   Tensor]:.      
-0000be40: 2020 2222 224f 7574 7075 7420 636f 6d70    """Output comp
-0000be50: 7574 6174 696f 6e20 666f 7220 6120 4772  utation for a Gr
-0000be60: 6170 684e 6574 776f 726b 0a0a 2020 2020  aphNetwork..    
-0000be70: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0000be80: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0000be90: 2d0a 2020 2020 2020 2020 6e6f 6465 5f66  -.        node_f
-0000bea0: 6561 7475 7265 733a 2074 6f72 6368 2e54  eatures: torch.T
-0000beb0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-0000bec0: 2020 496e 7075 7420 6e6f 6465 2066 6561    Input node fea
-0000bed0: 7475 7265 7320 6f66 2073 6861 7065 203a  tures of shape :
-0000bee0: 6d61 7468 3a60 287c 5c6d 6174 6863 616c  math:`(|\mathcal
-0000bef0: 7b56 7d7c 2c20 465f 6e29 600a 2020 2020  {V}|, F_n)`.    
-0000bf00: 2020 2020 6564 6765 5f69 6e64 6578 3a20      edge_index: 
-0000bf10: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-0000bf20: 2020 2020 2020 2020 2045 6467 6520 696e           Edge in
-0000bf30: 6465 7865 7320 6f66 2073 6861 7065 203a  dexes of shape :
-0000bf40: 6d61 7468 3a60 2832 2c20 7c5c 6d61 7468  math:`(2, |\math
-0000bf50: 6361 6c7b 457d 7c29 600a 2020 2020 2020  cal{E}|)`.      
-0000bf60: 2020 6564 6765 5f66 6561 7475 7265 733a    edge_features:
-0000bf70: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-0000bf80: 2020 2020 2020 2020 2020 4564 6765 2066            Edge f
-0000bf90: 6561 7475 7265 7320 6f66 2074 6865 2067  eatures of the g
-0000bfa0: 7261 7068 2c20 7368 6170 653a 203a 6d61  raph, shape: :ma
-0000bfb0: 7468 3a60 287c 5c6d 6174 6863 616c 7b45  th:`(|\mathcal{E
-0000bfc0: 7d7c 2c20 465f 6529 600a 2020 2020 2020  }|, F_e)`.      
-0000bfd0: 2020 676c 6f62 616c 5f66 6561 7475 7265    global_feature
-0000bfe0: 733a 2074 6f72 6368 2e54 656e 736f 720a  s: torch.Tensor.
-0000bff0: 2020 2020 2020 2020 2020 2020 476c 6f62              Glob
-0000c000: 616c 2066 6561 7475 7265 7320 6f66 2074  al features of t
-0000c010: 6865 2067 7261 7068 2c20 7368 6170 653a  he graph, shape:
-0000c020: 203a 6d61 7468 3a60 2846 5f67 2c20 3129   :math:`(F_g, 1)
-0000c030: 6020 7768 6572 652c 203a 6d61 7468 3a60  ` where, :math:`
-0000c040: 7c5c 6d61 7468 6361 6c7b 567d 7c60 2061  |\mathcal{V}|` a
-0000c050: 6e64 203a 6d61 7468 3a60 7c5c 6d61 7468  nd :math:`|\math
-0000c060: 6361 6c7b 457d 7c60 2064 656e 6f74 6573  cal{E}|` denotes
-0000c070: 2074 6865 206e 756d 6265 7220 6f66 206e   the number of n
-0000c080: 6f64 6573 2061 6e64 2065 6467 6573 2069  odes and edges i
-0000c090: 6e20 7468 6520 6772 6170 682c 0a20 2020  n the graph,.   
-0000c0a0: 2020 2020 2020 2020 203a 6d61 7468 3a60           :math:`
-0000c0b0: 465f 6e60 2c20 3a6d 6174 683a 6046 5f65  F_n`, :math:`F_e
-0000c0c0: 602c 203a 6d61 7468 3a60 465f 6760 2064  `, :math:`F_g` d
-0000c0d0: 656e 6f74 6573 2074 6865 206e 756d 6265  enotes the numbe
-0000c0e0: 7220 6f66 206e 6f64 6520 6665 6174 7572  r of node featur
-0000c0f0: 6573 2c20 6564 6765 2066 6561 7475 7265  es, edge feature
-0000c100: 7320 616e 6420 676c 6f62 616c 2073 7461  s and global sta
-0000c110: 7465 2066 6561 7475 7265 7320 7265 7370  te features resp
-0000c120: 6563 7469 7665 6c79 2e0a 2020 2020 2020  ectively..      
-0000c130: 2020 6261 7463 683a 2074 6f72 6368 2e4c    batch: torch.L
-0000c140: 6f6e 6754 656e 736f 7220 286f 7074 696f  ongTensor (optio
-0000c150: 6e61 6c2c 2064 6566 6175 6c74 3a20 4e6f  nal, default: No
-0000c160: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-0000c170: 4120 7665 6374 6f72 2074 6861 7420 6d61  A vector that ma
-0000c180: 7073 2065 6163 6820 6e6f 6465 2074 6f20  ps each node to 
-0000c190: 6974 7320 7265 7370 6563 7469 7665 2067  its respective g
-0000c1a0: 7261 7068 2069 6465 6e74 6966 6965 722e  raph identifier.
-0000c1b0: 2054 6865 2061 7474 7269 6275 7465 2069   The attribute i
-0000c1c0: 7320 7573 6564 206f 6e6c 7920 7768 656e  s used only when
-0000c1d0: 206d 6f72 6520 7468 616e 206f 6e65 2067   more than one g
-0000c1e0: 7261 7068 2061 7265 2062 6174 6368 6564  raph are batched
-0000c1f0: 2074 6f67 6574 6865 7220 6475 7269 6e67   together during
-0000c200: 2061 2073 696e 676c 6520 666f 7277 6172   a single forwar
-0000c210: 6420 7061 7373 2e0a 2020 2020 2020 2020  d pass..        
-0000c220: 2222 220a 2020 2020 2020 2020 6966 2062  """.        if b
-0000c230: 6174 6368 2069 7320 4e6f 6e65 3a0a 2020  atch is None:.  
-0000c240: 2020 2020 2020 2020 2020 6261 7463 6820            batch 
-0000c250: 3d20 6e6f 6465 5f66 6561 7475 7265 732e  = node_features.
-0000c260: 6e65 775f 7a65 726f 7328 6e6f 6465 5f66  new_zeros(node_f
-0000c270: 6561 7475 7265 732e 7369 7a65 2830 292c  eatures.size(0),
-0000c280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc00: 2069 6e64 6578 3d6e 6f64 655f 6261 7463   index=node_batc
+0000bc10: 685f 6d61 702c 0a20 2020 2020 2020 2020  h_map,.         
+0000bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc30: 2020 2020 2020 2020 2020 2020 6469 6d3d              dim=
+0000bc40: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0000bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc60: 2020 2020 2020 2020 7265 6475 6365 3d27          reduce='
+0000bc70: 6d65 616e 2729 0a20 2020 2020 2020 206f  mean').        o
+0000bc80: 7574 203d 2074 6f72 6368 2e63 6174 280a  ut = torch.cat(.
+0000bc90: 2020 2020 2020 2020 2020 2020 2865 6467              (edg
+0000bca0: 655f 6665 6174 7572 6573 5f6d 6561 6e2c  e_features_mean,
+0000bcb0: 206e 6f64 655f 6665 6174 7572 6573 5f6d   node_features_m
+0000bcc0: 6561 6e2c 2067 6c6f 6261 6c5f 6665 6174  ean, global_feat
+0000bcd0: 7572 6573 292c 2064 696d 3d31 290a 2020  ures), dim=1).  
+0000bce0: 2020 2020 2020 666f 7220 6d6f 6465 6c20        for model 
+0000bcf0: 696e 2073 656c 662e 676c 6f62 616c 5f6d  in self.global_m
+0000bd00: 6f64 656c 733a 0a20 2020 2020 2020 2020  odels:.         
+0000bd10: 2020 206f 7574 203d 206d 6f64 656c 286f     out = model(o
+0000bd20: 7574 290a 2020 2020 2020 2020 7265 7475  ut).        retu
+0000bd30: 726e 2073 656c 662e 676c 6f62 616c 5f64  rn self.global_d
+0000bd40: 656e 7365 286f 7574 290a 0a20 2020 2064  ense(out)..    d
+0000bd50: 6566 2066 6f72 7761 7264 280a 2020 2020  ef forward(.    
+0000bd60: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0000bd70: 2020 2020 2020 2020 2020 6e6f 6465 5f66            node_f
+0000bd80: 6561 7475 7265 733a 2054 656e 736f 722c  eatures: Tensor,
+0000bd90: 0a20 2020 2020 2020 2020 2020 2065 6467  .            edg
+0000bda0: 655f 696e 6465 783a 2054 656e 736f 722c  e_index: Tensor,
+0000bdb0: 0a20 2020 2020 2020 2020 2020 2065 6467  .            edg
+0000bdc0: 655f 6665 6174 7572 6573 3a20 5465 6e73  e_features: Tens
+0000bdd0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0000bde0: 676c 6f62 616c 5f66 6561 7475 7265 733a  global_features:
+0000bdf0: 2054 656e 736f 722c 0a20 2020 2020 2020   Tensor,.       
+0000be00: 2020 2020 2062 6174 6368 3a20 4f70 7469       batch: Opti
+0000be10: 6f6e 616c 5b54 656e 736f 725d 203d 204e  onal[Tensor] = N
+0000be20: 6f6e 6529 202d 3e20 5475 706c 655b 5465  one) -> Tuple[Te
+0000be30: 6e73 6f72 2c20 5465 6e73 6f72 2c20 5465  nsor, Tensor, Te
+0000be40: 6e73 6f72 5d3a 0a20 2020 2020 2020 2022  nsor]:.        "
+0000be50: 2222 4f75 7470 7574 2063 6f6d 7075 7461  ""Output computa
+0000be60: 7469 6f6e 2066 6f72 2061 2047 7261 7068  tion for a Graph
+0000be70: 4e65 7477 6f72 6b0a 0a20 2020 2020 2020  Network..       
+0000be80: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+0000be90: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+0000bea0: 2020 2020 2020 206e 6f64 655f 6665 6174         node_feat
+0000beb0: 7572 6573 3a20 746f 7263 682e 5465 6e73  ures: torch.Tens
+0000bec0: 6f72 0a20 2020 2020 2020 2020 2020 2049  or.            I
+0000bed0: 6e70 7574 206e 6f64 6520 6665 6174 7572  nput node featur
+0000bee0: 6573 206f 6620 7368 6170 6520 3a6d 6174  es of shape :mat
+0000bef0: 683a 6028 7c5c 6d61 7468 6361 6c7b 567d  h:`(|\mathcal{V}
+0000bf00: 7c2c 2046 5f6e 2960 0a20 2020 2020 2020  |, F_n)`.       
+0000bf10: 2065 6467 655f 696e 6465 783a 2074 6f72   edge_index: tor
+0000bf20: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+0000bf30: 2020 2020 2020 4564 6765 2069 6e64 6578        Edge index
+0000bf40: 6573 206f 6620 7368 6170 6520 3a6d 6174  es of shape :mat
+0000bf50: 683a 6028 322c 207c 5c6d 6174 6863 616c  h:`(2, |\mathcal
+0000bf60: 7b45 7d7c 2960 0a20 2020 2020 2020 2065  {E}|)`.        e
+0000bf70: 6467 655f 6665 6174 7572 6573 3a20 746f  dge_features: to
+0000bf80: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+0000bf90: 2020 2020 2020 2045 6467 6520 6665 6174         Edge feat
+0000bfa0: 7572 6573 206f 6620 7468 6520 6772 6170  ures of the grap
+0000bfb0: 682c 2073 6861 7065 3a20 3a6d 6174 683a  h, shape: :math:
+0000bfc0: 6028 7c5c 6d61 7468 6361 6c7b 457d 7c2c  `(|\mathcal{E}|,
+0000bfd0: 2046 5f65 2960 0a20 2020 2020 2020 2067   F_e)`.        g
+0000bfe0: 6c6f 6261 6c5f 6665 6174 7572 6573 3a20  lobal_features: 
+0000bff0: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+0000c000: 2020 2020 2020 2020 2047 6c6f 6261 6c20           Global 
+0000c010: 6665 6174 7572 6573 206f 6620 7468 6520  features of the 
+0000c020: 6772 6170 682c 2073 6861 7065 3a20 3a6d  graph, shape: :m
+0000c030: 6174 683a 6028 465f 672c 2031 2960 2077  ath:`(F_g, 1)` w
+0000c040: 6865 7265 2c20 3a6d 6174 683a 607c 5c6d  here, :math:`|\m
+0000c050: 6174 6863 616c 7b56 7d7c 6020 616e 6420  athcal{V}|` and 
+0000c060: 3a6d 6174 683a 607c 5c6d 6174 6863 616c  :math:`|\mathcal
+0000c070: 7b45 7d7c 6020 6465 6e6f 7465 7320 7468  {E}|` denotes th
+0000c080: 6520 6e75 6d62 6572 206f 6620 6e6f 6465  e number of node
+0000c090: 7320 616e 6420 6564 6765 7320 696e 2074  s and edges in t
+0000c0a0: 6865 2067 7261 7068 2c0a 2020 2020 2020  he graph,.      
+0000c0b0: 2020 2020 2020 3a6d 6174 683a 6046 5f6e        :math:`F_n
+0000c0c0: 602c 203a 6d61 7468 3a60 465f 6560 2c20  `, :math:`F_e`, 
+0000c0d0: 3a6d 6174 683a 6046 5f67 6020 6465 6e6f  :math:`F_g` deno
+0000c0e0: 7465 7320 7468 6520 6e75 6d62 6572 206f  tes the number o
+0000c0f0: 6620 6e6f 6465 2066 6561 7475 7265 732c  f node features,
+0000c100: 2065 6467 6520 6665 6174 7572 6573 2061   edge features a
+0000c110: 6e64 2067 6c6f 6261 6c20 7374 6174 6520  nd global state 
+0000c120: 6665 6174 7572 6573 2072 6573 7065 6374  features respect
+0000c130: 6976 656c 792e 0a20 2020 2020 2020 2062  ively..        b
+0000c140: 6174 6368 3a20 746f 7263 682e 4c6f 6e67  atch: torch.Long
+0000c150: 5465 6e73 6f72 2028 6f70 7469 6f6e 616c  Tensor (optional
+0000c160: 2c20 6465 6661 756c 743a 204e 6f6e 6529  , default: None)
+0000c170: 0a20 2020 2020 2020 2020 2020 2041 2076  .            A v
+0000c180: 6563 746f 7220 7468 6174 206d 6170 7320  ector that maps 
+0000c190: 6561 6368 206e 6f64 6520 746f 2069 7473  each node to its
+0000c1a0: 2072 6573 7065 6374 6976 6520 6772 6170   respective grap
+0000c1b0: 6820 6964 656e 7469 6669 6572 2e20 5468  h identifier. Th
+0000c1c0: 6520 6174 7472 6962 7574 6520 6973 2075  e attribute is u
+0000c1d0: 7365 6420 6f6e 6c79 2077 6865 6e20 6d6f  sed only when mo
+0000c1e0: 7265 2074 6861 6e20 6f6e 6520 6772 6170  re than one grap
+0000c1f0: 6820 6172 6520 6261 7463 6865 6420 746f  h are batched to
+0000c200: 6765 7468 6572 2064 7572 696e 6720 6120  gether during a 
+0000c210: 7369 6e67 6c65 2066 6f72 7761 7264 2070  single forward p
+0000c220: 6173 732e 0a20 2020 2020 2020 2022 2222  ass..        """
+0000c230: 0a20 2020 2020 2020 2069 6620 6261 7463  .        if batc
+0000c240: 6820 6973 204e 6f6e 653a 0a20 2020 2020  h is None:.     
+0000c250: 2020 2020 2020 2062 6174 6368 203d 206e         batch = n
+0000c260: 6f64 655f 6665 6174 7572 6573 2e6e 6577  ode_features.new
+0000c270: 5f7a 6572 6f73 286e 6f64 655f 6665 6174  _zeros(node_feat
+0000c280: 7572 6573 2e73 697a 6528 3029 2c0a 2020  ures.size(0),.  
 0000c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2a0: 2020 2020 2020 2020 2020 2020 2064 7479               dty
-0000c2b0: 7065 3d74 6f72 6368 2e69 6e74 3634 290a  pe=torch.int64).
-0000c2c0: 0a20 2020 2020 2020 206e 6f64 655f 6665  .        node_fe
-0000c2d0: 6174 7572 6573 5f63 6f70 792c 2065 6467  atures_copy, edg
-0000c2e0: 655f 6665 6174 7572 6573 5f63 6f70 792c  e_features_copy,
-0000c2f0: 2067 6c6f 6261 6c5f 6665 6174 7572 6573   global_features
-0000c300: 5f63 6f70 7920 3d20 6e6f 6465 5f66 6561  _copy = node_fea
-0000c310: 7475 7265 732c 2065 6467 655f 6665 6174  tures, edge_feat
-0000c320: 7572 6573 2c20 676c 6f62 616c 5f66 6561  ures, global_fea
-0000c330: 7475 7265 730a 2020 2020 2020 2020 6966  tures.        if
-0000c340: 2073 656c 662e 6973 5f75 6e64 6972 6563   self.is_undirec
-0000c350: 7465 6420 6973 2054 7275 653a 0a20 2020  ted is True:.   
-0000c360: 2020 2020 2020 2020 2023 2068 6f6c 6469           # holdi
-0000c370: 6e67 2062 692d 6469 7265 6374 696f 6e61  ng bi-directiona
-0000c380: 6c20 6564 6765 7320 696e 2063 6173 6520  l edges in case 
-0000c390: 6f66 2075 6e64 6972 6563 7465 6420 6772  of undirected gr
-0000c3a0: 6170 6873 0a20 2020 2020 2020 2020 2020  aphs.           
-0000c3b0: 2065 6467 655f 696e 6465 7820 3d20 746f   edge_index = to
-0000c3c0: 7263 682e 6361 7428 2865 6467 655f 696e  rch.cat((edge_in
-0000c3d0: 6465 782c 2065 6467 655f 696e 6465 782e  dex, edge_index.
-0000c3e0: 666c 6970 285b 305d 2929 2c20 6469 6d3d  flip([0])), dim=
-0000c3f0: 3129 0a20 2020 2020 2020 2020 2020 2065  1).            e
-0000c400: 6467 655f 6665 6174 7572 6573 5f6c 656e  dge_features_len
-0000c410: 203d 2065 6467 655f 6665 6174 7572 6573   = edge_features
-0000c420: 2e73 6861 7065 5b30 5d0a 2020 2020 2020  .shape[0].      
-0000c430: 2020 2020 2020 6564 6765 5f66 6561 7475        edge_featu
-0000c440: 7265 7320 3d20 746f 7263 682e 6361 7428  res = torch.cat(
-0000c450: 2865 6467 655f 6665 6174 7572 6573 2c20  (edge_features, 
-0000c460: 6564 6765 5f66 6561 7475 7265 7329 2c20  edge_features), 
-0000c470: 6469 6d3d 3029 0a20 2020 2020 2020 2065  dim=0).        e
-0000c480: 6467 655f 6261 7463 685f 6d61 7020 3d20  dge_batch_map = 
-0000c490: 6261 7463 685b 6564 6765 5f69 6e64 6578  batch[edge_index
-0000c4a0: 5b30 5d5d 0a20 2020 2020 2020 2065 6467  [0]].        edg
-0000c4b0: 655f 6665 6174 7572 6573 203d 2073 656c  e_features = sel
-0000c4c0: 662e 5f75 7064 6174 655f 6564 6765 5f66  f._update_edge_f
-0000c4d0: 6561 7475 7265 7328 6e6f 6465 5f66 6561  eatures(node_fea
-0000c4e0: 7475 7265 732c 2065 6467 655f 696e 6465  tures, edge_inde
-0000c4f0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+0000c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2b0: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
+0000c2c0: 746f 7263 682e 696e 7436 3429 0a0a 2020  torch.int64)..  
+0000c2d0: 2020 2020 2020 6e6f 6465 5f66 6561 7475        node_featu
+0000c2e0: 7265 735f 636f 7079 2c20 6564 6765 5f66  res_copy, edge_f
+0000c2f0: 6561 7475 7265 735f 636f 7079 2c20 676c  eatures_copy, gl
+0000c300: 6f62 616c 5f66 6561 7475 7265 735f 636f  obal_features_co
+0000c310: 7079 203d 206e 6f64 655f 6665 6174 7572  py = node_featur
+0000c320: 6573 2c20 6564 6765 5f66 6561 7475 7265  es, edge_feature
+0000c330: 732c 2067 6c6f 6261 6c5f 6665 6174 7572  s, global_featur
+0000c340: 6573 0a20 2020 2020 2020 2069 6620 7365  es.        if se
+0000c350: 6c66 2e69 735f 756e 6469 7265 6374 6564  lf.is_undirected
+0000c360: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
+0000c370: 2020 2020 2020 2320 686f 6c64 696e 6720        # holding 
+0000c380: 6269 2d64 6972 6563 7469 6f6e 616c 2065  bi-directional e
+0000c390: 6467 6573 2069 6e20 6361 7365 206f 6620  dges in case of 
+0000c3a0: 756e 6469 7265 6374 6564 2067 7261 7068  undirected graph
+0000c3b0: 730a 2020 2020 2020 2020 2020 2020 6564  s.            ed
+0000c3c0: 6765 5f69 6e64 6578 203d 2074 6f72 6368  ge_index = torch
+0000c3d0: 2e63 6174 2828 6564 6765 5f69 6e64 6578  .cat((edge_index
+0000c3e0: 2c20 6564 6765 5f69 6e64 6578 2e66 6c69  , edge_index.fli
+0000c3f0: 7028 5b30 5d29 292c 2064 696d 3d31 290a  p([0])), dim=1).
+0000c400: 2020 2020 2020 2020 2020 2020 6564 6765              edge
+0000c410: 5f66 6561 7475 7265 735f 6c65 6e20 3d20  _features_len = 
+0000c420: 6564 6765 5f66 6561 7475 7265 732e 7368  edge_features.sh
+0000c430: 6170 655b 305d 0a20 2020 2020 2020 2020  ape[0].         
+0000c440: 2020 2065 6467 655f 6665 6174 7572 6573     edge_features
+0000c450: 203d 2074 6f72 6368 2e63 6174 2828 6564   = torch.cat((ed
+0000c460: 6765 5f66 6561 7475 7265 732c 2065 6467  ge_features, edg
+0000c470: 655f 6665 6174 7572 6573 292c 2064 696d  e_features), dim
+0000c480: 3d30 290a 2020 2020 2020 2020 6564 6765  =0).        edge
+0000c490: 5f62 6174 6368 5f6d 6170 203d 2062 6174  _batch_map = bat
+0000c4a0: 6368 5b65 6467 655f 696e 6465 785b 305d  ch[edge_index[0]
+0000c4b0: 5d0a 2020 2020 2020 2020 6564 6765 5f66  ].        edge_f
+0000c4c0: 6561 7475 7265 7320 3d20 7365 6c66 2e5f  eatures = self._
+0000c4d0: 7570 6461 7465 5f65 6467 655f 6665 6174  update_edge_feat
+0000c4e0: 7572 6573 286e 6f64 655f 6665 6174 7572  ures(node_featur
+0000c4f0: 6573 2c20 6564 6765 5f69 6e64 6578 2c0a  es, edge_index,.
 0000c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c520: 2020 2020 2020 6564 6765 5f66 6561 7475        edge_featu
-0000c530: 7265 732c 0a20 2020 2020 2020 2020 2020  res,.           
-0000c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c530: 2020 2065 6467 655f 6665 6174 7572 6573     edge_features
+0000c540: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0000c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c560: 2020 2020 2020 2020 676c 6f62 616c 5f66          global_f
-0000c570: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
-0000c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c570: 2020 2020 2067 6c6f 6261 6c5f 6665 6174       global_feat
+0000c580: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
 0000c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5a0: 2020 2020 2020 2020 2020 2020 6564 6765              edge
-0000c5b0: 5f62 6174 6368 5f6d 6170 290a 2020 2020  _batch_map).    
-0000c5c0: 2020 2020 6e6f 6465 5f66 6561 7475 7265      node_feature
-0000c5d0: 7320 3d20 7365 6c66 2e5f 7570 6461 7465  s = self._update
-0000c5e0: 5f6e 6f64 655f 6665 6174 7572 6573 286e  _node_features(n
-0000c5f0: 6f64 655f 6665 6174 7572 6573 2c20 6564  ode_features, ed
-0000c600: 6765 5f69 6e64 6578 2c0a 2020 2020 2020  ge_index,.      
-0000c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5b0: 2020 2020 2020 2020 2065 6467 655f 6261           edge_ba
+0000c5c0: 7463 685f 6d61 7029 0a20 2020 2020 2020  tch_map).       
+0000c5d0: 206e 6f64 655f 6665 6174 7572 6573 203d   node_features =
+0000c5e0: 2073 656c 662e 5f75 7064 6174 655f 6e6f   self._update_no
+0000c5f0: 6465 5f66 6561 7475 7265 7328 6e6f 6465  de_features(node
+0000c600: 5f66 6561 7475 7265 732c 2065 6467 655f  _features, edge_
+0000c610: 696e 6465 782c 0a20 2020 2020 2020 2020  index,.         
 0000c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c630: 2020 2020 2020 2020 2020 2020 2065 6467               edg
-0000c640: 655f 6665 6174 7572 6573 2c0a 2020 2020  e_features,.    
-0000c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c640: 2020 2020 2020 2020 2020 6564 6765 5f66            edge_f
+0000c650: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
 0000c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c670: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000c680: 6c6f 6261 6c5f 6665 6174 7572 6573 2c20  lobal_features, 
-0000c690: 6261 7463 6829 0a20 2020 2020 2020 2067  batch).        g
-0000c6a0: 6c6f 6261 6c5f 6665 6174 7572 6573 203d  lobal_features =
-0000c6b0: 2073 656c 662e 5f75 7064 6174 655f 676c   self._update_gl
-0000c6c0: 6f62 616c 5f66 6561 7475 7265 7328 6e6f  obal_features(no
-0000c6d0: 6465 5f66 6561 7475 7265 732c 0a20 2020  de_features,.   
-0000c6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c680: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
+0000c690: 616c 5f66 6561 7475 7265 732c 2062 6174  al_features, bat
+0000c6a0: 6368 290a 2020 2020 2020 2020 676c 6f62  ch).        glob
+0000c6b0: 616c 5f66 6561 7475 7265 7320 3d20 7365  al_features = se
+0000c6c0: 6c66 2e5f 7570 6461 7465 5f67 6c6f 6261  lf._update_globa
+0000c6d0: 6c5f 6665 6174 7572 6573 286e 6f64 655f  l_features(node_
+0000c6e0: 6665 6174 7572 6573 2c0a 2020 2020 2020  features,.      
 0000c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c710: 2020 2020 6564 6765 5f66 6561 7475 7265      edge_feature
-0000c720: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c720: 2065 6467 655f 6665 6174 7572 6573 2c0a   edge_features,.
 0000c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c750: 2020 2020 2020 2020 2020 676c 6f62 616c            global
-0000c760: 5f66 6561 7475 7265 732c 2062 6174 6368  _features, batch
-0000c770: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c760: 2020 2020 2020 2067 6c6f 6261 6c5f 6665         global_fe
+0000c770: 6174 7572 6573 2c20 6261 7463 682c 0a20  atures, batch,. 
 0000c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7a0: 2020 2020 2020 2020 2065 6467 655f 6261           edge_ba
-0000c7b0: 7463 685f 6d61 7029 0a0a 2020 2020 2020  tch_map)..      
-0000c7c0: 2020 6966 2073 656c 662e 6973 5f75 6e64    if self.is_und
-0000c7d0: 6972 6563 7465 6420 6973 2054 7275 653a  irected is True:
-0000c7e0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0000c7f0: 6f6f 6e76 6572 7469 6e67 2065 6467 6520  oonverting edge 
-0000c800: 6665 6174 7572 6573 2074 6f20 6974 7320  features to its 
-0000c810: 6f72 6967 696e 616c 2073 6861 7065 0a20  original shape. 
-0000c820: 2020 2020 2020 2020 2020 2073 706c 6974             split
-0000c830: 203d 2074 6f72 6368 2e73 706c 6974 2865   = torch.split(e
-0000c840: 6467 655f 6665 6174 7572 6573 2c0a 2020  dge_features,.  
-0000c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c860: 2020 2020 2020 2020 2020 2020 2020 5b65                [e
-0000c870: 6467 655f 6665 6174 7572 6573 5f6c 656e  dge_features_len
-0000c880: 2c20 6564 6765 5f66 6561 7475 7265 735f  , edge_features_
-0000c890: 6c65 6e5d 290a 2020 2020 2020 2020 2020  len]).          
-0000c8a0: 2020 6564 6765 5f66 6561 7475 7265 7320    edge_features 
-0000c8b0: 3d20 2873 706c 6974 5b30 5d20 2b20 7370  = (split[0] + sp
-0000c8c0: 6c69 745b 315d 2920 2f20 320a 0a20 2020  lit[1]) / 2..   
-0000c8d0: 2020 2020 2069 6620 7365 6c66 2e72 6573       if self.res
-0000c8e0: 6964 7561 6c5f 636f 6e6e 6563 7469 6f6e  idual_connection
-0000c8f0: 3a0a 2020 2020 2020 2020 2020 2020 6564  :.            ed
-0000c900: 6765 5f66 6561 7475 7265 7320 2b3d 2065  ge_features += e
-0000c910: 6467 655f 6665 6174 7572 6573 5f63 6f70  dge_features_cop
-0000c920: 790a 2020 2020 2020 2020 2020 2020 6e6f  y.            no
-0000c930: 6465 5f66 6561 7475 7265 7320 2b3d 206e  de_features += n
-0000c940: 6f64 655f 6665 6174 7572 6573 5f63 6f70  ode_features_cop
-0000c950: 790a 2020 2020 2020 2020 2020 2020 676c  y.            gl
-0000c960: 6f62 616c 5f66 6561 7475 7265 7320 2b3d  obal_features +=
-0000c970: 2067 6c6f 6261 6c5f 6665 6174 7572 6573   global_features
-0000c980: 5f63 6f70 790a 0a20 2020 2020 2020 2072  _copy..        r
-0000c990: 6574 7572 6e20 6e6f 6465 5f66 6561 7475  eturn node_featu
-0000c9a0: 7265 732c 2065 6467 655f 6665 6174 7572  res, edge_featur
-0000c9b0: 6573 2c20 676c 6f62 616c 5f66 6561 7475  es, global_featu
-0000c9c0: 7265 730a 0a20 2020 2064 6566 205f 5f72  res..    def __r
-0000c9d0: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
-0000c9e0: 7472 3a0a 2020 2020 2020 2020 7265 7475  tr:.        retu
-0000c9f0: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-0000ca00: 2066 277b 7365 6c66 2e5f 5f63 6c61 7373   f'{self.__class
-0000ca10: 5f5f 2e5f 5f6e 616d 655f 5f7d 286e 5f6e  __.__name__}(n_n
-0000ca20: 6f64 655f 6665 6174 7572 6573 3d7b 7365  ode_features={se
-0000ca30: 6c66 2e6e 5f6e 6f64 655f 6665 6174 7572  lf.n_node_featur
-0000ca40: 6573 7d2c 206e 5f65 6467 655f 6665 6174  es}, n_edge_feat
-0000ca50: 7572 6573 3d7b 7365 6c66 2e6e 5f65 6467  ures={self.n_edg
-0000ca60: 655f 6665 6174 7572 6573 7d2c 206e 5f67  e_features}, n_g
-0000ca70: 6c6f 6261 6c5f 6665 6174 7572 6573 3d7b  lobal_features={
-0000ca80: 7365 6c66 2e6e 5f67 6c6f 6261 6c5f 6665  self.n_global_fe
-0000ca90: 6174 7572 6573 7d2c 2069 735f 756e 6469  atures}, is_undi
-0000caa0: 7265 6374 6564 3d7b 7365 6c66 2e69 735f  rected={self.is_
-0000cab0: 756e 6469 7265 6374 6564 7d2c 2072 6573  undirected}, res
-0000cac0: 6964 7561 6c5f 636f 6e6e 6563 7469 6f6e  idual_connection
-0000cad0: 3d7b 7365 6c66 2e72 6573 6964 7561 6c5f  ={self.residual_
-0000cae0: 636f 6e6e 6563 7469 6f6e 7d29 270a 2020  connection})'.  
-0000caf0: 2020 2020 2020 290a 0a0a 636c 6173 7320        )...class 
-0000cb00: 4166 6669 6e65 286e 6e2e 4d6f 6475 6c65  Affine(nn.Module
-0000cb10: 293a 0a20 2020 2022 2222 436c 6173 7320  ):.    """Class 
-0000cb20: 7768 6963 6820 7065 7266 6f72 6d73 2074  which performs t
-0000cb30: 6865 2041 6666 696e 6520 7472 616e 7366  he Affine transf
-0000cb40: 6f72 6d61 7469 6f6e 2e0a 0a20 2020 2054  ormation...    T
-0000cb50: 6869 7320 7472 616e 7366 6f72 6d61 7469  his transformati
-0000cb60: 6f6e 2069 7320 6261 7365 6420 6f6e 2074  on is based on t
-0000cb70: 6865 2061 6666 696e 6974 7920 6f66 2074  he affinity of t
-0000cb80: 6865 2062 6173 6520 6469 7374 7269 6275  he base distribu
-0000cb90: 7469 6f6e 2077 6974 680a 2020 2020 7468  tion with.    th
-0000cba0: 6520 7461 7267 6574 2064 6973 7472 6962  e target distrib
-0000cbb0: 7574 696f 6e2e 2041 2067 656f 6d65 7472  ution. A geometr
-0000cbc0: 6963 2074 7261 6e73 666f 726d 6174 696f  ic transformatio
-0000cbd0: 6e20 6973 2061 7070 6c69 6564 2077 6865  n is applied whe
-0000cbe0: 7265 0a20 2020 2074 6865 2070 6172 616d  re.    the param
-0000cbf0: 6574 6572 7320 7065 7266 6f72 6d73 2063  eters performs c
-0000cc00: 6861 6e67 6573 206f 6e20 7468 6520 7363  hanges on the sc
-0000cc10: 616c 6520 616e 6420 7368 6966 7420 6f66  ale and shift of
-0000cc20: 2061 2066 756e 6374 696f 6e0a 2020 2020   a function.    
-0000cc30: 2869 6e70 7574 7329 2e0a 0a20 2020 204e  (inputs)...    N
-0000cc40: 6f72 6d61 6c69 7a69 6e67 2046 6c6f 7720  ormalizing Flow 
-0000cc50: 7472 616e 7366 6f72 6d61 7469 6f6e 7320  transformations 
-0000cc60: 6d75 7374 2062 6520 6269 6a65 6374 6976  must be bijectiv
-0000cc70: 6520 696e 206f 7264 6572 2074 6f20 636f  e in order to co
-0000cc80: 6d70 7574 650a 2020 2020 7468 6520 6c6f  mpute.    the lo
-0000cc90: 6761 7269 7468 6d20 6f66 206a 6163 6f62  garithm of jacob
-0000cca0: 6961 6e27 7320 6465 7465 726d 696e 616e  ian's determinan
-0000ccb0: 742e 2046 6f72 2074 6869 7320 7265 6173  t. For this reas
-0000ccc0: 6f6e 2c20 7472 616e 7366 6f72 6d61 7469  on, transformati
-0000ccd0: 6f6e 730a 2020 2020 6d75 7374 2070 6572  ons.    must per
-0000cce0: 666f 726d 2061 2066 6f72 7761 7264 2061  form a forward a
-0000ccf0: 6e64 2069 6e76 6572 7365 2070 6173 732e  nd inverse pass.
-0000cd00: 0a0a 2020 2020 4578 616d 706c 650a 2020  ..    Example.  
-0000cd10: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
-0000cd20: 3e3e 2069 6d70 6f72 7420 6465 6570 6368  >> import deepch
-0000cd30: 656d 2061 7320 6463 0a20 2020 203e 3e3e  em as dc.    >>>
-0000cd40: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
-0000cd50: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
-0000cd60: 6c73 2e6c 6179 6572 7320 696d 706f 7274  ls.layers import
-0000cd70: 2041 6666 696e 650a 2020 2020 3e3e 3e20   Affine.    >>> 
-0000cd80: 696d 706f 7274 2074 6f72 6368 0a20 2020  import torch.   
-0000cd90: 203e 3e3e 2066 726f 6d20 746f 7263 682e   >>> from torch.
-0000cda0: 6469 7374 7269 6275 7469 6f6e 7320 696d  distributions im
-0000cdb0: 706f 7274 204d 756c 7469 7661 7269 6174  port Multivariat
-0000cdc0: 654e 6f72 6d61 6c0a 2020 2020 3e3e 3e20  eNormal.    >>> 
-0000cdd0: 2320 696e 6974 6961 6c69 7a65 2074 6865  # initialize the
-0000cde0: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
-0000cdf0: 6c61 7965 7227 7320 7061 7261 6d65 7465  layer's paramete
-0000ce00: 7273 0a20 2020 203e 3e3e 2064 696d 203d  rs.    >>> dim =
-0000ce10: 2032 0a20 2020 203e 3e3e 2073 616d 706c   2.    >>> sampl
-0000ce20: 6573 203d 2039 360a 2020 2020 3e3e 3e20  es = 96.    >>> 
-0000ce30: 7472 616e 7366 6f72 6d73 203d 2041 6666  transforms = Aff
-0000ce40: 696e 6528 6469 6d29 0a20 2020 203e 3e3e  ine(dim).    >>>
-0000ce50: 2023 2066 6f72 7761 7264 2070 6173 7320   # forward pass 
-0000ce60: 6261 7365 6420 6f6e 2061 2067 6976 656e  based on a given
-0000ce70: 2064 6973 7472 6962 7574 696f 6e0a 2020   distribution.  
-0000ce80: 2020 3e3e 3e20 6469 7374 7269 6275 7469    >>> distributi
-0000ce90: 6f6e 203d 204d 756c 7469 7661 7269 6174  on = Multivariat
-0000cea0: 654e 6f72 6d61 6c28 746f 7263 682e 7a65  eNormal(torch.ze
-0000ceb0: 726f 7328 6469 6d29 2c20 746f 7263 682e  ros(dim), torch.
-0000cec0: 6579 6528 6469 6d29 290a 2020 2020 3e3e  eye(dim)).    >>
-0000ced0: 3e20 696e 7075 7420 3d20 6469 7374 7269  > input = distri
-0000cee0: 6275 7469 6f6e 2e73 616d 706c 6528 746f  bution.sample(to
-0000cef0: 7263 682e 5369 7a65 2828 7361 6d70 6c65  rch.Size((sample
-0000cf00: 732c 2064 696d 2929 290a 2020 2020 3e3e  s, dim))).    >>
-0000cf10: 3e20 6c65 6e28 7472 616e 7366 6f72 6d73  > len(transforms
-0000cf20: 2e66 6f72 7761 7264 2869 6e70 7574 2929  .forward(input))
-0000cf30: 0a20 2020 2032 0a20 2020 203e 3e3e 2023  .    2.    >>> #
-0000cf40: 2069 6e76 6572 7365 2070 6173 7320 6261   inverse pass ba
-0000cf50: 7365 6420 6f6e 2061 2064 6973 7472 6962  sed on a distrib
-0000cf60: 7574 696f 6e0a 2020 2020 3e3e 3e20 6c65  ution.    >>> le
-0000cf70: 6e28 7472 616e 7366 6f72 6d73 2e69 6e76  n(transforms.inv
-0000cf80: 6572 7365 2869 6e70 7574 2929 0a20 2020  erse(input)).   
-0000cf90: 2032 0a0a 2020 2020 2222 220a 0a20 2020   2..    """..   
-0000cfa0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-0000cfb0: 6c66 2c20 6469 6d3a 2069 6e74 2920 2d3e  lf, dim: int) ->
-0000cfc0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-0000cfd0: 2222 4372 6561 7465 2061 2041 6666 696e  ""Create a Affin
-0000cfe0: 6520 7472 616e 7366 6f72 6d20 6c61 7965  e transform laye
-0000cff0: 722e 0a0a 2020 2020 2020 2020 5061 7261  r...        Para
-0000d000: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-0000d010: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-0000d020: 2020 6469 6d3a 2069 6e74 0a20 2020 2020    dim: int.     
-0000d030: 2020 2020 2020 2056 616c 7565 206f 6620         Value of 
-0000d040: 7468 6520 4e74 6820 6469 6d65 6e73 696f  the Nth dimensio
-0000d050: 6e20 6f66 2074 6865 2064 6174 6173 6574  n of the dataset
-0000d060: 2e0a 0a20 2020 2020 2020 2022 2222 0a0a  ...        """..
-0000d070: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-0000d080: 5f5f 696e 6974 5f5f 2829 0a20 2020 2020  __init__().     
-0000d090: 2020 2073 656c 662e 6469 6d20 3d20 6469     self.dim = di
-0000d0a0: 6d0a 2020 2020 2020 2020 7365 6c66 2e73  m.        self.s
-0000d0b0: 6361 6c65 203d 206e 6e2e 5061 7261 6d65  cale = nn.Parame
-0000d0c0: 7465 7228 746f 7263 682e 7a65 726f 7328  ter(torch.zeros(
-0000d0d0: 7365 6c66 2e64 696d 2929 0a20 2020 2020  self.dim)).     
-0000d0e0: 2020 2073 656c 662e 7368 6966 7420 3d20     self.shift = 
-0000d0f0: 6e6e 2e50 6172 616d 6574 6572 2874 6f72  nn.Parameter(tor
-0000d100: 6368 2e7a 6572 6f73 2873 656c 662e 6469  ch.zeros(self.di
-0000d110: 6d29 290a 0a20 2020 2064 6566 2066 6f72  m))..    def for
-0000d120: 7761 7264 2873 656c 662c 2078 3a20 5365  ward(self, x: Se
-0000d130: 7175 656e 6365 2920 2d3e 2054 7570 6c65  quence) -> Tuple
-0000d140: 5b74 6f72 6368 2e54 656e 736f 722c 2074  [torch.Tensor, t
-0000d150: 6f72 6368 2e54 656e 736f 725d 3a0a 2020  orch.Tensor]:.  
-0000d160: 2020 2020 2020 2222 2250 6572 666f 726d        """Perform
-0000d170: 7320 6120 7472 616e 7366 6f72 6d61 7469  s a transformati
-0000d180: 6f6e 2062 6574 7765 656e 2074 776f 2064  on between two d
-0000d190: 6966 6665 7265 6e74 2064 6973 7472 6962  ifferent distrib
-0000d1a0: 7574 696f 6e73 2e20 5468 6973 0a20 2020  utions. This.   
-0000d1b0: 2020 2020 2070 6172 7469 6375 6c61 7220       particular 
-0000d1c0: 7472 616e 7366 6f72 6d61 7469 6f6e 2072  transformation r
-0000d1d0: 6570 7265 7365 6e74 7320 7468 6520 666f  epresents the fo
-0000d1e0: 6c6c 6f77 696e 6720 6675 6e63 7469 6f6e  llowing function
-0000d1f0: 3a0a 2020 2020 2020 2020 7920 3d20 7820  :.        y = x 
-0000d200: 2a20 6578 7028 6129 202b 2062 2c20 7768  * exp(a) + b, wh
-0000d210: 6572 6520 6120 6973 2073 6361 6c65 2070  ere a is scale p
-0000d220: 6172 616d 6574 6572 2061 6e64 2062 2070  arameter and b p
-0000d230: 6572 666f 726d 7320 6120 7368 6966 742e  erforms a shift.
-0000d240: 0a20 2020 2020 2020 2054 6869 7320 636c  .        This cl
-0000d250: 6173 7320 616c 736f 2072 6574 7572 6e73  ass also returns
-0000d260: 2074 6865 206c 6f67 6172 6974 686d 206f   the logarithm o
-0000d270: 6620 7468 6520 6a61 636f 6269 616e 7320  f the jacobians 
-0000d280: 6465 7465 726d 696e 616e 740a 2020 2020  determinant.    
-0000d290: 2020 2020 7768 6963 6820 6973 2075 7365      which is use
-0000d2a0: 6675 6c20 7768 656e 2069 6e76 6572 7420  ful when invert 
-0000d2b0: 6120 7472 616e 7366 6f72 6d61 7469 6f6e  a transformation
-0000d2c0: 2061 6e64 2063 6f6d 7075 7465 2074 6865   and compute the
-0000d2d0: 0a20 2020 2020 2020 2070 726f 6261 6269  .        probabi
-0000d2e0: 6c69 7479 206f 6620 7468 6520 7472 616e  lity of the tran
-0000d2f0: 7366 6f72 6d61 7469 6f6e 2e0a 0a20 2020  sformation...   
-0000d300: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-0000d310: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0000d320: 2d2d 0a20 2020 2020 2020 2078 203a 2053  --.        x : S
-0000d330: 6571 7565 6e63 650a 2020 2020 2020 2020  equence.        
-0000d340: 2020 2020 5465 6e73 6f72 2073 616d 706c      Tensor sampl
-0000d350: 6520 7769 7468 2074 6865 2069 6e69 7469  e with the initi
-0000d360: 616c 2064 6973 7472 6962 7574 696f 6e20  al distribution 
-0000d370: 6461 7461 2077 6869 6368 2077 696c 6c20  data which will 
-0000d380: 7061 7373 2069 6e74 6f0a 2020 2020 2020  pass into.      
-0000d390: 2020 2020 2020 7468 6520 6e6f 726d 616c        the normal
-0000d3a0: 697a 696e 6720 666c 6f77 2061 6c67 6f72  izing flow algor
-0000d3b0: 6974 686d 2e0a 0a20 2020 2020 2020 2052  ithm...        R
-0000d3c0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-0000d3d0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2079  ------.        y
-0000d3e0: 203a 2074 6f72 6368 2e54 656e 736f 720a   : torch.Tensor.
-0000d3f0: 2020 2020 2020 2020 2020 2020 5472 616e              Tran
-0000d400: 7366 6f72 6d65 6420 7465 6e73 6f72 2061  sformed tensor a
-0000d410: 6363 6f72 6469 6e67 2074 6f20 4166 6669  ccording to Affi
-0000d420: 6e65 206c 6179 6572 2077 6974 6820 7468  ne layer with th
-0000d430: 6520 7368 6170 6520 6f66 2027 7827 2e0a  e shape of 'x'..
-0000d440: 2020 2020 2020 2020 6c6f 675f 6465 745f          log_det_
-0000d450: 6a61 636f 6269 616e 203a 2074 6f72 6368  jacobian : torch
-0000d460: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-0000d470: 2020 2020 5465 6e73 6f72 2077 6869 6368      Tensor which
-0000d480: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
-0000d490: 696e 666f 2061 626f 7574 2074 6865 2064  info about the d
-0000d4a0: 6576 6961 7469 6f6e 206f 6620 7468 6520  eviation of the 
-0000d4b0: 696e 6974 6961 6c0a 2020 2020 2020 2020  initial.        
-0000d4c0: 2020 2020 616e 6420 7461 7267 6574 2064      and target d
-0000d4d0: 6973 7472 6962 7574 696f 6e2e 0a0a 2020  istribution...  
-0000d4e0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000d4f0: 2020 2079 203d 2074 6f72 6368 2e65 7870     y = torch.exp
-0000d500: 2873 656c 662e 7363 616c 6529 202a 2078  (self.scale) * x
-0000d510: 202b 2073 656c 662e 7368 6966 740a 2020   + self.shift.  
-0000d520: 2020 2020 2020 6465 745f 6a61 636f 6269        det_jacobi
-0000d530: 616e 203d 2074 6f72 6368 2e65 7870 2873  an = torch.exp(s
-0000d540: 656c 662e 7363 616c 652e 7375 6d28 2929  elf.scale.sum())
-0000d550: 0a20 2020 2020 2020 206c 6f67 5f64 6574  .        log_det
-0000d560: 5f6a 6163 6f62 6961 6e20 3d20 746f 7263  _jacobian = torc
-0000d570: 682e 6f6e 6573 2879 2e73 6861 7065 5b30  h.ones(y.shape[0
-0000d580: 5d29 202a 2074 6f72 6368 2e6c 6f67 2864  ]) * torch.log(d
-0000d590: 6574 5f6a 6163 6f62 6961 6e29 0a0a 2020  et_jacobian)..  
-0000d5a0: 2020 2020 2020 7265 7475 726e 2079 2c20        return y, 
-0000d5b0: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
-0000d5c0: 0a0a 2020 2020 6465 6620 696e 7665 7273  ..    def invers
-0000d5d0: 6528 7365 6c66 2c20 793a 2053 6571 7565  e(self, y: Seque
-0000d5e0: 6e63 6529 202d 3e20 5475 706c 655b 746f  nce) -> Tuple[to
-0000d5f0: 7263 682e 5465 6e73 6f72 2c20 746f 7263  rch.Tensor, torc
-0000d600: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
-0000d610: 2020 2022 2222 5065 7266 6f72 6d73 2061     """Performs a
-0000d620: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
-0000d630: 6265 7477 6565 6e20 7477 6f20 6469 6666  between two diff
-0000d640: 6572 656e 7420 6469 7374 7269 6275 7469  erent distributi
-0000d650: 6f6e 732e 0a20 2020 2020 2020 2054 6869  ons..        Thi
-0000d660: 7320 7472 616e 7366 6f72 6d61 7469 6f6e  s transformation
-0000d670: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
-0000d680: 6261 6377 6172 6420 7061 7373 206f 6620  bacward pass of 
-0000d690: 7468 6520 6675 6e63 7469 6f6e 0a20 2020  the function.   
-0000d6a0: 2020 2020 206d 656e 7469 6f6e 2062 6566       mention bef
-0000d6b0: 6f72 652e 2049 7473 206d 6174 6865 6d61  ore. Its mathema
-0000d6c0: 7469 6361 6c20 7265 7072 6573 656e 7461  tical representa
-0000d6d0: 7469 6f6e 2069 7320 7820 3d20 2879 202d  tion is x = (y -
-0000d6e0: 2062 2920 2f20 6578 7028 6129 0a20 2020   b) / exp(a).   
-0000d6f0: 2020 2020 202c 2077 6865 7265 2022 6122       , where "a"
-0000d700: 2069 7320 7363 616c 6520 7061 7261 6d65   is scale parame
-0000d710: 7465 7220 616e 6420 2262 2220 7065 7266  ter and "b" perf
-0000d720: 6f72 6d73 2061 2073 6869 6674 2e20 5468  orms a shift. Th
-0000d730: 6973 2063 6c61 7373 0a20 2020 2020 2020  is class.       
-0000d740: 2061 6c73 6f20 7265 7475 726e 7320 7468   also returns th
-0000d750: 6520 6c6f 6761 7269 7468 6d20 6f66 2074  e logarithm of t
-0000d760: 6865 206a 6163 6f62 6961 6e73 2064 6574  he jacobians det
-0000d770: 6572 6d69 6e61 6e74 2077 6869 6368 2069  erminant which i
-0000d780: 730a 2020 2020 2020 2020 7573 6566 756c  s.        useful
-0000d790: 2077 6865 6e20 696e 7665 7274 2061 2074   when invert a t
-0000d7a0: 7261 6e73 666f 726d 6174 696f 6e20 616e  ransformation an
-0000d7b0: 6420 636f 6d70 7574 6520 7468 6520 7072  d compute the pr
-0000d7c0: 6f62 6162 696c 6974 7920 6f66 0a20 2020  obability of.   
-0000d7d0: 2020 2020 2074 6865 2074 7261 6e73 666f       the transfo
-0000d7e0: 726d 6174 696f 6e2e 0a0a 2020 2020 2020  rmation...      
-0000d7f0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0000d800: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-0000d810: 2020 2020 2020 2020 7920 3a20 5365 7175          y : Sequ
-0000d820: 656e 6365 0a20 2020 2020 2020 2020 2020  ence.           
-0000d830: 2054 656e 736f 7220 7361 6d70 6c65 2077   Tensor sample w
-0000d840: 6974 6820 7472 616e 7366 6f72 6d65 6420  ith transformed 
-0000d850: 6469 7374 7269 6275 7469 6f6e 2064 6174  distribution dat
-0000d860: 6120 7768 6963 6820 7769 6c6c 2062 6520  a which will be 
-0000d870: 7573 6564 2069 6e0a 2020 2020 2020 2020  used in.        
-0000d880: 2020 2020 7468 6520 6e6f 726d 616c 697a      the normaliz
-0000d890: 696e 6720 616c 676f 7269 7468 6d20 696e  ing algorithm in
-0000d8a0: 7665 7273 6520 7061 7373 2e0a 0a20 2020  verse pass...   
-0000d8b0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-0000d8c0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-0000d8d0: 2020 2020 2078 203a 2074 6f72 6368 2e54       x : torch.T
-0000d8e0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-0000d8f0: 2020 5472 616e 7366 6f72 6d65 6420 7465    Transformed te
-0000d900: 6e73 6f72 2061 6363 6f72 6469 6e67 2074  nsor according t
-0000d910: 6f20 4166 6669 6e65 206c 6179 6572 2077  o Affine layer w
-0000d920: 6974 6820 7468 6520 7368 6170 6520 6f66  ith the shape of
-0000d930: 2027 7927 2e0a 2020 2020 2020 2020 696e   'y'..        in
-0000d940: 7665 7273 655f 6c6f 675f 6465 745f 6a61  verse_log_det_ja
-0000d950: 636f 6269 616e 203a 2074 6f72 6368 2e54  cobian : torch.T
-0000d960: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-0000d970: 2020 5465 6e73 6f72 2077 6869 6368 2072    Tensor which r
-0000d980: 6570 7265 7365 6e74 7320 7468 6520 696e  epresents the in
-0000d990: 666f 726d 6174 696f 6e20 6f66 2074 6865  formation of the
-0000d9a0: 2064 6576 6961 7469 6f6e 206f 6620 7468   deviation of th
-0000d9b0: 6520 696e 6974 6961 6c0a 2020 2020 2020  e initial.      
-0000d9c0: 2020 2020 2020 616e 6420 7461 7267 6574        and target
-0000d9d0: 2064 6973 7472 6962 7574 696f 6e2e 0a0a   distribution...
-0000d9e0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000d9f0: 2020 2020 2078 203d 2028 7920 2d20 7365       x = (y - se
-0000da00: 6c66 2e73 6869 6674 2920 2f20 746f 7263  lf.shift) / torc
-0000da10: 682e 6578 7028 7365 6c66 2e73 6361 6c65  h.exp(self.scale
-0000da20: 290a 2020 2020 2020 2020 6465 745f 6a61  ).        det_ja
-0000da30: 636f 6269 616e 203d 2031 202f 2074 6f72  cobian = 1 / tor
-0000da40: 6368 2e65 7870 2873 656c 662e 7363 616c  ch.exp(self.scal
-0000da50: 652e 7375 6d28 2929 0a20 2020 2020 2020  e.sum()).       
-0000da60: 2069 6e76 6572 7365 5f6c 6f67 5f64 6574   inverse_log_det
-0000da70: 5f6a 6163 6f62 6961 6e20 3d20 746f 7263  _jacobian = torc
-0000da80: 682e 6f6e 6573 280a 2020 2020 2020 2020  h.ones(.        
-0000da90: 2020 2020 782e 7368 6170 655b 305d 2920      x.shape[0]) 
-0000daa0: 2a20 746f 7263 682e 6c6f 6728 6465 745f  * torch.log(det_
-0000dab0: 6a61 636f 6269 616e 290a 0a20 2020 2020  jacobian)..     
-0000dac0: 2020 2072 6574 7572 6e20 782c 2069 6e76     return x, inv
-0000dad0: 6572 7365 5f6c 6f67 5f64 6574 5f6a 6163  erse_log_det_jac
-0000dae0: 6f62 6961 6e0a 0a0a 636c 6173 7320 444d  obian...class DM
-0000daf0: 504e 4e45 6e63 6f64 6572 4c61 7965 7228  PNNEncoderLayer(
-0000db00: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
-0000db10: 2222 220a 2020 2020 456e 636f 6465 7220  """.    Encoder 
-0000db20: 6c61 7965 7220 666f 7220 7573 6520 696e  layer for use in
-0000db30: 2074 6865 2044 6972 6563 7465 6420 4d65   the Directed Me
-0000db40: 7373 6167 6520 5061 7373 696e 6720 4e65  ssage Passing Ne
-0000db50: 7572 616c 204e 6574 776f 726b 2028 442d  ural Network (D-
-0000db60: 4d50 4e4e 2920 5b31 5d5f 2e0a 0a20 2020  MPNN) [1]_...   
-0000db70: 2054 6865 2072 6f6c 6520 6f66 2074 6865   The role of the
-0000db80: 2044 4d50 4e4e 456e 636f 6465 724c 6179   DMPNNEncoderLay
-0000db90: 6572 2063 6c61 7373 2069 7320 746f 2067  er class is to g
-0000dba0: 656e 6572 6174 6520 6d6f 6c65 6375 6c65  enerate molecule
-0000dbb0: 2065 6e63 6f64 696e 6773 2069 6e20 666f   encodings in fo
-0000dbc0: 6c6c 6f77 696e 6720 7374 6570 733a 0a0a  llowing steps:..
-0000dbd0: 2020 2020 2d20 4d65 7373 6167 6520 7061      - Message pa
-0000dbe0: 7373 696e 6720 7068 6173 650a 2020 2020  ssing phase.    
-0000dbf0: 2d20 4765 7420 6e65 7720 6174 6f6d 2068  - Get new atom h
-0000dc00: 6964 6465 6e20 7374 6174 6573 2061 6e64  idden states and
-0000dc10: 2072 6561 646f 7574 2070 6861 7365 0a20   readout phase. 
-0000dc20: 2020 202d 2043 6f6e 6361 7465 6e61 7465     - Concatenate
-0000dc30: 2074 6865 2067 6c6f 6261 6c20 6665 6174   the global feat
-0000dc40: 7572 6573 0a0a 0a20 2020 204c 6574 2074  ures...    Let t
-0000dc50: 6865 2064 6961 6772 616d 2067 6976 656e  he diagram given
-0000dc60: 2062 656c 6f77 2072 6570 7265 7365 6e74   below represent
-0000dc70: 2061 206d 6f6c 6563 756c 6520 636f 6e74   a molecule cont
-0000dc80: 6169 6e69 6e67 2035 2061 746f 6d73 2028  aining 5 atoms (
-0000dc90: 6e6f 6465 7329 2061 6e64 2034 2062 6f6e  nodes) and 4 bon
-0000dca0: 6473 2028 6564 6765 7329 3a2d 0a0a 2020  ds (edges):-..  
-0000dcb0: 2020 7c20 2020 3120 2d2d 2d20 350a 2020    |   1 --- 5.  
-0000dcc0: 2020 7c20 2020 7c0a 2020 2020 7c20 2020    |   |.    |   
-0000dcd0: 3220 2d2d 2d20 340a 2020 2020 7c20 2020  2 --- 4.    |   
-0000dce0: 7c0a 2020 2020 7c20 2020 330a 0a20 2020  |.    |   3..   
-0000dcf0: 204c 6574 2074 6865 2062 6f6e 6473 2066   Let the bonds f
-0000dd00: 726f 6d20 6174 6f6d 7320 312d 3e32 2028  rom atoms 1->2 (
-0000dd10: 2a2a 425b 3132 5d2a 2a29 2061 6e64 2032  **B[12]**) and 2
-0000dd20: 2d3e 3120 282a 2a42 5b32 315d 2a2a 2920  ->1 (**B[21]**) 
-0000dd30: 6265 2063 6f6e 7369 6465 7265 6420 6173  be considered as
-0000dd40: 2032 2064 6966 6665 7265 6e74 2062 6f6e   2 different bon
-0000dd50: 6473 2e0a 2020 2020 4865 6e63 652c 2062  ds..    Hence, b
-0000dd60: 7920 636f 6e73 6964 6572 696e 6720 7468  y considering th
-0000dd70: 6520 7361 6d65 2066 6f72 2061 6c6c 2061  e same for all a
-0000dd80: 746f 6d73 2c20 7468 6520 746f 7461 6c20  toms, the total 
-0000dd90: 6e75 6d62 6572 206f 6620 626f 6e64 7320  number of bonds 
-0000dda0: 3d20 382e 0a0a 2020 2020 4c65 743a 0a0a  = 8...    Let:..
-0000ddb0: 2020 2020 2d20 2a2a 6174 6f6d 2066 6561      - **atom fea
-0000ddc0: 7475 7265 732a 2a20 3a20 6060 6131 2c20  tures** : ``a1, 
-0000ddd0: 6132 2c20 6133 2c20 6134 2c20 6135 6060  a2, a3, a4, a5``
-0000dde0: 0a20 2020 202d 202a 2a68 6964 6465 6e20  .    - **hidden 
-0000ddf0: 7374 6174 6573 206f 6620 6174 6f6d 732a  states of atoms*
-0000de00: 2a20 3a20 6060 6831 2c20 6832 2c20 6833  * : ``h1, h2, h3
-0000de10: 2c20 6834 2c20 6835 6060 0a20 2020 202d  , h4, h5``.    -
-0000de20: 202a 2a62 6f6e 6420 6665 6174 7572 6573   **bond features
-0000de30: 2062 6f6e 6473 2a2a 203a 2060 6062 3132   bonds** : ``b12
-0000de40: 2c20 6232 312c 2062 3233 2c20 6233 322c  , b21, b23, b32,
-0000de50: 2062 3234 2c20 6234 322c 2062 3135 2c20   b24, b42, b15, 
-0000de60: 6235 3160 600a 2020 2020 2d20 2a2a 696e  b51``.    - **in
-0000de70: 6974 6961 6c20 6869 6464 656e 2073 7461  itial hidden sta
-0000de80: 7465 7320 6f66 2062 6f6e 6473 2a2a 203a  tes of bonds** :
-0000de90: 2060 6028 3029 6831 322c 2028 3029 6832   ``(0)h12, (0)h2
-0000dea0: 312c 2028 3029 6832 332c 2028 3029 6833  1, (0)h23, (0)h3
-0000deb0: 322c 2028 3029 6832 342c 2028 3029 6834  2, (0)h24, (0)h4
-0000dec0: 322c 2028 3029 6831 352c 2028 3029 6835  2, (0)h15, (0)h5
-0000ded0: 3160 600a 0a20 2020 2054 6865 2068 6964  1``..    The hid
-0000dee0: 6465 6e20 7374 6174 6520 6f66 2065 7665  den state of eve
-0000def0: 7279 2062 6f6e 6420 6973 2061 2066 756e  ry bond is a fun
-0000df00: 6374 696f 6e20 6f66 2074 6865 2063 6f6e  ction of the con
-0000df10: 6361 7465 6e61 7465 6420 6665 6174 7572  catenated featur
-0000df20: 6520 7665 6374 6f72 2077 6869 6368 2063  e vector which c
-0000df30: 6f6e 7461 696e 730a 2020 2020 636f 6e63  ontains.    conc
-0000df40: 6174 656e 6174 696f 6e20 6f66 2074 6865  atenation of the
-0000df50: 202a 2a66 6561 7475 7265 7320 6f66 2069   **features of i
-0000df60: 6e69 7469 616c 2061 746f 6d20 6f66 2074  nitial atom of t
-0000df70: 6865 2062 6f6e 642a 2a20 616e 6420 2a2a  he bond** and **
-0000df80: 626f 6e64 2066 6561 7475 7265 732a 2a2e  bond features**.
-0000df90: 0a0a 2020 2020 4578 616d 706c 653a 2060  ..    Example: `
-0000dfa0: 6028 3029 6832 3120 3d20 6675 6e63 3128  `(0)h21 = func1(
-0000dfb0: 636f 6e63 6174 2861 322c 2062 3231 2929  concat(a2, b21))
-0000dfc0: 6060 0a0a 2020 2020 2e2e 206e 6f74 653a  ``..    .. note:
-0000dfd0: 3a0a 2020 2020 2048 6572 6520 6675 6e63  :.     Here func
-0000dfe0: 3120 6973 2060 6073 656c 662e 575f 6960  1 is ``self.W_i`
-0000dff0: 600a 0a20 2020 202a 2a54 6865 204d 6573  `..    **The Mes
-0000e000: 7361 6765 2070 6173 7369 6e67 2070 6861  sage passing pha
-0000e010: 7365 2a2a 0a0a 2020 2020 5468 6520 676f  se**..    The go
-0000e020: 616c 206f 6620 7468 6520 6d65 7373 6167  al of the messag
-0000e030: 652d 7061 7373 696e 6720 7068 6173 6520  e-passing phase 
-0000e040: 6973 2074 6f20 6765 6e65 7261 7465 202a  is to generate *
-0000e050: 2a68 6964 6465 6e20 7374 6174 6573 206f  *hidden states o
-0000e060: 6620 616c 6c20 7468 6520 6174 6f6d 7320  f all the atoms 
-0000e070: 696e 2074 6865 206d 6f6c 6563 756c 652a  in the molecule*
-0000e080: 2a2e 0a0a 2020 2020 5468 6520 6869 6464  *...    The hidd
-0000e090: 656e 2073 7461 7465 206f 6620 616e 2061  en state of an a
-0000e0a0: 746f 6d20 6973 202a 2a61 2066 756e 6374  tom is **a funct
-0000e0b0: 696f 6e20 6f66 2063 6f6e 6361 7465 6e61  ion of concatena
-0000e0c0: 7469 6f6e 206f 6620 6174 6f6d 2066 6561  tion of atom fea
-0000e0d0: 7475 7265 7320 616e 6420 6d65 7373 6167  tures and messag
-0000e0e0: 6573 2028 6174 2054 2064 6570 7468 292a  es (at T depth)*
-0000e0f0: 2a2e 0a0a 2020 2020 4120 6d65 7373 6167  *...    A messag
-0000e100: 6520 6973 2061 2073 756d 206f 6620 2a2a  e is a sum of **
-0000e110: 6869 6464 656e 2073 7461 7465 7320 6f66  hidden states of
-0000e120: 2062 6f6e 6473 2063 6f6d 696e 6720 746f   bonds coming to
-0000e130: 2074 6865 2061 746f 6d20 2861 7420 5420   the atom (at T 
-0000e140: 6465 7074 6829 2a2a 2e0a 0a20 2020 202e  depth)**...    .
-0000e150: 2e20 6e6f 7465 3a3a 0a20 2020 2020 4465  . note::.     De
-0000e160: 7074 6820 7265 6665 7273 2074 6f20 7468  pth refers to th
-0000e170: 6520 6e75 6d62 6572 206f 6620 6974 6572  e number of iter
-0000e180: 6174 696f 6e73 2069 6e20 7468 6520 6d65  ations in the me
-0000e190: 7373 6167 6520 7061 7373 696e 6720 7068  ssage passing ph
-0000e1a0: 6173 6520 2868 6572 652c 2054 2069 7465  ase (here, T ite
-0000e1b0: 7261 7469 6f6e 7329 2e20 4166 7465 7220  rations). After 
-0000e1c0: 6561 6368 2069 7465 7261 7469 6f6e 2c20  each iteration, 
-0000e1d0: 7468 6520 6869 6464 656e 2073 7461 7465  the hidden state
-0000e1e0: 7320 6f66 2074 6865 2062 6f6e 6473 2061  s of the bonds a
-0000e1f0: 7265 2075 7064 6174 6564 2e0a 0a0a 2020  re updated....  
-0000e200: 2020 4578 616d 706c 653a 0a20 2020 2060    Example:.    `
-0000e210: 6068 3120 3d20 6675 6e63 3328 636f 6e63  `h1 = func3(conc
-0000e220: 6174 2861 312c 206d 3129 2960 600a 0a20  at(a1, m1))``.. 
-0000e230: 2020 202e 2e20 6e6f 7465 3a3a 0a20 2020     .. note::.   
-0000e240: 2020 4865 7265 2066 756e 6333 2069 7320    Here func3 is 
-0000e250: 6060 7365 6c66 2e57 5f6f 6060 2e0a 0a20  ``self.W_o``... 
-0000e260: 2020 2020 606d 3160 2072 6566 6572 7320      `m1` refers 
-0000e270: 746f 2074 6865 206d 6573 7361 6765 2063  to the message c
-0000e280: 6f6d 696e 6720 746f 2074 6865 2061 746f  oming to the ato
-0000e290: 6d2e 0a0a 2020 2020 6060 6d31 203d 2028  m...    ``m1 = (
-0000e2a0: 542d 3129 6832 3120 2b20 2854 2d31 2968  T-1)h21 + (T-1)h
-0000e2b0: 3531 6060 0a20 2020 2028 6869 6464 656e  51``.    (hidden
-0000e2c0: 2073 7461 7465 206f 6620 626f 6e64 2032   state of bond 2
-0000e2d0: 2d3e 3120 2b20 6869 6464 656e 2073 7461  ->1 + hidden sta
-0000e2e0: 7465 206f 6620 626f 6e64 2035 2d3e 3129  te of bond 5->1)
-0000e2f0: 2028 6174 2054 2064 6570 7468 290a 0a20   (at T depth).. 
-0000e300: 2020 2066 6f72 2c20 6465 7074 6820 5420     for, depth T 
-0000e310: 3d20 323a 0a0a 2020 2020 2d20 7468 6520  = 2:..    - the 
-0000e320: 6869 6464 656e 2073 7461 7465 7320 6f66  hidden states of
-0000e330: 2074 6865 2062 6f6e 6473 2040 2031 7374   the bonds @ 1st
-0000e340: 2069 7465 7261 7469 6f6e 2077 696c 6c20   iteration will 
-0000e350: 6265 203d 3e20 2830 2968 3231 2c20 2830  be => (0)h21, (0
-0000e360: 2968 3531 0a20 2020 202d 2074 6865 2068  )h51.    - the h
-0000e370: 6964 6465 6e20 7374 6174 6573 206f 6620  idden states of 
-0000e380: 7468 6520 626f 6e64 7320 4020 326e 6420  the bonds @ 2nd 
-0000e390: 6974 6572 6174 696f 6e20 7769 6c6c 2062  iteration will b
-0000e3a0: 6520 3d3e 2028 3129 6832 312c 2028 3129  e => (1)h21, (1)
-0000e3b0: 6835 310a 0a20 2020 2054 6865 2068 6964  h51..    The hid
-0000e3c0: 6465 6e20 7374 6174 6573 206f 6620 7468  den states of th
-0000e3d0: 6520 626f 6e64 7320 696e 2031 7374 2069  e bonds in 1st i
-0000e3e0: 7465 7261 7469 6f6e 2061 7265 2061 6c72  teration are alr
-0000e3f0: 6561 6479 206b 6e6f 772e 0a20 2020 2046  eady know..    F
-0000e400: 6f72 2068 6964 6465 6e20 7374 6174 6573  or hidden states
-0000e410: 206f 6620 7468 6520 626f 6e64 7320 696e   of the bonds in
-0000e420: 2032 6e64 2069 7465 7261 7469 6f6e 2c20   2nd iteration, 
-0000e430: 7765 2066 6f6c 6c6f 7720 7468 6520 6372  we follow the cr
-0000e440: 6974 6572 696f 6e20 7468 6174 3a0a 0a20  iterion that:.. 
-0000e450: 2020 202d 2068 6964 6465 6e20 7374 6174     - hidden stat
-0000e460: 6520 6f66 2074 6865 2062 6f6e 6420 6973  e of the bond is
-0000e470: 2061 2066 756e 6374 696f 6e20 6f66 202a   a function of *
-0000e480: 2a69 6e69 7469 616c 2068 6964 6465 6e20  *initial hidden 
-0000e490: 7374 6174 6520 6f66 2062 6f6e 642a 2a0a  state of bond**.
-0000e4a0: 2020 2020 616e 6420 2a2a 6d65 7373 6167      and **messag
-0000e4b0: 6573 2063 6f6d 696e 6720 746f 2074 6861  es coming to tha
-0000e4c0: 7420 626f 6e64 2069 6e20 7468 6174 2069  t bond in that i
-0000e4d0: 7465 7261 7469 6f6e 2a2a 0a0a 2020 2020  teration**..    
-0000e4e0: 4578 616d 706c 653a 0a20 2020 2060 6028  Example:.    ``(
-0000e4f0: 3129 6832 3120 3d20 6675 6e63 3228 2028  1)h21 = func2( (
-0000e500: 3029 6832 3120 2c20 2831 296d 3231 2029  0)h21 , (1)m21 )
-0000e510: 6060 0a0a 2020 2020 2e2e 206e 6f74 653a  ``..    .. note:
-0000e520: 3a0a 2020 2020 2048 6572 6520 6675 6e63  :.     Here func
-0000e530: 3220 6973 2060 6073 656c 662e 575f 6860  2 is ``self.W_h`
-0000e540: 602e 0a0a 2020 2020 2060 2831 296d 3231  `...     `(1)m21
-0000e550: 6020 7265 6665 7273 2074 6f20 7468 6520  ` refers to the 
-0000e560: 6d65 7373 6167 6573 2063 6f6d 696e 6720  messages coming 
-0000e570: 746f 2074 6861 7420 626f 6e64 2032 2d3e  to that bond 2->
-0000e580: 3120 696e 2074 6861 7420 326e 6420 6974  1 in that 2nd it
-0000e590: 6572 6174 696f 6e2e 0a0a 2020 2020 4d65  eration...    Me
-0000e5a0: 7373 6167 6573 2063 6f6d 696e 6720 746f  ssages coming to
-0000e5b0: 2061 2062 6f6e 6420 696e 2061 6e20 6974   a bond in an it
-0000e5c0: 6572 6174 696f 6e20 6973 202a 2a61 2073  eration is **a s
-0000e5d0: 756d 206f 6620 6869 6464 656e 2073 7461  um of hidden sta
-0000e5e0: 7465 7320 6f66 2062 6f6e 6473 2028 6672  tes of bonds (fr
-0000e5f0: 6f6d 2070 7265 7669 6f75 7320 6974 6572  om previous iter
-0000e600: 6174 696f 6e29 2063 6f6d 696e 6720 746f  ation) coming to
-0000e610: 2074 6869 7320 626f 6e64 2a2a 2e0a 0a20   this bond**... 
-0000e620: 2020 2045 7861 6d70 6c65 3a0a 2020 2020     Example:.    
-0000e630: 6060 2831 296d 3231 203d 2028 3029 6833  ``(1)m21 = (0)h3
-0000e640: 3220 2b20 2830 2968 3432 6060 0a0a 2020  2 + (0)h42``..  
-0000e650: 2020 7c20 2020 3220 3c2d 2d2d 2033 0a20    |   2 <--- 3. 
-0000e660: 2020 207c 2020 205e 0a20 2020 207c 2020     |   ^.    |  
-0000e670: 207c 0a20 2020 207c 2020 2034 0a0a 2020   |.    |   4..  
-0000e680: 2020 2a2a 436f 6d70 7574 696e 6720 7468    **Computing th
-0000e690: 6520 6d65 7373 6167 6573 2a2a 0a0a 2020  e messages**..  
-0000e6a0: 2020 2e2e 2063 6f64 652d 626c 6f63 6b3a    .. code-block:
-0000e6b0: 3a20 7079 7468 6f6e 0a0a 2020 2020 2020  : python..      
-0000e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6d0: 2020 2020 2020 2042 3020 2020 2020 2042         B0      B
-0000e6e0: 3120 2020 2020 2042 3220 2020 2020 2042  1      B2      B
-0000e6f0: 3320 2020 2020 2042 3420 2020 2020 2042  3      B4      B
-0000e700: 3520 2020 2020 2042 3620 2020 2020 2042  5      B6      B
-0000e710: 3720 2020 2020 2042 380a 2020 2020 2020  7      B8.      
-0000e720: 2020 665f 696e 695f 6174 6f6d 735f 626f    f_ini_atoms_bo
-0000e730: 6e64 7320 3d20 5b28 3029 6831 322c 2028  nds = [(0)h12, (
-0000e740: 3029 6832 312c 2028 3029 6832 332c 2028  0)h21, (0)h23, (
-0000e750: 3029 6833 322c 2028 3029 6832 342c 2028  0)h32, (0)h24, (
-0000e760: 3029 6834 322c 2028 3029 6831 352c 2028  0)h42, (0)h15, (
-0000e770: 3029 6835 312c 2068 282d 3129 5d0a 0a0a  0)h51, h(-1)]...
-0000e780: 2020 2020 2e2e 206e 6f74 653a 3a0a 2020      .. note::.  
-0000e790: 2020 2068 282d 3129 2069 7320 616e 2065     h(-1) is an e
-0000e7a0: 6d70 7479 2061 7272 6179 206f 6620 7468  mpty array of th
-0000e7b0: 6520 7361 6d65 2073 697a 6520 6173 206f  e same size as o
-0000e7c0: 7468 6572 2068 6964 6465 6e20 7374 6174  ther hidden stat
-0000e7d0: 6573 206f 6620 626f 6e64 2073 7461 7465  es of bond state
-0000e7e0: 732e 0a0a 2020 2020 2e2e 2063 6f64 652d  s...    .. code-
-0000e7f0: 626c 6f63 6b3a 3a20 7079 7468 6f6e 0a0a  block:: python..
-0000e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e810: 2020 2020 4230 2020 2020 2020 4231 2020      B0      B1  
-0000e820: 2020 2020 4232 2020 2020 2020 4233 2020      B2      B3  
-0000e830: 2020 2020 4234 2020 2020 2020 4235 2020      B4      B5  
-0000e840: 2020 2020 4236 2020 2020 2020 4237 2020      B6      B7  
-0000e850: 2020 2020 2042 380a 2020 2020 2020 2020       B8.        
-0000e860: 6d61 7070 696e 6720 3d20 5b20 5b2d 312c  mapping = [ [-1,
-0000e870: 4237 5d20 5b42 332c 4235 5d20 5b42 302c  B7] [B3,B5] [B0,
-0000e880: 4235 5d20 5b2d 312c 2d31 5d20 5b42 302c  B5] [-1,-1] [B0,
-0000e890: 4233 5d20 5b2d 312c 2d31 5d20 5b42 312c  B3] [-1,-1] [B1,
-0000e8a0: 2d31 5d20 5b2d 312c 2d31 5d20 205b 2d31  -1] [-1,-1]  [-1
-0000e8b0: 2c2d 315d 205d 0a0a 2020 2020 4c61 7465  ,-1] ]..    Late
-0000e8c0: 722c 2074 6865 2065 6e63 6f64 6572 2077  r, the encoder w
-0000e8d0: 696c 6c20 6d61 7020 7468 6520 636f 6e63  ill map the conc
-0000e8e0: 6174 656e 6174 6564 2066 6561 7475 7265  atenated feature
-0000e8f0: 7320 6672 6f6d 2074 6865 2060 6066 5f69  s from the ``f_i
-0000e900: 6e69 5f61 746f 6d73 5f62 6f6e 6473 6060  ni_atoms_bonds``
-0000e910: 0a20 2020 2074 6f20 6060 6d61 7070 696e  .    to ``mappin
-0000e920: 6760 6020 696e 2065 6163 6820 6974 6572  g`` in each iter
-0000e930: 6174 696f 6e20 7570 746f 2054 7468 2069  ation upto Tth i
-0000e940: 7465 7261 7469 6f6e 2e0a 0a20 2020 204e  teration...    N
-0000e950: 6578 7420 7468 6520 656e 636f 6465 7220  ext the encoder 
-0000e960: 7769 6c6c 2073 756d 2d75 7020 7468 6520  will sum-up the 
-0000e970: 636f 6e63 6174 2066 6561 7475 7265 7320  concat features 
-0000e980: 7769 7468 696e 2073 616d 6520 626f 6e64  within same bond
-0000e990: 2069 6e64 6578 2e0a 0a20 2020 202e 2e20   index...    .. 
-0000e9a0: 636f 6465 2d62 6c6f 636b 3a3a 2070 7974  code-block:: pyt
-0000e9b0: 686f 6e0a 0a20 2020 2020 2020 2020 2020  hon..           
-0000e9c0: 2020 2020 2020 2020 2020 2020 2028 3129               (1)
-0000e9d0: 6d31 3220 2020 2020 2020 2020 2020 2831  m12           (1
-0000e9e0: 296d 3231 2020 2020 2020 2020 2020 2028  )m21           (
-0000e9f0: 3129 6d32 3320 2020 2020 2020 2020 2020  1)m23           
-0000ea00: 2020 2028 3129 6d33 3220 2020 2020 2020     (1)m32       
-0000ea10: 2020 2028 3129 6d32 3420 2020 2020 2020     (1)m24       
-0000ea20: 2020 2020 2831 296d 3432 2020 2020 2020      (1)m42      
-0000ea30: 2020 2020 2028 3129 6d31 3520 2020 2020       (1)m15     
-0000ea40: 2020 2020 2028 3129 6d35 3120 2020 2020       (1)m51     
-0000ea50: 2020 2020 2020 206d 282d 3129 0a20 2020         m(-1).   
-0000ea60: 2020 2020 206d 6573 7361 6765 203d 205b       message = [
-0000ea70: 205b 6828 2d31 2920 2b20 2830 2968 3531   [h(-1) + (0)h51
-0000ea80: 5d20 5b28 3029 6833 3220 2b20 2830 2968  ] [(0)h32 + (0)h
-0000ea90: 3432 5d20 5b28 3029 6831 3220 2b20 2830  42] [(0)h12 + (0
-0000eaa0: 2968 3432 5d20 5b68 282d 3129 202b 2068  )h42] [h(-1) + h
-0000eab0: 282d 3129 5d20 5b28 3029 6831 3220 2b20  (-1)] [(0)h12 + 
-0000eac0: 2830 2968 3332 5d20 5b68 282d 3129 202b  (0)h32] [h(-1) +
-0000ead0: 2068 282d 3129 5d20 5b28 3029 6832 3120   h(-1)] [(0)h21 
-0000eae0: 2b20 6828 2d31 295d 205b 6828 2d31 2920  + h(-1)] [h(-1) 
-0000eaf0: 2b20 6828 2d31 295d 2020 5b68 282d 3129  + h(-1)]  [h(-1)
-0000eb00: 202b 2068 282d 3129 5d20 5d0a 0a20 2020   + h(-1)] ]..   
-0000eb10: 2048 656e 6365 2c20 7468 6973 2069 7320   Hence, this is 
-0000eb20: 686f 7720 656e 636f 6465 7220 6361 6e20  how encoder can 
-0000eb30: 6765 7420 6d65 7373 6167 6573 2066 6f72  get messages for
-0000eb40: 206d 6573 7361 6765 2d70 6173 7369 6e67   message-passing
-0000eb50: 2073 7465 7073 2e0a 0a20 2020 202a 2a47   steps...    **G
-0000eb60: 6574 206e 6577 2061 746f 6d20 6869 6464  et new atom hidd
-0000eb70: 656e 2073 7461 7465 7320 616e 6420 7265  en states and re
-0000eb80: 6164 6f75 7420 7068 6173 652a 2a0a 0a20  adout phase**.. 
-0000eb90: 2020 2048 656e 6365 206e 6f77 2066 6f72     Hence now for
-0000eba0: 2068 313a 0a0a 2020 2020 2e2e 2063 6f64   h1:..    .. cod
-0000ebb0: 652d 626c 6f63 6b3a 3a20 7079 7468 6f6e  e-block:: python
-0000ebc0: 0a0a 2020 2020 2020 2020 6831 203d 2066  ..        h1 = f
-0000ebd0: 756e 6333 280a 2020 2020 2020 2020 2020  unc3(.          
-0000ebe0: 2020 2020 2020 2020 2020 636f 6e63 6174            concat
-0000ebf0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ec00: 2020 2020 2020 2020 2020 2061 312c 0a20             a1,. 
-0000ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec20: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
-0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec40: 2020 2020 2020 6675 6e63 3228 2028 3029        func2( (0)
-0000ec50: 6832 3120 2c20 2830 2968 3332 202b 2028  h21 , (0)h32 + (
-0000ec60: 3029 6834 3220 2920 2b0a 2020 2020 2020  0)h42 ) +.      
-0000ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec80: 2020 2020 2020 6675 6e63 3228 2028 3029        func2( (0)
-0000ec90: 6835 3120 2c20 3020 2020 2020 2020 2020  h51 , 0         
-0000eca0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecc0: 205d 0a20 2020 2020 2020 2020 2020 2020   ].             
-0000ecd0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000ece0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000ecf0: 0a20 2020 2053 696d 696c 6172 6c79 2c20  .    Similarly, 
-0000ed00: 6832 2c20 6833 2c20 6834 2061 6e64 2068  h2, h3, h4 and h
-0000ed10: 3520 6172 6520 6361 6c63 756c 6174 6564  5 are calculated
-0000ed20: 2e0a 0a20 2020 204e 6578 742c 2061 6c6c  ...    Next, all
-0000ed30: 2061 746f 6d20 6869 6464 656e 2073 7461   atom hidden sta
-0000ed40: 7465 7320 6172 6520 636f 6e63 6174 656e  tes are concaten
-0000ed50: 6174 6564 2074 6f20 6d61 6b65 2061 2066  ated to make a f
-0000ed60: 6561 7475 7265 2076 6563 746f 7220 6f66  eature vector of
-0000ed70: 2074 6865 206d 6f6c 6563 756c 653a 0a0a   the molecule:..
-0000ed80: 2020 2020 6060 6d6f 6c5f 656e 636f 6469      ``mol_encodi
-0000ed90: 6e67 7320 3d20 5b5b 6831 2c20 6832 2c20  ngs = [[h1, h2, 
-0000eda0: 6833 2c20 6834 2c20 6835 5d5d 6060 0a0a  h3, h4, h5]]``..
-0000edb0: 2020 2020 2a2a 436f 6e63 6174 656e 6174      **Concatenat
-0000edc0: 6520 7468 6520 676c 6f62 616c 2066 6561  e the global fea
-0000edd0: 7475 7265 732a 2a0a 0a20 2020 204c 6574  tures**..    Let
-0000ede0: 2c0a 2020 2020 6060 676c 6f62 616c 5f66  ,.    ``global_f
-0000edf0: 6561 7475 7265 7320 3d20 5b5b 6766 312c  eatures = [[gf1,
-0000ee00: 2067 6632 2c20 6766 335d 5d60 600a 2020   gf2, gf3]]``.  
-0000ee10: 2020 5468 6973 2061 7272 6179 2063 6f6e    This array con
-0000ee20: 7461 696e 7320 6d6f 6c65 6375 6c65 206c  tains molecule l
-0000ee30: 6576 656c 2066 6561 7475 7265 732e 2049  evel features. I
-0000ee40: 6e20 6361 7365 206f 6620 7468 6973 2065  n case of this e
-0000ee50: 7861 6d70 6c65 2c20 6974 2063 6f6e 7461  xample, it conta
-0000ee60: 696e 7320 3320 676c 6f62 616c 2066 6561  ins 3 global fea
-0000ee70: 7475 7265 732e 0a0a 2020 2020 4865 6e63  tures...    Henc
-0000ee80: 6520 6166 7465 7220 636f 6e63 6174 656e  e after concaten
-0000ee90: 6174 696f 6e2c 0a0a 2020 2020 6060 6d6f  ation,..    ``mo
-0000eea0: 6c5f 656e 636f 6469 6e67 7320 3d20 5b5b  l_encodings = [[
-0000eeb0: 6831 2c20 6832 2c20 6833 2c20 6834 2c20  h1, h2, h3, h4, 
-0000eec0: 6835 2c20 6766 312c 2067 6632 2c20 6766  h5, gf1, gf2, gf
-0000eed0: 335d 5d60 600a 2020 2020 2846 696e 616c  3]]``.    (Final
-0000eee0: 206f 7574 7075 7420 6f66 2074 6865 2065   output of the e
-0000eef0: 6e63 6f64 6572 290a 0a20 2020 2052 6566  ncoder)..    Ref
-0000ef00: 6572 656e 6365 730a 2020 2020 2d2d 2d2d  erences.    ----
-0000ef10: 2d2d 2d2d 2d2d 0a20 2020 202e 2e20 5b31  ------.    .. [1
-0000ef20: 5d20 416e 616c 797a 696e 6720 4c65 6172  ] Analyzing Lear
-0000ef30: 6e65 6420 4d6f 6c65 6375 6c61 7220 5265  ned Molecular Re
-0000ef40: 7072 6573 656e 7461 7469 6f6e 7320 666f  presentations fo
-0000ef50: 7220 5072 6f70 6572 7479 2050 7265 6469  r Property Predi
-0000ef60: 6374 696f 6e20 6874 7470 733a 2f2f 6172  ction https://ar
-0000ef70: 7869 762e 6f72 672f 7064 662f 3139 3034  xiv.org/pdf/1904
-0000ef80: 2e30 3135 3631 2e70 6466 0a0a 2020 2020  .01561.pdf..    
-0000ef90: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
-0000efa0: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 6672  -----.    >>> fr
-0000efb0: 6f6d 2072 646b 6974 2069 6d70 6f72 7420  om rdkit import 
-0000efc0: 4368 656d 0a20 2020 203e 3e3e 2069 6d70  Chem.    >>> imp
-0000efd0: 6f72 7420 746f 7263 680a 2020 2020 3e3e  ort torch.    >>
-0000efe0: 3e20 696d 706f 7274 2064 6565 7063 6865  > import deepche
-0000eff0: 6d20 6173 2064 630a 2020 2020 3e3e 3e20  m as dc.    >>> 
-0000f000: 696e 7075 745f 736d 696c 6520 3d20 2243  input_smile = "C
-0000f010: 4322 0a20 2020 203e 3e3e 2066 6561 7420  C".    >>> feat 
-0000f020: 3d20 6463 2e66 6561 742e 444d 504e 4e46  = dc.feat.DMPNNF
-0000f030: 6561 7475 7269 7a65 7228 6665 6174 7572  eaturizer(featur
-0000f040: 6573 5f67 656e 6572 6174 6f72 733d 5b27  es_generators=['
-0000f050: 6d6f 7267 616e 275d 290a 2020 2020 3e3e  morgan']).    >>
-0000f060: 3e20 6772 6170 6820 3d20 6665 6174 2e66  > graph = feat.f
-0000f070: 6561 7475 7269 7a65 2869 6e70 7574 5f73  eaturize(input_s
-0000f080: 6d69 6c65 290a 2020 2020 3e3e 3e20 6672  mile).    >>> fr
-0000f090: 6f6d 2064 6565 7063 6865 6d2e 6d6f 6465  om deepchem.mode
-0000f0a0: 6c73 2e74 6f72 6368 5f6d 6f64 656c 732e  ls.torch_models.
-0000f0b0: 646d 706e 6e20 696d 706f 7274 205f 4d61  dmpnn import _Ma
-0000f0c0: 7070 6572 444d 504e 4e0a 2020 2020 3e3e  pperDMPNN.    >>
-0000f0d0: 3e20 6d61 7070 6572 203d 205f 4d61 7070  > mapper = _Mapp
-0000f0e0: 6572 444d 504e 4e28 6772 6170 685b 305d  erDMPNN(graph[0]
-0000f0f0: 290a 2020 2020 3e3e 3e20 6174 6f6d 5f66  ).    >>> atom_f
-0000f100: 6561 7475 7265 732c 2066 5f69 6e69 5f61  eatures, f_ini_a
-0000f110: 746f 6d73 5f62 6f6e 6473 2c20 6174 6f6d  toms_bonds, atom
-0000f120: 5f74 6f5f 696e 636f 6d69 6e67 5f62 6f6e  _to_incoming_bon
-0000f130: 6473 2c20 6d61 7070 696e 672c 2067 6c6f  ds, mapping, glo
-0000f140: 6261 6c5f 6665 6174 7572 6573 203d 206d  bal_features = m
-0000f150: 6170 7065 722e 7661 6c75 6573 0a20 2020  apper.values.   
-0000f160: 203e 3e3e 2061 746f 6d5f 6665 6174 7572   >>> atom_featur
-0000f170: 6573 203d 2074 6f72 6368 2e66 726f 6d5f  es = torch.from_
-0000f180: 6e75 6d70 7928 6174 6f6d 5f66 6561 7475  numpy(atom_featu
-0000f190: 7265 7329 2e66 6c6f 6174 2829 0a20 2020  res).float().   
-0000f1a0: 203e 3e3e 2066 5f69 6e69 5f61 746f 6d73   >>> f_ini_atoms
-0000f1b0: 5f62 6f6e 6473 203d 2074 6f72 6368 2e66  _bonds = torch.f
-0000f1c0: 726f 6d5f 6e75 6d70 7928 665f 696e 695f  rom_numpy(f_ini_
-0000f1d0: 6174 6f6d 735f 626f 6e64 7329 2e66 6c6f  atoms_bonds).flo
-0000f1e0: 6174 2829 0a20 2020 203e 3e3e 2061 746f  at().    >>> ato
-0000f1f0: 6d5f 746f 5f69 6e63 6f6d 696e 675f 626f  m_to_incoming_bo
-0000f200: 6e64 7320 3d20 746f 7263 682e 6672 6f6d  nds = torch.from
-0000f210: 5f6e 756d 7079 2861 746f 6d5f 746f 5f69  _numpy(atom_to_i
-0000f220: 6e63 6f6d 696e 675f 626f 6e64 7329 0a20  ncoming_bonds). 
-0000f230: 2020 203e 3e3e 206d 6170 7069 6e67 203d     >>> mapping =
-0000f240: 2074 6f72 6368 2e66 726f 6d5f 6e75 6d70   torch.from_nump
-0000f250: 7928 6d61 7070 696e 6729 0a20 2020 203e  y(mapping).    >
-0000f260: 3e3e 2067 6c6f 6261 6c5f 6665 6174 7572  >> global_featur
-0000f270: 6573 203d 2074 6f72 6368 2e66 726f 6d5f  es = torch.from_
-0000f280: 6e75 6d70 7928 676c 6f62 616c 5f66 6561  numpy(global_fea
-0000f290: 7475 7265 7329 2e66 6c6f 6174 2829 0a20  tures).float(). 
-0000f2a0: 2020 203e 3e3e 206d 6f6c 6563 756c 6573     >>> molecules
-0000f2b0: 5f75 6e62 6174 6368 5f6b 6579 203d 206c  _unbatch_key = l
-0000f2c0: 656e 2861 746f 6d5f 6665 6174 7572 6573  en(atom_features
-0000f2d0: 290a 2020 2020 3e3e 3e20 6c61 7965 7220  ).    >>> layer 
-0000f2e0: 3d20 444d 504e 4e45 6e63 6f64 6572 4c61  = DMPNNEncoderLa
-0000f2f0: 7965 7228 645f 6869 6464 656e 3d32 290a  yer(d_hidden=2).
-0000f300: 2020 2020 3e3e 3e20 6f75 7470 7574 203d      >>> output =
-0000f310: 206c 6179 6572 2861 746f 6d5f 6665 6174   layer(atom_feat
-0000f320: 7572 6573 2c20 665f 696e 695f 6174 6f6d  ures, f_ini_atom
-0000f330: 735f 626f 6e64 732c 2061 746f 6d5f 746f  s_bonds, atom_to
-0000f340: 5f69 6e63 6f6d 696e 675f 626f 6e64 732c  _incoming_bonds,
-0000f350: 206d 6170 7069 6e67 2c20 676c 6f62 616c   mapping, global
-0000f360: 5f66 6561 7475 7265 732c 206d 6f6c 6563  _features, molec
-0000f370: 756c 6573 5f75 6e62 6174 6368 5f6b 6579  ules_unbatch_key
-0000f380: 290a 2020 2020 2222 220a 0a20 2020 2064  ).    """..    d
-0000f390: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-0000f3a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f3b0: 2020 2075 7365 5f64 6566 6175 6c74 5f66     use_default_f
-0000f3c0: 6469 6d3a 2062 6f6f 6c20 3d20 5472 7565  dim: bool = True
-0000f3d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f3e0: 2020 2061 746f 6d5f 6664 696d 3a20 696e     atom_fdim: in
-0000f3f0: 7420 3d20 3133 332c 0a20 2020 2020 2020  t = 133,.       
-0000f400: 2020 2020 2020 2020 2020 626f 6e64 5f66            bond_f
-0000f410: 6469 6d3a 2069 6e74 203d 2031 342c 0a20  dim: int = 14,. 
-0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f430: 645f 6869 6464 656e 3a20 696e 7420 3d20  d_hidden: int = 
-0000f440: 3330 302c 0a20 2020 2020 2020 2020 2020  300,.           
-0000f450: 2020 2020 2020 6465 7074 683a 2069 6e74        depth: int
-0000f460: 203d 2033 2c0a 2020 2020 2020 2020 2020   = 3,.          
-0000f470: 2020 2020 2020 2062 6961 733a 2062 6f6f         bias: boo
-0000f480: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-0000f490: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-0000f4a0: 7661 7469 6f6e 3a20 7374 7220 3d20 2772  vation: str = 'r
-0000f4b0: 656c 7527 2c0a 2020 2020 2020 2020 2020  elu',.          
-0000f4c0: 2020 2020 2020 2064 726f 706f 7574 5f70         dropout_p
-0000f4d0: 3a20 666c 6f61 7420 3d20 302e 302c 0a20  : float = 0.0,. 
-0000f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4f0: 6167 6772 6567 6174 696f 6e3a 2073 7472  aggregation: str
-0000f500: 203d 2027 6d65 616e 272c 0a20 2020 2020   = 'mean',.     
-0000f510: 2020 2020 2020 2020 2020 2020 6167 6772              aggr
-0000f520: 6567 6174 696f 6e5f 6e6f 726d 3a20 556e  egation_norm: Un
-0000f530: 696f 6e5b 696e 742c 2066 6c6f 6174 5d20  ion[int, float] 
-0000f540: 3d20 3130 3029 3a0a 2020 2020 2020 2020  = 100):.        
-0000f550: 2222 2249 6e69 7469 616c 697a 6520 6120  """Initialize a 
-0000f560: 444d 504e 4e45 6e63 6f64 6572 4c61 7965  DMPNNEncoderLaye
-0000f570: 7220 6c61 7965 722e 0a0a 2020 2020 2020  r layer...      
-0000f580: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0000f590: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-0000f5a0: 2020 2020 2020 2020 7573 655f 6465 6661          use_defa
-0000f5b0: 756c 745f 6664 696d 3a20 626f 6f6c 0a20  ult_fdim: bool. 
-0000f5c0: 2020 2020 2020 2020 2020 2049 6620 6060             If ``
-0000f5d0: 5472 7565 6060 2c20 6060 7365 6c66 2e61  True``, ``self.a
-0000f5e0: 746f 6d5f 6664 696d 6060 2061 6e64 2060  tom_fdim`` and `
-0000f5f0: 6073 656c 662e 626f 6e64 5f66 6469 6d60  `self.bond_fdim`
-0000f600: 6020 6172 6520 696e 6974 6961 6c69 7a65  ` are initialize
-0000f610: 6420 7573 696e 6720 7661 6c75 6573 2066  d using values f
-0000f620: 726f 6d20 7468 6520 4772 6170 6843 6f6e  rom the GraphCon
-0000f630: 7643 6f6e 7374 616e 7473 2063 6c61 7373  vConstants class
-0000f640: 2e20 4966 2060 6046 616c 7365 6060 2c20  . If ``False``, 
-0000f650: 6060 7365 6c66 2e61 746f 6d5f 6664 696d  ``self.atom_fdim
-0000f660: 6060 2061 6e64 2060 6073 656c 662e 626f  `` and ``self.bo
-0000f670: 6e64 5f66 6469 6d60 6020 6172 6520 696e  nd_fdim`` are in
-0000f680: 6974 6961 6c69 7a65 6420 6672 6f6d 2074  itialized from t
-0000f690: 6865 2076 616c 7565 7320 7072 6f76 6964  he values provid
-0000f6a0: 6564 2e0a 2020 2020 2020 2020 6174 6f6d  ed..        atom
-0000f6b0: 5f66 6469 6d3a 2069 6e74 0a20 2020 2020  _fdim: int.     
-0000f6c0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-0000f6d0: 206f 6620 6174 6f6d 2066 6561 7475 7265   of atom feature
-0000f6e0: 2076 6563 746f 722e 0a20 2020 2020 2020   vector..       
-0000f6f0: 2062 6f6e 645f 6664 696d 3a20 696e 740a   bond_fdim: int.
-0000f700: 2020 2020 2020 2020 2020 2020 4469 6d65              Dime
-0000f710: 6e73 696f 6e20 6f66 2062 6f6e 6420 6665  nsion of bond fe
-0000f720: 6174 7572 6520 7665 6374 6f72 2e0a 2020  ature vector..  
-0000f730: 2020 2020 2020 645f 6869 6464 656e 3a20        d_hidden: 
-0000f740: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-0000f750: 5369 7a65 206f 6620 6869 6464 656e 206c  Size of hidden l
-0000f760: 6179 6572 2069 6e20 7468 6520 656e 636f  ayer in the enco
-0000f770: 6465 7220 6c61 7965 722e 0a20 2020 2020  der layer..     
-0000f780: 2020 2064 6570 7468 3a20 696e 740a 2020     depth: int.  
-0000f790: 2020 2020 2020 2020 2020 4e6f 206f 6620            No of 
-0000f7a0: 6d65 7373 6167 6520 7061 7373 696e 6720  message passing 
-0000f7b0: 7374 6570 732e 0a20 2020 2020 2020 2062  steps..        b
-0000f7c0: 6961 733a 2062 6f6f 6c0a 2020 2020 2020  ias: bool.      
-0000f7d0: 2020 2020 2020 4966 2060 6054 7275 6560        If ``True`
-0000f7e0: 602c 2064 656e 7365 206c 6179 6572 7320  `, dense layers 
-0000f7f0: 7769 6c6c 2075 7365 2062 6961 7320 7665  will use bias ve
-0000f800: 6374 6f72 732e 0a20 2020 2020 2020 2061  ctors..        a
-0000f810: 6374 6976 6174 696f 6e3a 2073 7472 0a20  ctivation: str. 
-0000f820: 2020 2020 2020 2020 2020 2041 6374 6976             Activ
-0000f830: 6174 696f 6e20 6675 6e63 7469 6f6e 2074  ation function t
-0000f840: 6f20 6265 2075 7365 6420 696e 2074 6865  o be used in the
-0000f850: 2065 6e63 6f64 6572 206c 6179 6572 2e0a   encoder layer..
-0000f860: 2020 2020 2020 2020 2020 2020 4361 6e20              Can 
-0000f870: 6368 6f6f 7365 2062 6574 7765 656e 2027  choose between '
-0000f880: 7265 6c75 2720 666f 7220 5265 4c55 2c20  relu' for ReLU, 
-0000f890: 276c 6561 6b79 7265 6c75 2720 666f 7220  'leakyrelu' for 
-0000f8a0: 4c65 616b 7952 654c 552c 2027 7072 656c  LeakyReLU, 'prel
-0000f8b0: 7527 2066 6f72 2050 5265 4c55 2c0a 2020  u' for PReLU,.  
-0000f8c0: 2020 2020 2020 2020 2020 2774 616e 6827            'tanh'
-0000f8d0: 2066 6f72 2054 616e 482c 2027 7365 6c75   for TanH, 'selu
-0000f8e0: 2720 666f 7220 5345 4c55 2c20 616e 6420  ' for SELU, and 
-0000f8f0: 2765 6c75 2720 666f 7220 454c 552e 0a20  'elu' for ELU.. 
-0000f900: 2020 2020 2020 2064 726f 706f 7574 5f70         dropout_p
-0000f910: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-0000f920: 2020 2020 4472 6f70 6f75 7420 7072 6f62      Dropout prob
-0000f930: 6162 696c 6974 7920 666f 7220 7468 6520  ability for the 
-0000f940: 656e 636f 6465 7220 6c61 7965 722e 0a20  encoder layer.. 
-0000f950: 2020 2020 2020 2061 6767 7265 6761 7469         aggregati
-0000f960: 6f6e 3a20 7374 720a 2020 2020 2020 2020  on: str.        
-0000f970: 2020 2020 4167 6772 6567 6174 696f 6e20      Aggregation 
-0000f980: 7479 7065 2074 6f20 6265 2075 7365 6420  type to be used 
-0000f990: 696e 2074 6865 2065 6e63 6f64 6572 206c  in the encoder l
-0000f9a0: 6179 6572 2e0a 2020 2020 2020 2020 2020  ayer..          
-0000f9b0: 2020 4361 6e20 6368 6f6f 7365 2062 6574    Can choose bet
-0000f9c0: 7765 656e 2027 6d65 616e 272c 2027 7375  ween 'mean', 'su
-0000f9d0: 6d27 2c20 616e 6420 276e 6f72 6d27 2e0a  m', and 'norm'..
-0000f9e0: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
-0000f9f0: 696f 6e5f 6e6f 726d 3a20 556e 696f 6e5b  ion_norm: Union[
-0000fa00: 696e 742c 2066 6c6f 6174 5d0a 2020 2020  int, float].    
-0000fa10: 2020 2020 2020 2020 5661 6c75 6520 7265          Value re
-0000fa20: 7175 6972 6564 2069 6620 6061 6767 7265  quired if `aggre
-0000fa30: 6761 7469 6f6e 6020 7479 7065 2069 7320  gation` type is 
-0000fa40: 276e 6f72 6d27 2e0a 2020 2020 2020 2020  'norm'..        
-0000fa50: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
-0000fa60: 7228 444d 504e 4e45 6e63 6f64 6572 4c61  r(DMPNNEncoderLa
-0000fa70: 7965 722c 2073 656c 6629 2e5f 5f69 6e69  yer, self).__ini
-0000fa80: 745f 5f28 290a 0a20 2020 2020 2020 2069  t__()..        i
-0000fa90: 6620 7573 655f 6465 6661 756c 745f 6664  f use_default_fd
-0000faa0: 696d 3a0a 2020 2020 2020 2020 2020 2020  im:.            
-0000fab0: 6672 6f6d 2064 6565 7063 6865 6d2e 6665  from deepchem.fe
-0000fac0: 6174 2e6d 6f6c 6563 756c 655f 6665 6174  at.molecule_feat
-0000fad0: 7572 697a 6572 732e 646d 706e 6e5f 6665  urizers.dmpnn_fe
-0000fae0: 6174 7572 697a 6572 2069 6d70 6f72 7420  aturizer import 
-0000faf0: 4772 6170 6843 6f6e 7643 6f6e 7374 616e  GraphConvConstan
-0000fb00: 7473 0a20 2020 2020 2020 2020 2020 2073  ts.            s
-0000fb10: 656c 662e 6174 6f6d 5f66 6469 6d3a 2069  elf.atom_fdim: i
-0000fb20: 6e74 203d 2047 7261 7068 436f 6e76 436f  nt = GraphConvCo
-0000fb30: 6e73 7461 6e74 732e 4154 4f4d 5f46 4449  nstants.ATOM_FDI
-0000fb40: 4d0a 2020 2020 2020 2020 2020 2020 7365  M.            se
-0000fb50: 6c66 2e63 6f6e 6361 745f 6664 696d 3a20  lf.concat_fdim: 
-0000fb60: 696e 7420 3d20 4772 6170 6843 6f6e 7643  int = GraphConvC
-0000fb70: 6f6e 7374 616e 7473 2e41 544f 4d5f 4644  onstants.ATOM_FD
-0000fb80: 494d 202b 2047 7261 7068 436f 6e76 436f  IM + GraphConvCo
-0000fb90: 6e73 7461 6e74 732e 424f 4e44 5f46 4449  nstants.BOND_FDI
-0000fba0: 4d0a 2020 2020 2020 2020 656c 7365 3a0a  M.        else:.
-0000fbb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000fbc0: 2e61 746f 6d5f 6664 696d 203d 2061 746f  .atom_fdim = ato
-0000fbd0: 6d5f 6664 696d 0a20 2020 2020 2020 2020  m_fdim.         
-0000fbe0: 2020 2073 656c 662e 636f 6e63 6174 5f66     self.concat_f
-0000fbf0: 6469 6d20 3d20 6174 6f6d 5f66 6469 6d20  dim = atom_fdim 
-0000fc00: 2b20 626f 6e64 5f66 6469 6d0a 0a20 2020  + bond_fdim..   
-0000fc10: 2020 2020 2073 656c 662e 6465 7074 683a       self.depth:
-0000fc20: 2069 6e74 203d 2064 6570 7468 0a20 2020   int = depth.   
-0000fc30: 2020 2020 2073 656c 662e 6167 6772 6567       self.aggreg
-0000fc40: 6174 696f 6e3a 2073 7472 203d 2061 6767  ation: str = agg
-0000fc50: 7265 6761 7469 6f6e 0a20 2020 2020 2020  regation.       
-0000fc60: 2073 656c 662e 6167 6772 6567 6174 696f   self.aggregatio
-0000fc70: 6e5f 6e6f 726d 3a20 556e 696f 6e5b 696e  n_norm: Union[in
-0000fc80: 742c 2066 6c6f 6174 5d20 3d20 6167 6772  t, float] = aggr
-0000fc90: 6567 6174 696f 6e5f 6e6f 726d 0a0a 2020  egation_norm..  
-0000fca0: 2020 2020 2020 6966 2061 6374 6976 6174        if activat
-0000fcb0: 696f 6e20 3d3d 2027 7265 6c75 273a 0a20  ion == 'relu':. 
-0000fcc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000fcd0: 6163 7469 7661 7469 6f6e 3a20 6e6e 2e6d  activation: nn.m
-0000fce0: 6f64 756c 6573 2e61 6374 6976 6174 696f  odules.activatio
-0000fcf0: 6e2e 4d6f 6475 6c65 203d 206e 6e2e 5265  n.Module = nn.Re
-0000fd00: 4c55 2829 0a0a 2020 2020 2020 2020 656c  LU()..        el
-0000fd10: 6966 2061 6374 6976 6174 696f 6e20 3d3d  if activation ==
-0000fd20: 2027 6c65 616b 7972 656c 7527 3a0a 2020   'leakyrelu':.  
-0000fd30: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000fd40: 6374 6976 6174 696f 6e20 3d20 6e6e 2e4c  ctivation = nn.L
-0000fd50: 6561 6b79 5265 4c55 2830 2e31 290a 0a20  eakyReLU(0.1).. 
-0000fd60: 2020 2020 2020 2065 6c69 6620 6163 7469         elif acti
-0000fd70: 7661 7469 6f6e 203d 3d20 2770 7265 6c75  vation == 'prelu
-0000fd80: 273a 0a20 2020 2020 2020 2020 2020 2073  ':.            s
-0000fd90: 656c 662e 6163 7469 7661 7469 6f6e 203d  elf.activation =
-0000fda0: 206e 6e2e 5052 654c 5528 290a 0a20 2020   nn.PReLU()..   
-0000fdb0: 2020 2020 2065 6c69 6620 6163 7469 7661       elif activa
-0000fdc0: 7469 6f6e 203d 3d20 2774 616e 6827 3a0a  tion == 'tanh':.
-0000fdd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000fde0: 2e61 6374 6976 6174 696f 6e20 3d20 6e6e  .activation = nn
-0000fdf0: 2e54 616e 6828 290a 0a20 2020 2020 2020  .Tanh()..       
-0000fe00: 2065 6c69 6620 6163 7469 7661 7469 6f6e   elif activation
-0000fe10: 203d 3d20 2773 656c 7527 3a0a 2020 2020   == 'selu':.    
-0000fe20: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
-0000fe30: 6976 6174 696f 6e20 3d20 6e6e 2e53 454c  ivation = nn.SEL
-0000fe40: 5528 290a 0a20 2020 2020 2020 2065 6c69  U()..        eli
-0000fe50: 6620 6163 7469 7661 7469 6f6e 203d 3d20  f activation == 
-0000fe60: 2765 6c75 273a 0a20 2020 2020 2020 2020  'elu':.         
-0000fe70: 2020 2073 656c 662e 6163 7469 7661 7469     self.activati
-0000fe80: 6f6e 203d 206e 6e2e 454c 5528 290a 0a20  on = nn.ELU().. 
-0000fe90: 2020 2020 2020 2073 656c 662e 6472 6f70         self.drop
-0000fea0: 6f75 743a 206e 6e2e 6d6f 6475 6c65 732e  out: nn.modules.
-0000feb0: 6472 6f70 6f75 742e 4d6f 6475 6c65 203d  dropout.Module =
-0000fec0: 206e 6e2e 4472 6f70 6f75 7428 6472 6f70   nn.Dropout(drop
-0000fed0: 6f75 745f 7029 0a0a 2020 2020 2020 2020  out_p)..        
-0000fee0: 2320 496e 7075 740a 2020 2020 2020 2020  # Input.        
-0000fef0: 7365 6c66 2e57 5f69 3a20 6e6e 2e4c 696e  self.W_i: nn.Lin
-0000ff00: 6561 7220 3d20 6e6e 2e4c 696e 6561 7228  ear = nn.Linear(
-0000ff10: 7365 6c66 2e63 6f6e 6361 745f 6664 696d  self.concat_fdim
-0000ff20: 2c20 645f 6869 6464 656e 2c20 6269 6173  , d_hidden, bias
-0000ff30: 3d62 6961 7329 0a0a 2020 2020 2020 2020  =bias)..        
-0000ff40: 2320 5368 6172 6564 2077 6569 6768 7420  # Shared weight 
-0000ff50: 6d61 7472 6978 2061 6372 6f73 7320 6465  matrix across de
-0000ff60: 7074 6873 2028 6465 6661 756c 7429 3a0a  pths (default):.
-0000ff70: 2020 2020 2020 2020 2320 466f 7220 6d65          # For me
-0000ff80: 7373 6167 6573 2068 6964 6465 6e20 7374  ssages hidden st
-0000ff90: 6174 6573 0a20 2020 2020 2020 2073 656c  ates.        sel
-0000ffa0: 662e 575f 683a 206e 6e2e 4c69 6e65 6172  f.W_h: nn.Linear
-0000ffb0: 203d 206e 6e2e 4c69 6e65 6172 2864 5f68   = nn.Linear(d_h
-0000ffc0: 6964 6465 6e2c 2064 5f68 6964 6465 6e2c  idden, d_hidden,
-0000ffd0: 2062 6961 733d 6269 6173 290a 0a20 2020   bias=bias)..   
-0000ffe0: 2020 2020 2023 2046 6f72 2061 746f 6d20       # For atom 
-0000fff0: 6869 6464 656e 2073 7461 7465 730a 2020  hidden states.  
-00010000: 2020 2020 2020 7365 6c66 2e57 5f6f 3a20        self.W_o: 
-00010010: 6e6e 2e4c 696e 6561 7220 3d20 6e6e 2e4c  nn.Linear = nn.L
-00010020: 696e 6561 7228 7365 6c66 2e61 746f 6d5f  inear(self.atom_
-00010030: 6664 696d 202b 2064 5f68 6964 6465 6e2c  fdim + d_hidden,
-00010040: 2064 5f68 6964 6465 6e29 0a0a 2020 2020   d_hidden)..    
-00010050: 6465 6620 5f67 6574 5f75 7064 6174 6564  def _get_updated
-00010060: 5f61 746f 6d73 5f68 6964 6465 6e5f 7374  _atoms_hidden_st
-00010070: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
-00010080: 2073 656c 662c 2061 746f 6d5f 6665 6174   self, atom_feat
-00010090: 7572 6573 3a20 746f 7263 682e 5465 6e73  ures: torch.Tens
-000100a0: 6f72 2c20 685f 6d65 7373 6167 653a 2074  or, h_message: t
-000100b0: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
-000100c0: 2020 2020 2020 2020 2061 746f 6d5f 746f           atom_to
-000100d0: 5f69 6e63 6f6d 696e 675f 626f 6e64 733a  _incoming_bonds:
-000100e0: 2074 6f72 6368 2e54 656e 736f 7229 202d   torch.Tensor) -
-000100f0: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
-00010100: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010110: 2020 2020 4d65 7468 6f64 2074 6f20 636f      Method to co
-00010120: 6d70 7574 6520 6174 6f6d 2068 6964 6465  mpute atom hidde
-00010130: 6e20 7374 6174 6573 2e0a 0a20 2020 2020  n states...     
-00010140: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00010150: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00010160: 0a20 2020 2020 2020 2061 746f 6d5f 6665  .        atom_fe
-00010170: 6174 7572 6573 3a20 746f 7263 682e 5465  atures: torch.Te
-00010180: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-00010190: 2054 656e 736f 7220 636f 6e74 6169 6e69   Tensor containi
-000101a0: 6e67 2061 746f 6d73 2066 6561 7475 7265  ng atoms feature
-000101b0: 732e 0a20 2020 2020 2020 2068 5f6d 6573  s..        h_mes
-000101c0: 7361 6765 3a20 746f 7263 682e 5465 6e73  sage: torch.Tens
-000101d0: 6f72 0a20 2020 2020 2020 2020 2020 2054  or.            T
-000101e0: 656e 736f 7220 636f 6e74 6169 6e69 6e67  ensor containing
-000101f0: 2068 6964 6465 6e20 7374 6174 6573 206f   hidden states o
-00010200: 6620 6d65 7373 6167 6573 2e0a 2020 2020  f messages..    
-00010210: 2020 2020 6174 6f6d 5f74 6f5f 696e 636f      atom_to_inco
-00010220: 6d69 6e67 5f62 6f6e 6473 3a20 746f 7263  ming_bonds: torc
-00010230: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00010240: 2020 2020 2054 656e 736f 7220 636f 6e74       Tensor cont
-00010250: 6169 6e69 6e67 206d 6170 7069 6e67 2066  aining mapping f
-00010260: 726f 6d20 6174 6f6d 2069 6e64 6578 2074  rom atom index t
-00010270: 6f20 6c69 7374 206f 6620 696e 6469 6369  o list of indici
-00010280: 6573 206f 6620 696e 636f 6d69 6e67 2062  es of incoming b
-00010290: 6f6e 6473 2e0a 0a20 2020 2020 2020 2052  onds...        R
-000102a0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-000102b0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2061  ------.        a
-000102c0: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
-000102d0: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
-000102e0: 0a20 2020 2020 2020 2020 2020 2054 656e  .            Ten
-000102f0: 736f 7220 636f 6e74 6169 6e69 6e67 2061  sor containing a
-00010300: 746f 6d20 6869 6464 656e 2073 7461 7465  tom hidden state
-00010310: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00010320: 2020 2020 2020 206d 6573 7361 6765 735f         messages_
-00010330: 746f 5f61 746f 6d73 3a20 746f 7263 682e  to_atoms: torch.
-00010340: 5465 6e73 6f72 203d 2068 5f6d 6573 7361  Tensor = h_messa
-00010350: 6765 5b61 746f 6d5f 746f 5f69 6e63 6f6d  ge[atom_to_incom
-00010360: 696e 675f 626f 6e64 735d 2e73 756d 280a  ing_bonds].sum(.
-00010370: 2020 2020 2020 2020 2020 2020 3129 2020              1)  
-00010380: 2320 6e75 6d5f 6174 6f6d 7320 7820 6869  # num_atoms x hi
-00010390: 6464 656e 5f73 697a 650a 2020 2020 2020  dden_size.      
-000103a0: 2020 6174 6f6d 735f 6869 6464 656e 5f73    atoms_hidden_s
-000103b0: 7461 7465 733a 2074 6f72 6368 2e54 656e  tates: torch.Ten
-000103c0: 736f 7220 3d20 7365 6c66 2e57 5f6f 280a  sor = self.W_o(.
-000103d0: 2020 2020 2020 2020 2020 2020 746f 7263              torc
-000103e0: 682e 6361 7428 2861 746f 6d5f 6665 6174  h.cat((atom_feat
-000103f0: 7572 6573 2c20 6d65 7373 6167 6573 5f74  ures, messages_t
-00010400: 6f5f 6174 6f6d 7329 2c0a 2020 2020 2020  o_atoms),.      
-00010410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010420: 3129 2920 2023 206e 756d 5f61 746f 6d73  1))  # num_atoms
-00010430: 2078 2068 6964 6465 6e5f 7369 7a65 0a20   x hidden_size. 
-00010440: 2020 2020 2020 2061 746f 6d73 5f68 6964         atoms_hid
-00010450: 6465 6e5f 7374 6174 6573 203d 2073 656c  den_states = sel
-00010460: 662e 6163 7469 7661 7469 6f6e 280a 2020  f.activation(.  
-00010470: 2020 2020 2020 2020 2020 6174 6f6d 735f            atoms_
-00010480: 6869 6464 656e 5f73 7461 7465 7329 2020  hidden_states)  
-00010490: 2320 6e75 6d5f 6174 6f6d 7320 7820 6869  # num_atoms x hi
-000104a0: 6464 656e 5f73 697a 650a 2020 2020 2020  dden_size.      
-000104b0: 2020 6174 6f6d 735f 6869 6464 656e 5f73    atoms_hidden_s
-000104c0: 7461 7465 7320 3d20 7365 6c66 2e64 726f  tates = self.dro
-000104d0: 706f 7574 280a 2020 2020 2020 2020 2020  pout(.          
-000104e0: 2020 6174 6f6d 735f 6869 6464 656e 5f73    atoms_hidden_s
-000104f0: 7461 7465 7329 2020 2320 6e75 6d5f 6174  tates)  # num_at
-00010500: 6f6d 7320 7820 6869 6464 656e 5f73 697a  oms x hidden_siz
-00010510: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00010520: 2061 746f 6d73 5f68 6964 6465 6e5f 7374   atoms_hidden_st
-00010530: 6174 6573 2020 2320 6e75 6d5f 6174 6f6d  ates  # num_atom
-00010540: 7320 7820 6869 6464 656e 5f73 697a 650a  s x hidden_size.
-00010550: 0a20 2020 2064 6566 205f 7265 6164 6f75  .    def _readou
-00010560: 7428 7365 6c66 2c20 6174 6f6d 735f 6869  t(self, atoms_hi
-00010570: 6464 656e 5f73 7461 7465 733a 2074 6f72  dden_states: tor
-00010580: 6368 2e54 656e 736f 722c 0a20 2020 2020  ch.Tensor,.     
-00010590: 2020 2020 2020 2020 2020 2020 6d6f 6c65              mole
-000105a0: 6375 6c65 735f 756e 6261 7463 685f 6b65  cules_unbatch_ke
-000105b0: 793a 204c 6973 7429 202d 3e20 746f 7263  y: List) -> torc
-000105c0: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
-000105d0: 2020 2222 220a 2020 2020 2020 2020 4d65    """.        Me
-000105e0: 7468 6f64 2074 6f20 6578 6563 7574 6520  thod to execute 
-000105f0: 7468 6520 7265 6164 6f75 7420 7068 6173  the readout phas
-00010600: 652e 2028 636f 6d70 7574 6520 6d6f 6c65  e. (compute mole
-00010610: 6375 6c65 7320 656e 636f 6469 6e67 7320  cules encodings 
-00010620: 6672 6f6d 2061 746f 6d20 6869 6464 656e  from atom hidden
-00010630: 2073 7461 7465 7329 0a0a 2020 2020 2020   states)..      
-00010640: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00010650: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00010660: 2020 2020 2020 2020 6174 6f6d 735f 6869          atoms_hi
-00010670: 6464 656e 5f73 7461 7465 733a 2074 6f72  dden_states: tor
-00010680: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00010690: 2020 2020 2020 5465 6e73 6f72 2063 6f6e        Tensor con
-000106a0: 7461 696e 696e 6720 6174 6f6d 2068 6964  taining atom hid
-000106b0: 6465 6e20 7374 6174 6573 2e0a 2020 2020  den states..    
-000106c0: 2020 2020 6d6f 6c65 6375 6c65 735f 756e      molecules_un
-000106d0: 6261 7463 685f 6b65 793a 204c 6973 740a  batch_key: List.
-000106e0: 2020 2020 2020 2020 2020 2020 4c69 7374              List
-000106f0: 2063 6f6e 7461 696e 696e 6720 6e75 6d62   containing numb
-00010700: 6572 206f 6620 6174 6f6d 7320 696e 2076  er of atoms in v
-00010710: 6172 696f 7573 206d 6f6c 6563 756c 6573  arious molecules
-00010720: 206f 6620 6120 6261 7463 680a 0a20 2020   of a batch..   
-00010730: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00010740: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00010750: 2020 2020 206d 6f6c 6563 756c 655f 6869       molecule_hi
-00010760: 6464 656e 5f73 7461 7465 3a20 746f 7263  dden_state: torc
-00010770: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00010780: 2020 2020 2054 656e 736f 7220 636f 6e74       Tensor cont
-00010790: 6169 6e69 6e67 206d 6f6c 6563 756c 6520  aining molecule 
-000107a0: 656e 636f 6469 6e67 732e 0a20 2020 2020  encodings..     
-000107b0: 2020 2022 2222 0a20 2020 2020 2020 206d     """.        m
-000107c0: 6f6c 5f76 6563 733a 204c 6973 7420 3d20  ol_vecs: List = 
-000107d0: 5b5d 0a20 2020 2020 2020 2061 746f 6d73  [].        atoms
-000107e0: 5f68 6964 6465 6e5f 7374 6174 6573 5f73  _hidden_states_s
-000107f0: 706c 6974 3a20 5365 7175 656e 6365 5b54  plit: Sequence[T
-00010800: 656e 736f 725d 203d 2074 6f72 6368 2e73  ensor] = torch.s
-00010810: 706c 6974 280a 2020 2020 2020 2020 2020  plit(.          
-00010820: 2020 6174 6f6d 735f 6869 6464 656e 5f73    atoms_hidden_s
-00010830: 7461 7465 732c 206d 6f6c 6563 756c 6573  tates, molecules
-00010840: 5f75 6e62 6174 6368 5f6b 6579 290a 2020  _unbatch_key).  
-00010850: 2020 2020 2020 6d6f 6c5f 7665 633a 2074        mol_vec: t
-00010860: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-00010870: 2020 2020 666f 7220 6d6f 6c5f 7665 6320      for mol_vec 
-00010880: 696e 2061 746f 6d73 5f68 6964 6465 6e5f  in atoms_hidden_
-00010890: 7374 6174 6573 5f73 706c 6974 3a0a 2020  states_split:.  
-000108a0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-000108b0: 662e 6167 6772 6567 6174 696f 6e20 3d3d  f.aggregation ==
-000108c0: 2027 6d65 616e 273a 0a20 2020 2020 2020   'mean':.       
-000108d0: 2020 2020 2020 2020 206d 6f6c 5f76 6563           mol_vec
-000108e0: 203d 206d 6f6c 5f76 6563 2e73 756d 2864   = mol_vec.sum(d
-000108f0: 696d 3d30 2920 2f20 6c65 6e28 6d6f 6c5f  im=0) / len(mol_
-00010900: 7665 6329 0a20 2020 2020 2020 2020 2020  vec).           
-00010910: 2065 6c69 6620 7365 6c66 2e61 6767 7265   elif self.aggre
-00010920: 6761 7469 6f6e 203d 3d20 2773 756d 273a  gation == 'sum':
-00010930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010940: 206d 6f6c 5f76 6563 203d 206d 6f6c 5f76   mol_vec = mol_v
-00010950: 6563 2e73 756d 2864 696d 3d30 290a 2020  ec.sum(dim=0).  
-00010960: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-00010970: 656c 662e 6167 6772 6567 6174 696f 6e20  elf.aggregation 
-00010980: 3d3d 2027 6e6f 726d 273a 0a20 2020 2020  == 'norm':.     
-00010990: 2020 2020 2020 2020 2020 206d 6f6c 5f76             mol_v
-000109a0: 6563 203d 206d 6f6c 5f76 6563 2e73 756d  ec = mol_vec.sum
-000109b0: 2864 696d 3d30 2920 2f20 7365 6c66 2e61  (dim=0) / self.a
-000109c0: 6767 7265 6761 7469 6f6e 5f6e 6f72 6d0a  ggregation_norm.
-000109d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000109e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000109f0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-00010a00: 6e28 2249 6e76 616c 6964 2061 6767 7265  n("Invalid aggre
-00010a10: 6761 7469 6f6e 2229 0a20 2020 2020 2020  gation").       
-00010a20: 2020 2020 206d 6f6c 5f76 6563 732e 6170       mol_vecs.ap
-00010a30: 7065 6e64 286d 6f6c 5f76 6563 290a 0a20  pend(mol_vec).. 
-00010a40: 2020 2020 2020 206d 6f6c 6563 756c 655f         molecule_
-00010a50: 6869 6464 656e 5f73 7461 7465 3a20 746f  hidden_state: to
-00010a60: 7263 682e 5465 6e73 6f72 203d 2074 6f72  rch.Tensor = tor
-00010a70: 6368 2e73 7461 636b 286d 6f6c 5f76 6563  ch.stack(mol_vec
-00010a80: 732c 2064 696d 3d30 290a 2020 2020 2020  s, dim=0).      
-00010a90: 2020 7265 7475 726e 206d 6f6c 6563 756c    return molecul
-00010aa0: 655f 6869 6464 656e 5f73 7461 7465 2020  e_hidden_state  
-00010ab0: 2320 6e75 6d5f 6d6f 6c65 6375 6c65 7320  # num_molecules 
-00010ac0: 7820 6869 6464 656e 5f73 697a 650a 0a20  x hidden_size.. 
-00010ad0: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
-00010ae0: 656c 662c 2061 746f 6d5f 6665 6174 7572  elf, atom_featur
-00010af0: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
-00010b00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010b10: 2020 665f 696e 695f 6174 6f6d 735f 626f    f_ini_atoms_bo
-00010b20: 6e64 733a 2074 6f72 6368 2e54 656e 736f  nds: torch.Tenso
-00010b30: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00010b40: 2020 2061 746f 6d5f 746f 5f69 6e63 6f6d     atom_to_incom
-00010b50: 696e 675f 626f 6e64 733a 2074 6f72 6368  ing_bonds: torch
-00010b60: 2e54 656e 736f 722c 206d 6170 7069 6e67  .Tensor, mapping
-00010b70: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
-00010b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b90: 676c 6f62 616c 5f66 6561 7475 7265 733a  global_features:
-00010ba0: 2074 6f72 6368 2e54 656e 736f 722c 0a20   torch.Tensor,. 
-00010bb0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00010bc0: 6f6c 6563 756c 6573 5f75 6e62 6174 6368  olecules_unbatch
-00010bd0: 5f6b 6579 3a20 4c69 7374 2920 2d3e 2074  _key: List) -> t
-00010be0: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
-00010bf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00010c00: 204f 7574 7075 7420 636f 6d70 7574 6174   Output computat
-00010c10: 696f 6e20 666f 7220 7468 6520 444d 504e  ion for the DMPN
-00010c20: 4e45 6e63 6f64 6572 4c61 7965 722e 0a0a  NEncoderLayer...
-00010c30: 2020 2020 2020 2020 5374 6570 733a 0a0a          Steps:..
-00010c40: 2020 2020 2020 2020 2d20 4765 7420 6f72          - Get or
-00010c50: 6967 696e 616c 2062 6f6e 6420 6869 6464  iginal bond hidd
-00010c60: 656e 2073 7461 7465 7320 6672 6f6d 2063  en states from c
-00010c70: 6f6e 6361 7465 6e61 7469 6f6e 206f 6620  oncatenation of 
-00010c80: 696e 6974 6961 6c20 6174 6f6d 2061 6e64  initial atom and
-00010c90: 2062 6f6e 6420 6665 6174 7572 6573 2e20   bond features. 
-00010ca0: 2860 6069 6e70 7574 6060 290a 2020 2020  (``input``).    
-00010cb0: 2020 2020 2d20 4765 7420 696e 6974 6961      - Get initia
-00010cc0: 6c20 6d65 7373 6167 6573 2068 6964 6465  l messages hidde
-00010cd0: 6e20 7374 6174 6573 2e20 2860 606d 6573  n states. (``mes
-00010ce0: 7361 6765 6060 290a 2020 2020 2020 2020  sage``).        
-00010cf0: 2d20 4578 6563 7574 6520 6d65 7373 6167  - Execute messag
-00010d00: 6520 7061 7373 696e 6720 7374 6570 2066  e passing step f
-00010d10: 6f72 2060 6073 656c 662e 6465 7074 6820  or ``self.depth 
-00010d20: 2d20 3160 6020 6974 6572 6174 696f 6e73  - 1`` iterations
-00010d30: 2e0a 2020 2020 2020 2020 2d20 4765 7420  ..        - Get 
-00010d40: 6174 6f6d 2068 6964 6465 6e20 7374 6174  atom hidden stat
-00010d50: 6573 2075 7369 6e67 2061 746f 6d20 6665  es using atom fe
-00010d60: 6174 7572 6573 2061 6e64 206d 6573 7361  atures and messa
-00010d70: 6765 2068 6964 6465 6e20 7374 6174 6573  ge hidden states
-00010d80: 2e0a 2020 2020 2020 2020 2d20 4765 7420  ..        - Get 
-00010d90: 6d6f 6c65 6375 6c65 2065 6e63 6f64 696e  molecule encodin
-00010da0: 6773 2e0a 2020 2020 2020 2020 2d20 436f  gs..        - Co
-00010db0: 6e63 6174 656e 6174 6520 676c 6f62 616c  ncatenate global
-00010dc0: 206d 6f6c 6563 756c 6172 2066 6561 7475   molecular featu
-00010dd0: 7265 7320 616e 6420 6d6f 6c65 6375 6c65  res and molecule
-00010de0: 2065 6e63 6f64 696e 6773 2e0a 0a20 2020   encodings...   
-00010df0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00010e00: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00010e10: 2d2d 0a20 2020 2020 2020 2061 746f 6d5f  --.        atom_
-00010e20: 6665 6174 7572 6573 3a20 746f 7263 682e  features: torch.
-00010e30: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00010e40: 2020 2054 656e 736f 7220 636f 6e74 6169     Tensor contai
-00010e50: 6e69 6e67 2061 746f 6d73 2066 6561 7475  ning atoms featu
-00010e60: 7265 732e 0a20 2020 2020 2020 2066 5f69  res..        f_i
-00010e70: 6e69 5f61 746f 6d73 5f62 6f6e 6473 3a20  ni_atoms_bonds: 
-00010e80: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-00010e90: 2020 2020 2020 2020 2054 656e 736f 7220           Tensor 
-00010ea0: 636f 6e74 6169 6e69 6e67 2063 6f6e 6361  containing conca
-00010eb0: 7465 6e61 7465 6420 6665 6174 7572 6520  tenated feature 
-00010ec0: 7665 6374 6f72 2077 6869 6368 2063 6f6e  vector which con
-00010ed0: 7461 696e 7320 636f 6e63 6174 656e 6174  tains concatenat
-00010ee0: 696f 6e20 6f66 2069 6e69 7469 616c 2061  ion of initial a
-00010ef0: 746f 6d20 616e 6420 626f 6e64 2066 6561  tom and bond fea
-00010f00: 7475 7265 732e 0a20 2020 2020 2020 2061  tures..        a
-00010f10: 746f 6d5f 746f 5f69 6e63 6f6d 696e 675f  tom_to_incoming_
-00010f20: 626f 6e64 733a 2074 6f72 6368 2e54 656e  bonds: torch.Ten
-00010f30: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00010f40: 5465 6e73 6f72 2063 6f6e 7461 696e 696e  Tensor containin
-00010f50: 6720 6d61 7070 696e 6720 6672 6f6d 2061  g mapping from a
-00010f60: 746f 6d20 696e 6465 7820 746f 206c 6973  tom index to lis
-00010f70: 7420 6f66 2069 6e64 6963 6965 7320 6f66  t of indicies of
-00010f80: 2069 6e63 6f6d 696e 6720 626f 6e64 732e   incoming bonds.
-00010f90: 0a20 2020 2020 2020 206d 6170 7069 6e67  .        mapping
-00010fa0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-00010fb0: 2020 2020 2020 2020 2020 2054 656e 736f             Tenso
-00010fc0: 7220 636f 6e74 6169 6e69 6e67 2074 6865  r containing the
-00010fd0: 206d 6170 7069 6e67 2074 6861 7420 6d61   mapping that ma
-00010fe0: 7073 2062 6f6e 6420 696e 6465 7820 746f  ps bond index to
-00010ff0: 2027 6172 7261 7920 6f66 2069 6e64 6963   'array of indic
-00011000: 6573 206f 6620 7468 6520 626f 6e64 7327  es of the bonds'
-00011010: 0a20 2020 2020 2020 2020 2020 2069 6e63  .            inc
-00011020: 6f6d 696e 6720 6174 2074 6865 2069 6e69  oming at the ini
-00011030: 7469 616c 2061 746f 6d20 6f66 2074 6865  tial atom of the
-00011040: 2062 6f6e 6420 2865 7863 6c75 6469 6e67   bond (excluding
-00011050: 2074 6865 2072 6576 6572 7365 2062 6f6e   the reverse bon
-00011060: 6473 292e 0a20 2020 2020 2020 2067 6c6f  ds)..        glo
-00011070: 6261 6c5f 6665 6174 7572 6573 3a20 746f  bal_features: to
-00011080: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-00011090: 2020 2020 2020 2054 656e 736f 7220 636f         Tensor co
-000110a0: 6e74 6169 6e69 6e67 206d 6f6c 6563 756c  ntaining molecul
-000110b0: 6520 6665 6174 7572 6573 2e0a 2020 2020  e features..    
-000110c0: 2020 2020 6d6f 6c65 6375 6c65 735f 756e      molecules_un
-000110d0: 6261 7463 685f 6b65 793a 204c 6973 740a  batch_key: List.
-000110e0: 2020 2020 2020 2020 2020 2020 4c69 7374              List
-000110f0: 2063 6f6e 7461 696e 696e 6720 6e75 6d62   containing numb
-00011100: 6572 206f 6620 6174 6f6d 7320 696e 2076  er of atoms in v
-00011110: 6172 696f 7573 206d 6f6c 6563 756c 6573  arious molecules
-00011120: 206f 6620 6120 6261 7463 680a 0a20 2020   of a batch..   
-00011130: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00011140: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00011150: 2020 2020 206f 7574 7075 743a 2074 6f72       output: tor
-00011160: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00011170: 2020 2020 2020 5465 6e73 6f72 2063 6f6e        Tensor con
-00011180: 7461 696e 696e 6720 7468 6520 656e 636f  taining the enco
-00011190: 6469 6e67 7320 6f66 2074 6865 206d 6f6c  dings of the mol
-000111a0: 6563 756c 6573 2e0a 2020 2020 2020 2020  ecules..        
-000111b0: 2222 220a 2020 2020 2020 2020 696e 7075  """.        inpu
-000111c0: 743a 2074 6f72 6368 2e54 656e 736f 7220  t: torch.Tensor 
-000111d0: 3d20 7365 6c66 2e57 5f69 280a 2020 2020  = self.W_i(.    
-000111e0: 2020 2020 2020 2020 665f 696e 695f 6174          f_ini_at
-000111f0: 6f6d 735f 626f 6e64 7329 2020 2320 6e75  oms_bonds)  # nu
-00011200: 6d5f 626f 6e64 7320 7820 6869 6464 656e  m_bonds x hidden
-00011210: 5f73 697a 650a 2020 2020 2020 2020 6d65  _size.        me
-00011220: 7373 6167 653a 2074 6f72 6368 2e54 656e  ssage: torch.Ten
-00011230: 736f 7220 3d20 7365 6c66 2e61 6374 6976  sor = self.activ
-00011240: 6174 696f 6e28 0a20 2020 2020 2020 2020  ation(.         
-00011250: 2020 2069 6e70 7574 2920 2023 206e 756d     input)  # num
-00011260: 5f62 6f6e 6473 2078 2068 6964 6465 6e5f  _bonds x hidden_
-00011270: 7369 7a65 0a0a 2020 2020 2020 2020 666f  size..        fo
-00011280: 7220 5f20 696e 2072 616e 6765 2831 2c20  r _ in range(1, 
-00011290: 7365 6c66 2e64 6570 7468 293a 0a20 2020  self.depth):.   
-000112a0: 2020 2020 2020 2020 206d 6573 7361 6765           message
-000112b0: 203d 206d 6573 7361 6765 5b6d 6170 7069   = message[mappi
-000112c0: 6e67 5d2e 7375 6d28 3129 2020 2320 6e75  ng].sum(1)  # nu
-000112d0: 6d5f 626f 6e64 7320 7820 6869 6464 656e  m_bonds x hidden
-000112e0: 5f73 697a 650a 2020 2020 2020 2020 2020  _size.          
-000112f0: 2020 685f 6d65 7373 6167 653a 2074 6f72    h_message: tor
-00011300: 6368 2e54 656e 736f 7220 3d20 696e 7075  ch.Tensor = inpu
-00011310: 7420 2b20 7365 6c66 2e57 5f68 280a 2020  t + self.W_h(.  
-00011320: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00011330: 7373 6167 6529 2020 2320 6e75 6d5f 626f  ssage)  # num_bo
-00011340: 6e64 7320 7820 6869 6464 656e 5f73 697a  nds x hidden_siz
-00011350: 650a 2020 2020 2020 2020 2020 2020 685f  e.            h_
-00011360: 6d65 7373 6167 6520 3d20 7365 6c66 2e61  message = self.a
-00011370: 6374 6976 6174 696f 6e28 685f 6d65 7373  ctivation(h_mess
-00011380: 6167 6529 2020 2320 6e75 6d5f 626f 6e64  age)  # num_bond
-00011390: 7320 7820 6869 6464 656e 5f73 697a 650a  s x hidden_size.
-000113a0: 2020 2020 2020 2020 2020 2020 685f 6d65              h_me
-000113b0: 7373 6167 6520 3d20 7365 6c66 2e64 726f  ssage = self.dro
-000113c0: 706f 7574 2868 5f6d 6573 7361 6765 2920  pout(h_message) 
-000113d0: 2023 206e 756d 5f62 6f6e 6473 2078 2068   # num_bonds x h
-000113e0: 6964 6465 6e5f 7369 7a65 0a0a 2020 2020  idden_size..    
-000113f0: 2020 2020 2320 6e75 6d5f 6174 6f6d 7320      # num_atoms 
-00011400: 7820 6869 6464 656e 5f73 697a 650a 2020  x hidden_size.  
-00011410: 2020 2020 2020 6174 6f6d 735f 6869 6464        atoms_hidd
-00011420: 656e 5f73 7461 7465 733a 2074 6f72 6368  en_states: torch
-00011430: 2e54 656e 736f 7220 3d20 7365 6c66 2e5f  .Tensor = self._
-00011440: 6765 745f 7570 6461 7465 645f 6174 6f6d  get_updated_atom
-00011450: 735f 6869 6464 656e 5f73 7461 7465 280a  s_hidden_state(.
-00011460: 2020 2020 2020 2020 2020 2020 6174 6f6d              atom
-00011470: 5f66 6561 7475 7265 732c 2068 5f6d 6573  _features, h_mes
-00011480: 7361 6765 2c20 6174 6f6d 5f74 6f5f 696e  sage, atom_to_in
-00011490: 636f 6d69 6e67 5f62 6f6e 6473 290a 0a20  coming_bonds).. 
-000114a0: 2020 2020 2020 2023 206e 756d 5f6d 6f6c         # num_mol
-000114b0: 6563 756c 6573 2078 2068 6964 6465 6e5f  ecules x hidden_
-000114c0: 7369 7a65 0a20 2020 2020 2020 206f 7574  size.        out
-000114d0: 7075 743a 2074 6f72 6368 2e54 656e 736f  put: torch.Tenso
-000114e0: 7220 3d20 7365 6c66 2e5f 7265 6164 6f75  r = self._readou
-000114f0: 7428 6174 6f6d 735f 6869 6464 656e 5f73  t(atoms_hidden_s
-00011500: 7461 7465 732c 0a20 2020 2020 2020 2020  tates,.         
-00011510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7b0: 2020 2020 2020 6564 6765 5f62 6174 6368        edge_batch
+0000c7c0: 5f6d 6170 290a 0a20 2020 2020 2020 2069  _map)..        i
+0000c7d0: 6620 7365 6c66 2e69 735f 756e 6469 7265  f self.is_undire
+0000c7e0: 6374 6564 2069 7320 5472 7565 3a0a 2020  cted is True:.  
+0000c7f0: 2020 2020 2020 2020 2020 2320 636f 6f6e            # coon
+0000c800: 7665 7274 696e 6720 6564 6765 2066 6561  verting edge fea
+0000c810: 7475 7265 7320 746f 2069 7473 206f 7269  tures to its ori
+0000c820: 6769 6e61 6c20 7368 6170 650a 2020 2020  ginal shape.    
+0000c830: 2020 2020 2020 2020 7370 6c69 7420 3d20          split = 
+0000c840: 746f 7263 682e 7370 6c69 7428 6564 6765  torch.split(edge
+0000c850: 5f66 6561 7475 7265 732c 0a20 2020 2020  _features,.     
+0000c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c870: 2020 2020 2020 2020 2020 205b 6564 6765             [edge
+0000c880: 5f66 6561 7475 7265 735f 6c65 6e2c 2065  _features_len, e
+0000c890: 6467 655f 6665 6174 7572 6573 5f6c 656e  dge_features_len
+0000c8a0: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
+0000c8b0: 6467 655f 6665 6174 7572 6573 203d 2028  dge_features = (
+0000c8c0: 7370 6c69 745b 305d 202b 2073 706c 6974  split[0] + split
+0000c8d0: 5b31 5d29 202f 2032 0a0a 2020 2020 2020  [1]) / 2..      
+0000c8e0: 2020 6966 2073 656c 662e 7265 7369 6475    if self.residu
+0000c8f0: 616c 5f63 6f6e 6e65 6374 696f 6e3a 0a20  al_connection:. 
+0000c900: 2020 2020 2020 2020 2020 2065 6467 655f             edge_
+0000c910: 6665 6174 7572 6573 202b 3d20 6564 6765  features += edge
+0000c920: 5f66 6561 7475 7265 735f 636f 7079 0a20  _features_copy. 
+0000c930: 2020 2020 2020 2020 2020 206e 6f64 655f             node_
+0000c940: 6665 6174 7572 6573 202b 3d20 6e6f 6465  features += node
+0000c950: 5f66 6561 7475 7265 735f 636f 7079 0a20  _features_copy. 
+0000c960: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
+0000c970: 6c5f 6665 6174 7572 6573 202b 3d20 676c  l_features += gl
+0000c980: 6f62 616c 5f66 6561 7475 7265 735f 636f  obal_features_co
+0000c990: 7079 0a0a 2020 2020 2020 2020 7265 7475  py..        retu
+0000c9a0: 726e 206e 6f64 655f 6665 6174 7572 6573  rn node_features
+0000c9b0: 2c20 6564 6765 5f66 6561 7475 7265 732c  , edge_features,
+0000c9c0: 2067 6c6f 6261 6c5f 6665 6174 7572 6573   global_features
+0000c9d0: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+0000c9e0: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
+0000c9f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000ca00: 280a 2020 2020 2020 2020 2020 2020 6627  (.            f'
+0000ca10: 7b73 656c 662e 5f5f 636c 6173 735f 5f2e  {self.__class__.
+0000ca20: 5f5f 6e61 6d65 5f5f 7d28 6e5f 6e6f 6465  __name__}(n_node
+0000ca30: 5f66 6561 7475 7265 733d 7b73 656c 662e  _features={self.
+0000ca40: 6e5f 6e6f 6465 5f66 6561 7475 7265 737d  n_node_features}
+0000ca50: 2c20 6e5f 6564 6765 5f66 6561 7475 7265  , n_edge_feature
+0000ca60: 733d 7b73 656c 662e 6e5f 6564 6765 5f66  s={self.n_edge_f
+0000ca70: 6561 7475 7265 737d 2c20 6e5f 676c 6f62  eatures}, n_glob
+0000ca80: 616c 5f66 6561 7475 7265 733d 7b73 656c  al_features={sel
+0000ca90: 662e 6e5f 676c 6f62 616c 5f66 6561 7475  f.n_global_featu
+0000caa0: 7265 737d 2c20 6973 5f75 6e64 6972 6563  res}, is_undirec
+0000cab0: 7465 643d 7b73 656c 662e 6973 5f75 6e64  ted={self.is_und
+0000cac0: 6972 6563 7465 647d 2c20 7265 7369 6475  irected}, residu
+0000cad0: 616c 5f63 6f6e 6e65 6374 696f 6e3d 7b73  al_connection={s
+0000cae0: 656c 662e 7265 7369 6475 616c 5f63 6f6e  elf.residual_con
+0000caf0: 6e65 6374 696f 6e7d 2927 0a20 2020 2020  nection})'.     
+0000cb00: 2020 2029 0a0a 0a63 6c61 7373 2041 6666     )...class Aff
+0000cb10: 696e 6528 6e6e 2e4d 6f64 756c 6529 3a0a  ine(nn.Module):.
+0000cb20: 2020 2020 2222 2243 6c61 7373 2077 6869      """Class whi
+0000cb30: 6368 2070 6572 666f 726d 7320 7468 6520  ch performs the 
+0000cb40: 4166 6669 6e65 2074 7261 6e73 666f 726d  Affine transform
+0000cb50: 6174 696f 6e2e 0a0a 2020 2020 5468 6973  ation...    This
+0000cb60: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
+0000cb70: 6973 2062 6173 6564 206f 6e20 7468 6520  is based on the 
+0000cb80: 6166 6669 6e69 7479 206f 6620 7468 6520  affinity of the 
+0000cb90: 6261 7365 2064 6973 7472 6962 7574 696f  base distributio
+0000cba0: 6e20 7769 7468 0a20 2020 2074 6865 2074  n with.    the t
+0000cbb0: 6172 6765 7420 6469 7374 7269 6275 7469  arget distributi
+0000cbc0: 6f6e 2e20 4120 6765 6f6d 6574 7269 6320  on. A geometric 
+0000cbd0: 7472 616e 7366 6f72 6d61 7469 6f6e 2069  transformation i
+0000cbe0: 7320 6170 706c 6965 6420 7768 6572 650a  s applied where.
+0000cbf0: 2020 2020 7468 6520 7061 7261 6d65 7465      the paramete
+0000cc00: 7273 2070 6572 666f 726d 7320 6368 616e  rs performs chan
+0000cc10: 6765 7320 6f6e 2074 6865 2073 6361 6c65  ges on the scale
+0000cc20: 2061 6e64 2073 6869 6674 206f 6620 6120   and shift of a 
+0000cc30: 6675 6e63 7469 6f6e 0a20 2020 2028 696e  function.    (in
+0000cc40: 7075 7473 292e 0a0a 2020 2020 4e6f 726d  puts)...    Norm
+0000cc50: 616c 697a 696e 6720 466c 6f77 2074 7261  alizing Flow tra
+0000cc60: 6e73 666f 726d 6174 696f 6e73 206d 7573  nsformations mus
+0000cc70: 7420 6265 2062 696a 6563 7469 7665 2069  t be bijective i
+0000cc80: 6e20 6f72 6465 7220 746f 2063 6f6d 7075  n order to compu
+0000cc90: 7465 0a20 2020 2074 6865 206c 6f67 6172  te.    the logar
+0000cca0: 6974 686d 206f 6620 6a61 636f 6269 616e  ithm of jacobian
+0000ccb0: 2773 2064 6574 6572 6d69 6e61 6e74 2e20  's determinant. 
+0000ccc0: 466f 7220 7468 6973 2072 6561 736f 6e2c  For this reason,
+0000ccd0: 2074 7261 6e73 666f 726d 6174 696f 6e73   transformations
+0000cce0: 0a20 2020 206d 7573 7420 7065 7266 6f72  .    must perfor
+0000ccf0: 6d20 6120 666f 7277 6172 6420 616e 6420  m a forward and 
+0000cd00: 696e 7665 7273 6520 7061 7373 2e0a 0a20  inverse pass... 
+0000cd10: 2020 2045 7861 6d70 6c65 0a20 2020 202d     Example.    -
+0000cd20: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+0000cd30: 696d 706f 7274 2064 6565 7063 6865 6d20  import deepchem 
+0000cd40: 6173 2064 630a 2020 2020 3e3e 3e20 6672  as dc.    >>> fr
+0000cd50: 6f6d 2064 6565 7063 6865 6d2e 6d6f 6465  om deepchem.mode
+0000cd60: 6c73 2e74 6f72 6368 5f6d 6f64 656c 732e  ls.torch_models.
+0000cd70: 6c61 7965 7273 2069 6d70 6f72 7420 4166  layers import Af
+0000cd80: 6669 6e65 0a20 2020 203e 3e3e 2069 6d70  fine.    >>> imp
+0000cd90: 6f72 7420 746f 7263 680a 2020 2020 3e3e  ort torch.    >>
+0000cda0: 3e20 6672 6f6d 2074 6f72 6368 2e64 6973  > from torch.dis
+0000cdb0: 7472 6962 7574 696f 6e73 2069 6d70 6f72  tributions impor
+0000cdc0: 7420 4d75 6c74 6976 6172 6961 7465 4e6f  t MultivariateNo
+0000cdd0: 726d 616c 0a20 2020 203e 3e3e 2023 2069  rmal.    >>> # i
+0000cde0: 6e69 7469 616c 697a 6520 7468 6520 7472  nitialize the tr
+0000cdf0: 616e 7366 6f72 6d61 7469 6f6e 206c 6179  ansformation lay
+0000ce00: 6572 2773 2070 6172 616d 6574 6572 730a  er's parameters.
+0000ce10: 2020 2020 3e3e 3e20 6469 6d20 3d20 320a      >>> dim = 2.
+0000ce20: 2020 2020 3e3e 3e20 7361 6d70 6c65 7320      >>> samples 
+0000ce30: 3d20 3936 0a20 2020 203e 3e3e 2074 7261  = 96.    >>> tra
+0000ce40: 6e73 666f 726d 7320 3d20 4166 6669 6e65  nsforms = Affine
+0000ce50: 2864 696d 290a 2020 2020 3e3e 3e20 2320  (dim).    >>> # 
+0000ce60: 666f 7277 6172 6420 7061 7373 2062 6173  forward pass bas
+0000ce70: 6564 206f 6e20 6120 6769 7665 6e20 6469  ed on a given di
+0000ce80: 7374 7269 6275 7469 6f6e 0a20 2020 203e  stribution.    >
+0000ce90: 3e3e 2064 6973 7472 6962 7574 696f 6e20  >> distribution 
+0000cea0: 3d20 4d75 6c74 6976 6172 6961 7465 4e6f  = MultivariateNo
+0000ceb0: 726d 616c 2874 6f72 6368 2e7a 6572 6f73  rmal(torch.zeros
+0000cec0: 2864 696d 292c 2074 6f72 6368 2e65 7965  (dim), torch.eye
+0000ced0: 2864 696d 2929 0a20 2020 203e 3e3e 2069  (dim)).    >>> i
+0000cee0: 6e70 7574 203d 2064 6973 7472 6962 7574  nput = distribut
+0000cef0: 696f 6e2e 7361 6d70 6c65 2874 6f72 6368  ion.sample(torch
+0000cf00: 2e53 697a 6528 2873 616d 706c 6573 2c20  .Size((samples, 
+0000cf10: 6469 6d29 2929 0a20 2020 203e 3e3e 206c  dim))).    >>> l
+0000cf20: 656e 2874 7261 6e73 666f 726d 732e 666f  en(transforms.fo
+0000cf30: 7277 6172 6428 696e 7075 7429 290a 2020  rward(input)).  
+0000cf40: 2020 320a 2020 2020 3e3e 3e20 2320 696e    2.    >>> # in
+0000cf50: 7665 7273 6520 7061 7373 2062 6173 6564  verse pass based
+0000cf60: 206f 6e20 6120 6469 7374 7269 6275 7469   on a distributi
+0000cf70: 6f6e 0a20 2020 203e 3e3e 206c 656e 2874  on.    >>> len(t
+0000cf80: 7261 6e73 666f 726d 732e 696e 7665 7273  ransforms.invers
+0000cf90: 6528 696e 7075 7429 290a 2020 2020 320a  e(input)).    2.
+0000cfa0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+0000cfb0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+0000cfc0: 2064 696d 3a20 696e 7429 202d 3e20 4e6f   dim: int) -> No
+0000cfd0: 6e65 3a0a 2020 2020 2020 2020 2222 2243  ne:.        """C
+0000cfe0: 7265 6174 6520 6120 4166 6669 6e65 2074  reate a Affine t
+0000cff0: 7261 6e73 666f 726d 206c 6179 6572 2e0a  ransform layer..
+0000d000: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0000d010: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+0000d020: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+0000d030: 696d 3a20 696e 740a 2020 2020 2020 2020  im: int.        
+0000d040: 2020 2020 5661 6c75 6520 6f66 2074 6865      Value of the
+0000d050: 204e 7468 2064 696d 656e 7369 6f6e 206f   Nth dimension o
+0000d060: 6620 7468 6520 6461 7461 7365 742e 0a0a  f the dataset...
+0000d070: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0000d080: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
+0000d090: 6e69 745f 5f28 290a 2020 2020 2020 2020  nit__().        
+0000d0a0: 7365 6c66 2e64 696d 203d 2064 696d 0a20  self.dim = dim. 
+0000d0b0: 2020 2020 2020 2073 656c 662e 7363 616c         self.scal
+0000d0c0: 6520 3d20 6e6e 2e50 6172 616d 6574 6572  e = nn.Parameter
+0000d0d0: 2874 6f72 6368 2e7a 6572 6f73 2873 656c  (torch.zeros(sel
+0000d0e0: 662e 6469 6d29 290a 2020 2020 2020 2020  f.dim)).        
+0000d0f0: 7365 6c66 2e73 6869 6674 203d 206e 6e2e  self.shift = nn.
+0000d100: 5061 7261 6d65 7465 7228 746f 7263 682e  Parameter(torch.
+0000d110: 7a65 726f 7328 7365 6c66 2e64 696d 2929  zeros(self.dim))
+0000d120: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
+0000d130: 6428 7365 6c66 2c20 783a 2053 6571 7565  d(self, x: Seque
+0000d140: 6e63 6529 202d 3e20 5475 706c 655b 746f  nce) -> Tuple[to
+0000d150: 7263 682e 5465 6e73 6f72 2c20 746f 7263  rch.Tensor, torc
+0000d160: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
+0000d170: 2020 2022 2222 5065 7266 6f72 6d73 2061     """Performs a
+0000d180: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
+0000d190: 6265 7477 6565 6e20 7477 6f20 6469 6666  between two diff
+0000d1a0: 6572 656e 7420 6469 7374 7269 6275 7469  erent distributi
+0000d1b0: 6f6e 732e 2054 6869 730a 2020 2020 2020  ons. This.      
+0000d1c0: 2020 7061 7274 6963 756c 6172 2074 7261    particular tra
+0000d1d0: 6e73 666f 726d 6174 696f 6e20 7265 7072  nsformation repr
+0000d1e0: 6573 656e 7473 2074 6865 2066 6f6c 6c6f  esents the follo
+0000d1f0: 7769 6e67 2066 756e 6374 696f 6e3a 0a20  wing function:. 
+0000d200: 2020 2020 2020 2079 203d 2078 202a 2065         y = x * e
+0000d210: 7870 2861 2920 2b20 622c 2077 6865 7265  xp(a) + b, where
+0000d220: 2061 2069 7320 7363 616c 6520 7061 7261   a is scale para
+0000d230: 6d65 7465 7220 616e 6420 6220 7065 7266  meter and b perf
+0000d240: 6f72 6d73 2061 2073 6869 6674 2e0a 2020  orms a shift..  
+0000d250: 2020 2020 2020 5468 6973 2063 6c61 7373        This class
+0000d260: 2061 6c73 6f20 7265 7475 726e 7320 7468   also returns th
+0000d270: 6520 6c6f 6761 7269 7468 6d20 6f66 2074  e logarithm of t
+0000d280: 6865 206a 6163 6f62 6961 6e73 2064 6574  he jacobians det
+0000d290: 6572 6d69 6e61 6e74 0a20 2020 2020 2020  erminant.       
+0000d2a0: 2077 6869 6368 2069 7320 7573 6566 756c   which is useful
+0000d2b0: 2077 6865 6e20 696e 7665 7274 2061 2074   when invert a t
+0000d2c0: 7261 6e73 666f 726d 6174 696f 6e20 616e  ransformation an
+0000d2d0: 6420 636f 6d70 7574 6520 7468 650a 2020  d compute the.  
+0000d2e0: 2020 2020 2020 7072 6f62 6162 696c 6974        probabilit
+0000d2f0: 7920 6f66 2074 6865 2074 7261 6e73 666f  y of the transfo
+0000d300: 726d 6174 696f 6e2e 0a0a 2020 2020 2020  rmation...      
+0000d310: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0000d320: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0000d330: 2020 2020 2020 2020 7820 3a20 5365 7175          x : Sequ
+0000d340: 656e 6365 0a20 2020 2020 2020 2020 2020  ence.           
+0000d350: 2054 656e 736f 7220 7361 6d70 6c65 2077   Tensor sample w
+0000d360: 6974 6820 7468 6520 696e 6974 6961 6c20  ith the initial 
+0000d370: 6469 7374 7269 6275 7469 6f6e 2064 6174  distribution dat
+0000d380: 6120 7768 6963 6820 7769 6c6c 2070 6173  a which will pas
+0000d390: 7320 696e 746f 0a20 2020 2020 2020 2020  s into.         
+0000d3a0: 2020 2074 6865 206e 6f72 6d61 6c69 7a69     the normalizi
+0000d3b0: 6e67 2066 6c6f 7720 616c 676f 7269 7468  ng flow algorith
+0000d3c0: 6d2e 0a0a 2020 2020 2020 2020 5265 7475  m...        Retu
+0000d3d0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+0000d3e0: 2d2d 2d0a 2020 2020 2020 2020 7920 3a20  ---.        y : 
+0000d3f0: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+0000d400: 2020 2020 2020 2020 2054 7261 6e73 666f           Transfo
+0000d410: 726d 6564 2074 656e 736f 7220 6163 636f  rmed tensor acco
+0000d420: 7264 696e 6720 746f 2041 6666 696e 6520  rding to Affine 
+0000d430: 6c61 7965 7220 7769 7468 2074 6865 2073  layer with the s
+0000d440: 6861 7065 206f 6620 2778 272e 0a20 2020  hape of 'x'..   
+0000d450: 2020 2020 206c 6f67 5f64 6574 5f6a 6163       log_det_jac
+0000d460: 6f62 6961 6e20 3a20 746f 7263 682e 5465  obian : torch.Te
+0000d470: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+0000d480: 2054 656e 736f 7220 7768 6963 6820 7265   Tensor which re
+0000d490: 7072 6573 656e 7473 2074 6865 2069 6e66  presents the inf
+0000d4a0: 6f20 6162 6f75 7420 7468 6520 6465 7669  o about the devi
+0000d4b0: 6174 696f 6e20 6f66 2074 6865 2069 6e69  ation of the ini
+0000d4c0: 7469 616c 0a20 2020 2020 2020 2020 2020  tial.           
+0000d4d0: 2061 6e64 2074 6172 6765 7420 6469 7374   and target dist
+0000d4e0: 7269 6275 7469 6f6e 2e0a 0a20 2020 2020  ribution...     
+0000d4f0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0000d500: 7920 3d20 746f 7263 682e 6578 7028 7365  y = torch.exp(se
+0000d510: 6c66 2e73 6361 6c65 2920 2a20 7820 2b20  lf.scale) * x + 
+0000d520: 7365 6c66 2e73 6869 6674 0a20 2020 2020  self.shift.     
+0000d530: 2020 2064 6574 5f6a 6163 6f62 6961 6e20     det_jacobian 
+0000d540: 3d20 746f 7263 682e 6578 7028 7365 6c66  = torch.exp(self
+0000d550: 2e73 6361 6c65 2e73 756d 2829 290a 2020  .scale.sum()).  
+0000d560: 2020 2020 2020 6c6f 675f 6465 745f 6a61        log_det_ja
+0000d570: 636f 6269 616e 203d 2074 6f72 6368 2e6f  cobian = torch.o
+0000d580: 6e65 7328 792e 7368 6170 655b 305d 2920  nes(y.shape[0]) 
+0000d590: 2a20 746f 7263 682e 6c6f 6728 6465 745f  * torch.log(det_
+0000d5a0: 6a61 636f 6269 616e 290a 0a20 2020 2020  jacobian)..     
+0000d5b0: 2020 2072 6574 7572 6e20 792c 206c 6f67     return y, log
+0000d5c0: 5f64 6574 5f6a 6163 6f62 6961 6e0a 0a20  _det_jacobian.. 
+0000d5d0: 2020 2064 6566 2069 6e76 6572 7365 2873     def inverse(s
+0000d5e0: 656c 662c 2079 3a20 5365 7175 656e 6365  elf, y: Sequence
+0000d5f0: 2920 2d3e 2054 7570 6c65 5b74 6f72 6368  ) -> Tuple[torch
+0000d600: 2e54 656e 736f 722c 2074 6f72 6368 2e54  .Tensor, torch.T
+0000d610: 656e 736f 725d 3a0a 2020 2020 2020 2020  ensor]:.        
+0000d620: 2222 2250 6572 666f 726d 7320 6120 7472  """Performs a tr
+0000d630: 616e 7366 6f72 6d61 7469 6f6e 2062 6574  ansformation bet
+0000d640: 7765 656e 2074 776f 2064 6966 6665 7265  ween two differe
+0000d650: 6e74 2064 6973 7472 6962 7574 696f 6e73  nt distributions
+0000d660: 2e0a 2020 2020 2020 2020 5468 6973 2074  ..        This t
+0000d670: 7261 6e73 666f 726d 6174 696f 6e20 7265  ransformation re
+0000d680: 7072 6573 656e 7473 2074 6865 2062 6163  presents the bac
+0000d690: 7761 7264 2070 6173 7320 6f66 2074 6865  ward pass of the
+0000d6a0: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+0000d6b0: 2020 6d65 6e74 696f 6e20 6265 666f 7265    mention before
+0000d6c0: 2e20 4974 7320 6d61 7468 656d 6174 6963  . Its mathematic
+0000d6d0: 616c 2072 6570 7265 7365 6e74 6174 696f  al representatio
+0000d6e0: 6e20 6973 2078 203d 2028 7920 2d20 6229  n is x = (y - b)
+0000d6f0: 202f 2065 7870 2861 290a 2020 2020 2020   / exp(a).      
+0000d700: 2020 2c20 7768 6572 6520 2261 2220 6973    , where "a" is
+0000d710: 2073 6361 6c65 2070 6172 616d 6574 6572   scale parameter
+0000d720: 2061 6e64 2022 6222 2070 6572 666f 726d   and "b" perform
+0000d730: 7320 6120 7368 6966 742e 2054 6869 7320  s a shift. This 
+0000d740: 636c 6173 730a 2020 2020 2020 2020 616c  class.        al
+0000d750: 736f 2072 6574 7572 6e73 2074 6865 206c  so returns the l
+0000d760: 6f67 6172 6974 686d 206f 6620 7468 6520  ogarithm of the 
+0000d770: 6a61 636f 6269 616e 7320 6465 7465 726d  jacobians determ
+0000d780: 696e 616e 7420 7768 6963 6820 6973 0a20  inant which is. 
+0000d790: 2020 2020 2020 2075 7365 6675 6c20 7768         useful wh
+0000d7a0: 656e 2069 6e76 6572 7420 6120 7472 616e  en invert a tran
+0000d7b0: 7366 6f72 6d61 7469 6f6e 2061 6e64 2063  sformation and c
+0000d7c0: 6f6d 7075 7465 2074 6865 2070 726f 6261  ompute the proba
+0000d7d0: 6269 6c69 7479 206f 660a 2020 2020 2020  bility of.      
+0000d7e0: 2020 7468 6520 7472 616e 7366 6f72 6d61    the transforma
+0000d7f0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2050  tion...        P
+0000d800: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0000d810: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0000d820: 2020 2020 2079 203a 2053 6571 7565 6e63       y : Sequenc
+0000d830: 650a 2020 2020 2020 2020 2020 2020 5465  e.            Te
+0000d840: 6e73 6f72 2073 616d 706c 6520 7769 7468  nsor sample with
+0000d850: 2074 7261 6e73 666f 726d 6564 2064 6973   transformed dis
+0000d860: 7472 6962 7574 696f 6e20 6461 7461 2077  tribution data w
+0000d870: 6869 6368 2077 696c 6c20 6265 2075 7365  hich will be use
+0000d880: 6420 696e 0a20 2020 2020 2020 2020 2020  d in.           
+0000d890: 2074 6865 206e 6f72 6d61 6c69 7a69 6e67   the normalizing
+0000d8a0: 2061 6c67 6f72 6974 686d 2069 6e76 6572   algorithm inver
+0000d8b0: 7365 2070 6173 732e 0a0a 2020 2020 2020  se pass...      
+0000d8c0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0000d8d0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+0000d8e0: 2020 7820 3a20 746f 7263 682e 5465 6e73    x : torch.Tens
+0000d8f0: 6f72 0a20 2020 2020 2020 2020 2020 2054  or.            T
+0000d900: 7261 6e73 666f 726d 6564 2074 656e 736f  ransformed tenso
+0000d910: 7220 6163 636f 7264 696e 6720 746f 2041  r according to A
+0000d920: 6666 696e 6520 6c61 7965 7220 7769 7468  ffine layer with
+0000d930: 2074 6865 2073 6861 7065 206f 6620 2779   the shape of 'y
+0000d940: 272e 0a20 2020 2020 2020 2069 6e76 6572  '..        inver
+0000d950: 7365 5f6c 6f67 5f64 6574 5f6a 6163 6f62  se_log_det_jacob
+0000d960: 6961 6e20 3a20 746f 7263 682e 5465 6e73  ian : torch.Tens
+0000d970: 6f72 0a20 2020 2020 2020 2020 2020 2054  or.            T
+0000d980: 656e 736f 7220 7768 6963 6820 7265 7072  ensor which repr
+0000d990: 6573 656e 7473 2074 6865 2069 6e66 6f72  esents the infor
+0000d9a0: 6d61 7469 6f6e 206f 6620 7468 6520 6465  mation of the de
+0000d9b0: 7669 6174 696f 6e20 6f66 2074 6865 2069  viation of the i
+0000d9c0: 6e69 7469 616c 0a20 2020 2020 2020 2020  nitial.         
+0000d9d0: 2020 2061 6e64 2074 6172 6765 7420 6469     and target di
+0000d9e0: 7374 7269 6275 7469 6f6e 2e0a 0a20 2020  stribution...   
+0000d9f0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0000da00: 2020 7820 3d20 2879 202d 2073 656c 662e    x = (y - self.
+0000da10: 7368 6966 7429 202f 2074 6f72 6368 2e65  shift) / torch.e
+0000da20: 7870 2873 656c 662e 7363 616c 6529 0a20  xp(self.scale). 
+0000da30: 2020 2020 2020 2064 6574 5f6a 6163 6f62         det_jacob
+0000da40: 6961 6e20 3d20 3120 2f20 746f 7263 682e  ian = 1 / torch.
+0000da50: 6578 7028 7365 6c66 2e73 6361 6c65 2e73  exp(self.scale.s
+0000da60: 756d 2829 290a 2020 2020 2020 2020 696e  um()).        in
+0000da70: 7665 7273 655f 6c6f 675f 6465 745f 6a61  verse_log_det_ja
+0000da80: 636f 6269 616e 203d 2074 6f72 6368 2e6f  cobian = torch.o
+0000da90: 6e65 7328 0a20 2020 2020 2020 2020 2020  nes(.           
+0000daa0: 2078 2e73 6861 7065 5b30 5d29 202a 2074   x.shape[0]) * t
+0000dab0: 6f72 6368 2e6c 6f67 2864 6574 5f6a 6163  orch.log(det_jac
+0000dac0: 6f62 6961 6e29 0a0a 2020 2020 2020 2020  obian)..        
+0000dad0: 7265 7475 726e 2078 2c20 696e 7665 7273  return x, invers
+0000dae0: 655f 6c6f 675f 6465 745f 6a61 636f 6269  e_log_det_jacobi
+0000daf0: 616e 0a0a 0a63 6c61 7373 2044 4d50 4e4e  an...class DMPNN
+0000db00: 456e 636f 6465 724c 6179 6572 286e 6e2e  EncoderLayer(nn.
+0000db10: 4d6f 6475 6c65 293a 0a20 2020 2022 2222  Module):.    """
+0000db20: 0a20 2020 2045 6e63 6f64 6572 206c 6179  .    Encoder lay
+0000db30: 6572 2066 6f72 2075 7365 2069 6e20 7468  er for use in th
+0000db40: 6520 4469 7265 6374 6564 204d 6573 7361  e Directed Messa
+0000db50: 6765 2050 6173 7369 6e67 204e 6575 7261  ge Passing Neura
+0000db60: 6c20 4e65 7477 6f72 6b20 2844 2d4d 504e  l Network (D-MPN
+0000db70: 4e29 205b 315d 5f2e 0a0a 2020 2020 5468  N) [1]_...    Th
+0000db80: 6520 726f 6c65 206f 6620 7468 6520 444d  e role of the DM
+0000db90: 504e 4e45 6e63 6f64 6572 4c61 7965 7220  PNNEncoderLayer 
+0000dba0: 636c 6173 7320 6973 2074 6f20 6765 6e65  class is to gene
+0000dbb0: 7261 7465 206d 6f6c 6563 756c 6520 656e  rate molecule en
+0000dbc0: 636f 6469 6e67 7320 696e 2066 6f6c 6c6f  codings in follo
+0000dbd0: 7769 6e67 2073 7465 7073 3a0a 0a20 2020  wing steps:..   
+0000dbe0: 202d 204d 6573 7361 6765 2070 6173 7369   - Message passi
+0000dbf0: 6e67 2070 6861 7365 0a20 2020 202d 2047  ng phase.    - G
+0000dc00: 6574 206e 6577 2061 746f 6d20 6869 6464  et new atom hidd
+0000dc10: 656e 2073 7461 7465 7320 616e 6420 7265  en states and re
+0000dc20: 6164 6f75 7420 7068 6173 650a 2020 2020  adout phase.    
+0000dc30: 2d20 436f 6e63 6174 656e 6174 6520 7468  - Concatenate th
+0000dc40: 6520 676c 6f62 616c 2066 6561 7475 7265  e global feature
+0000dc50: 730a 0a0a 2020 2020 4c65 7420 7468 6520  s...    Let the 
+0000dc60: 6469 6167 7261 6d20 6769 7665 6e20 6265  diagram given be
+0000dc70: 6c6f 7720 7265 7072 6573 656e 7420 6120  low represent a 
+0000dc80: 6d6f 6c65 6375 6c65 2063 6f6e 7461 696e  molecule contain
+0000dc90: 696e 6720 3520 6174 6f6d 7320 286e 6f64  ing 5 atoms (nod
+0000dca0: 6573 2920 616e 6420 3420 626f 6e64 7320  es) and 4 bonds 
+0000dcb0: 2865 6467 6573 293a 2d0a 0a20 2020 207c  (edges):-..    |
+0000dcc0: 2020 2031 202d 2d2d 2035 0a20 2020 207c     1 --- 5.    |
+0000dcd0: 2020 207c 0a20 2020 207c 2020 2032 202d     |.    |   2 -
+0000dce0: 2d2d 2034 0a20 2020 207c 2020 207c 0a20  -- 4.    |   |. 
+0000dcf0: 2020 207c 2020 2033 0a0a 2020 2020 4c65     |   3..    Le
+0000dd00: 7420 7468 6520 626f 6e64 7320 6672 6f6d  t the bonds from
+0000dd10: 2061 746f 6d73 2031 2d3e 3220 282a 2a42   atoms 1->2 (**B
+0000dd20: 5b31 325d 2a2a 2920 616e 6420 322d 3e31  [12]**) and 2->1
+0000dd30: 2028 2a2a 425b 3231 5d2a 2a29 2062 6520   (**B[21]**) be 
+0000dd40: 636f 6e73 6964 6572 6564 2061 7320 3220  considered as 2 
+0000dd50: 6469 6666 6572 656e 7420 626f 6e64 732e  different bonds.
+0000dd60: 0a20 2020 2048 656e 6365 2c20 6279 2063  .    Hence, by c
+0000dd70: 6f6e 7369 6465 7269 6e67 2074 6865 2073  onsidering the s
+0000dd80: 616d 6520 666f 7220 616c 6c20 6174 6f6d  ame for all atom
+0000dd90: 732c 2074 6865 2074 6f74 616c 206e 756d  s, the total num
+0000dda0: 6265 7220 6f66 2062 6f6e 6473 203d 2038  ber of bonds = 8
+0000ddb0: 2e0a 0a20 2020 204c 6574 3a0a 0a20 2020  ...    Let:..   
+0000ddc0: 202d 202a 2a61 746f 6d20 6665 6174 7572   - **atom featur
+0000ddd0: 6573 2a2a 203a 2060 6061 312c 2061 322c  es** : ``a1, a2,
+0000dde0: 2061 332c 2061 342c 2061 3560 600a 2020   a3, a4, a5``.  
+0000ddf0: 2020 2d20 2a2a 6869 6464 656e 2073 7461    - **hidden sta
+0000de00: 7465 7320 6f66 2061 746f 6d73 2a2a 203a  tes of atoms** :
+0000de10: 2060 6068 312c 2068 322c 2068 332c 2068   ``h1, h2, h3, h
+0000de20: 342c 2068 3560 600a 2020 2020 2d20 2a2a  4, h5``.    - **
+0000de30: 626f 6e64 2066 6561 7475 7265 7320 626f  bond features bo
+0000de40: 6e64 732a 2a20 3a20 6060 6231 322c 2062  nds** : ``b12, b
+0000de50: 3231 2c20 6232 332c 2062 3332 2c20 6232  21, b23, b32, b2
+0000de60: 342c 2062 3432 2c20 6231 352c 2062 3531  4, b42, b15, b51
+0000de70: 6060 0a20 2020 202d 202a 2a69 6e69 7469  ``.    - **initi
+0000de80: 616c 2068 6964 6465 6e20 7374 6174 6573  al hidden states
+0000de90: 206f 6620 626f 6e64 732a 2a20 3a20 6060   of bonds** : ``
+0000dea0: 2830 2968 3132 2c20 2830 2968 3231 2c20  (0)h12, (0)h21, 
+0000deb0: 2830 2968 3233 2c20 2830 2968 3332 2c20  (0)h23, (0)h32, 
+0000dec0: 2830 2968 3234 2c20 2830 2968 3432 2c20  (0)h24, (0)h42, 
+0000ded0: 2830 2968 3135 2c20 2830 2968 3531 6060  (0)h15, (0)h51``
+0000dee0: 0a0a 2020 2020 5468 6520 6869 6464 656e  ..    The hidden
+0000def0: 2073 7461 7465 206f 6620 6576 6572 7920   state of every 
+0000df00: 626f 6e64 2069 7320 6120 6675 6e63 7469  bond is a functi
+0000df10: 6f6e 206f 6620 7468 6520 636f 6e63 6174  on of the concat
+0000df20: 656e 6174 6564 2066 6561 7475 7265 2076  enated feature v
+0000df30: 6563 746f 7220 7768 6963 6820 636f 6e74  ector which cont
+0000df40: 6169 6e73 0a20 2020 2063 6f6e 6361 7465  ains.    concate
+0000df50: 6e61 7469 6f6e 206f 6620 7468 6520 2a2a  nation of the **
+0000df60: 6665 6174 7572 6573 206f 6620 696e 6974  features of init
+0000df70: 6961 6c20 6174 6f6d 206f 6620 7468 6520  ial atom of the 
+0000df80: 626f 6e64 2a2a 2061 6e64 202a 2a62 6f6e  bond** and **bon
+0000df90: 6420 6665 6174 7572 6573 2a2a 2e0a 0a20  d features**... 
+0000dfa0: 2020 2045 7861 6d70 6c65 3a20 6060 2830     Example: ``(0
+0000dfb0: 2968 3231 203d 2066 756e 6331 2863 6f6e  )h21 = func1(con
+0000dfc0: 6361 7428 6132 2c20 6232 3129 2960 600a  cat(a2, b21))``.
+0000dfd0: 0a20 2020 202e 2e20 6e6f 7465 3a3a 0a20  .    .. note::. 
+0000dfe0: 2020 2020 4865 7265 2066 756e 6331 2069      Here func1 i
+0000dff0: 7320 6060 7365 6c66 2e57 5f69 6060 0a0a  s ``self.W_i``..
+0000e000: 2020 2020 2a2a 5468 6520 4d65 7373 6167      **The Messag
+0000e010: 6520 7061 7373 696e 6720 7068 6173 652a  e passing phase*
+0000e020: 2a0a 0a20 2020 2054 6865 2067 6f61 6c20  *..    The goal 
+0000e030: 6f66 2074 6865 206d 6573 7361 6765 2d70  of the message-p
+0000e040: 6173 7369 6e67 2070 6861 7365 2069 7320  assing phase is 
+0000e050: 746f 2067 656e 6572 6174 6520 2a2a 6869  to generate **hi
+0000e060: 6464 656e 2073 7461 7465 7320 6f66 2061  dden states of a
+0000e070: 6c6c 2074 6865 2061 746f 6d73 2069 6e20  ll the atoms in 
+0000e080: 7468 6520 6d6f 6c65 6375 6c65 2a2a 2e0a  the molecule**..
+0000e090: 0a20 2020 2054 6865 2068 6964 6465 6e20  .    The hidden 
+0000e0a0: 7374 6174 6520 6f66 2061 6e20 6174 6f6d  state of an atom
+0000e0b0: 2069 7320 2a2a 6120 6675 6e63 7469 6f6e   is **a function
+0000e0c0: 206f 6620 636f 6e63 6174 656e 6174 696f   of concatenatio
+0000e0d0: 6e20 6f66 2061 746f 6d20 6665 6174 7572  n of atom featur
+0000e0e0: 6573 2061 6e64 206d 6573 7361 6765 7320  es and messages 
+0000e0f0: 2861 7420 5420 6465 7074 6829 2a2a 2e0a  (at T depth)**..
+0000e100: 0a20 2020 2041 206d 6573 7361 6765 2069  .    A message i
+0000e110: 7320 6120 7375 6d20 6f66 202a 2a68 6964  s a sum of **hid
+0000e120: 6465 6e20 7374 6174 6573 206f 6620 626f  den states of bo
+0000e130: 6e64 7320 636f 6d69 6e67 2074 6f20 7468  nds coming to th
+0000e140: 6520 6174 6f6d 2028 6174 2054 2064 6570  e atom (at T dep
+0000e150: 7468 292a 2a2e 0a0a 2020 2020 2e2e 206e  th)**...    .. n
+0000e160: 6f74 653a 3a0a 2020 2020 2044 6570 7468  ote::.     Depth
+0000e170: 2072 6566 6572 7320 746f 2074 6865 206e   refers to the n
+0000e180: 756d 6265 7220 6f66 2069 7465 7261 7469  umber of iterati
+0000e190: 6f6e 7320 696e 2074 6865 206d 6573 7361  ons in the messa
+0000e1a0: 6765 2070 6173 7369 6e67 2070 6861 7365  ge passing phase
+0000e1b0: 2028 6865 7265 2c20 5420 6974 6572 6174   (here, T iterat
+0000e1c0: 696f 6e73 292e 2041 6674 6572 2065 6163  ions). After eac
+0000e1d0: 6820 6974 6572 6174 696f 6e2c 2074 6865  h iteration, the
+0000e1e0: 2068 6964 6465 6e20 7374 6174 6573 206f   hidden states o
+0000e1f0: 6620 7468 6520 626f 6e64 7320 6172 6520  f the bonds are 
+0000e200: 7570 6461 7465 642e 0a0a 0a20 2020 2045  updated....    E
+0000e210: 7861 6d70 6c65 3a0a 2020 2020 6060 6831  xample:.    ``h1
+0000e220: 203d 2066 756e 6333 2863 6f6e 6361 7428   = func3(concat(
+0000e230: 6131 2c20 6d31 2929 6060 0a0a 2020 2020  a1, m1))``..    
+0000e240: 2e2e 206e 6f74 653a 3a0a 2020 2020 2048  .. note::.     H
+0000e250: 6572 6520 6675 6e63 3320 6973 2060 6073  ere func3 is ``s
+0000e260: 656c 662e 575f 6f60 602e 0a0a 2020 2020  elf.W_o``...    
+0000e270: 2060 6d31 6020 7265 6665 7273 2074 6f20   `m1` refers to 
+0000e280: 7468 6520 6d65 7373 6167 6520 636f 6d69  the message comi
+0000e290: 6e67 2074 6f20 7468 6520 6174 6f6d 2e0a  ng to the atom..
+0000e2a0: 0a20 2020 2060 606d 3120 3d20 2854 2d31  .    ``m1 = (T-1
+0000e2b0: 2968 3231 202b 2028 542d 3129 6835 3160  )h21 + (T-1)h51`
+0000e2c0: 600a 2020 2020 2868 6964 6465 6e20 7374  `.    (hidden st
+0000e2d0: 6174 6520 6f66 2062 6f6e 6420 322d 3e31  ate of bond 2->1
+0000e2e0: 202b 2068 6964 6465 6e20 7374 6174 6520   + hidden state 
+0000e2f0: 6f66 2062 6f6e 6420 352d 3e31 2920 2861  of bond 5->1) (a
+0000e300: 7420 5420 6465 7074 6829 0a0a 2020 2020  t T depth)..    
+0000e310: 666f 722c 2064 6570 7468 2054 203d 2032  for, depth T = 2
+0000e320: 3a0a 0a20 2020 202d 2074 6865 2068 6964  :..    - the hid
+0000e330: 6465 6e20 7374 6174 6573 206f 6620 7468  den states of th
+0000e340: 6520 626f 6e64 7320 4020 3173 7420 6974  e bonds @ 1st it
+0000e350: 6572 6174 696f 6e20 7769 6c6c 2062 6520  eration will be 
+0000e360: 3d3e 2028 3029 6832 312c 2028 3029 6835  => (0)h21, (0)h5
+0000e370: 310a 2020 2020 2d20 7468 6520 6869 6464  1.    - the hidd
+0000e380: 656e 2073 7461 7465 7320 6f66 2074 6865  en states of the
+0000e390: 2062 6f6e 6473 2040 2032 6e64 2069 7465   bonds @ 2nd ite
+0000e3a0: 7261 7469 6f6e 2077 696c 6c20 6265 203d  ration will be =
+0000e3b0: 3e20 2831 2968 3231 2c20 2831 2968 3531  > (1)h21, (1)h51
+0000e3c0: 0a0a 2020 2020 5468 6520 6869 6464 656e  ..    The hidden
+0000e3d0: 2073 7461 7465 7320 6f66 2074 6865 2062   states of the b
+0000e3e0: 6f6e 6473 2069 6e20 3173 7420 6974 6572  onds in 1st iter
+0000e3f0: 6174 696f 6e20 6172 6520 616c 7265 6164  ation are alread
+0000e400: 7920 6b6e 6f77 2e0a 2020 2020 466f 7220  y know..    For 
+0000e410: 6869 6464 656e 2073 7461 7465 7320 6f66  hidden states of
+0000e420: 2074 6865 2062 6f6e 6473 2069 6e20 326e   the bonds in 2n
+0000e430: 6420 6974 6572 6174 696f 6e2c 2077 6520  d iteration, we 
+0000e440: 666f 6c6c 6f77 2074 6865 2063 7269 7465  follow the crite
+0000e450: 7269 6f6e 2074 6861 743a 0a0a 2020 2020  rion that:..    
+0000e460: 2d20 6869 6464 656e 2073 7461 7465 206f  - hidden state o
+0000e470: 6620 7468 6520 626f 6e64 2069 7320 6120  f the bond is a 
+0000e480: 6675 6e63 7469 6f6e 206f 6620 2a2a 696e  function of **in
+0000e490: 6974 6961 6c20 6869 6464 656e 2073 7461  itial hidden sta
+0000e4a0: 7465 206f 6620 626f 6e64 2a2a 0a20 2020  te of bond**.   
+0000e4b0: 2061 6e64 202a 2a6d 6573 7361 6765 7320   and **messages 
+0000e4c0: 636f 6d69 6e67 2074 6f20 7468 6174 2062  coming to that b
+0000e4d0: 6f6e 6420 696e 2074 6861 7420 6974 6572  ond in that iter
+0000e4e0: 6174 696f 6e2a 2a0a 0a20 2020 2045 7861  ation**..    Exa
+0000e4f0: 6d70 6c65 3a0a 2020 2020 6060 2831 2968  mple:.    ``(1)h
+0000e500: 3231 203d 2066 756e 6332 2820 2830 2968  21 = func2( (0)h
+0000e510: 3231 202c 2028 3129 6d32 3120 2960 600a  21 , (1)m21 )``.
+0000e520: 0a20 2020 202e 2e20 6e6f 7465 3a3a 0a20  .    .. note::. 
+0000e530: 2020 2020 4865 7265 2066 756e 6332 2069      Here func2 i
+0000e540: 7320 6060 7365 6c66 2e57 5f68 6060 2e0a  s ``self.W_h``..
+0000e550: 0a20 2020 2020 6028 3129 6d32 3160 2072  .     `(1)m21` r
+0000e560: 6566 6572 7320 746f 2074 6865 206d 6573  efers to the mes
+0000e570: 7361 6765 7320 636f 6d69 6e67 2074 6f20  sages coming to 
+0000e580: 7468 6174 2062 6f6e 6420 322d 3e31 2069  that bond 2->1 i
+0000e590: 6e20 7468 6174 2032 6e64 2069 7465 7261  n that 2nd itera
+0000e5a0: 7469 6f6e 2e0a 0a20 2020 204d 6573 7361  tion...    Messa
+0000e5b0: 6765 7320 636f 6d69 6e67 2074 6f20 6120  ges coming to a 
+0000e5c0: 626f 6e64 2069 6e20 616e 2069 7465 7261  bond in an itera
+0000e5d0: 7469 6f6e 2069 7320 2a2a 6120 7375 6d20  tion is **a sum 
+0000e5e0: 6f66 2068 6964 6465 6e20 7374 6174 6573  of hidden states
+0000e5f0: 206f 6620 626f 6e64 7320 2866 726f 6d20   of bonds (from 
+0000e600: 7072 6576 696f 7573 2069 7465 7261 7469  previous iterati
+0000e610: 6f6e 2920 636f 6d69 6e67 2074 6f20 7468  on) coming to th
+0000e620: 6973 2062 6f6e 642a 2a2e 0a0a 2020 2020  is bond**...    
+0000e630: 4578 616d 706c 653a 0a20 2020 2060 6028  Example:.    ``(
+0000e640: 3129 6d32 3120 3d20 2830 2968 3332 202b  1)m21 = (0)h32 +
+0000e650: 2028 3029 6834 3260 600a 0a20 2020 207c   (0)h42``..    |
+0000e660: 2020 2032 203c 2d2d 2d20 330a 2020 2020     2 <--- 3.    
+0000e670: 7c20 2020 5e0a 2020 2020 7c20 2020 7c0a  |   ^.    |   |.
+0000e680: 2020 2020 7c20 2020 340a 0a20 2020 202a      |   4..    *
+0000e690: 2a43 6f6d 7075 7469 6e67 2074 6865 206d  *Computing the m
+0000e6a0: 6573 7361 6765 732a 2a0a 0a20 2020 202e  essages**..    .
+0000e6b0: 2e20 636f 6465 2d62 6c6f 636b 3a3a 2070  . code-block:: p
+0000e6c0: 7974 686f 6e0a 0a20 2020 2020 2020 2020  ython..         
+0000e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6e0: 2020 2020 4230 2020 2020 2020 4231 2020      B0      B1  
+0000e6f0: 2020 2020 4232 2020 2020 2020 4233 2020      B2      B3  
+0000e700: 2020 2020 4234 2020 2020 2020 4235 2020      B4      B5  
+0000e710: 2020 2020 4236 2020 2020 2020 4237 2020      B6      B7  
+0000e720: 2020 2020 4238 0a20 2020 2020 2020 2066      B8.        f
+0000e730: 5f69 6e69 5f61 746f 6d73 5f62 6f6e 6473  _ini_atoms_bonds
+0000e740: 203d 205b 2830 2968 3132 2c20 2830 2968   = [(0)h12, (0)h
+0000e750: 3231 2c20 2830 2968 3233 2c20 2830 2968  21, (0)h23, (0)h
+0000e760: 3332 2c20 2830 2968 3234 2c20 2830 2968  32, (0)h24, (0)h
+0000e770: 3432 2c20 2830 2968 3135 2c20 2830 2968  42, (0)h15, (0)h
+0000e780: 3531 2c20 6828 2d31 295d 0a0a 0a20 2020  51, h(-1)]...   
+0000e790: 202e 2e20 6e6f 7465 3a3a 0a20 2020 2020   .. note::.     
+0000e7a0: 6828 2d31 2920 6973 2061 6e20 656d 7074  h(-1) is an empt
+0000e7b0: 7920 6172 7261 7920 6f66 2074 6865 2073  y array of the s
+0000e7c0: 616d 6520 7369 7a65 2061 7320 6f74 6865  ame size as othe
+0000e7d0: 7220 6869 6464 656e 2073 7461 7465 7320  r hidden states 
+0000e7e0: 6f66 2062 6f6e 6420 7374 6174 6573 2e0a  of bond states..
+0000e7f0: 0a20 2020 202e 2e20 636f 6465 2d62 6c6f  .    .. code-blo
+0000e800: 636b 3a3a 2070 7974 686f 6e0a 0a20 2020  ck:: python..   
+0000e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e820: 2042 3020 2020 2020 2042 3120 2020 2020   B0      B1     
+0000e830: 2042 3220 2020 2020 2042 3320 2020 2020   B2      B3     
+0000e840: 2042 3420 2020 2020 2042 3520 2020 2020   B4      B5     
+0000e850: 2042 3620 2020 2020 2042 3720 2020 2020   B6      B7     
+0000e860: 2020 4238 0a20 2020 2020 2020 206d 6170    B8.        map
+0000e870: 7069 6e67 203d 205b 205b 2d31 2c42 375d  ping = [ [-1,B7]
+0000e880: 205b 4233 2c42 355d 205b 4230 2c42 355d   [B3,B5] [B0,B5]
+0000e890: 205b 2d31 2c2d 315d 205b 4230 2c42 335d   [-1,-1] [B0,B3]
+0000e8a0: 205b 2d31 2c2d 315d 205b 4231 2c2d 315d   [-1,-1] [B1,-1]
+0000e8b0: 205b 2d31 2c2d 315d 2020 5b2d 312c 2d31   [-1,-1]  [-1,-1
+0000e8c0: 5d20 5d0a 0a20 2020 204c 6174 6572 2c20  ] ]..    Later, 
+0000e8d0: 7468 6520 656e 636f 6465 7220 7769 6c6c  the encoder will
+0000e8e0: 206d 6170 2074 6865 2063 6f6e 6361 7465   map the concate
+0000e8f0: 6e61 7465 6420 6665 6174 7572 6573 2066  nated features f
+0000e900: 726f 6d20 7468 6520 6060 665f 696e 695f  rom the ``f_ini_
+0000e910: 6174 6f6d 735f 626f 6e64 7360 600a 2020  atoms_bonds``.  
+0000e920: 2020 746f 2060 606d 6170 7069 6e67 6060    to ``mapping``
+0000e930: 2069 6e20 6561 6368 2069 7465 7261 7469   in each iterati
+0000e940: 6f6e 2075 7074 6f20 5474 6820 6974 6572  on upto Tth iter
+0000e950: 6174 696f 6e2e 0a0a 2020 2020 4e65 7874  ation...    Next
+0000e960: 2074 6865 2065 6e63 6f64 6572 2077 696c   the encoder wil
+0000e970: 6c20 7375 6d2d 7570 2074 6865 2063 6f6e  l sum-up the con
+0000e980: 6361 7420 6665 6174 7572 6573 2077 6974  cat features wit
+0000e990: 6869 6e20 7361 6d65 2062 6f6e 6420 696e  hin same bond in
+0000e9a0: 6465 782e 0a0a 2020 2020 2e2e 2063 6f64  dex...    .. cod
+0000e9b0: 652d 626c 6f63 6b3a 3a20 7079 7468 6f6e  e-block:: python
+0000e9c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e9d0: 2020 2020 2020 2020 2020 2831 296d 3132            (1)m12
+0000e9e0: 2020 2020 2020 2020 2020 2028 3129 6d32             (1)m2
+0000e9f0: 3120 2020 2020 2020 2020 2020 2831 296d  1           (1)m
+0000ea00: 3233 2020 2020 2020 2020 2020 2020 2020  23              
+0000ea10: 2831 296d 3332 2020 2020 2020 2020 2020  (1)m32          
+0000ea20: 2831 296d 3234 2020 2020 2020 2020 2020  (1)m24          
+0000ea30: 2028 3129 6d34 3220 2020 2020 2020 2020   (1)m42         
+0000ea40: 2020 2831 296d 3135 2020 2020 2020 2020    (1)m15        
+0000ea50: 2020 2831 296d 3531 2020 2020 2020 2020    (1)m51        
+0000ea60: 2020 2020 6d28 2d31 290a 2020 2020 2020      m(-1).      
+0000ea70: 2020 6d65 7373 6167 6520 3d20 5b20 5b68    message = [ [h
+0000ea80: 282d 3129 202b 2028 3029 6835 315d 205b  (-1) + (0)h51] [
+0000ea90: 2830 2968 3332 202b 2028 3029 6834 325d  (0)h32 + (0)h42]
+0000eaa0: 205b 2830 2968 3132 202b 2028 3029 6834   [(0)h12 + (0)h4
+0000eab0: 325d 205b 6828 2d31 2920 2b20 6828 2d31  2] [h(-1) + h(-1
+0000eac0: 295d 205b 2830 2968 3132 202b 2028 3029  )] [(0)h12 + (0)
+0000ead0: 6833 325d 205b 6828 2d31 2920 2b20 6828  h32] [h(-1) + h(
+0000eae0: 2d31 295d 205b 2830 2968 3231 202b 2068  -1)] [(0)h21 + h
+0000eaf0: 282d 3129 5d20 5b68 282d 3129 202b 2068  (-1)] [h(-1) + h
+0000eb00: 282d 3129 5d20 205b 6828 2d31 2920 2b20  (-1)]  [h(-1) + 
+0000eb10: 6828 2d31 295d 205d 0a0a 2020 2020 4865  h(-1)] ]..    He
+0000eb20: 6e63 652c 2074 6869 7320 6973 2068 6f77  nce, this is how
+0000eb30: 2065 6e63 6f64 6572 2063 616e 2067 6574   encoder can get
+0000eb40: 206d 6573 7361 6765 7320 666f 7220 6d65   messages for me
+0000eb50: 7373 6167 652d 7061 7373 696e 6720 7374  ssage-passing st
+0000eb60: 6570 732e 0a0a 2020 2020 2a2a 4765 7420  eps...    **Get 
+0000eb70: 6e65 7720 6174 6f6d 2068 6964 6465 6e20  new atom hidden 
+0000eb80: 7374 6174 6573 2061 6e64 2072 6561 646f  states and reado
+0000eb90: 7574 2070 6861 7365 2a2a 0a0a 2020 2020  ut phase**..    
+0000eba0: 4865 6e63 6520 6e6f 7720 666f 7220 6831  Hence now for h1
+0000ebb0: 3a0a 0a20 2020 202e 2e20 636f 6465 2d62  :..    .. code-b
+0000ebc0: 6c6f 636b 3a3a 2070 7974 686f 6e0a 0a20  lock:: python.. 
+0000ebd0: 2020 2020 2020 2068 3120 3d20 6675 6e63         h1 = func
+0000ebe0: 3328 0a20 2020 2020 2020 2020 2020 2020  3(.             
+0000ebf0: 2020 2020 2020 2063 6f6e 6361 7428 0a20         concat(. 
+0000ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec10: 2020 2020 2020 2020 6131 2c0a 2020 2020          a1,.    
+0000ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec30: 2020 2020 205b 0a20 2020 2020 2020 2020       [.         
+0000ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec50: 2020 2066 756e 6332 2820 2830 2968 3231     func2( (0)h21
+0000ec60: 202c 2028 3029 6833 3220 2b20 2830 2968   , (0)h32 + (0)h
+0000ec70: 3432 2029 202b 0a20 2020 2020 2020 2020  42 ) +.         
+0000ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec90: 2020 2066 756e 6332 2820 2830 2968 3531     func2( (0)h51
+0000eca0: 202c 2030 2020 2020 2020 2020 2020 2020   , 0            
+0000ecb0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000ecc0: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ece0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000ecf0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000ed00: 2020 5369 6d69 6c61 726c 792c 2068 322c    Similarly, h2,
+0000ed10: 2068 332c 2068 3420 616e 6420 6835 2061   h3, h4 and h5 a
+0000ed20: 7265 2063 616c 6375 6c61 7465 642e 0a0a  re calculated...
+0000ed30: 2020 2020 4e65 7874 2c20 616c 6c20 6174      Next, all at
+0000ed40: 6f6d 2068 6964 6465 6e20 7374 6174 6573  om hidden states
+0000ed50: 2061 7265 2063 6f6e 6361 7465 6e61 7465   are concatenate
+0000ed60: 6420 746f 206d 616b 6520 6120 6665 6174  d to make a feat
+0000ed70: 7572 6520 7665 6374 6f72 206f 6620 7468  ure vector of th
+0000ed80: 6520 6d6f 6c65 6375 6c65 3a0a 0a20 2020  e molecule:..   
+0000ed90: 2060 606d 6f6c 5f65 6e63 6f64 696e 6773   ``mol_encodings
+0000eda0: 203d 205b 5b68 312c 2068 322c 2068 332c   = [[h1, h2, h3,
+0000edb0: 2068 342c 2068 355d 5d60 600a 0a20 2020   h4, h5]]``..   
+0000edc0: 202a 2a43 6f6e 6361 7465 6e61 7465 2074   **Concatenate t
+0000edd0: 6865 2067 6c6f 6261 6c20 6665 6174 7572  he global featur
+0000ede0: 6573 2a2a 0a0a 2020 2020 4c65 742c 0a20  es**..    Let,. 
+0000edf0: 2020 2060 6067 6c6f 6261 6c5f 6665 6174     ``global_feat
+0000ee00: 7572 6573 203d 205b 5b67 6631 2c20 6766  ures = [[gf1, gf
+0000ee10: 322c 2067 6633 5d5d 6060 0a20 2020 2054  2, gf3]]``.    T
+0000ee20: 6869 7320 6172 7261 7920 636f 6e74 6169  his array contai
+0000ee30: 6e73 206d 6f6c 6563 756c 6520 6c65 7665  ns molecule leve
+0000ee40: 6c20 6665 6174 7572 6573 2e20 496e 2063  l features. In c
+0000ee50: 6173 6520 6f66 2074 6869 7320 6578 616d  ase of this exam
+0000ee60: 706c 652c 2069 7420 636f 6e74 6169 6e73  ple, it contains
+0000ee70: 2033 2067 6c6f 6261 6c20 6665 6174 7572   3 global featur
+0000ee80: 6573 2e0a 0a20 2020 2048 656e 6365 2061  es...    Hence a
+0000ee90: 6674 6572 2063 6f6e 6361 7465 6e61 7469  fter concatenati
+0000eea0: 6f6e 2c0a 0a20 2020 2060 606d 6f6c 5f65  on,..    ``mol_e
+0000eeb0: 6e63 6f64 696e 6773 203d 205b 5b68 312c  ncodings = [[h1,
+0000eec0: 2068 322c 2068 332c 2068 342c 2068 352c   h2, h3, h4, h5,
+0000eed0: 2067 6631 2c20 6766 322c 2067 6633 5d5d   gf1, gf2, gf3]]
+0000eee0: 6060 0a20 2020 2028 4669 6e61 6c20 6f75  ``.    (Final ou
+0000eef0: 7470 7574 206f 6620 7468 6520 656e 636f  tput of the enco
+0000ef00: 6465 7229 0a0a 2020 2020 5265 6665 7265  der)..    Refere
+0000ef10: 6e63 6573 0a20 2020 202d 2d2d 2d2d 2d2d  nces.    -------
+0000ef20: 2d2d 2d0a 2020 2020 2e2e 205b 315d 2041  ---.    .. [1] A
+0000ef30: 6e61 6c79 7a69 6e67 204c 6561 726e 6564  nalyzing Learned
+0000ef40: 204d 6f6c 6563 756c 6172 2052 6570 7265   Molecular Repre
+0000ef50: 7365 6e74 6174 696f 6e73 2066 6f72 2050  sentations for P
+0000ef60: 726f 7065 7274 7920 5072 6564 6963 7469  roperty Predicti
+0000ef70: 6f6e 2068 7474 7073 3a2f 2f61 7278 6976  on https://arxiv
+0000ef80: 2e6f 7267 2f70 6466 2f31 3930 342e 3031  .org/pdf/1904.01
+0000ef90: 3536 312e 7064 660a 0a20 2020 2045 7861  561.pdf..    Exa
+0000efa0: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
+0000efb0: 2d2d 0a20 2020 203e 3e3e 2066 726f 6d20  --.    >>> from 
+0000efc0: 7264 6b69 7420 696d 706f 7274 2043 6865  rdkit import Che
+0000efd0: 6d0a 2020 2020 3e3e 3e20 696d 706f 7274  m.    >>> import
+0000efe0: 2074 6f72 6368 0a20 2020 203e 3e3e 2069   torch.    >>> i
+0000eff0: 6d70 6f72 7420 6465 6570 6368 656d 2061  mport deepchem a
+0000f000: 7320 6463 0a20 2020 203e 3e3e 2069 6e70  s dc.    >>> inp
+0000f010: 7574 5f73 6d69 6c65 203d 2022 4343 220a  ut_smile = "CC".
+0000f020: 2020 2020 3e3e 3e20 6665 6174 203d 2064      >>> feat = d
+0000f030: 632e 6665 6174 2e44 4d50 4e4e 4665 6174  c.feat.DMPNNFeat
+0000f040: 7572 697a 6572 2866 6561 7475 7265 735f  urizer(features_
+0000f050: 6765 6e65 7261 746f 7273 3d5b 276d 6f72  generators=['mor
+0000f060: 6761 6e27 5d29 0a20 2020 203e 3e3e 2067  gan']).    >>> g
+0000f070: 7261 7068 203d 2066 6561 742e 6665 6174  raph = feat.feat
+0000f080: 7572 697a 6528 696e 7075 745f 736d 696c  urize(input_smil
+0000f090: 6529 0a20 2020 203e 3e3e 2066 726f 6d20  e).    >>> from 
+0000f0a0: 6465 6570 6368 656d 2e6d 6f64 656c 732e  deepchem.models.
+0000f0b0: 746f 7263 685f 6d6f 6465 6c73 2e64 6d70  torch_models.dmp
+0000f0c0: 6e6e 2069 6d70 6f72 7420 5f4d 6170 7065  nn import _Mappe
+0000f0d0: 7244 4d50 4e4e 0a20 2020 203e 3e3e 206d  rDMPNN.    >>> m
+0000f0e0: 6170 7065 7220 3d20 5f4d 6170 7065 7244  apper = _MapperD
+0000f0f0: 4d50 4e4e 2867 7261 7068 5b30 5d29 0a20  MPNN(graph[0]). 
+0000f100: 2020 203e 3e3e 2061 746f 6d5f 6665 6174     >>> atom_feat
+0000f110: 7572 6573 2c20 665f 696e 695f 6174 6f6d  ures, f_ini_atom
+0000f120: 735f 626f 6e64 732c 2061 746f 6d5f 746f  s_bonds, atom_to
+0000f130: 5f69 6e63 6f6d 696e 675f 626f 6e64 732c  _incoming_bonds,
+0000f140: 206d 6170 7069 6e67 2c20 676c 6f62 616c   mapping, global
+0000f150: 5f66 6561 7475 7265 7320 3d20 6d61 7070  _features = mapp
+0000f160: 6572 2e76 616c 7565 730a 2020 2020 3e3e  er.values.    >>
+0000f170: 3e20 6174 6f6d 5f66 6561 7475 7265 7320  > atom_features 
+0000f180: 3d20 746f 7263 682e 6672 6f6d 5f6e 756d  = torch.from_num
+0000f190: 7079 2861 746f 6d5f 6665 6174 7572 6573  py(atom_features
+0000f1a0: 292e 666c 6f61 7428 290a 2020 2020 3e3e  ).float().    >>
+0000f1b0: 3e20 665f 696e 695f 6174 6f6d 735f 626f  > f_ini_atoms_bo
+0000f1c0: 6e64 7320 3d20 746f 7263 682e 6672 6f6d  nds = torch.from
+0000f1d0: 5f6e 756d 7079 2866 5f69 6e69 5f61 746f  _numpy(f_ini_ato
+0000f1e0: 6d73 5f62 6f6e 6473 292e 666c 6f61 7428  ms_bonds).float(
+0000f1f0: 290a 2020 2020 3e3e 3e20 6174 6f6d 5f74  ).    >>> atom_t
+0000f200: 6f5f 696e 636f 6d69 6e67 5f62 6f6e 6473  o_incoming_bonds
+0000f210: 203d 2074 6f72 6368 2e66 726f 6d5f 6e75   = torch.from_nu
+0000f220: 6d70 7928 6174 6f6d 5f74 6f5f 696e 636f  mpy(atom_to_inco
+0000f230: 6d69 6e67 5f62 6f6e 6473 290a 2020 2020  ming_bonds).    
+0000f240: 3e3e 3e20 6d61 7070 696e 6720 3d20 746f  >>> mapping = to
+0000f250: 7263 682e 6672 6f6d 5f6e 756d 7079 286d  rch.from_numpy(m
+0000f260: 6170 7069 6e67 290a 2020 2020 3e3e 3e20  apping).    >>> 
+0000f270: 676c 6f62 616c 5f66 6561 7475 7265 7320  global_features 
+0000f280: 3d20 746f 7263 682e 6672 6f6d 5f6e 756d  = torch.from_num
+0000f290: 7079 2867 6c6f 6261 6c5f 6665 6174 7572  py(global_featur
+0000f2a0: 6573 292e 666c 6f61 7428 290a 2020 2020  es).float().    
+0000f2b0: 3e3e 3e20 6d6f 6c65 6375 6c65 735f 756e  >>> molecules_un
+0000f2c0: 6261 7463 685f 6b65 7920 3d20 6c65 6e28  batch_key = len(
+0000f2d0: 6174 6f6d 5f66 6561 7475 7265 7329 0a20  atom_features). 
+0000f2e0: 2020 203e 3e3e 206c 6179 6572 203d 2044     >>> layer = D
+0000f2f0: 4d50 4e4e 456e 636f 6465 724c 6179 6572  MPNNEncoderLayer
+0000f300: 2864 5f68 6964 6465 6e3d 3229 0a20 2020  (d_hidden=2).   
+0000f310: 203e 3e3e 206f 7574 7075 7420 3d20 6c61   >>> output = la
+0000f320: 7965 7228 6174 6f6d 5f66 6561 7475 7265  yer(atom_feature
+0000f330: 732c 2066 5f69 6e69 5f61 746f 6d73 5f62  s, f_ini_atoms_b
+0000f340: 6f6e 6473 2c20 6174 6f6d 5f74 6f5f 696e  onds, atom_to_in
+0000f350: 636f 6d69 6e67 5f62 6f6e 6473 2c20 6d61  coming_bonds, ma
+0000f360: 7070 696e 672c 2067 6c6f 6261 6c5f 6665  pping, global_fe
+0000f370: 6174 7572 6573 2c20 6d6f 6c65 6375 6c65  atures, molecule
+0000f380: 735f 756e 6261 7463 685f 6b65 7929 0a20  s_unbatch_key). 
+0000f390: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+0000f3a0: 5f5f 696e 6974 5f5f 2873 656c 662c 0a20  __init__(self,. 
+0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3c0: 7573 655f 6465 6661 756c 745f 6664 696d  use_default_fdim
+0000f3d0: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
+0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3f0: 6174 6f6d 5f66 6469 6d3a 2069 6e74 203d  atom_fdim: int =
+0000f400: 2031 3333 2c0a 2020 2020 2020 2020 2020   133,.          
+0000f410: 2020 2020 2020 2062 6f6e 645f 6664 696d         bond_fdim
+0000f420: 3a20 696e 7420 3d20 3134 2c0a 2020 2020  : int = 14,.    
+0000f430: 2020 2020 2020 2020 2020 2020 2064 5f68               d_h
+0000f440: 6964 6465 6e3a 2069 6e74 203d 2033 3030  idden: int = 300
+0000f450: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f460: 2020 2064 6570 7468 3a20 696e 7420 3d20     depth: int = 
+0000f470: 332c 0a20 2020 2020 2020 2020 2020 2020  3,.             
+0000f480: 2020 2020 6269 6173 3a20 626f 6f6c 203d      bias: bool =
+0000f490: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+0000f4a0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+0000f4b0: 696f 6e3a 2073 7472 203d 2027 7265 6c75  ion: str = 'relu
+0000f4c0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0000f4d0: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
+0000f4e0: 6c6f 6174 203d 2030 2e30 2c0a 2020 2020  loat = 0.0,.    
+0000f4f0: 2020 2020 2020 2020 2020 2020 2061 6767               agg
+0000f500: 7265 6761 7469 6f6e 3a20 7374 7220 3d20  regation: str = 
+0000f510: 276d 6561 6e27 2c0a 2020 2020 2020 2020  'mean',.        
+0000f520: 2020 2020 2020 2020 2061 6767 7265 6761           aggrega
+0000f530: 7469 6f6e 5f6e 6f72 6d3a 2055 6e69 6f6e  tion_norm: Union
+0000f540: 5b69 6e74 2c20 666c 6f61 745d 203d 2031  [int, float] = 1
+0000f550: 3030 293a 0a20 2020 2020 2020 2022 2222  00):.        """
+0000f560: 496e 6974 6961 6c69 7a65 2061 2044 4d50  Initialize a DMP
+0000f570: 4e4e 456e 636f 6465 724c 6179 6572 206c  NNEncoderLayer l
+0000f580: 6179 6572 2e0a 0a20 2020 2020 2020 2050  ayer...        P
+0000f590: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0000f5a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0000f5b0: 2020 2020 2075 7365 5f64 6566 6175 6c74       use_default
+0000f5c0: 5f66 6469 6d3a 2062 6f6f 6c0a 2020 2020  _fdim: bool.    
+0000f5d0: 2020 2020 2020 2020 4966 2060 6054 7275          If ``Tru
+0000f5e0: 6560 602c 2060 6073 656c 662e 6174 6f6d  e``, ``self.atom
+0000f5f0: 5f66 6469 6d60 6020 616e 6420 6060 7365  _fdim`` and ``se
+0000f600: 6c66 2e62 6f6e 645f 6664 696d 6060 2061  lf.bond_fdim`` a
+0000f610: 7265 2069 6e69 7469 616c 697a 6564 2075  re initialized u
+0000f620: 7369 6e67 2076 616c 7565 7320 6672 6f6d  sing values from
+0000f630: 2074 6865 2047 7261 7068 436f 6e76 436f   the GraphConvCo
+0000f640: 6e73 7461 6e74 7320 636c 6173 732e 2049  nstants class. I
+0000f650: 6620 6060 4661 6c73 6560 602c 2060 6073  f ``False``, ``s
+0000f660: 656c 662e 6174 6f6d 5f66 6469 6d60 6020  elf.atom_fdim`` 
+0000f670: 616e 6420 6060 7365 6c66 2e62 6f6e 645f  and ``self.bond_
+0000f680: 6664 696d 6060 2061 7265 2069 6e69 7469  fdim`` are initi
+0000f690: 616c 697a 6564 2066 726f 6d20 7468 6520  alized from the 
+0000f6a0: 7661 6c75 6573 2070 726f 7669 6465 642e  values provided.
+0000f6b0: 0a20 2020 2020 2020 2061 746f 6d5f 6664  .        atom_fd
+0000f6c0: 696d 3a20 696e 740a 2020 2020 2020 2020  im: int.        
+0000f6d0: 2020 2020 4469 6d65 6e73 696f 6e20 6f66      Dimension of
+0000f6e0: 2061 746f 6d20 6665 6174 7572 6520 7665   atom feature ve
+0000f6f0: 6374 6f72 2e0a 2020 2020 2020 2020 626f  ctor..        bo
+0000f700: 6e64 5f66 6469 6d3a 2069 6e74 0a20 2020  nd_fdim: int.   
+0000f710: 2020 2020 2020 2020 2044 696d 656e 7369           Dimensi
+0000f720: 6f6e 206f 6620 626f 6e64 2066 6561 7475  on of bond featu
+0000f730: 7265 2076 6563 746f 722e 0a20 2020 2020  re vector..     
+0000f740: 2020 2064 5f68 6964 6465 6e3a 2069 6e74     d_hidden: int
+0000f750: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
+0000f760: 6520 6f66 2068 6964 6465 6e20 6c61 7965  e of hidden laye
+0000f770: 7220 696e 2074 6865 2065 6e63 6f64 6572  r in the encoder
+0000f780: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+0000f790: 6465 7074 683a 2069 6e74 0a20 2020 2020  depth: int.     
+0000f7a0: 2020 2020 2020 204e 6f20 6f66 206d 6573         No of mes
+0000f7b0: 7361 6765 2070 6173 7369 6e67 2073 7465  sage passing ste
+0000f7c0: 7073 2e0a 2020 2020 2020 2020 6269 6173  ps..        bias
+0000f7d0: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
+0000f7e0: 2020 2049 6620 6060 5472 7565 6060 2c20     If ``True``, 
+0000f7f0: 6465 6e73 6520 6c61 7965 7273 2077 696c  dense layers wil
+0000f800: 6c20 7573 6520 6269 6173 2076 6563 746f  l use bias vecto
+0000f810: 7273 2e0a 2020 2020 2020 2020 6163 7469  rs..        acti
+0000f820: 7661 7469 6f6e 3a20 7374 720a 2020 2020  vation: str.    
+0000f830: 2020 2020 2020 2020 4163 7469 7661 7469          Activati
+0000f840: 6f6e 2066 756e 6374 696f 6e20 746f 2062  on function to b
+0000f850: 6520 7573 6564 2069 6e20 7468 6520 656e  e used in the en
+0000f860: 636f 6465 7220 6c61 7965 722e 0a20 2020  coder layer..   
+0000f870: 2020 2020 2020 2020 2043 616e 2063 686f           Can cho
+0000f880: 6f73 6520 6265 7477 6565 6e20 2772 656c  ose between 'rel
+0000f890: 7527 2066 6f72 2052 654c 552c 2027 6c65  u' for ReLU, 'le
+0000f8a0: 616b 7972 656c 7527 2066 6f72 204c 6561  akyrelu' for Lea
+0000f8b0: 6b79 5265 4c55 2c20 2770 7265 6c75 2720  kyReLU, 'prelu' 
+0000f8c0: 666f 7220 5052 654c 552c 0a20 2020 2020  for PReLU,.     
+0000f8d0: 2020 2020 2020 2027 7461 6e68 2720 666f         'tanh' fo
+0000f8e0: 7220 5461 6e48 2c20 2773 656c 7527 2066  r TanH, 'selu' f
+0000f8f0: 6f72 2053 454c 552c 2061 6e64 2027 656c  or SELU, and 'el
+0000f900: 7527 2066 6f72 2045 4c55 2e0a 2020 2020  u' for ELU..    
+0000f910: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
+0000f920: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+0000f930: 2044 726f 706f 7574 2070 726f 6261 6269   Dropout probabi
+0000f940: 6c69 7479 2066 6f72 2074 6865 2065 6e63  lity for the enc
+0000f950: 6f64 6572 206c 6179 6572 2e0a 2020 2020  oder layer..    
+0000f960: 2020 2020 6167 6772 6567 6174 696f 6e3a      aggregation:
+0000f970: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
+0000f980: 2041 6767 7265 6761 7469 6f6e 2074 7970   Aggregation typ
+0000f990: 6520 746f 2062 6520 7573 6564 2069 6e20  e to be used in 
+0000f9a0: 7468 6520 656e 636f 6465 7220 6c61 7965  the encoder laye
+0000f9b0: 722e 0a20 2020 2020 2020 2020 2020 2043  r..            C
+0000f9c0: 616e 2063 686f 6f73 6520 6265 7477 6565  an choose betwee
+0000f9d0: 6e20 276d 6561 6e27 2c20 2773 756d 272c  n 'mean', 'sum',
+0000f9e0: 2061 6e64 2027 6e6f 726d 272e 0a20 2020   and 'norm'..   
+0000f9f0: 2020 2020 2061 6767 7265 6761 7469 6f6e       aggregation
+0000fa00: 5f6e 6f72 6d3a 2055 6e69 6f6e 5b69 6e74  _norm: Union[int
+0000fa10: 2c20 666c 6f61 745d 0a20 2020 2020 2020  , float].       
+0000fa20: 2020 2020 2056 616c 7565 2072 6571 7569       Value requi
+0000fa30: 7265 6420 6966 2060 6167 6772 6567 6174  red if `aggregat
+0000fa40: 696f 6e60 2074 7970 6520 6973 2027 6e6f  ion` type is 'no
+0000fa50: 726d 272e 0a20 2020 2020 2020 2022 2222  rm'..        """
+0000fa60: 0a20 2020 2020 2020 2073 7570 6572 2844  .        super(D
+0000fa70: 4d50 4e4e 456e 636f 6465 724c 6179 6572  MPNNEncoderLayer
+0000fa80: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
+0000fa90: 2829 0a0a 2020 2020 2020 2020 6966 2075  ()..        if u
+0000faa0: 7365 5f64 6566 6175 6c74 5f66 6469 6d3a  se_default_fdim:
+0000fab0: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+0000fac0: 6d20 6465 6570 6368 656d 2e66 6561 742e  m deepchem.feat.
+0000fad0: 6d6f 6c65 6375 6c65 5f66 6561 7475 7269  molecule_featuri
+0000fae0: 7a65 7273 2e64 6d70 6e6e 5f66 6561 7475  zers.dmpnn_featu
+0000faf0: 7269 7a65 7220 696d 706f 7274 2047 7261  rizer import Gra
+0000fb00: 7068 436f 6e76 436f 6e73 7461 6e74 730a  phConvConstants.
+0000fb10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fb20: 2e61 746f 6d5f 6664 696d 3a20 696e 7420  .atom_fdim: int 
+0000fb30: 3d20 4772 6170 6843 6f6e 7643 6f6e 7374  = GraphConvConst
+0000fb40: 616e 7473 2e41 544f 4d5f 4644 494d 0a20  ants.ATOM_FDIM. 
+0000fb50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000fb60: 636f 6e63 6174 5f66 6469 6d3a 2069 6e74  concat_fdim: int
+0000fb70: 203d 2047 7261 7068 436f 6e76 436f 6e73   = GraphConvCons
+0000fb80: 7461 6e74 732e 4154 4f4d 5f46 4449 4d20  tants.ATOM_FDIM 
+0000fb90: 2b20 4772 6170 6843 6f6e 7643 6f6e 7374  + GraphConvConst
+0000fba0: 616e 7473 2e42 4f4e 445f 4644 494d 0a20  ants.BOND_FDIM. 
+0000fbb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000fbc0: 2020 2020 2020 2020 2073 656c 662e 6174           self.at
+0000fbd0: 6f6d 5f66 6469 6d20 3d20 6174 6f6d 5f66  om_fdim = atom_f
+0000fbe0: 6469 6d0a 2020 2020 2020 2020 2020 2020  dim.            
+0000fbf0: 7365 6c66 2e63 6f6e 6361 745f 6664 696d  self.concat_fdim
+0000fc00: 203d 2061 746f 6d5f 6664 696d 202b 2062   = atom_fdim + b
+0000fc10: 6f6e 645f 6664 696d 0a0a 2020 2020 2020  ond_fdim..      
+0000fc20: 2020 7365 6c66 2e64 6570 7468 3a20 696e    self.depth: in
+0000fc30: 7420 3d20 6465 7074 680a 2020 2020 2020  t = depth.      
+0000fc40: 2020 7365 6c66 2e61 6767 7265 6761 7469    self.aggregati
+0000fc50: 6f6e 3a20 7374 7220 3d20 6167 6772 6567  on: str = aggreg
+0000fc60: 6174 696f 6e0a 2020 2020 2020 2020 7365  ation.        se
+0000fc70: 6c66 2e61 6767 7265 6761 7469 6f6e 5f6e  lf.aggregation_n
+0000fc80: 6f72 6d3a 2055 6e69 6f6e 5b69 6e74 2c20  orm: Union[int, 
+0000fc90: 666c 6f61 745d 203d 2061 6767 7265 6761  float] = aggrega
+0000fca0: 7469 6f6e 5f6e 6f72 6d0a 0a20 2020 2020  tion_norm..     
+0000fcb0: 2020 2069 6620 6163 7469 7661 7469 6f6e     if activation
+0000fcc0: 203d 3d20 2772 656c 7527 3a0a 2020 2020   == 'relu':.    
+0000fcd0: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
+0000fce0: 6976 6174 696f 6e3a 206e 6e2e 6d6f 6475  ivation: nn.modu
+0000fcf0: 6c65 732e 6163 7469 7661 7469 6f6e 2e4d  les.activation.M
+0000fd00: 6f64 756c 6520 3d20 6e6e 2e52 654c 5528  odule = nn.ReLU(
+0000fd10: 290a 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+0000fd20: 6163 7469 7661 7469 6f6e 203d 3d20 276c  activation == 'l
+0000fd30: 6561 6b79 7265 6c75 273a 0a20 2020 2020  eakyrelu':.     
+0000fd40: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
+0000fd50: 7661 7469 6f6e 203d 206e 6e2e 4c65 616b  vation = nn.Leak
+0000fd60: 7952 654c 5528 302e 3129 0a0a 2020 2020  yReLU(0.1)..    
+0000fd70: 2020 2020 656c 6966 2061 6374 6976 6174      elif activat
+0000fd80: 696f 6e20 3d3d 2027 7072 656c 7527 3a0a  ion == 'prelu':.
+0000fd90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fda0: 2e61 6374 6976 6174 696f 6e20 3d20 6e6e  .activation = nn
+0000fdb0: 2e50 5265 4c55 2829 0a0a 2020 2020 2020  .PReLU()..      
+0000fdc0: 2020 656c 6966 2061 6374 6976 6174 696f    elif activatio
+0000fdd0: 6e20 3d3d 2027 7461 6e68 273a 0a20 2020  n == 'tanh':.   
+0000fde0: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
+0000fdf0: 7469 7661 7469 6f6e 203d 206e 6e2e 5461  tivation = nn.Ta
+0000fe00: 6e68 2829 0a0a 2020 2020 2020 2020 656c  nh()..        el
+0000fe10: 6966 2061 6374 6976 6174 696f 6e20 3d3d  if activation ==
+0000fe20: 2027 7365 6c75 273a 0a20 2020 2020 2020   'selu':.       
+0000fe30: 2020 2020 2073 656c 662e 6163 7469 7661       self.activa
+0000fe40: 7469 6f6e 203d 206e 6e2e 5345 4c55 2829  tion = nn.SELU()
+0000fe50: 0a0a 2020 2020 2020 2020 656c 6966 2061  ..        elif a
+0000fe60: 6374 6976 6174 696f 6e20 3d3d 2027 656c  ctivation == 'el
+0000fe70: 7527 3a0a 2020 2020 2020 2020 2020 2020  u':.            
+0000fe80: 7365 6c66 2e61 6374 6976 6174 696f 6e20  self.activation 
+0000fe90: 3d20 6e6e 2e45 4c55 2829 0a0a 2020 2020  = nn.ELU()..    
+0000fea0: 2020 2020 7365 6c66 2e64 726f 706f 7574      self.dropout
+0000feb0: 3a20 6e6e 2e6d 6f64 756c 6573 2e64 726f  : nn.modules.dro
+0000fec0: 706f 7574 2e4d 6f64 756c 6520 3d20 6e6e  pout.Module = nn
+0000fed0: 2e44 726f 706f 7574 2864 726f 706f 7574  .Dropout(dropout
+0000fee0: 5f70 290a 0a20 2020 2020 2020 2023 2049  _p)..        # I
+0000fef0: 6e70 7574 0a20 2020 2020 2020 2073 656c  nput.        sel
+0000ff00: 662e 575f 693a 206e 6e2e 4c69 6e65 6172  f.W_i: nn.Linear
+0000ff10: 203d 206e 6e2e 4c69 6e65 6172 2873 656c   = nn.Linear(sel
+0000ff20: 662e 636f 6e63 6174 5f66 6469 6d2c 2064  f.concat_fdim, d
+0000ff30: 5f68 6964 6465 6e2c 2062 6961 733d 6269  _hidden, bias=bi
+0000ff40: 6173 290a 0a20 2020 2020 2020 2023 2053  as)..        # S
+0000ff50: 6861 7265 6420 7765 6967 6874 206d 6174  hared weight mat
+0000ff60: 7269 7820 6163 726f 7373 2064 6570 7468  rix across depth
+0000ff70: 7320 2864 6566 6175 6c74 293a 0a20 2020  s (default):.   
+0000ff80: 2020 2020 2023 2046 6f72 206d 6573 7361       # For messa
+0000ff90: 6765 7320 6869 6464 656e 2073 7461 7465  ges hidden state
+0000ffa0: 730a 2020 2020 2020 2020 7365 6c66 2e57  s.        self.W
+0000ffb0: 5f68 3a20 6e6e 2e4c 696e 6561 7220 3d20  _h: nn.Linear = 
+0000ffc0: 6e6e 2e4c 696e 6561 7228 645f 6869 6464  nn.Linear(d_hidd
+0000ffd0: 656e 2c20 645f 6869 6464 656e 2c20 6269  en, d_hidden, bi
+0000ffe0: 6173 3d62 6961 7329 0a0a 2020 2020 2020  as=bias)..      
+0000fff0: 2020 2320 466f 7220 6174 6f6d 2068 6964    # For atom hid
+00010000: 6465 6e20 7374 6174 6573 0a20 2020 2020  den states.     
+00010010: 2020 2073 656c 662e 575f 6f3a 206e 6e2e     self.W_o: nn.
+00010020: 4c69 6e65 6172 203d 206e 6e2e 4c69 6e65  Linear = nn.Line
+00010030: 6172 2873 656c 662e 6174 6f6d 5f66 6469  ar(self.atom_fdi
+00010040: 6d20 2b20 645f 6869 6464 656e 2c20 645f  m + d_hidden, d_
+00010050: 6869 6464 656e 290a 0a20 2020 2064 6566  hidden)..    def
+00010060: 205f 6765 745f 7570 6461 7465 645f 6174   _get_updated_at
+00010070: 6f6d 735f 6869 6464 656e 5f73 7461 7465  oms_hidden_state
+00010080: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00010090: 6c66 2c20 6174 6f6d 5f66 6561 7475 7265  lf, atom_feature
+000100a0: 733a 2074 6f72 6368 2e54 656e 736f 722c  s: torch.Tensor,
+000100b0: 2068 5f6d 6573 7361 6765 3a20 746f 7263   h_message: torc
+000100c0: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
+000100d0: 2020 2020 2020 6174 6f6d 5f74 6f5f 696e        atom_to_in
+000100e0: 636f 6d69 6e67 5f62 6f6e 6473 3a20 746f  coming_bonds: to
+000100f0: 7263 682e 5465 6e73 6f72 2920 2d3e 2074  rch.Tensor) -> t
+00010100: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
+00010110: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00010120: 204d 6574 686f 6420 746f 2063 6f6d 7075   Method to compu
+00010130: 7465 2061 746f 6d20 6869 6464 656e 2073  te atom hidden s
+00010140: 7461 7465 732e 0a0a 2020 2020 2020 2020  tates...        
+00010150: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00010160: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00010170: 2020 2020 2020 6174 6f6d 5f66 6561 7475        atom_featu
+00010180: 7265 733a 2074 6f72 6368 2e54 656e 736f  res: torch.Tenso
+00010190: 720a 2020 2020 2020 2020 2020 2020 5465  r.            Te
+000101a0: 6e73 6f72 2063 6f6e 7461 696e 696e 6720  nsor containing 
+000101b0: 6174 6f6d 7320 6665 6174 7572 6573 2e0a  atoms features..
+000101c0: 2020 2020 2020 2020 685f 6d65 7373 6167          h_messag
+000101d0: 653a 2074 6f72 6368 2e54 656e 736f 720a  e: torch.Tensor.
+000101e0: 2020 2020 2020 2020 2020 2020 5465 6e73              Tens
+000101f0: 6f72 2063 6f6e 7461 696e 696e 6720 6869  or containing hi
+00010200: 6464 656e 2073 7461 7465 7320 6f66 206d  dden states of m
+00010210: 6573 7361 6765 732e 0a20 2020 2020 2020  essages..       
+00010220: 2061 746f 6d5f 746f 5f69 6e63 6f6d 696e   atom_to_incomin
+00010230: 675f 626f 6e64 733a 2074 6f72 6368 2e54  g_bonds: torch.T
+00010240: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00010250: 2020 5465 6e73 6f72 2063 6f6e 7461 696e    Tensor contain
+00010260: 696e 6720 6d61 7070 696e 6720 6672 6f6d  ing mapping from
+00010270: 2061 746f 6d20 696e 6465 7820 746f 206c   atom index to l
+00010280: 6973 7420 6f66 2069 6e64 6963 6965 7320  ist of indicies 
+00010290: 6f66 2069 6e63 6f6d 696e 6720 626f 6e64  of incoming bond
+000102a0: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
+000102b0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+000102c0: 2d2d 2d0a 2020 2020 2020 2020 6174 6f6d  ---.        atom
+000102d0: 735f 6869 6464 656e 5f73 7461 7465 733a  s_hidden_states:
+000102e0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+000102f0: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
+00010300: 2063 6f6e 7461 696e 696e 6720 6174 6f6d   containing atom
+00010310: 2068 6964 6465 6e20 7374 6174 6573 2e0a   hidden states..
+00010320: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010330: 2020 2020 6d65 7373 6167 6573 5f74 6f5f      messages_to_
+00010340: 6174 6f6d 733a 2074 6f72 6368 2e54 656e  atoms: torch.Ten
+00010350: 736f 7220 3d20 685f 6d65 7373 6167 655b  sor = h_message[
+00010360: 6174 6f6d 5f74 6f5f 696e 636f 6d69 6e67  atom_to_incoming
+00010370: 5f62 6f6e 6473 5d2e 7375 6d28 0a20 2020  _bonds].sum(.   
+00010380: 2020 2020 2020 2020 2031 2920 2023 206e           1)  # n
+00010390: 756d 5f61 746f 6d73 2078 2068 6964 6465  um_atoms x hidde
+000103a0: 6e5f 7369 7a65 0a20 2020 2020 2020 2061  n_size.        a
+000103b0: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
+000103c0: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
+000103d0: 203d 2073 656c 662e 575f 6f28 0a20 2020   = self.W_o(.   
+000103e0: 2020 2020 2020 2020 2074 6f72 6368 2e63           torch.c
+000103f0: 6174 2828 6174 6f6d 5f66 6561 7475 7265  at((atom_feature
+00010400: 732c 206d 6573 7361 6765 735f 746f 5f61  s, messages_to_a
+00010410: 746f 6d73 292c 0a20 2020 2020 2020 2020  toms),.         
+00010420: 2020 2020 2020 2020 2020 2020 2031 2929               1))
+00010430: 2020 2320 6e75 6d5f 6174 6f6d 7320 7820    # num_atoms x 
+00010440: 6869 6464 656e 5f73 697a 650a 2020 2020  hidden_size.    
+00010450: 2020 2020 6174 6f6d 735f 6869 6464 656e      atoms_hidden
+00010460: 5f73 7461 7465 7320 3d20 7365 6c66 2e61  _states = self.a
+00010470: 6374 6976 6174 696f 6e28 0a20 2020 2020  ctivation(.     
+00010480: 2020 2020 2020 2061 746f 6d73 5f68 6964         atoms_hid
+00010490: 6465 6e5f 7374 6174 6573 2920 2023 206e  den_states)  # n
+000104a0: 756d 5f61 746f 6d73 2078 2068 6964 6465  um_atoms x hidde
+000104b0: 6e5f 7369 7a65 0a20 2020 2020 2020 2061  n_size.        a
+000104c0: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
+000104d0: 6573 203d 2073 656c 662e 6472 6f70 6f75  es = self.dropou
+000104e0: 7428 0a20 2020 2020 2020 2020 2020 2061  t(.            a
+000104f0: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
+00010500: 6573 2920 2023 206e 756d 5f61 746f 6d73  es)  # num_atoms
+00010510: 2078 2068 6964 6465 6e5f 7369 7a65 0a20   x hidden_size. 
+00010520: 2020 2020 2020 2072 6574 7572 6e20 6174         return at
+00010530: 6f6d 735f 6869 6464 656e 5f73 7461 7465  oms_hidden_state
+00010540: 7320 2023 206e 756d 5f61 746f 6d73 2078  s  # num_atoms x
+00010550: 2068 6964 6465 6e5f 7369 7a65 0a0a 2020   hidden_size..  
+00010560: 2020 6465 6620 5f72 6561 646f 7574 2873    def _readout(s
+00010570: 656c 662c 2061 746f 6d73 5f68 6964 6465  elf, atoms_hidde
+00010580: 6e5f 7374 6174 6573 3a20 746f 7263 682e  n_states: torch.
+00010590: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
+000105a0: 2020 2020 2020 2020 206d 6f6c 6563 756c           molecul
+000105b0: 6573 5f75 6e62 6174 6368 5f6b 6579 3a20  es_unbatch_key: 
+000105c0: 4c69 7374 2920 2d3e 2074 6f72 6368 2e54  List) -> torch.T
+000105d0: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
+000105e0: 2222 0a20 2020 2020 2020 204d 6574 686f  "".        Metho
+000105f0: 6420 746f 2065 7865 6375 7465 2074 6865  d to execute the
+00010600: 2072 6561 646f 7574 2070 6861 7365 2e20   readout phase. 
+00010610: 2863 6f6d 7075 7465 206d 6f6c 6563 756c  (compute molecul
+00010620: 6573 2065 6e63 6f64 696e 6773 2066 726f  es encodings fro
+00010630: 6d20 6174 6f6d 2068 6964 6465 6e20 7374  m atom hidden st
+00010640: 6174 6573 290a 0a20 2020 2020 2020 2050  ates)..        P
+00010650: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00010660: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00010670: 2020 2020 2061 746f 6d73 5f68 6964 6465       atoms_hidde
+00010680: 6e5f 7374 6174 6573 3a20 746f 7263 682e  n_states: torch.
+00010690: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+000106a0: 2020 2054 656e 736f 7220 636f 6e74 6169     Tensor contai
+000106b0: 6e69 6e67 2061 746f 6d20 6869 6464 656e  ning atom hidden
+000106c0: 2073 7461 7465 732e 0a20 2020 2020 2020   states..       
+000106d0: 206d 6f6c 6563 756c 6573 5f75 6e62 6174   molecules_unbat
+000106e0: 6368 5f6b 6579 3a20 4c69 7374 0a20 2020  ch_key: List.   
+000106f0: 2020 2020 2020 2020 204c 6973 7420 636f           List co
+00010700: 6e74 6169 6e69 6e67 206e 756d 6265 7220  ntaining number 
+00010710: 6f66 2061 746f 6d73 2069 6e20 7661 7269  of atoms in vari
+00010720: 6f75 7320 6d6f 6c65 6375 6c65 7320 6f66  ous molecules of
+00010730: 2061 2062 6174 6368 0a0a 2020 2020 2020   a batch..      
+00010740: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00010750: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00010760: 2020 6d6f 6c65 6375 6c65 5f68 6964 6465    molecule_hidde
+00010770: 6e5f 7374 6174 653a 2074 6f72 6368 2e54  n_state: torch.T
+00010780: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00010790: 2020 5465 6e73 6f72 2063 6f6e 7461 696e    Tensor contain
+000107a0: 696e 6720 6d6f 6c65 6375 6c65 2065 6e63  ing molecule enc
+000107b0: 6f64 696e 6773 2e0a 2020 2020 2020 2020  odings..        
+000107c0: 2222 220a 2020 2020 2020 2020 6d6f 6c5f  """.        mol_
+000107d0: 7665 6373 3a20 4c69 7374 203d 205b 5d0a  vecs: List = [].
+000107e0: 2020 2020 2020 2020 6174 6f6d 735f 6869          atoms_hi
+000107f0: 6464 656e 5f73 7461 7465 735f 7370 6c69  dden_states_spli
+00010800: 743a 2053 6571 7565 6e63 655b 5465 6e73  t: Sequence[Tens
+00010810: 6f72 5d20 3d20 746f 7263 682e 7370 6c69  or] = torch.spli
+00010820: 7428 0a20 2020 2020 2020 2020 2020 2061  t(.            a
+00010830: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
+00010840: 6573 2c20 6d6f 6c65 6375 6c65 735f 756e  es, molecules_un
+00010850: 6261 7463 685f 6b65 7929 0a20 2020 2020  batch_key).     
+00010860: 2020 206d 6f6c 5f76 6563 3a20 746f 7263     mol_vec: torc
+00010870: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00010880: 2066 6f72 206d 6f6c 5f76 6563 2069 6e20   for mol_vec in 
+00010890: 6174 6f6d 735f 6869 6464 656e 5f73 7461  atoms_hidden_sta
+000108a0: 7465 735f 7370 6c69 743a 0a20 2020 2020  tes_split:.     
+000108b0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
+000108c0: 6767 7265 6761 7469 6f6e 203d 3d20 276d  ggregation == 'm
+000108d0: 6561 6e27 3a0a 2020 2020 2020 2020 2020  ean':.          
+000108e0: 2020 2020 2020 6d6f 6c5f 7665 6320 3d20        mol_vec = 
+000108f0: 6d6f 6c5f 7665 632e 7375 6d28 6469 6d3d  mol_vec.sum(dim=
+00010900: 3029 202f 206c 656e 286d 6f6c 5f76 6563  0) / len(mol_vec
+00010910: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00010920: 6966 2073 656c 662e 6167 6772 6567 6174  if self.aggregat
+00010930: 696f 6e20 3d3d 2027 7375 6d27 3a0a 2020  ion == 'sum':.  
+00010940: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+00010950: 6c5f 7665 6320 3d20 6d6f 6c5f 7665 632e  l_vec = mol_vec.
+00010960: 7375 6d28 6469 6d3d 3029 0a20 2020 2020  sum(dim=0).     
+00010970: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00010980: 2e61 6767 7265 6761 7469 6f6e 203d 3d20  .aggregation == 
+00010990: 276e 6f72 6d27 3a0a 2020 2020 2020 2020  'norm':.        
+000109a0: 2020 2020 2020 2020 6d6f 6c5f 7665 6320          mol_vec 
+000109b0: 3d20 6d6f 6c5f 7665 632e 7375 6d28 6469  = mol_vec.sum(di
+000109c0: 6d3d 3029 202f 2073 656c 662e 6167 6772  m=0) / self.aggr
+000109d0: 6567 6174 696f 6e5f 6e6f 726d 0a20 2020  egation_norm.   
+000109e0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000109f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00010a00: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+00010a10: 496e 7661 6c69 6420 6167 6772 6567 6174  Invalid aggregat
+00010a20: 696f 6e22 290a 2020 2020 2020 2020 2020  ion").          
+00010a30: 2020 6d6f 6c5f 7665 6373 2e61 7070 656e    mol_vecs.appen
+00010a40: 6428 6d6f 6c5f 7665 6329 0a0a 2020 2020  d(mol_vec)..    
+00010a50: 2020 2020 6d6f 6c65 6375 6c65 5f68 6964      molecule_hid
+00010a60: 6465 6e5f 7374 6174 653a 2074 6f72 6368  den_state: torch
+00010a70: 2e54 656e 736f 7220 3d20 746f 7263 682e  .Tensor = torch.
+00010a80: 7374 6163 6b28 6d6f 6c5f 7665 6373 2c20  stack(mol_vecs, 
+00010a90: 6469 6d3d 3029 0a20 2020 2020 2020 2072  dim=0).        r
+00010aa0: 6574 7572 6e20 6d6f 6c65 6375 6c65 5f68  eturn molecule_h
+00010ab0: 6964 6465 6e5f 7374 6174 6520 2023 206e  idden_state  # n
+00010ac0: 756d 5f6d 6f6c 6563 756c 6573 2078 2068  um_molecules x h
+00010ad0: 6964 6465 6e5f 7369 7a65 0a0a 2020 2020  idden_size..    
+00010ae0: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
+00010af0: 2c20 6174 6f6d 5f66 6561 7475 7265 733a  , atom_features:
+00010b00: 2074 6f72 6368 2e54 656e 736f 722c 0a20   torch.Tensor,. 
+00010b10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010b20: 5f69 6e69 5f61 746f 6d73 5f62 6f6e 6473  _ini_atoms_bonds
+00010b30: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
+00010b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b50: 6174 6f6d 5f74 6f5f 696e 636f 6d69 6e67  atom_to_incoming
+00010b60: 5f62 6f6e 6473 3a20 746f 7263 682e 5465  _bonds: torch.Te
+00010b70: 6e73 6f72 2c20 6d61 7070 696e 673a 2074  nsor, mapping: t
+00010b80: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
+00010b90: 2020 2020 2020 2020 2020 2020 2067 6c6f               glo
+00010ba0: 6261 6c5f 6665 6174 7572 6573 3a20 746f  bal_features: to
+00010bb0: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
+00010bc0: 2020 2020 2020 2020 2020 2020 6d6f 6c65              mole
+00010bd0: 6375 6c65 735f 756e 6261 7463 685f 6b65  cules_unbatch_ke
+00010be0: 793a 204c 6973 7429 202d 3e20 746f 7263  y: List) -> torc
+00010bf0: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
+00010c00: 2020 2222 220a 2020 2020 2020 2020 4f75    """.        Ou
+00010c10: 7470 7574 2063 6f6d 7075 7461 7469 6f6e  tput computation
+00010c20: 2066 6f72 2074 6865 2044 4d50 4e4e 456e   for the DMPNNEn
+00010c30: 636f 6465 724c 6179 6572 2e0a 0a20 2020  coderLayer...   
+00010c40: 2020 2020 2053 7465 7073 3a0a 0a20 2020       Steps:..   
+00010c50: 2020 2020 202d 2047 6574 206f 7269 6769       - Get origi
+00010c60: 6e61 6c20 626f 6e64 2068 6964 6465 6e20  nal bond hidden 
+00010c70: 7374 6174 6573 2066 726f 6d20 636f 6e63  states from conc
+00010c80: 6174 656e 6174 696f 6e20 6f66 2069 6e69  atenation of ini
+00010c90: 7469 616c 2061 746f 6d20 616e 6420 626f  tial atom and bo
+00010ca0: 6e64 2066 6561 7475 7265 732e 2028 6060  nd features. (``
+00010cb0: 696e 7075 7460 6029 0a20 2020 2020 2020  input``).       
+00010cc0: 202d 2047 6574 2069 6e69 7469 616c 206d   - Get initial m
+00010cd0: 6573 7361 6765 7320 6869 6464 656e 2073  essages hidden s
+00010ce0: 7461 7465 732e 2028 6060 6d65 7373 6167  tates. (``messag
+00010cf0: 6560 6029 0a20 2020 2020 2020 202d 2045  e``).        - E
+00010d00: 7865 6375 7465 206d 6573 7361 6765 2070  xecute message p
+00010d10: 6173 7369 6e67 2073 7465 7020 666f 7220  assing step for 
+00010d20: 6060 7365 6c66 2e64 6570 7468 202d 2031  ``self.depth - 1
+00010d30: 6060 2069 7465 7261 7469 6f6e 732e 0a20  `` iterations.. 
+00010d40: 2020 2020 2020 202d 2047 6574 2061 746f         - Get ato
+00010d50: 6d20 6869 6464 656e 2073 7461 7465 7320  m hidden states 
+00010d60: 7573 696e 6720 6174 6f6d 2066 6561 7475  using atom featu
+00010d70: 7265 7320 616e 6420 6d65 7373 6167 6520  res and message 
+00010d80: 6869 6464 656e 2073 7461 7465 732e 0a20  hidden states.. 
+00010d90: 2020 2020 2020 202d 2047 6574 206d 6f6c         - Get mol
+00010da0: 6563 756c 6520 656e 636f 6469 6e67 732e  ecule encodings.
+00010db0: 0a20 2020 2020 2020 202d 2043 6f6e 6361  .        - Conca
+00010dc0: 7465 6e61 7465 2067 6c6f 6261 6c20 6d6f  tenate global mo
+00010dd0: 6c65 6375 6c61 7220 6665 6174 7572 6573  lecular features
+00010de0: 2061 6e64 206d 6f6c 6563 756c 6520 656e   and molecule en
+00010df0: 636f 6469 6e67 732e 0a0a 2020 2020 2020  codings...      
+00010e00: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00010e10: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00010e20: 2020 2020 2020 2020 6174 6f6d 5f66 6561          atom_fea
+00010e30: 7475 7265 733a 2074 6f72 6368 2e54 656e  tures: torch.Ten
+00010e40: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00010e50: 5465 6e73 6f72 2063 6f6e 7461 696e 696e  Tensor containin
+00010e60: 6720 6174 6f6d 7320 6665 6174 7572 6573  g atoms features
+00010e70: 2e0a 2020 2020 2020 2020 665f 696e 695f  ..        f_ini_
+00010e80: 6174 6f6d 735f 626f 6e64 733a 2074 6f72  atoms_bonds: tor
+00010e90: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00010ea0: 2020 2020 2020 5465 6e73 6f72 2063 6f6e        Tensor con
+00010eb0: 7461 696e 696e 6720 636f 6e63 6174 656e  taining concaten
+00010ec0: 6174 6564 2066 6561 7475 7265 2076 6563  ated feature vec
+00010ed0: 746f 7220 7768 6963 6820 636f 6e74 6169  tor which contai
+00010ee0: 6e73 2063 6f6e 6361 7465 6e61 7469 6f6e  ns concatenation
+00010ef0: 206f 6620 696e 6974 6961 6c20 6174 6f6d   of initial atom
+00010f00: 2061 6e64 2062 6f6e 6420 6665 6174 7572   and bond featur
+00010f10: 6573 2e0a 2020 2020 2020 2020 6174 6f6d  es..        atom
+00010f20: 5f74 6f5f 696e 636f 6d69 6e67 5f62 6f6e  _to_incoming_bon
+00010f30: 6473 3a20 746f 7263 682e 5465 6e73 6f72  ds: torch.Tensor
+00010f40: 0a20 2020 2020 2020 2020 2020 2054 656e  .            Ten
+00010f50: 736f 7220 636f 6e74 6169 6e69 6e67 206d  sor containing m
+00010f60: 6170 7069 6e67 2066 726f 6d20 6174 6f6d  apping from atom
+00010f70: 2069 6e64 6578 2074 6f20 6c69 7374 206f   index to list o
+00010f80: 6620 696e 6469 6369 6573 206f 6620 696e  f indicies of in
+00010f90: 636f 6d69 6e67 2062 6f6e 6473 2e0a 2020  coming bonds..  
+00010fa0: 2020 2020 2020 6d61 7070 696e 673a 2074        mapping: t
+00010fb0: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00010fc0: 2020 2020 2020 2020 5465 6e73 6f72 2063          Tensor c
+00010fd0: 6f6e 7461 696e 696e 6720 7468 6520 6d61  ontaining the ma
+00010fe0: 7070 696e 6720 7468 6174 206d 6170 7320  pping that maps 
+00010ff0: 626f 6e64 2069 6e64 6578 2074 6f20 2761  bond index to 'a
+00011000: 7272 6179 206f 6620 696e 6469 6365 7320  rray of indices 
+00011010: 6f66 2074 6865 2062 6f6e 6473 270a 2020  of the bonds'.  
+00011020: 2020 2020 2020 2020 2020 696e 636f 6d69            incomi
+00011030: 6e67 2061 7420 7468 6520 696e 6974 6961  ng at the initia
+00011040: 6c20 6174 6f6d 206f 6620 7468 6520 626f  l atom of the bo
+00011050: 6e64 2028 6578 636c 7564 696e 6720 7468  nd (excluding th
+00011060: 6520 7265 7665 7273 6520 626f 6e64 7329  e reverse bonds)
+00011070: 2e0a 2020 2020 2020 2020 676c 6f62 616c  ..        global
+00011080: 5f66 6561 7475 7265 733a 2074 6f72 6368  _features: torch
+00011090: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+000110a0: 2020 2020 5465 6e73 6f72 2063 6f6e 7461      Tensor conta
+000110b0: 696e 696e 6720 6d6f 6c65 6375 6c65 2066  ining molecule f
+000110c0: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
+000110d0: 206d 6f6c 6563 756c 6573 5f75 6e62 6174   molecules_unbat
+000110e0: 6368 5f6b 6579 3a20 4c69 7374 0a20 2020  ch_key: List.   
+000110f0: 2020 2020 2020 2020 204c 6973 7420 636f           List co
+00011100: 6e74 6169 6e69 6e67 206e 756d 6265 7220  ntaining number 
+00011110: 6f66 2061 746f 6d73 2069 6e20 7661 7269  of atoms in vari
+00011120: 6f75 7320 6d6f 6c65 6375 6c65 7320 6f66  ous molecules of
+00011130: 2061 2062 6174 6368 0a0a 2020 2020 2020   a batch..      
+00011140: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00011150: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00011160: 2020 6f75 7470 7574 3a20 746f 7263 682e    output: torch.
+00011170: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00011180: 2020 2054 656e 736f 7220 636f 6e74 6169     Tensor contai
+00011190: 6e69 6e67 2074 6865 2065 6e63 6f64 696e  ning the encodin
+000111a0: 6773 206f 6620 7468 6520 6d6f 6c65 6375  gs of the molecu
+000111b0: 6c65 732e 0a20 2020 2020 2020 2022 2222  les..        """
+000111c0: 0a20 2020 2020 2020 2069 6e70 7574 3a20  .        input: 
+000111d0: 746f 7263 682e 5465 6e73 6f72 203d 2073  torch.Tensor = s
+000111e0: 656c 662e 575f 6928 0a20 2020 2020 2020  elf.W_i(.       
+000111f0: 2020 2020 2066 5f69 6e69 5f61 746f 6d73       f_ini_atoms
+00011200: 5f62 6f6e 6473 2920 2023 206e 756d 5f62  _bonds)  # num_b
+00011210: 6f6e 6473 2078 2068 6964 6465 6e5f 7369  onds x hidden_si
+00011220: 7a65 0a20 2020 2020 2020 206d 6573 7361  ze.        messa
+00011230: 6765 3a20 746f 7263 682e 5465 6e73 6f72  ge: torch.Tensor
+00011240: 203d 2073 656c 662e 6163 7469 7661 7469   = self.activati
+00011250: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00011260: 696e 7075 7429 2020 2320 6e75 6d5f 626f  input)  # num_bo
+00011270: 6e64 7320 7820 6869 6464 656e 5f73 697a  nds x hidden_siz
+00011280: 650a 0a20 2020 2020 2020 2066 6f72 205f  e..        for _
+00011290: 2069 6e20 7261 6e67 6528 312c 2073 656c   in range(1, sel
+000112a0: 662e 6465 7074 6829 3a0a 2020 2020 2020  f.depth):.      
+000112b0: 2020 2020 2020 6d65 7373 6167 6520 3d20        message = 
+000112c0: 6d65 7373 6167 655b 6d61 7070 696e 675d  message[mapping]
+000112d0: 2e73 756d 2831 2920 2023 206e 756d 5f62  .sum(1)  # num_b
+000112e0: 6f6e 6473 2078 2068 6964 6465 6e5f 7369  onds x hidden_si
+000112f0: 7a65 0a20 2020 2020 2020 2020 2020 2068  ze.            h
+00011300: 5f6d 6573 7361 6765 3a20 746f 7263 682e  _message: torch.
+00011310: 5465 6e73 6f72 203d 2069 6e70 7574 202b  Tensor = input +
+00011320: 2073 656c 662e 575f 6828 0a20 2020 2020   self.W_h(.     
+00011330: 2020 2020 2020 2020 2020 206d 6573 7361             messa
+00011340: 6765 2920 2023 206e 756d 5f62 6f6e 6473  ge)  # num_bonds
+00011350: 2078 2068 6964 6465 6e5f 7369 7a65 0a20   x hidden_size. 
+00011360: 2020 2020 2020 2020 2020 2068 5f6d 6573             h_mes
+00011370: 7361 6765 203d 2073 656c 662e 6163 7469  sage = self.acti
+00011380: 7661 7469 6f6e 2868 5f6d 6573 7361 6765  vation(h_message
+00011390: 2920 2023 206e 756d 5f62 6f6e 6473 2078  )  # num_bonds x
+000113a0: 2068 6964 6465 6e5f 7369 7a65 0a20 2020   hidden_size.   
+000113b0: 2020 2020 2020 2020 2068 5f6d 6573 7361           h_messa
+000113c0: 6765 203d 2073 656c 662e 6472 6f70 6f75  ge = self.dropou
+000113d0: 7428 685f 6d65 7373 6167 6529 2020 2320  t(h_message)  # 
+000113e0: 6e75 6d5f 626f 6e64 7320 7820 6869 6464  num_bonds x hidd
+000113f0: 656e 5f73 697a 650a 0a20 2020 2020 2020  en_size..       
+00011400: 2023 206e 756d 5f61 746f 6d73 2078 2068   # num_atoms x h
+00011410: 6964 6465 6e5f 7369 7a65 0a20 2020 2020  idden_size.     
+00011420: 2020 2061 746f 6d73 5f68 6964 6465 6e5f     atoms_hidden_
+00011430: 7374 6174 6573 3a20 746f 7263 682e 5465  states: torch.Te
+00011440: 6e73 6f72 203d 2073 656c 662e 5f67 6574  nsor = self._get
+00011450: 5f75 7064 6174 6564 5f61 746f 6d73 5f68  _updated_atoms_h
+00011460: 6964 6465 6e5f 7374 6174 6528 0a20 2020  idden_state(.   
+00011470: 2020 2020 2020 2020 2061 746f 6d5f 6665           atom_fe
+00011480: 6174 7572 6573 2c20 685f 6d65 7373 6167  atures, h_messag
+00011490: 652c 2061 746f 6d5f 746f 5f69 6e63 6f6d  e, atom_to_incom
+000114a0: 696e 675f 626f 6e64 7329 0a0a 2020 2020  ing_bonds)..    
+000114b0: 2020 2020 2320 6e75 6d5f 6d6f 6c65 6375      # num_molecu
+000114c0: 6c65 7320 7820 6869 6464 656e 5f73 697a  les x hidden_siz
+000114d0: 650a 2020 2020 2020 2020 6f75 7470 7574  e.        output
+000114e0: 3a20 746f 7263 682e 5465 6e73 6f72 203d  : torch.Tensor =
+000114f0: 2073 656c 662e 5f72 6561 646f 7574 2861   self._readout(a
+00011500: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
+00011510: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
 00011520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011530: 2020 2020 6d6f 6c65 6375 6c65 735f 756e      molecules_un
-00011540: 6261 7463 685f 6b65 7929 0a0a 2020 2020  batch_key)..    
-00011550: 2020 2020 2320 636f 6e63 6174 2067 6c6f      # concat glo
-00011560: 6261 6c20 6665 6174 7572 6573 0a20 2020  bal features.   
-00011570: 2020 2020 2069 6620 676c 6f62 616c 5f66       if global_f
-00011580: 6561 7475 7265 732e 7369 7a65 2829 5b30  eatures.size()[0
-00011590: 5d20 213d 2030 3a0a 2020 2020 2020 2020  ] != 0:.        
-000115a0: 2020 2020 6966 206c 656e 2867 6c6f 6261      if len(globa
-000115b0: 6c5f 6665 6174 7572 6573 2e73 6861 7065  l_features.shape
-000115c0: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
-000115d0: 2020 2020 2020 2020 676c 6f62 616c 5f66          global_f
-000115e0: 6561 7475 7265 7320 3d20 676c 6f62 616c  eatures = global
-000115f0: 5f66 6561 7475 7265 732e 7669 6577 286c  _features.view(l
-00011600: 656e 286f 7574 7075 7429 2c20 2d31 290a  en(output), -1).
-00011610: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-00011620: 7574 203d 2074 6f72 6368 2e63 6174 285b  ut = torch.cat([
-00011630: 6f75 7470 7574 2c20 676c 6f62 616c 5f66  output, global_f
-00011640: 6561 7475 7265 735d 2c20 6469 6d3d 3129  eatures], dim=1)
-00011650: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00011660: 206f 7574 7075 7420 2023 206e 756d 5f6d   output  # num_m
-00011670: 6f6c 6563 756c 6573 2078 2068 6964 6465  olecules x hidde
-00011680: 6e5f 7369 7a65 0a0a 0a63 6c61 7373 2049  n_size...class I
-00011690: 6e74 6572 6174 6f6d 6963 4c32 4469 7374  nteratomicL2Dist
-000116a0: 616e 6365 7328 6e6e 2e4d 6f64 756c 6529  ances(nn.Module)
-000116b0: 3a0a 2020 2020 2222 2243 6f6d 7075 7465  :.    """Compute
-000116c0: 2028 7371 7561 7265 6429 204c 3220 4469   (squared) L2 Di
-000116d0: 7374 616e 6365 7320 6265 7477 6565 6e20  stances between 
-000116e0: 6174 6f6d 7320 6769 7665 6e20 6e65 6967  atoms given neig
-000116f0: 6862 6f72 732e 0a0a 2020 2020 5468 6973  hbors...    This
-00011700: 2063 6c61 7373 2069 7320 7468 6520 7079   class is the py
-00011710: 746f 7263 6820 696d 706c 656d 656e 7461  torch implementa
-00011720: 7469 6f6e 206f 6620 7468 6520 6f72 6967  tion of the orig
-00011730: 696e 616c 2049 6e74 6572 6174 6f6d 6963  inal Interatomic
-00011740: 4c32 4469 7374 616e 6365 7320 6c61 7965  L2Distances laye
-00011750: 7220 696d 706c 656d 656e 7465 6420 696e  r implemented in
-00011760: 204b 6572 6173 2e0a 2020 2020 5061 6972   Keras..    Pair
-00011770: 7769 7365 2064 6973 7461 6e63 6520 284c  wise distance (L
-00011780: 3229 2069 7320 6361 6c63 756c 6174 6564  2) is calculated
-00011790: 2062 6574 7765 656e 2069 6e70 7574 2061   between input a
-000117a0: 746f 6d73 2c20 6769 7665 6e20 7468 6520  toms, given the 
-000117b0: 6e75 6d62 6572 206f 6620 6e65 6967 6862  number of neighb
-000117c0: 6f72 7320 746f 2063 6f6e 7369 6465 722c  ors to consider,
-000117d0: 2061 6c6f 6e67 2077 6974 6820 7468 6520   along with the 
-000117e0: 6e75 6d62 6572 206f 6620 6465 7363 7269  number of descri
-000117f0: 7074 6f72 7320 666f 7220 6576 6572 7920  ptors for every 
-00011800: 6174 6f6d 2e0a 0a20 2020 2045 7861 6d70  atom...    Examp
-00011810: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-00011820: 0a20 2020 203e 3e3e 2061 746f 6d73 203d  .    >>> atoms =
-00011830: 2035 0a20 2020 203e 3e3e 206e 6569 6768   5.    >>> neigh
-00011840: 626f 7273 203d 2032 0a20 2020 203e 3e3e  bors = 2.    >>>
-00011850: 2063 6f6f 7264 7320 3d20 6e70 2e72 616e   coords = np.ran
-00011860: 646f 6d2e 7261 6e64 2861 746f 6d73 2c20  dom.rand(atoms, 
-00011870: 3329 0a20 2020 203e 3e3e 206e 6569 6768  3).    >>> neigh
-00011880: 626f 725f 6c69 7374 203d 206e 702e 7261  bor_list = np.ra
-00011890: 6e64 6f6d 2e72 616e 6469 6e74 2830 2c20  ndom.randint(0, 
-000118a0: 6174 6f6d 732c 2073 697a 653d 2861 746f  atoms, size=(ato
-000118b0: 6d73 2c20 6e65 6967 6862 6f72 7329 290a  ms, neighbors)).
-000118c0: 2020 2020 3e3e 3e20 6c61 7965 7220 3d20      >>> layer = 
-000118d0: 496e 7465 7261 746f 6d69 634c 3244 6973  InteratomicL2Dis
-000118e0: 7461 6e63 6573 2861 746f 6d73 2c20 6e65  tances(atoms, ne
-000118f0: 6967 6862 6f72 732c 2033 290a 2020 2020  ighbors, 3).    
-00011900: 3e3e 3e20 7265 7375 6c74 203d 206e 702e  >>> result = np.
-00011910: 6172 7261 7928 6c61 7965 7228 5b63 6f6f  array(layer([coo
-00011920: 7264 732c 206e 6569 6768 626f 725f 6c69  rds, neighbor_li
-00011930: 7374 5d29 290a 2020 2020 3e3e 3e20 7265  st])).    >>> re
-00011940: 7375 6c74 2e73 6861 7065 0a20 2020 2028  sult.shape.    (
-00011950: 352c 2032 290a 0a20 2020 2022 2222 0a0a  5, 2)..    """..
-00011960: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00011970: 2873 656c 662c 204e 5f61 746f 6d73 3a20  (self, N_atoms: 
-00011980: 696e 742c 204d 5f6e 6272 733a 2069 6e74  int, M_nbrs: int
-00011990: 2c20 6e64 696d 3a20 696e 742c 202a 2a6b  , ndim: int, **k
-000119a0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-000119b0: 2222 2243 6f6e 7374 7275 6374 6f72 2066  """Constructor f
-000119c0: 6f72 2074 6869 7320 6c61 7965 722e 0a0a  or this layer...
-000119d0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-000119e0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-000119f0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4e5f  -----.        N_
-00011a00: 6174 6f6d 733a 2069 6e74 0a20 2020 2020  atoms: int.     
-00011a10: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-00011a20: 2061 746f 6d73 2069 6e20 7468 6520 7379   atoms in the sy
-00011a30: 7374 656d 2074 6f74 616c 2e0a 2020 2020  stem total..    
-00011a40: 2020 2020 4d5f 6e62 7273 3a20 696e 740a      M_nbrs: int.
-00011a50: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
-00011a60: 6572 206f 6620 6e65 6967 6862 6f72 7320  er of neighbors 
-00011a70: 746f 2063 6f6e 7369 6465 7220 7768 656e  to consider when
-00011a80: 2063 6f6d 7075 7469 6e67 2064 6973 7461   computing dista
-00011a90: 6e63 6573 2e0a 2020 2020 2020 2020 6e5f  nces..        n_
-00011aa0: 6469 6d3a 2020 696e 740a 2020 2020 2020  dim:  int.      
-00011ab0: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
-00011ac0: 6465 7363 7269 7074 6f72 7320 666f 7220  descriptors for 
-00011ad0: 6561 6368 2061 746f 6d2e 0a20 2020 2020  each atom..     
-00011ae0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-00011af0: 7570 6572 2849 6e74 6572 6174 6f6d 6963  uper(Interatomic
-00011b00: 4c32 4469 7374 616e 6365 732c 2073 656c  L2Distances, sel
-00011b10: 6629 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  f).__init__(**kw
-00011b20: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
-00011b30: 6c66 2e4e 5f61 746f 6d73 203d 204e 5f61  lf.N_atoms = N_a
-00011b40: 746f 6d73 0a20 2020 2020 2020 2073 656c  toms.        sel
-00011b50: 662e 4d5f 6e62 7273 203d 204d 5f6e 6272  f.M_nbrs = M_nbr
-00011b60: 730a 2020 2020 2020 2020 7365 6c66 2e6e  s.        self.n
-00011b70: 6469 6d20 3d20 6e64 696d 0a0a 2020 2020  dim = ndim..    
-00011b80: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
-00011b90: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
-00011ba0: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
-00011bb0: 2020 2020 2020 2020 6627 7b73 656c 662e          f'{self.
-00011bc0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00011bd0: 5f5f 7d28 4e5f 6174 6f6d 733d 7b73 656c  __}(N_atoms={sel
-00011be0: 662e 4e5f 6174 6f6d 737d 2c20 4d5f 6e62  f.N_atoms}, M_nb
-00011bf0: 7273 3d7b 7365 6c66 2e4d 5f6e 6272 737d  rs={self.M_nbrs}
-00011c00: 2c20 6e64 696d 3d7b 7365 6c66 2e6e 6469  , ndim={self.ndi
-00011c10: 6d7d 2927 0a20 2020 2020 2020 2029 0a0a  m})'.        )..
-00011c20: 2020 2020 6465 6620 666f 7277 6172 6428      def forward(
-00011c30: 0a20 2020 2020 2020 2073 656c 662c 2069  .        self, i
-00011c40: 6e70 7574 733a 204c 6973 745b 556e 696f  nputs: List[Unio
-00011c50: 6e5b 746f 7263 682e 5465 6e73 6f72 2c0a  n[torch.Tensor,.
-00011c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011540: 206d 6f6c 6563 756c 6573 5f75 6e62 6174   molecules_unbat
+00011550: 6368 5f6b 6579 290a 0a20 2020 2020 2020  ch_key)..       
+00011560: 2023 2063 6f6e 6361 7420 676c 6f62 616c   # concat global
+00011570: 2066 6561 7475 7265 730a 2020 2020 2020   features.      
+00011580: 2020 6966 2067 6c6f 6261 6c5f 6665 6174    if global_feat
+00011590: 7572 6573 2e73 697a 6528 295b 305d 2021  ures.size()[0] !
+000115a0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+000115b0: 2069 6620 6c65 6e28 676c 6f62 616c 5f66   if len(global_f
+000115c0: 6561 7475 7265 732e 7368 6170 6529 203d  eatures.shape) =
+000115d0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+000115e0: 2020 2020 2067 6c6f 6261 6c5f 6665 6174       global_feat
+000115f0: 7572 6573 203d 2067 6c6f 6261 6c5f 6665  ures = global_fe
+00011600: 6174 7572 6573 2e76 6965 7728 6c65 6e28  atures.view(len(
+00011610: 6f75 7470 7574 292c 202d 3129 0a20 2020  output), -1).   
+00011620: 2020 2020 2020 2020 206f 7574 7075 7420           output 
+00011630: 3d20 746f 7263 682e 6361 7428 5b6f 7574  = torch.cat([out
+00011640: 7075 742c 2067 6c6f 6261 6c5f 6665 6174  put, global_feat
+00011650: 7572 6573 5d2c 2064 696d 3d31 290a 0a20  ures], dim=1).. 
+00011660: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
+00011670: 7470 7574 2020 2320 6e75 6d5f 6d6f 6c65  tput  # num_mole
+00011680: 6375 6c65 7320 7820 6869 6464 656e 5f73  cules x hidden_s
+00011690: 697a 650a 0a0a 636c 6173 7320 496e 7465  ize...class Inte
+000116a0: 7261 746f 6d69 634c 3244 6973 7461 6e63  ratomicL2Distanc
+000116b0: 6573 286e 6e2e 4d6f 6475 6c65 293a 0a20  es(nn.Module):. 
+000116c0: 2020 2022 2222 436f 6d70 7574 6520 2873     """Compute (s
+000116d0: 7175 6172 6564 2920 4c32 2044 6973 7461  quared) L2 Dista
+000116e0: 6e63 6573 2062 6574 7765 656e 2061 746f  nces between ato
+000116f0: 6d73 2067 6976 656e 206e 6569 6768 626f  ms given neighbo
+00011700: 7273 2e0a 0a20 2020 2054 6869 7320 636c  rs...    This cl
+00011710: 6173 7320 6973 2074 6865 2070 7974 6f72  ass is the pytor
+00011720: 6368 2069 6d70 6c65 6d65 6e74 6174 696f  ch implementatio
+00011730: 6e20 6f66 2074 6865 206f 7269 6769 6e61  n of the origina
+00011740: 6c20 496e 7465 7261 746f 6d69 634c 3244  l InteratomicL2D
+00011750: 6973 7461 6e63 6573 206c 6179 6572 2069  istances layer i
+00011760: 6d70 6c65 6d65 6e74 6564 2069 6e20 4b65  mplemented in Ke
+00011770: 7261 732e 0a20 2020 2050 6169 7277 6973  ras..    Pairwis
+00011780: 6520 6469 7374 616e 6365 2028 4c32 2920  e distance (L2) 
+00011790: 6973 2063 616c 6375 6c61 7465 6420 6265  is calculated be
+000117a0: 7477 6565 6e20 696e 7075 7420 6174 6f6d  tween input atom
+000117b0: 732c 2067 6976 656e 2074 6865 206e 756d  s, given the num
+000117c0: 6265 7220 6f66 206e 6569 6768 626f 7273  ber of neighbors
+000117d0: 2074 6f20 636f 6e73 6964 6572 2c20 616c   to consider, al
+000117e0: 6f6e 6720 7769 7468 2074 6865 206e 756d  ong with the num
+000117f0: 6265 7220 6f66 2064 6573 6372 6970 746f  ber of descripto
+00011800: 7273 2066 6f72 2065 7665 7279 2061 746f  rs for every ato
+00011810: 6d2e 0a0a 2020 2020 4578 616d 706c 6573  m...    Examples
+00011820: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+00011830: 2020 3e3e 3e20 6174 6f6d 7320 3d20 350a    >>> atoms = 5.
+00011840: 2020 2020 3e3e 3e20 6e65 6967 6862 6f72      >>> neighbor
+00011850: 7320 3d20 320a 2020 2020 3e3e 3e20 636f  s = 2.    >>> co
+00011860: 6f72 6473 203d 206e 702e 7261 6e64 6f6d  ords = np.random
+00011870: 2e72 616e 6428 6174 6f6d 732c 2033 290a  .rand(atoms, 3).
+00011880: 2020 2020 3e3e 3e20 6e65 6967 6862 6f72      >>> neighbor
+00011890: 5f6c 6973 7420 3d20 6e70 2e72 616e 646f  _list = np.rando
+000118a0: 6d2e 7261 6e64 696e 7428 302c 2061 746f  m.randint(0, ato
+000118b0: 6d73 2c20 7369 7a65 3d28 6174 6f6d 732c  ms, size=(atoms,
+000118c0: 206e 6569 6768 626f 7273 2929 0a20 2020   neighbors)).   
+000118d0: 203e 3e3e 206c 6179 6572 203d 2049 6e74   >>> layer = Int
+000118e0: 6572 6174 6f6d 6963 4c32 4469 7374 616e  eratomicL2Distan
+000118f0: 6365 7328 6174 6f6d 732c 206e 6569 6768  ces(atoms, neigh
+00011900: 626f 7273 2c20 3329 0a20 2020 203e 3e3e  bors, 3).    >>>
+00011910: 2072 6573 756c 7420 3d20 6e70 2e61 7272   result = np.arr
+00011920: 6179 286c 6179 6572 285b 636f 6f72 6473  ay(layer([coords
+00011930: 2c20 6e65 6967 6862 6f72 5f6c 6973 745d  , neighbor_list]
+00011940: 2929 0a20 2020 203e 3e3e 2072 6573 756c  )).    >>> resul
+00011950: 742e 7368 6170 650a 2020 2020 2835 2c20  t.shape.    (5, 
+00011960: 3229 0a0a 2020 2020 2222 220a 0a20 2020  2)..    """..   
+00011970: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00011980: 6c66 2c20 4e5f 6174 6f6d 733a 2069 6e74  lf, N_atoms: int
+00011990: 2c20 4d5f 6e62 7273 3a20 696e 742c 206e  , M_nbrs: int, n
+000119a0: 6469 6d3a 2069 6e74 2c20 2a2a 6b77 6172  dim: int, **kwar
+000119b0: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
+000119c0: 436f 6e73 7472 7563 746f 7220 666f 7220  Constructor for 
+000119d0: 7468 6973 206c 6179 6572 2e0a 0a20 2020  this layer...   
+000119e0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+000119f0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00011a00: 2d2d 0a20 2020 2020 2020 204e 5f61 746f  --.        N_ato
+00011a10: 6d73 3a20 696e 740a 2020 2020 2020 2020  ms: int.        
+00011a20: 2020 2020 4e75 6d62 6572 206f 6620 6174      Number of at
+00011a30: 6f6d 7320 696e 2074 6865 2073 7973 7465  oms in the syste
+00011a40: 6d20 746f 7461 6c2e 0a20 2020 2020 2020  m total..       
+00011a50: 204d 5f6e 6272 733a 2069 6e74 0a20 2020   M_nbrs: int.   
+00011a60: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
+00011a70: 6f66 206e 6569 6768 626f 7273 2074 6f20  of neighbors to 
+00011a80: 636f 6e73 6964 6572 2077 6865 6e20 636f  consider when co
+00011a90: 6d70 7574 696e 6720 6469 7374 616e 6365  mputing distance
+00011aa0: 732e 0a20 2020 2020 2020 206e 5f64 696d  s..        n_dim
+00011ab0: 3a20 2069 6e74 0a20 2020 2020 2020 2020  :  int.         
+00011ac0: 2020 204e 756d 6265 7220 6f66 2064 6573     Number of des
+00011ad0: 6372 6970 746f 7273 2066 6f72 2065 6163  criptors for eac
+00011ae0: 6820 6174 6f6d 2e0a 2020 2020 2020 2020  h atom..        
+00011af0: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
+00011b00: 7228 496e 7465 7261 746f 6d69 634c 3244  r(InteratomicL2D
+00011b10: 6973 7461 6e63 6573 2c20 7365 6c66 292e  istances, self).
+00011b20: 5f5f 696e 6974 5f5f 282a 2a6b 7761 7267  __init__(**kwarg
+00011b30: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+00011b40: 4e5f 6174 6f6d 7320 3d20 4e5f 6174 6f6d  N_atoms = N_atom
+00011b50: 730a 2020 2020 2020 2020 7365 6c66 2e4d  s.        self.M
+00011b60: 5f6e 6272 7320 3d20 4d5f 6e62 7273 0a20  _nbrs = M_nbrs. 
+00011b70: 2020 2020 2020 2073 656c 662e 6e64 696d         self.ndim
+00011b80: 203d 206e 6469 6d0a 0a20 2020 2064 6566   = ndim..    def
+00011b90: 205f 5f72 6570 725f 5f28 7365 6c66 2920   __repr__(self) 
+00011ba0: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+00011bb0: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
+00011bc0: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
+00011bd0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00011be0: 284e 5f61 746f 6d73 3d7b 7365 6c66 2e4e  (N_atoms={self.N
+00011bf0: 5f61 746f 6d73 7d2c 204d 5f6e 6272 733d  _atoms}, M_nbrs=
+00011c00: 7b73 656c 662e 4d5f 6e62 7273 7d2c 206e  {self.M_nbrs}, n
+00011c10: 6469 6d3d 7b73 656c 662e 6e64 696d 7d29  dim={self.ndim})
+00011c20: 270a 2020 2020 2020 2020 290a 0a20 2020  '.        )..   
+00011c30: 2064 6566 2066 6f72 7761 7264 280a 2020   def forward(.  
+00011c40: 2020 2020 2020 7365 6c66 2c20 696e 7075        self, inpu
+00011c50: 7473 3a20 4c69 7374 5b55 6e69 6f6e 5b74  ts: List[Union[t
+00011c60: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
 00011c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c80: 204c 6973 745b 556e 696f 6e5b 696e 742c   List[Union[int,
-00011c90: 2066 6c6f 6174 5d5d 5d5d 2920 2d3e 2074   float]]]]) -> t
-00011ca0: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
-00011cb0: 2020 2020 2022 2222 496e 766f 6b65 7320       """Invokes 
-00011cc0: 7468 6973 206c 6179 6572 2e0a 0a20 2020  this layer...   
-00011cd0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00011ce0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00011cf0: 2d2d 0a20 2020 2020 2020 2069 6e70 7574  --.        input
-00011d00: 733a 206c 6973 740a 2020 2020 2020 2020  s: list.        
-00011d10: 2020 2020 5368 6f75 6c64 2062 6520 6f66      Should be of
-00011d20: 2066 6f72 6d20 6069 6e70 7574 733d 5b63   form `inputs=[c
-00011d30: 6f6f 7264 732c 206e 6272 5f6c 6973 745d  oords, nbr_list]
-00011d40: 6020 7768 6572 6520 6063 6f6f 7264 7360  ` where `coords`
-00011d50: 2069 7320 610a 2020 2020 2020 2020 2020   is a.          
-00011d60: 2020 7465 6e73 6f72 206f 6620 7368 6170    tensor of shap
-00011d70: 6520 6028 4e6f 6e65 2c20 4e2c 2033 2960  e `(None, N, 3)`
-00011d80: 2061 6e64 2060 6e62 725f 6c69 7374 6020   and `nbr_list` 
-00011d90: 6973 2061 206c 6973 742e 0a0a 2020 2020  is a list...    
-00011da0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00011db0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00011dc0: 2020 2020 5465 6e73 6f72 206f 6620 7368      Tensor of sh
-00011dd0: 6170 6520 6028 4e5f 6174 6f6d 732c 204d  ape `(N_atoms, M
-00011de0: 5f6e 6272 7329 6020 7769 7468 2069 6e74  _nbrs)` with int
-00011df0: 6572 6174 6f6d 6963 2064 6973 7461 6e63  eratomic distanc
-00011e00: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
-00011e10: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
-00011e20: 6e70 7574 7329 2021 3d20 323a 0a20 2020  nputs) != 2:.   
-00011e30: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00011e40: 616c 7565 4572 726f 7228 2249 6e74 6572  alueError("Inter
-00011e50: 6174 6f6d 6963 4469 7374 616e 6365 7320  atomicDistances 
-00011e60: 7265 7175 6972 6573 2063 6f6f 7264 732c  requires coords,
-00011e70: 6e62 725f 6c69 7374 2229 0a20 2020 2020  nbr_list").     
-00011e80: 2020 2063 6f6f 7264 732c 206e 6272 5f6c     coords, nbr_l
-00011e90: 6973 7420 3d20 2874 6f72 6368 2e74 656e  ist = (torch.ten
-00011ea0: 736f 7228 696e 7075 7473 5b30 5d29 2c20  sor(inputs[0]), 
-00011eb0: 746f 7263 682e 7465 6e73 6f72 2869 6e70  torch.tensor(inp
-00011ec0: 7574 735b 315d 2929 0a20 2020 2020 2020  uts[1])).       
-00011ed0: 204e 5f61 746f 6d73 2c20 4d5f 6e62 7273   N_atoms, M_nbrs
-00011ee0: 2c20 6e64 696d 203d 2073 656c 662e 4e5f  , ndim = self.N_
-00011ef0: 6174 6f6d 732c 2073 656c 662e 4d5f 6e62  atoms, self.M_nb
-00011f00: 7273 2c20 7365 6c66 2e6e 6469 6d0a 2020  rs, self.ndim.  
-00011f10: 2020 2020 2020 2320 5368 6170 6520 284e        # Shape (N
-00011f20: 5f61 746f 6d73 2c20 4d5f 6e62 7273 2c20  _atoms, M_nbrs, 
-00011f30: 6e64 696d 290a 2020 2020 2020 2020 6e62  ndim).        nb
-00011f40: 725f 636f 6f72 6473 203d 2063 6f6f 7264  r_coords = coord
-00011f50: 735b 6e62 725f 6c69 7374 2e6c 6f6e 6728  s[nbr_list.long(
-00011f60: 295d 0a20 2020 2020 2020 2023 2053 6861  )].        # Sha
-00011f70: 7065 2028 4e5f 6174 6f6d 732c 204d 5f6e  pe (N_atoms, M_n
-00011f80: 6272 732c 206e 6469 6d29 0a20 2020 2020  brs, ndim).     
-00011f90: 2020 2074 696c 6564 5f63 6f6f 7264 7320     tiled_coords 
-00011fa0: 3d20 746f 7263 682e 7469 6c65 2874 6f72  = torch.tile(tor
-00011fb0: 6368 2e72 6573 6861 7065 2863 6f6f 7264  ch.reshape(coord
-00011fc0: 732c 2028 4e5f 6174 6f6d 732c 2031 2c20  s, (N_atoms, 1, 
-00011fd0: 6e64 696d 2929 2c0a 2020 2020 2020 2020  ndim)),.        
-00011fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ff0: 2020 2020 2020 2020 2020 2831 2c20 4d5f            (1, M_
-00012000: 6e62 7273 2c20 3129 290a 2020 2020 2020  nbrs, 1)).      
-00012010: 2020 2320 5368 6170 6520 284e 5f61 746f    # Shape (N_ato
-00012020: 6d73 2c20 4d5f 6e62 7273 290a 2020 2020  ms, M_nbrs).    
-00012030: 2020 2020 7265 7475 726e 2074 6f72 6368      return torch
-00012040: 2e73 756d 2828 7469 6c65 645f 636f 6f72  .sum((tiled_coor
-00012050: 6473 202d 206e 6272 5f63 6f6f 7264 7329  ds - nbr_coords)
-00012060: 2a2a 322c 2064 696d 3d32 290a 0a0a 636c  **2, dim=2)...cl
-00012070: 6173 7320 5265 616c 4e56 504c 6179 6572  ass RealNVPLayer
-00012080: 286e 6e2e 4d6f 6475 6c65 293a 0a20 2020  (nn.Module):.   
-00012090: 2022 2222 5265 616c 204e 5650 2054 7261   """Real NVP Tra
-000120a0: 6e73 666f 726d 6174 696f 6e20 4c61 7965  nsformation Laye
-000120b0: 720a 0a20 2020 2054 6869 7320 636c 6173  r..    This clas
-000120c0: 7320 636c 6173 7320 6973 2061 2063 6f6e  s class is a con
-000120d0: 7374 7275 6374 6f72 2074 7261 6e73 666f  structor transfo
-000120e0: 726d 6174 696f 6e20 6c61 7965 7220 7573  rmation layer us
-000120f0: 6564 206f 6e20 610a 2020 2020 4e6f 726d  ed on a.    Norm
-00012100: 616c 697a 696e 6746 4c6f 7720 6d6f 6465  alizingFLow mode
-00012110: 6c2e 2020 5468 6520 5265 616c 204e 6f6e  l.  The Real Non
-00012120: 2d50 7265 7365 7276 696e 672d 566f 6c75  -Preserving-Volu
-00012130: 6d65 6e20 2852 6561 6c20 4e56 5029 2069  men (Real NVP) i
-00012140: 7320 6120 7479 7065 0a20 2020 206f 6620  s a type.    of 
-00012150: 6e6f 726d 616c 697a 696e 6720 666c 6f77  normalizing flow
-00012160: 206c 6179 6572 2077 6869 6368 2067 6976   layer which giv
-00012170: 6573 2061 6476 616e 7461 6765 7320 6f76  es advantages ov
-00012180: 6572 2074 6869 7320 6d61 696e 6c79 2062  er this mainly b
-00012190: 6563 6175 7365 2061 6e0a 2020 2020 6561  ecause an.    ea
-000121a0: 7365 2074 6f20 636f 6d70 7574 6520 7468  se to compute th
-000121b0: 6520 696e 7665 7273 6520 7061 7373 205b  e inverse pass [
-000121c0: 315d 5f2c 2074 6869 7320 6973 2074 6f20  1]_, this is to 
-000121d0: 6c65 6172 6e20 6120 7461 7267 6574 0a20  learn a target. 
-000121e0: 2020 2064 6973 7472 6962 7574 696f 6e2e     distribution.
-000121f0: 0a0a 2020 2020 4578 616d 706c 650a 2020  ..    Example.  
-00012200: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e    -------.    >>
-00012210: 3e20 696d 706f 7274 2074 6f72 6368 0a20  > import torch. 
-00012220: 2020 203e 3e3e 2069 6d70 6f72 7420 746f     >>> import to
-00012230: 7263 682e 6e6e 2061 7320 6e6e 0a20 2020  rch.nn as nn.   
-00012240: 203e 3e3e 2066 726f 6d20 746f 7263 682e   >>> from torch.
-00012250: 6469 7374 7269 6275 7469 6f6e 7320 696d  distributions im
-00012260: 706f 7274 204d 756c 7469 7661 7269 6174  port Multivariat
-00012270: 654e 6f72 6d61 6c0a 2020 2020 3e3e 3e20  eNormal.    >>> 
-00012280: 6672 6f6d 2064 6565 7063 6865 6d2e 6d6f  from deepchem.mo
-00012290: 6465 6c73 2e74 6f72 6368 5f6d 6f64 656c  dels.torch_model
-000122a0: 732e 6c61 7965 7273 2069 6d70 6f72 7420  s.layers import 
-000122b0: 5265 616c 4e56 504c 6179 6572 0a20 2020  RealNVPLayer.   
-000122c0: 203e 3e3e 2064 696d 203d 2032 0a20 2020   >>> dim = 2.   
-000122d0: 203e 3e3e 2073 616d 706c 6573 203d 2039   >>> samples = 9
-000122e0: 360a 2020 2020 3e3e 3e20 6461 7461 203d  6.    >>> data =
-000122f0: 204d 756c 7469 7661 7269 6174 654e 6f72   MultivariateNor
-00012300: 6d61 6c28 746f 7263 682e 7a65 726f 7328  mal(torch.zeros(
-00012310: 6469 6d29 2c20 746f 7263 682e 6579 6528  dim), torch.eye(
-00012320: 6469 6d29 290a 2020 2020 3e3e 3e20 7465  dim)).    >>> te
-00012330: 6e73 6f72 203d 2064 6174 612e 7361 6d70  nsor = data.samp
-00012340: 6c65 2874 6f72 6368 2e53 697a 6528 2873  le(torch.Size((s
-00012350: 616d 706c 6573 2c20 6469 6d29 2929 0a0a  amples, dim)))..
-00012360: 2020 2020 3e3e 3e20 6c61 7965 7273 203d      >>> layers =
-00012370: 2034 0a20 2020 203e 3e3e 2068 6964 6465   4.    >>> hidde
-00012380: 6e5f 7369 7a65 203d 2031 360a 2020 2020  n_size = 16.    
-00012390: 3e3e 3e20 6d61 736b 7320 3d20 462e 6f6e  >>> masks = F.on
-000123a0: 655f 686f 7428 746f 7263 682e 7465 6e73  e_hot(torch.tens
-000123b0: 6f72 285b 6920 2520 3220 666f 7220 6920  or([i % 2 for i 
-000123c0: 696e 2072 616e 6765 286c 6179 6572 7329  in range(layers)
-000123d0: 5d29 292e 666c 6f61 7428 290a 2020 2020  ])).float().    
-000123e0: 3e3e 3e20 6c61 7965 7273 203d 206e 6e2e  >>> layers = nn.
-000123f0: 4d6f 6475 6c65 4c69 7374 285b 5265 616c  ModuleList([Real
-00012400: 4e56 504c 6179 6572 286d 6173 6b2c 2068  NVPLayer(mask, h
-00012410: 6964 6465 6e5f 7369 7a65 2920 666f 7220  idden_size) for 
-00012420: 6d61 736b 2069 6e20 6d61 736b 735d 290a  mask in masks]).
-00012430: 0a20 2020 203e 3e3e 2066 6f72 206c 6179  .    >>> for lay
-00012440: 6572 2069 6e20 6c61 7965 7273 3a0a 2020  er in layers:.  
-00012450: 2020 2e2e 2e20 2020 5f2c 2069 6e76 6572    ...   _, inver
-00012460: 7365 5f6c 6f67 5f64 6574 5f6a 6163 6f62  se_log_det_jacob
-00012470: 6961 6e20 3d20 6c61 7965 722e 696e 7665  ian = layer.inve
-00012480: 7273 6528 7465 6e73 6f72 290a 2020 2020  rse(tensor).    
-00012490: 2e2e 2e20 2020 696e 7665 7273 655f 6c6f  ...   inverse_lo
-000124a0: 675f 6465 745f 6a61 636f 6269 616e 203d  g_det_jacobian =
-000124b0: 2069 6e76 6572 7365 5f6c 6f67 5f64 6574   inverse_log_det
-000124c0: 5f6a 6163 6f62 6961 6e2e 6465 7461 6368  _jacobian.detach
-000124d0: 2829 2e6e 756d 7079 2829 0a20 2020 203e  ().numpy().    >
-000124e0: 3e3e 206c 656e 2869 6e76 6572 7365 5f6c  >> len(inverse_l
-000124f0: 6f67 5f64 6574 5f6a 6163 6f62 6961 6e29  og_det_jacobian)
-00012500: 0a20 2020 2039 360a 0a20 2020 2052 6566  .    96..    Ref
-00012510: 6572 656e 6365 730a 2020 2020 2d2d 2d2d  erences.    ----
-00012520: 2d2d 2d2d 2d2d 0a20 2020 202e 2e20 5b31  ------.    .. [1
-00012530: 5d20 5374 696d 7065 722c 2056 2e2c 2053  ] Stimper, V., S
-00012540: 6368 c3b6 6c6b 6f70 662c 2042 2e2c 2026  ch..lkopf, B., &
-00012550: 2048 6572 6ec3 a16e 6465 7a2d 4c6f 6261   Hern..ndez-Loba
-00012560: 746f 2c20 4a2e 204d 2e20 2832 3032 3129  to, J. M. (2021)
-00012570: 2e20 5265 7361 6d70 6c69 6e67 2042 6173  . Resampling Bas
-00012580: 650a 2020 2020 4469 7374 7269 6275 7469  e.    Distributi
-00012590: 6f6e 7320 6f66 204e 6f72 6d61 6c69 7a69  ons of Normalizi
-000125a0: 6e67 2046 6c6f 7773 2e20 2832 3031 3729  ng Flows. (2017)
-000125b0: 2e20 5265 7472 6965 7665 6420 6672 6f6d  . Retrieved from
-000125c0: 2068 7474 703a 2f2f 6172 7869 762e 6f72   http://arxiv.or
-000125d0: 672f 6162 732f 3231 3130 2e31 3538 3238  g/abs/2110.15828
-000125e0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-000125f0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00012600: 206d 6173 6b3a 2074 6f72 6368 2e54 656e   mask: torch.Ten
-00012610: 736f 722c 2068 6964 6465 6e5f 7369 7a65  sor, hidden_size
-00012620: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
-00012630: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012640: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00012650: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00012660: 2d2d 0a20 2020 2020 2020 206d 6173 6b3a  --.        mask:
-00012670: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-00012680: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
-00012690: 2077 6974 6820 7a65 726f 7320 616e 6420   with zeros and 
-000126a0: 6f6e 6573 2061 6e64 2069 7473 2073 697a  ones and its siz
-000126b0: 6520 6465 7065 6e64 6520 6f6e 2074 6865  e depende on the
-000126c0: 206e 756d 6265 7220 6f66 206c 6179 6572   number of layer
-000126d0: 730a 2020 2020 2020 2020 2020 2020 616e  s.            an
-000126e0: 6420 6469 6d65 6e73 7369 6f6e 7320 7468  d dimenssions th
-000126f0: 6520 7573 6572 2072 6571 7565 7374 2e0a  e user request..
-00012700: 2020 2020 2020 2020 6869 6464 656e 5f73          hidden_s
-00012710: 697a 653a 2069 6e74 0a20 2020 2020 2020  ize: int.       
-00012720: 2020 2020 2054 6865 2073 697a 6520 6f66       The size of
-00012730: 2074 6865 206f 7574 7075 7473 2061 6e64   the outputs and
-00012740: 2069 6e70 7574 7320 7573 6564 206f 6e20   inputs used on 
-00012750: 7468 6520 696e 7465 726e 616c 206e 6f64  the internal nod
-00012760: 6573 206f 6620 7468 650a 2020 2020 2020  es of the.      
-00012770: 2020 2020 2020 7472 616e 7366 6f72 6d61        transforma
-00012780: 7469 6f6e 206c 6179 6572 2e0a 0a20 2020  tion layer...   
-00012790: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000127a0: 2073 7570 6572 2852 6561 6c4e 5650 4c61   super(RealNVPLa
-000127b0: 7965 722c 2073 656c 6629 2e5f 5f69 6e69  yer, self).__ini
-000127c0: 745f 5f28 290a 2020 2020 2020 2020 7365  t__().        se
-000127d0: 6c66 2e6d 6173 6b20 3d20 6e6e 2e50 6172  lf.mask = nn.Par
-000127e0: 616d 6574 6572 286d 6173 6b2c 2072 6571  ameter(mask, req
-000127f0: 7569 7265 735f 6772 6164 3d46 616c 7365  uires_grad=False
-00012800: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
-00012810: 696d 203d 206c 656e 286d 6173 6b29 0a0a  im = len(mask)..
-00012820: 2020 2020 2020 2020 7365 6c66 2e73 5f66          self.s_f
-00012830: 756e 6320 3d20 6e6e 2e53 6571 7565 6e74  unc = nn.Sequent
-00012840: 6961 6c28 0a20 2020 2020 2020 2020 2020  ial(.           
-00012850: 206e 6e2e 4c69 6e65 6172 2869 6e5f 6665   nn.Linear(in_fe
-00012860: 6174 7572 6573 3d73 656c 662e 6469 6d2c  atures=self.dim,
-00012870: 206f 7574 5f66 6561 7475 7265 733d 6869   out_features=hi
-00012880: 6464 656e 5f73 697a 6529 2c0a 2020 2020  dden_size),.    
-00012890: 2020 2020 2020 2020 6e6e 2e4c 6561 6b79          nn.Leaky
-000128a0: 5265 4c55 2829 2c0a 2020 2020 2020 2020  ReLU(),.        
-000128b0: 2020 2020 6e6e 2e4c 696e 6561 7228 696e      nn.Linear(in
-000128c0: 5f66 6561 7475 7265 733d 6869 6464 656e  _features=hidden
-000128d0: 5f73 697a 652c 206f 7574 5f66 6561 7475  _size, out_featu
-000128e0: 7265 733d 6869 6464 656e 5f73 697a 6529  res=hidden_size)
-000128f0: 2c0a 2020 2020 2020 2020 2020 2020 6e6e  ,.            nn
-00012900: 2e4c 6561 6b79 5265 4c55 2829 2c0a 2020  .LeakyReLU(),.  
-00012910: 2020 2020 2020 2020 2020 6e6e 2e4c 696e            nn.Lin
-00012920: 6561 7228 696e 5f66 6561 7475 7265 733d  ear(in_features=
-00012930: 6869 6464 656e 5f73 697a 652c 206f 7574  hidden_size, out
-00012940: 5f66 6561 7475 7265 733d 7365 6c66 2e64  _features=self.d
-00012950: 696d 2929 0a0a 2020 2020 2020 2020 7365  im))..        se
-00012960: 6c66 2e73 6361 6c65 203d 206e 6e2e 5061  lf.scale = nn.Pa
-00012970: 7261 6d65 7465 7228 746f 7263 682e 5465  rameter(torch.Te
-00012980: 6e73 6f72 2873 656c 662e 6469 6d29 290a  nsor(self.dim)).
-00012990: 0a20 2020 2020 2020 2073 656c 662e 745f  .        self.t_
-000129a0: 6675 6e63 203d 206e 6e2e 5365 7175 656e  func = nn.Sequen
-000129b0: 7469 616c 280a 2020 2020 2020 2020 2020  tial(.          
-000129c0: 2020 6e6e 2e4c 696e 6561 7228 696e 5f66    nn.Linear(in_f
-000129d0: 6561 7475 7265 733d 7365 6c66 2e64 696d  eatures=self.dim
-000129e0: 2c20 6f75 745f 6665 6174 7572 6573 3d68  , out_features=h
-000129f0: 6964 6465 6e5f 7369 7a65 292c 0a20 2020  idden_size),.   
-00012a00: 2020 2020 2020 2020 206e 6e2e 4c65 616b           nn.Leak
-00012a10: 7952 654c 5528 292c 0a20 2020 2020 2020  yReLU(),.       
-00012a20: 2020 2020 206e 6e2e 4c69 6e65 6172 2869       nn.Linear(i
-00012a30: 6e5f 6665 6174 7572 6573 3d68 6964 6465  n_features=hidde
-00012a40: 6e5f 7369 7a65 2c20 6f75 745f 6665 6174  n_size, out_feat
-00012a50: 7572 6573 3d68 6964 6465 6e5f 7369 7a65  ures=hidden_size
-00012a60: 292c 0a20 2020 2020 2020 2020 2020 206e  ),.            n
-00012a70: 6e2e 4c65 616b 7952 654c 5528 292c 0a20  n.LeakyReLU(),. 
-00012a80: 2020 2020 2020 2020 2020 206e 6e2e 4c69             nn.Li
-00012a90: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
-00012aa0: 3d68 6964 6465 6e5f 7369 7a65 2c20 6f75  =hidden_size, ou
-00012ab0: 745f 6665 6174 7572 6573 3d73 656c 662e  t_features=self.
-00012ac0: 6469 6d29 290a 0a20 2020 2064 6566 2066  dim))..    def f
-00012ad0: 6f72 7761 7264 2873 656c 662c 2078 3a20  orward(self, x: 
-00012ae0: 5365 7175 656e 6365 2920 2d3e 2054 7570  Sequence) -> Tup
-00012af0: 6c65 5b74 6f72 6368 2e54 656e 736f 722c  le[torch.Tensor,
-00012b00: 2074 6f72 6368 2e54 656e 736f 725d 3a0a   torch.Tensor]:.
-00012b10: 2020 2020 2020 2020 2222 2246 6f72 7761          """Forwa
-00012b20: 7264 2070 6173 732e 0a0a 2020 2020 2020  rd pass...      
-00012b30: 2020 5468 6973 2070 6172 7469 6375 6c61    This particula
-00012b40: 7220 7472 616e 7366 6f72 6d61 7469 6f6e  r transformation
-00012b50: 2069 7320 7265 7072 6573 656e 7465 6420   is represented 
-00012b60: 6279 2074 6865 2066 6f6c 6c6f 7769 6e67  by the following
-00012b70: 2066 756e 6374 696f 6e3a 0a20 2020 2020   function:.     
-00012b80: 2020 2079 203d 2078 202b 2028 3120 2d20     y = x + (1 - 
-00012b90: 7829 202a 2065 7870 2820 7328 7829 2920  x) * exp( s(x)) 
-00012ba0: 2b20 7428 7829 2c20 7768 6572 6520 7420  + t(x), where t 
-00012bb0: 616e 6420 7320 6e65 6564 7320 616e 2061  and s needs an a
-00012bc0: 6374 6976 6174 696f 6e0a 2020 2020 2020  ctivation.      
-00012bd0: 2020 6675 6e63 7469 6f6e 2e20 5468 6973    function. This
-00012be0: 2063 6c61 7373 2061 6c73 6f20 7265 7475   class also retu
-00012bf0: 726e 7320 7468 6520 6c6f 6761 7269 7468  rns the logarith
-00012c00: 6d20 6f66 2074 6865 206a 6163 6f62 6961  m of the jacobia
-00012c10: 6e73 0a20 2020 2020 2020 2064 6574 6572  ns.        deter
-00012c20: 6d69 6e61 6e74 2077 6869 6368 2069 7320  minant which is 
-00012c30: 7573 6566 756c 2077 6865 6e20 696e 7665  useful when inve
-00012c40: 7274 2061 2074 7261 6e73 666f 726d 6174  rt a transformat
-00012c50: 696f 6e20 616e 6420 636f 6d70 7574 650a  ion and compute.
-00012c60: 2020 2020 2020 2020 7468 6520 7072 6f62          the prob
-00012c70: 6162 696c 6974 7920 6f66 2074 6865 2074  ability of the t
-00012c80: 7261 6e73 666f 726d 6174 696f 6e2e 0a0a  ransformation...
-00012c90: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00012ca0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00012cb0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7820  -----.        x 
-00012cc0: 3a20 5365 7175 656e 6365 0a20 2020 2020  : Sequence.     
-00012cd0: 2020 2020 2020 2054 656e 736f 7220 7361         Tensor sa
-00012ce0: 6d70 6c65 2077 6974 6820 7468 6520 696e  mple with the in
-00012cf0: 6974 6961 6c20 6469 7374 7269 6275 7469  itial distributi
-00012d00: 6f6e 2064 6174 6120 7768 6963 6820 7769  on data which wi
-00012d10: 6c6c 2070 6173 7320 696e 746f 0a20 2020  ll pass into.   
-00012d20: 2020 2020 2020 2020 2074 6865 206e 6f72           the nor
-00012d30: 6d61 6c69 7a69 6e67 2061 6c67 6f72 6974  malizing algorit
-00012d40: 686d 0a0a 2020 2020 2020 2020 5265 7475  hm..        Retu
-00012d50: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00012d60: 2d2d 2d0a 2020 2020 2020 2020 7920 3a20  ---.        y : 
-00012d70: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-00012d80: 2020 2020 2020 2020 2054 7261 6e73 666f           Transfo
-00012d90: 726d 6564 2074 656e 736f 7220 6163 636f  rmed tensor acco
-00012da0: 7264 696e 6720 746f 2052 6561 6c20 4e56  rding to Real NV
-00012db0: 5020 6c61 7965 7220 7769 7468 2074 6865  P layer with the
-00012dc0: 2073 6861 7065 206f 6620 2778 272e 0a20   shape of 'x'.. 
-00012dd0: 2020 2020 2020 206c 6f67 5f64 6574 5f6a         log_det_j
-00012de0: 6163 6f62 6961 6e20 3a20 746f 7263 682e  acobian : torch.
-00012df0: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00012e00: 2020 2054 656e 736f 7220 7768 6963 6820     Tensor which 
-00012e10: 7265 7072 6573 656e 7473 2074 6865 2069  represents the i
-00012e20: 6e66 6f20 6162 6f75 7420 7468 6520 6465  nfo about the de
-00012e30: 7669 6174 696f 6e20 6f66 2074 6865 2069  viation of the i
-00012e40: 6e69 7469 616c 0a20 2020 2020 2020 2020  nitial.         
-00012e50: 2020 2061 6e64 2074 6172 6765 7420 6469     and target di
-00012e60: 7374 7269 6275 7469 6f6e 2e0a 0a20 2020  stribution...   
-00012e70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00012e80: 2078 5f6d 6173 6b20 3d20 7820 2a20 7365   x_mask = x * se
-00012e90: 6c66 2e6d 6173 6b0a 2020 2020 2020 2020  lf.mask.        
-00012ea0: 7320 3d20 7365 6c66 2e73 5f66 756e 6328  s = self.s_func(
-00012eb0: 785f 6d61 736b 2920 2a20 7365 6c66 2e73  x_mask) * self.s
-00012ec0: 6361 6c65 0a20 2020 2020 2020 2074 203d  cale.        t =
-00012ed0: 2073 656c 662e 745f 6675 6e63 2878 5f6d   self.t_func(x_m
-00012ee0: 6173 6b29 0a0a 2020 2020 2020 2020 7920  ask)..        y 
-00012ef0: 3d20 785f 6d61 736b 202b 2028 3120 2d20  = x_mask + (1 - 
-00012f00: 7365 6c66 2e6d 6173 6b29 202a 2028 7820  self.mask) * (x 
-00012f10: 2a20 746f 7263 682e 6578 7028 7329 202b  * torch.exp(s) +
-00012f20: 2074 290a 0a20 2020 2020 2020 206c 6f67   t)..        log
-00012f30: 5f64 6574 5f6a 6163 6f62 6961 6e20 3d20  _det_jacobian = 
-00012f40: 2828 3120 2d20 7365 6c66 2e6d 6173 6b29  ((1 - self.mask)
-00012f50: 202a 2073 292e 7375 6d28 2d31 290a 2020   * s).sum(-1).  
-00012f60: 2020 2020 2020 7265 7475 726e 2079 2c20        return y, 
-00012f70: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
-00012f80: 0a0a 2020 2020 6465 6620 696e 7665 7273  ..    def invers
-00012f90: 6528 7365 6c66 2c20 793a 2053 6571 7565  e(self, y: Seque
-00012fa0: 6e63 6529 202d 3e20 5475 706c 655b 746f  nce) -> Tuple[to
-00012fb0: 7263 682e 5465 6e73 6f72 2c20 746f 7263  rch.Tensor, torc
-00012fc0: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
-00012fd0: 2020 2022 2222 2049 6e76 6572 7365 2070     """ Inverse p
-00012fe0: 6173 730a 0a20 2020 2020 2020 2054 6869  ass..        Thi
-00012ff0: 7320 636c 6173 7320 7065 7266 6f72 6d73  s class performs
-00013000: 2074 6865 2069 6e76 6572 7365 206f 6620   the inverse of 
-00013010: 7468 6520 7072 6576 696f 7573 206d 6574  the previous met
-00013020: 686f 6420 2866 6f72 6d77 6172 6429 2e0a  hod (formward)..
-00013030: 2020 2020 2020 2020 416c 736f 2c20 7468          Also, th
-00013040: 6973 206d 6574 6568 6f64 2072 6574 7572  is metehod retur
-00013050: 6e73 2074 6865 206c 6f67 6172 6974 686d  ns the logarithm
-00013060: 206f 6620 7468 6520 6a61 636f 6269 616e   of the jacobian
-00013070: 7320 6465 7465 726d 696e 616e 740a 2020  s determinant.  
-00013080: 2020 2020 2020 7768 6963 6820 6973 2075        which is u
-00013090: 7365 6675 6c20 746f 2063 6f6d 7075 7465  seful to compute
-000130a0: 2074 6865 206c 6561 726e 6561 626c 6520   the learneable 
-000130b0: 6665 6174 7572 6573 206f 6620 7461 7267  features of targ
-000130c0: 6574 2064 6973 7472 6962 7574 696f 6e2e  et distribution.
-000130d0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-000130e0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-000130f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00013100: 7920 3a20 5365 7175 656e 6365 0a20 2020  y : Sequence.   
-00013110: 2020 2020 2020 2020 2054 656e 736f 7220           Tensor 
-00013120: 7361 6d70 6c65 2077 6974 6820 7472 616e  sample with tran
-00013130: 7366 6f72 6d65 6420 6469 7374 7269 6275  sformed distribu
-00013140: 7469 6f6e 2064 6174 6120 7768 6963 6820  tion data which 
-00013150: 7769 6c6c 2062 6520 7573 6564 2069 6e0a  will be used in.
-00013160: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00013170: 6e6f 726d 616c 697a 696e 6720 616c 676f  normalizing algo
-00013180: 7269 7468 6d20 696e 7665 7273 6520 7061  rithm inverse pa
-00013190: 7373 2e0a 0a20 2020 2020 2020 2052 6574  ss...        Ret
-000131a0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-000131b0: 2d2d 2d2d 0a20 2020 2020 2020 2078 203a  ----.        x :
-000131c0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-000131d0: 2020 2020 2020 2020 2020 5472 616e 7366            Transf
-000131e0: 6f72 6d65 6420 7465 6e73 6f72 2061 6363  ormed tensor acc
-000131f0: 6f72 6469 6e67 2074 6f20 5265 616c 204e  ording to Real N
-00013200: 5650 206c 6179 6572 2077 6974 6820 7468  VP layer with th
-00013210: 6520 7368 6170 6520 6f66 2027 7927 2e0a  e shape of 'y'..
-00013220: 2020 2020 2020 2020 696e 7665 7273 655f          inverse_
-00013230: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
-00013240: 203a 2074 6f72 6368 2e54 656e 736f 720a   : torch.Tensor.
-00013250: 2020 2020 2020 2020 2020 2020 5465 6e73              Tens
-00013260: 6f72 2077 6869 6368 2072 6570 7265 7365  or which represe
-00013270: 6e74 7320 7468 6520 696e 666f 726d 6174  nts the informat
-00013280: 696f 6e20 6f66 2074 6865 2064 6576 6961  ion of the devia
-00013290: 7469 6f6e 206f 6620 7468 6520 696e 6974  tion of the init
-000132a0: 6961 6c0a 2020 2020 2020 2020 2020 2020  ial.            
-000132b0: 616e 6420 7461 7267 6574 2064 6973 7472  and target distr
-000132c0: 6962 7574 696f 6e2e 0a0a 2020 2020 2020  ibution...      
-000132d0: 2020 2222 220a 2020 2020 2020 2020 795f    """.        y_
-000132e0: 6d61 736b 203d 2079 202a 2073 656c 662e  mask = y * self.
-000132f0: 6d61 736b 0a20 2020 2020 2020 2073 203d  mask.        s =
-00013300: 2073 656c 662e 735f 6675 6e63 2879 5f6d   self.s_func(y_m
-00013310: 6173 6b29 202a 2073 656c 662e 7363 616c  ask) * self.scal
-00013320: 650a 2020 2020 2020 2020 7420 3d20 7365  e.        t = se
-00013330: 6c66 2e74 5f66 756e 6328 795f 6d61 736b  lf.t_func(y_mask
-00013340: 290a 0a20 2020 2020 2020 2078 203d 2079  )..        x = y
-00013350: 5f6d 6173 6b20 2b20 2831 202d 2073 656c  _mask + (1 - sel
-00013360: 662e 6d61 736b 2920 2a20 2879 202d 2074  f.mask) * (y - t
-00013370: 2920 2a20 746f 7263 682e 6578 7028 2d73  ) * torch.exp(-s
-00013380: 290a 0a20 2020 2020 2020 2069 6e76 6572  )..        inver
-00013390: 7365 5f6c 6f67 5f64 6574 5f6a 6163 6f62  se_log_det_jacob
-000133a0: 6961 6e20 3d20 2828 3120 2d20 7365 6c66  ian = ((1 - self
-000133b0: 2e6d 6173 6b29 202a 202d 7329 2e73 756d  .mask) * -s).sum
-000133c0: 282d 3129 0a0a 2020 2020 2020 2020 7265  (-1)..        re
-000133d0: 7475 726e 2078 2c20 696e 7665 7273 655f  turn x, inverse_
-000133e0: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
-000133f0: 0a0a 0a63 6c61 7373 204e 6569 6768 626f  ...class Neighbo
-00013400: 724c 6973 7428 6e6e 2e4d 6f64 756c 6529  rList(nn.Module)
-00013410: 3a0a 2020 2020 2222 2243 6f6d 7075 7465  :.    """Compute
-00013420: 7320 6120 6e65 6967 6862 6f72 2d6c 6973  s a neighbor-lis
-00013430: 7420 696e 2050 7954 6f72 6368 2e0a 0a20  t in PyTorch... 
-00013440: 2020 204e 6569 6768 626f 722d 6c69 7374     Neighbor-list
-00013450: 7320 2861 6c73 6f20 6361 6c6c 6564 2056  s (also called V
-00013460: 6572 6c65 7420 4c69 7374 7329 2061 7265  erlet Lists) are
-00013470: 2061 2074 6f6f 6c20 666f 7220 6772 6f75   a tool for grou
-00013480: 7069 6e67 0a20 2020 2061 746f 6d73 2077  ping.    atoms w
-00013490: 6869 6368 2061 7265 2063 6c6f 7365 2074  hich are close t
-000134a0: 6f20 6561 6368 206f 7468 6572 2073 7061  o each other spa
-000134b0: 7469 616c 6c79 2e20 5468 6973 206c 6179  tially. This lay
-000134c0: 6572 2063 6f6d 7075 7465 7320 610a 2020  er computes a.  
-000134d0: 2020 4e65 6967 6862 6f72 204c 6973 7420    Neighbor List 
-000134e0: 6672 6f6d 2061 2070 726f 7669 6465 6420  from a provided 
-000134f0: 7465 6e73 6f72 206f 6620 6174 6f6d 6963  tensor of atomic
-00013500: 2063 6f6f 7264 696e 6174 6573 2e20 596f   coordinates. Yo
-00013510: 7520 6361 6e0a 2020 2020 7468 696e 6b20  u can.    think 
-00013520: 6f66 2074 6869 7320 6173 2061 2067 656e  of this as a gen
-00013530: 6572 616c 2022 6b2d 6d65 616e 7322 206c  eral "k-means" l
-00013540: 6179 6572 2c20 6275 7420 6f70 7469 6d69  ayer, but optimi
-00013550: 7a65 6420 666f 7220 7468 650a 2020 2020  zed for the.    
-00013560: 6361 7365 2060 6b3d 3d33 602e 0a0a 2020  case `k==3`...  
-00013570: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
-00013580: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
-00013590: 4e5f 6174 6f6d 7320 3d20 350a 2020 2020  N_atoms = 5.    
-000135a0: 3e3e 3e20 7374 6172 7420 3d20 300a 2020  >>> start = 0.  
-000135b0: 2020 3e3e 3e20 7374 6f70 203d 2031 320a    >>> stop = 12.
-000135c0: 2020 2020 3e3e 3e20 6e62 725f 6375 746f      >>> nbr_cuto
-000135d0: 6666 203d 2033 0a20 2020 203e 3e3e 206e  ff = 3.    >>> n
-000135e0: 6469 6d20 3d20 330a 2020 2020 3e3e 3e20  dim = 3.    >>> 
-000135f0: 4d5f 6e62 7273 203d 2032 0a20 2020 203e  M_nbrs = 2.    >
-00013600: 3e3e 2063 6f6f 7264 7320 3d20 7374 6172  >> coords = star
-00013610: 7420 2b20 6e70 2e72 616e 646f 6d2e 7261  t + np.random.ra
-00013620: 6e64 284e 5f61 746f 6d73 2c20 6e64 696d  nd(N_atoms, ndim
-00013630: 2920 2a20 2873 746f 7020 2d20 7374 6172  ) * (stop - star
-00013640: 7429 0a20 2020 203e 3e3e 2063 6f6f 7264  t).    >>> coord
-00013650: 7320 3d20 746f 7263 682e 6173 5f74 656e  s = torch.as_ten
-00013660: 736f 7228 636f 6f72 6473 2c20 6474 7970  sor(coords, dtyp
-00013670: 653d 746f 7263 682e 666c 6f61 7429 0a20  e=torch.float). 
-00013680: 2020 203e 3e3e 206c 6179 6572 203d 204e     >>> layer = N
-00013690: 6569 6768 626f 724c 6973 7428 4e5f 6174  eighborList(N_at
-000136a0: 6f6d 732c 204d 5f6e 6272 732c 206e 6469  oms, M_nbrs, ndi
-000136b0: 6d2c 206e 6272 5f63 7574 6f66 662c 2073  m, nbr_cutoff, s
-000136c0: 7461 7274 2c0a 2020 2020 2e2e 2e20 2020  tart,.    ...   
-000136d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136e0: 2020 2073 746f 7029 0a20 2020 203e 3e3e     stop).    >>>
-000136f0: 2072 6573 756c 7420 3d20 6c61 7965 7228   result = layer(
-00013700: 636f 6f72 6473 290a 2020 2020 3e3e 3e20  coords).    >>> 
-00013710: 7265 7375 6c74 2e73 6861 7065 0a20 2020  result.shape.   
-00013720: 2074 6f72 6368 2e53 697a 6528 5b35 2c20   torch.Size([5, 
-00013730: 325d 290a 0a20 2020 2054 4f44 4f28 7262  2])..    TODO(rb
-00013740: 6861 7261 7468 293a 204d 616b 6520 7468  harath): Make th
-00013750: 6973 206c 6179 6572 2073 7570 706f 7274  is layer support
-00013760: 2062 6174 6368 696e 672e 0a20 2020 2022   batching..    "
-00013770: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-00013780: 6974 5f5f 2873 656c 662c 204e 5f61 746f  it__(self, N_ato
-00013790: 6d73 3a20 696e 742c 204d 5f6e 6272 733a  ms: int, M_nbrs:
-000137a0: 2069 6e74 2c20 6e64 696d 3a20 696e 742c   int, ndim: int,
-000137b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000137c0: 2020 6e62 725f 6375 746f 6666 3a20 556e    nbr_cutoff: Un
-000137d0: 696f 6e5b 696e 742c 0a20 2020 2020 2020  ion[int,.       
-000137e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137f0: 2020 2020 2020 2020 2020 2020 666c 6f61              floa
-00013800: 745d 2c20 7374 6172 743a 2069 6e74 2c20  t], start: int, 
-00013810: 7374 6f70 3a20 696e 742c 202a 2a6b 7761  stop: int, **kwa
-00013820: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
-00013830: 220a 2020 2020 2020 2020 5061 7261 6d65  ".        Parame
-00013840: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00013850: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00013860: 4e5f 6174 6f6d 733a 2069 6e74 0a20 2020  N_atoms: int.   
-00013870: 2020 2020 2020 2020 204d 6178 696d 756d           Maximum
-00013880: 206e 756d 6265 7220 6f66 2061 746f 6d73   number of atoms
-00013890: 2074 6869 7320 6c61 7965 7220 7769 6c6c   this layer will
-000138a0: 206e 6569 6768 626f 722d 6c69 7374 2e0a   neighbor-list..
-000138b0: 2020 2020 2020 2020 4d5f 6e62 7273 3a20          M_nbrs: 
-000138c0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-000138d0: 4d61 7869 6d75 6d20 6e75 6d62 6572 206f  Maximum number o
-000138e0: 6620 7370 6174 6961 6c20 6e65 6967 6862  f spatial neighb
-000138f0: 6f72 7320 706f 7373 6962 6c65 2066 6f72  ors possible for
-00013900: 2061 746f 6d2e 0a20 2020 2020 2020 206e   atom..        n
-00013910: 6469 6d3a 2069 6e74 0a20 2020 2020 2020  dim: int.       
-00013920: 2020 2020 2044 696d 656e 7369 6f6e 616c       Dimensional
-00013930: 6974 7920 6f66 2073 7061 6365 2061 746f  ity of space ato
-00013940: 6d73 206c 6976 6520 696e 2e20 2854 7970  ms live in. (Typ
-00013950: 6963 616c 6c79 2033 442c 2062 7574 2073  ically 3D, but s
-00013960: 6f6d 6574 696d 6573 2077 696c 6c0a 2020  ometimes will.  
-00013970: 2020 2020 2020 2020 2020 7761 6e74 2074            want t
-00013980: 6f20 7573 6520 6869 6768 6572 2064 696d  o use higher dim
-00013990: 656e 7369 6f6e 616c 2064 6573 6372 6970  ensional descrip
-000139a0: 746f 7273 2066 6f72 2061 746f 6d73 292e  tors for atoms).
-000139b0: 0a20 2020 2020 2020 206e 6272 5f63 7574  .        nbr_cut
-000139c0: 6f66 663a 2069 6e74 206f 7220 666c 6f61  off: int or floa
-000139d0: 740a 2020 2020 2020 2020 2020 2020 4c65  t.            Le
-000139e0: 6e67 7468 2069 6e20 416e 6773 7472 6f6d  ngth in Angstrom
-000139f0: 7320 283f 2920 6174 2077 6869 6368 2061  s (?) at which a
-00013a00: 746f 6d20 626f 7865 7320 6172 6520 6772  tom boxes are gr
-00013a10: 6964 6465 642e 0a20 2020 2020 2020 2073  idded..        s
-00013a20: 7461 7274 3a20 696e 740a 2020 2020 2020  tart: int.      
-00013a30: 2020 2020 2020 5374 6172 7420 6f66 2072        Start of r
-00013a40: 616e 6765 2066 6f72 2074 6865 2062 6f78  ange for the box
-00013a50: 2069 6e20 7768 6963 6820 7468 6520 6c6f   in which the lo
-00013a60: 6361 7469 6f6e 7320 6f66 2061 6c6c 2067  cations of all g
-00013a70: 7269 6420 706f 696e 7473 2077 696c 6c20  rid points will 
-00013a80: 6265 2063 616c 6375 6c61 7465 6420 696e  be calculated in
-00013a90: 2060 7365 6c66 2e67 6574 5f63 656c 6c73   `self.get_cells
-00013aa0: 2829 602e 0a20 2020 2020 2020 2073 746f  ()`..        sto
-00013ab0: 703a 2069 6e74 0a20 2020 2020 2020 2020  p: int.         
-00013ac0: 2020 2045 6e64 206f 6620 7261 6e67 6520     End of range 
-00013ad0: 666f 7220 7468 6520 626f 7820 696e 2077  for the box in w
-00013ae0: 6869 6368 2074 6865 206c 6f63 6174 696f  hich the locatio
-00013af0: 6e73 206f 6620 616c 6c20 6772 6964 2070  ns of all grid p
-00013b00: 6f69 6e74 7320 7769 6c6c 2062 6520 6361  oints will be ca
-00013b10: 6c63 756c 6174 6564 2069 6e20 6073 656c  lculated in `sel
-00013b20: 662e 6765 745f 6365 6c6c 7328 2960 2e0a  f.get_cells()`..
-00013b30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013b40: 2020 2020 7375 7065 7228 4e65 6967 6862      super(Neighb
-00013b50: 6f72 4c69 7374 2c20 7365 6c66 292e 5f5f  orList, self).__
-00013b60: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
-00013b70: 0a20 2020 2020 2020 2073 656c 662e 4e5f  .        self.N_
-00013b80: 6174 6f6d 7320 3d20 4e5f 6174 6f6d 730a  atoms = N_atoms.
-00013b90: 2020 2020 2020 2020 7365 6c66 2e4d 5f6e          self.M_n
-00013ba0: 6272 7320 3d20 4d5f 6e62 7273 0a20 2020  brs = M_nbrs.   
-00013bb0: 2020 2020 2073 656c 662e 6e64 696d 203d       self.ndim =
-00013bc0: 206e 6469 6d0a 2020 2020 2020 2020 2320   ndim.        # 
-00013bd0: 4e75 6d62 6572 206f 6620 6772 6964 2063  Number of grid c
-00013be0: 656c 6c73 0a20 2020 2020 2020 206e 5f63  ells.        n_c
-00013bf0: 656c 6c73 203d 2069 6e74 2828 2873 746f  ells = int(((sto
-00013c00: 7020 2d20 7374 6172 7429 202f 206e 6272  p - start) / nbr
-00013c10: 5f63 7574 6f66 6629 2a2a 6e64 696d 290a  _cutoff)**ndim).
-00013c20: 2020 2020 2020 2020 7365 6c66 2e6e 5f63          self.n_c
-00013c30: 656c 6c73 203d 206e 5f63 656c 6c73 0a20  ells = n_cells. 
-00013c40: 2020 2020 2020 2073 656c 662e 6e62 725f         self.nbr_
-00013c50: 6375 746f 6666 203d 206e 6272 5f63 7574  cutoff = nbr_cut
-00013c60: 6f66 660a 2020 2020 2020 2020 7365 6c66  off.        self
-00013c70: 2e73 7461 7274 203d 2073 7461 7274 0a20  .start = start. 
-00013c80: 2020 2020 2020 2073 656c 662e 7374 6f70         self.stop
-00013c90: 203d 2073 746f 700a 0a20 2020 2064 6566   = stop..    def
-00013ca0: 205f 5f72 6570 725f 5f28 7365 6c66 2920   __repr__(self) 
-00013cb0: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
-00013cc0: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00013cd0: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
-00013ce0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-00013cf0: 284e 5f61 746f 6d73 3d7b 7365 6c66 2e4e  (N_atoms={self.N
-00013d00: 5f61 746f 6d73 7d2c 204d 5f6e 6272 733d  _atoms}, M_nbrs=
-00013d10: 7b73 656c 662e 4d5f 6e62 7273 7d2c 206e  {self.M_nbrs}, n
-00013d20: 6469 6d3d 7b73 656c 662e 6e64 696d 7d2c  dim={self.ndim},
-00013d30: 206e 5f63 656c 6c73 3d7b 7365 6c66 2e6e   n_cells={self.n
-00013d40: 5f63 656c 6c73 7d2c 206e 6272 5f63 7574  _cells}, nbr_cut
-00013d50: 6f66 663d 7b73 656c 662e 6e62 725f 6375  off={self.nbr_cu
-00013d60: 746f 6666 7d2c 2073 7461 7274 3d7b 7365  toff}, start={se
-00013d70: 6c66 2e73 7461 7274 7d2c 2073 746f 703d  lf.start}, stop=
-00013d80: 7b73 656c 662e 7374 6f70 7d29 270a 2020  {self.stop})'.  
-00013d90: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-00013da0: 2066 6f72 7761 7264 2873 656c 662c 2069   forward(self, i
-00013db0: 6e70 7574 733a 2074 6f72 6368 2e54 656e  nputs: torch.Ten
-00013dc0: 736f 7229 202d 3e20 746f 7263 682e 5465  sor) -> torch.Te
-00013dd0: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
-00013de0: 2249 6e76 6f6b 6573 2074 6869 7320 6c61  "Invokes this la
-00013df0: 7965 722e 0a0a 2020 2020 2020 2020 5061  yer...        Pa
-00013e00: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00013e10: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00013e20: 2020 2020 696e 7075 7473 3a20 746f 7263      inputs: torc
-00013e30: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00013e40: 2020 2020 2053 6861 7065 2028 6e75 6d5f       Shape (num_
-00013e50: 6174 6f6d 732c 206e 6469 6d29 0a0a 2020  atoms, ndim)..  
-00013e60: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00013e70: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00013e80: 2020 2020 2020 6e65 6967 6862 6f72 5f6c        neighbor_l
-00013e90: 6973 743a 2074 6f72 6368 2e54 656e 736f  ist: torch.Tenso
-00013ea0: 720a 2020 2020 2020 2020 2020 2020 5368  r.            Sh
-00013eb0: 6170 6520 6028 4e5f 6174 6f6d 732c 204d  ape `(N_atoms, M
-00013ec0: 5f6e 6272 7329 600a 2020 2020 2020 2020  _nbrs)`.        
-00013ed0: 2222 220a 2020 2020 2020 2020 6966 2069  """.        if i
-00013ee0: 7369 6e73 7461 6e63 6528 696e 7075 7473  sinstance(inputs
-00013ef0: 2c20 5365 7175 656e 6365 436f 6c6c 6563  , SequenceCollec
-00013f00: 7469 6f6e 293a 0a20 2020 2020 2020 2020  tion):.         
-00013f10: 2020 2069 6620 6c65 6e28 696e 7075 7473     if len(inputs
-00013f20: 2920 213d 2031 3a0a 2020 2020 2020 2020  ) != 1:.        
-00013f30: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00013f40: 6c75 6545 7272 6f72 2822 4e65 6967 6862  lueError("Neighb
-00013f50: 6f72 4c69 7374 2063 616e 206f 6e6c 7920  orList can only 
-00013f60: 6861 7665 206f 6e65 2069 6e70 7574 2229  have one input")
-00013f70: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-00013f80: 7574 7320 3d20 696e 7075 7473 5b30 5d0a  uts = inputs[0].
-00013f90: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
-00013fa0: 6e70 7574 732e 7368 6170 6529 2021 3d20  nputs.shape) != 
-00013fb0: 323a 0a20 2020 2020 2020 2020 2020 2023  2:.            #
-00013fc0: 2054 4f44 4f28 7262 6861 7261 7468 293a   TODO(rbharath):
-00013fd0: 2053 7570 706f 7274 2062 6174 6368 696e   Support batchin
-00013fe0: 670a 2020 2020 2020 2020 2020 2020 7261  g.            ra
-00013ff0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-00014000: 5061 7265 6e74 2074 656e 736f 7220 6d75  Parent tensor mu
-00014010: 7374 2062 6520 286e 756d 5f61 746f 6d73  st be (num_atoms
-00014020: 2c20 6e64 756d 2922 290a 2020 2020 2020  , ndum)").      
-00014030: 2020 7265 7475 726e 2073 656c 662e 636f    return self.co
-00014040: 6d70 7574 655f 6e62 725f 6c69 7374 2869  mpute_nbr_list(i
-00014050: 6e70 7574 7329 0a0a 2020 2020 6465 6620  nputs)..    def 
-00014060: 636f 6d70 7574 655f 6e62 725f 6c69 7374  compute_nbr_list
-00014070: 2873 656c 662c 2063 6f6f 7264 733a 2074  (self, coords: t
-00014080: 6f72 6368 2e54 656e 736f 7229 202d 3e20  orch.Tensor) -> 
-00014090: 746f 7263 682e 5465 6e73 6f72 3a0a 2020  torch.Tensor:.  
-000140a0: 2020 2020 2020 2222 2247 6574 2063 6c6f        """Get clo
-000140b0: 7365 7374 206e 6569 6768 626f 7273 2066  sest neighbors f
-000140c0: 6f72 2061 746f 6d73 2e0a 0a20 2020 2020  or atoms...     
-000140d0: 2020 204e 6565 6473 2074 6f20 6861 6e64     Needs to hand
-000140e0: 6c65 2070 6164 6469 6e67 2066 6f72 2061  le padding for a
-000140f0: 746f 6d73 2077 6974 6820 6e6f 206e 6569  toms with no nei
-00014100: 6768 626f 7273 2e0a 0a20 2020 2020 2020  ghbors...       
-00014110: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00014120: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00014130: 2020 2020 2020 2063 6f6f 7264 733a 2074         coords: t
-00014140: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-00014150: 2020 2020 2020 2020 5368 6170 6520 284e          Shape (N
-00014160: 5f61 746f 6d73 2c20 6e64 696d 290a 0a20  _atoms, ndim).. 
-00014170: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00014180: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00014190: 2020 2020 2020 206e 6272 5f6c 6973 743a         nbr_list:
-000141a0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-000141b0: 2020 2020 2020 2020 2020 5368 6170 6520            Shape 
-000141c0: 284e 5f61 746f 6d73 2c20 4d5f 6e62 7273  (N_atoms, M_nbrs
-000141d0: 2920 6f66 2061 746f 6d20 696e 6469 6365  ) of atom indice
-000141e0: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
-000141f0: 2020 2020 2020 2320 5368 6170 6520 286e        # Shape (n
-00014200: 5f63 656c 6c73 2c20 6e64 696d 290a 2020  _cells, ndim).  
-00014210: 2020 2020 2020 6365 6c6c 7320 3d20 7365        cells = se
-00014220: 6c66 2e67 6574 5f63 656c 6c73 2829 0a0a  lf.get_cells()..
-00014230: 2020 2020 2020 2020 2320 4c69 7374 206f          # List o
-00014240: 6620 6c65 6e67 7468 204e 5f61 746f 6d73  f length N_atoms
-00014250: 2c20 6561 6368 2065 6c65 6d65 6e74 206f  , each element o
-00014260: 6620 6469 6666 6572 656e 7420 6c65 6e67  f different leng
-00014270: 7468 2075 6e69 7175 6573 5f69 0a20 2020  th uniques_i.   
-00014280: 2020 2020 206e 6272 7320 3d20 7365 6c66       nbrs = self
-00014290: 2e67 6574 5f61 746f 6d73 5f69 6e5f 6e62  .get_atoms_in_nb
-000142a0: 7273 2863 6f6f 7264 732c 2063 656c 6c73  rs(coords, cells
-000142b0: 290a 2020 2020 2020 2020 7061 6464 696e  ).        paddin
-000142c0: 6720 3d20 746f 7263 682e 6675 6c6c 2828  g = torch.full((
-000142d0: 7365 6c66 2e4d 5f6e 6272 732c 292c 202d  self.M_nbrs,), -
-000142e0: 3129 0a20 2020 2020 2020 2070 6164 6465  1).        padde
-000142f0: 645f 6e62 7273 203d 205b 0a20 2020 2020  d_nbrs = [.     
-00014300: 2020 2020 2020 2074 6f72 6368 2e63 6f6e         torch.con
-00014310: 6361 7428 5b75 6e69 7175 655f 6e62 7273  cat([unique_nbrs
-00014320: 2c20 7061 6464 696e 675d 2c20 3029 2066  , padding], 0) f
-00014330: 6f72 2075 6e69 7175 655f 6e62 7273 2069  or unique_nbrs i
-00014340: 6e20 6e62 7273 0a20 2020 2020 2020 205d  n nbrs.        ]
-00014350: 0a0a 2020 2020 2020 2020 2320 4c69 7374  ..        # List
-00014360: 206f 6620 6c65 6e67 7468 204e 5f61 746f   of length N_ato
-00014370: 6d73 2c20 6561 6368 2065 6c65 6d65 6e74  ms, each element
-00014380: 206f 6620 6469 6666 6572 656e 7420 6c65   of different le
-00014390: 6e67 7468 2075 6e69 7175 6573 5f69 0a20  ngth uniques_i. 
-000143a0: 2020 2020 2020 2023 204c 6973 7420 6f66         # List of
-000143b0: 206c 656e 6774 6820 4e5f 6174 6f6d 732c   length N_atoms,
-000143c0: 2065 6163 6820 6120 7465 6e73 6f72 206f   each a tensor o
-000143d0: 6620 7368 6170 650a 2020 2020 2020 2020  f shape.        
-000143e0: 2320 2875 6e69 7175 6573 5f69 2c20 6e64  # (uniques_i, nd
-000143f0: 696d 290a 2020 2020 2020 2020 6e62 725f  im).        nbr_
-00014400: 636f 6f72 6473 203d 205b 0a20 2020 2020  coords = [.     
-00014410: 2020 2020 2020 2074 6f72 6368 2e69 6e64         torch.ind
-00014420: 6578 5f73 656c 6563 7428 636f 6f72 6473  ex_select(coords
-00014430: 2c20 302c 2061 746f 6d5f 6e62 7273 2920  , 0, atom_nbrs) 
-00014440: 666f 7220 6174 6f6d 5f6e 6272 7320 696e  for atom_nbrs in
-00014450: 206e 6272 730a 2020 2020 2020 2020 5d0a   nbrs.        ].
-00014460: 0a20 2020 2020 2020 2023 2041 6464 2070  .        # Add p
-00014470: 6861 6e74 6f6d 2061 746f 6d73 2074 6861  hantom atoms tha
-00014480: 7420 6578 6973 7420 6661 7220 6f75 7473  t exist far outs
-00014490: 6964 6520 7468 6520 626f 780a 2020 2020  ide the box.    
-000144a0: 2020 2020 636f 6f72 645f 7061 6464 696e      coord_paddin
-000144b0: 6720 3d20 746f 7263 682e 6675 6c6c 2828  g = torch.full((
-000144c0: 7365 6c66 2e4d 5f6e 6272 732c 2073 656c  self.M_nbrs, sel
-000144d0: 662e 6e64 696d 292c 0a20 2020 2020 2020  f.ndim),.       
-000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144f0: 2020 2020 2020 2020 2020 2020 3220 2a20              2 * 
-00014500: 7365 6c66 2e73 746f 7029 2e74 6f28 746f  self.stop).to(to
-00014510: 7263 682e 666c 6f61 7429 0a20 2020 2020  rch.float).     
-00014520: 2020 2070 6164 6465 645f 6e62 725f 636f     padded_nbr_co
-00014530: 6f72 6473 203d 205b 0a20 2020 2020 2020  ords = [.       
-00014540: 2020 2020 2074 6f72 6368 2e63 6174 285b       torch.cat([
-00014550: 6e62 725f 636f 6f72 642c 2063 6f6f 7264  nbr_coord, coord
-00014560: 5f70 6164 6469 6e67 5d2c 2030 2920 666f  _padding], 0) fo
-00014570: 7220 6e62 725f 636f 6f72 6420 696e 206e  r nbr_coord in n
-00014580: 6272 5f63 6f6f 7264 730a 2020 2020 2020  br_coords.      
-00014590: 2020 5d0a 0a20 2020 2020 2020 2023 204c    ]..        # L
-000145a0: 6973 7420 6f66 206c 656e 6774 6820 4e5f  ist of length N_
-000145b0: 6174 6f6d 732c 2065 6163 6820 6f66 2073  atoms, each of s
-000145c0: 6861 7065 2028 312c 206e 6469 6d29 0a20  hape (1, ndim). 
-000145d0: 2020 2020 2020 2061 746f 6d5f 636f 6f72         atom_coor
-000145e0: 6473 203d 2074 6f72 6368 2e74 656e 736f  ds = torch.tenso
-000145f0: 725f 7370 6c69 7428 636f 6f72 6473 2c20  r_split(coords, 
-00014600: 7365 6c66 2e4e 5f61 746f 6d73 290a 0a20  self.N_atoms).. 
-00014610: 2020 2020 2020 2023 2054 4f44 4f28 7262         # TODO(rb
-00014620: 6861 7261 7468 293a 2048 6f77 2064 6f65  harath): How doe
-00014630: 7320 6469 7374 616e 6365 206e 6565 6420  s distance need 
-00014640: 746f 2062 6520 6d6f 6469 6669 6564 2068  to be modified h
-00014650: 6572 6520 746f 0a20 2020 2020 2020 2023  ere to.        #
-00014660: 2061 6363 6f75 6e74 2066 6f72 2070 6572   account for per
-00014670: 696f 6469 6320 626f 756e 6461 7279 2063  iodic boundary c
-00014680: 6f6e 6469 7469 6f6e 733f 0a20 2020 2020  onditions?.     
-00014690: 2020 2023 204c 6973 7420 6f66 206c 656e     # List of len
-000146a0: 6774 6820 4e5f 6174 6f6d 7320 6561 6368  gth N_atoms each
-000146b0: 206f 6620 7368 6170 6520 284d 5f6e 6272   of shape (M_nbr
-000146c0: 7329 0a20 2020 2020 2020 2070 6164 6465  s).        padde
-000146d0: 645f 6469 7374 7320 3d20 5b0a 2020 2020  d_dists = [.    
-000146e0: 2020 2020 2020 2020 746f 7263 682e 7375          torch.su
-000146f0: 6d28 2861 746f 6d5f 636f 6f72 6420 2d20  m((atom_coord - 
-00014700: 7061 6464 6564 5f6e 6272 5f63 6f6f 7264  padded_nbr_coord
-00014710: 292a 2a32 2c20 6469 6d3d 2d31 290a 2020  )**2, dim=-1).  
-00014720: 2020 2020 2020 2020 2020 666f 7220 2861            for (a
-00014730: 746f 6d5f 636f 6f72 642c 0a20 2020 2020  tom_coord,.     
-00014740: 2020 2020 2020 2020 2020 2020 7061 6464              padd
-00014750: 6564 5f6e 6272 5f63 6f6f 7264 2920 696e  ed_nbr_coord) in
-00014760: 207a 6970 2861 746f 6d5f 636f 6f72 6473   zip(atom_coords
-00014770: 2c20 7061 6464 6564 5f6e 6272 5f63 6f6f  , padded_nbr_coo
-00014780: 7264 7329 0a20 2020 2020 2020 205d 0a0a  rds).        ]..
-00014790: 2020 2020 2020 2020 7061 6464 6564 5f63          padded_c
-000147a0: 6c6f 7365 7374 5f6e 6272 7320 3d20 5b0a  losest_nbrs = [.
-000147b0: 2020 2020 2020 2020 2020 2020 746f 7263              torc
-000147c0: 682e 746f 706b 2870 6164 6465 645f 6469  h.topk(padded_di
-000147d0: 7374 2c20 6b3d 7365 6c66 2e4d 5f6e 6272  st, k=self.M_nbr
-000147e0: 732c 206c 6172 6765 7374 3d46 616c 7365  s, largest=False
-000147f0: 295b 315d 0a20 2020 2020 2020 2020 2020  )[1].           
-00014800: 2066 6f72 2070 6164 6465 645f 6469 7374   for padded_dist
-00014810: 2069 6e20 7061 6464 6564 5f64 6973 7473   in padded_dists
-00014820: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
-00014830: 2020 2020 2320 4e5f 6174 6f6d 7320 656c      # N_atoms el
-00014840: 7473 206f 6620 7369 7a65 2028 4d5f 6e62  ts of size (M_nb
-00014850: 7273 2c29 2065 6163 680a 2020 2020 2020  rs,) each.      
-00014860: 2020 7061 6464 6564 5f6e 6569 6768 626f    padded_neighbo
-00014870: 725f 6c69 7374 203d 205b 0a20 2020 2020  r_list = [.     
-00014880: 2020 2020 2020 2074 6f72 6368 2e67 6174         torch.gat
-00014890: 6865 7228 7061 6464 6564 5f61 746f 6d5f  her(padded_atom_
-000148a0: 6e62 7273 2c20 302c 2070 6164 6465 645f  nbrs, 0, padded_
-000148b0: 636c 6f73 6573 745f 6e62 7229 0a20 2020  closest_nbr).   
-000148c0: 2020 2020 2020 2020 2066 6f72 2028 7061           for (pa
-000148d0: 6464 6564 5f61 746f 6d5f 6e62 7273 2c0a  dded_atom_nbrs,.
-000148e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148f0: 2070 6164 6465 645f 636c 6f73 6573 745f   padded_closest_
-00014900: 6e62 7229 2069 6e20 7a69 7028 7061 6464  nbr) in zip(padd
-00014910: 6564 5f6e 6272 732c 2070 6164 6465 645f  ed_nbrs, padded_
-00014920: 636c 6f73 6573 745f 6e62 7273 290a 2020  closest_nbrs).  
-00014930: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
-00014940: 206e 6569 6768 626f 725f 6c69 7374 203d   neighbor_list =
-00014950: 2074 6f72 6368 2e73 7461 636b 2870 6164   torch.stack(pad
-00014960: 6465 645f 6e65 6967 6862 6f72 5f6c 6973  ded_neighbor_lis
-00014970: 7429 0a0a 2020 2020 2020 2020 7265 7475  t)..        retu
-00014980: 726e 206e 6569 6768 626f 725f 6c69 7374  rn neighbor_list
-00014990: 0a0a 2020 2020 6465 6620 6765 745f 6174  ..    def get_at
-000149a0: 6f6d 735f 696e 5f6e 6272 7328 7365 6c66  oms_in_nbrs(self
-000149b0: 2c20 636f 6f72 6473 3a20 746f 7263 682e  , coords: torch.
-000149c0: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
-000149d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149e0: 2020 6365 6c6c 733a 2074 6f72 6368 2e54    cells: torch.T
-000149f0: 656e 736f 7229 202d 3e20 4c69 7374 5b74  ensor) -> List[t
-00014a00: 6f72 6368 2e54 656e 736f 725d 3a0a 2020  orch.Tensor]:.  
-00014a10: 2020 2020 2020 2222 2247 6574 2074 6865        """Get the
-00014a20: 2061 746f 6d73 2069 6e20 6e65 6967 6862   atoms in neighb
-00014a30: 6f72 696e 6720 6365 6c6c 7320 666f 7220  oring cells for 
-00014a40: 6561 6368 2063 656c 6c73 2e0a 0a20 2020  each cells...   
-00014a50: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00014a60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00014a70: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
-00014a80: 733a 2074 6f72 6368 2e54 656e 736f 720a  s: torch.Tensor.
-00014a90: 2020 2020 2020 2020 2020 2020 5368 6170              Shap
-00014aa0: 6520 284e 5f61 746f 6d73 2c20 6e64 696d  e (N_atoms, ndim
-00014ab0: 290a 2020 2020 2020 2020 6365 6c6c 733a  ).        cells:
-00014ac0: 2074 6f72 6368 2e54 656e 736f 720a 0a20   torch.Tensor.. 
-00014ad0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00014ae0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00014af0: 2020 2020 2020 2061 746f 6d73 5f69 6e5f         atoms_in_
-00014b00: 6e62 7273 3a20 4c69 7374 5b74 6f72 6368  nbrs: List[torch
-00014b10: 2e54 656e 736f 725d 0a20 2020 2020 2020  .Tensor].       
-00014b20: 2020 2020 2028 4e5f 6174 6f6d 732c 206e       (N_atoms, n
-00014b30: 5f6e 6272 5f63 656c 6c73 2c20 4d5f 6e62  _nbr_cells, M_nb
-00014b40: 7273 290a 2020 2020 2020 2020 2222 220a  rs).        """.
-00014b50: 2020 2020 2020 2020 2320 5368 6170 6520          # Shape 
-00014b60: 284e 5f61 746f 6d73 2c20 3129 0a20 2020  (N_atoms, 1).   
-00014b70: 2020 2020 2063 656c 6c73 5f66 6f72 5f61       cells_for_a
-00014b80: 746f 6d73 203d 2073 656c 662e 6765 745f  toms = self.get_
-00014b90: 6365 6c6c 735f 666f 725f 6174 6f6d 7328  cells_for_atoms(
-00014ba0: 636f 6f72 6473 2c20 6365 6c6c 7329 0a0a  coords, cells)..
-00014bb0: 2020 2020 2020 2020 2320 4669 6e64 204d          # Find M
-00014bc0: 5f6e 6272 7320 6174 6f6d 7320 636c 6f73  _nbrs atoms clos
-00014bd0: 6573 7420 746f 2065 6163 6820 6365 6c6c  est to each cell
-00014be0: 0a20 2020 2020 2020 2023 2053 6861 7065  .        # Shape
-00014bf0: 2028 6e5f 6365 6c6c 732c 204d 5f6e 6272   (n_cells, M_nbr
-00014c00: 7329 0a20 2020 2020 2020 2063 6c6f 7365  s).        close
-00014c10: 7374 5f61 746f 6d73 203d 2073 656c 662e  st_atoms = self.
-00014c20: 6765 745f 636c 6f73 6573 745f 6174 6f6d  get_closest_atom
-00014c30: 7328 636f 6f72 6473 2c20 6365 6c6c 7329  s(coords, cells)
-00014c40: 0a0a 2020 2020 2020 2020 2320 4173 736f  ..        # Asso
-00014c50: 6369 6174 6520 6561 6368 2063 656c 6c20  ciate each cell 
-00014c60: 7769 7468 2069 7473 206e 6569 6768 626f  with its neighbo
-00014c70: 7220 6365 6c6c 732e 2041 7373 756d 6573  r cells. Assumes
-00014c80: 2070 6572 696f 6469 6320 626f 756e 6461   periodic bounda
-00014c90: 7279 0a20 2020 2020 2020 2023 2063 6f6e  ry.        # con
-00014ca0: 6469 7469 6f6e 732c 2073 6f20 646f 6573  ditions, so does
-00014cb0: 2077 7261 7072 6f75 6e64 2e20 4f28 636f   wrapround. O(co
-00014cc0: 6e73 7461 6e74 290a 2020 2020 2020 2020  nstant).        
-00014cd0: 2320 5368 6170 6520 286e 5f63 656c 6c73  # Shape (n_cells
-00014ce0: 2c20 6e5f 6e62 725f 6365 6c6c 7329 0a20  , n_nbr_cells). 
-00014cf0: 2020 2020 2020 206e 6569 6768 626f 725f         neighbor_
-00014d00: 6365 6c6c 7320 3d20 7365 6c66 2e67 6574  cells = self.get
-00014d10: 5f6e 6569 6768 626f 725f 6365 6c6c 7328  _neighbor_cells(
-00014d20: 6365 6c6c 7329 0a0a 2020 2020 2020 2020  cells)..        
-00014d30: 2320 5368 6170 6520 284e 5f61 746f 6d73  # Shape (N_atoms
-00014d40: 2c20 6e5f 6e62 725f 6365 6c6c 7329 0a20  , n_nbr_cells). 
-00014d50: 2020 2020 2020 206e 6569 6768 626f 725f         neighbor_
-00014d60: 6365 6c6c 7320 3d20 746f 7263 682e 7371  cells = torch.sq
-00014d70: 7565 657a 6528 0a20 2020 2020 2020 2020  ueeze(.         
-00014d80: 2020 2074 6f72 6368 2e69 6e64 6578 5f73     torch.index_s
-00014d90: 656c 6563 7428 6e65 6967 6862 6f72 5f63  elect(neighbor_c
-00014da0: 656c 6c73 2c20 302c 0a20 2020 2020 2020  ells, 0,.       
-00014db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014dc0: 2020 2020 2020 2020 746f 7263 682e 7371          torch.sq
-00014dd0: 7565 657a 6528 6365 6c6c 735f 666f 725f  ueeze(cells_for_
-00014de0: 6174 6f6d 7329 2929 0a0a 2020 2020 2020  atoms)))..      
-00014df0: 2020 2320 5368 6170 6520 284e 5f61 746f    # Shape (N_ato
-00014e00: 6d73 2c20 6e5f 6e62 725f 6365 6c6c 732c  ms, n_nbr_cells,
-00014e10: 204d 5f6e 6272 7329 0a20 2020 2020 2020   M_nbrs).       
-00014e20: 2061 746f 6d73 5f69 6e5f 6e62 7273 203d   atoms_in_nbrs =
-00014e30: 2074 6f72 6368 2e69 6e64 6578 5f73 656c   torch.index_sel
-00014e40: 6563 7428 636c 6f73 6573 745f 6174 6f6d  ect(closest_atom
-00014e50: 732c 2030 2c0a 2020 2020 2020 2020 2020  s, 0,.          
-00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c80: 2020 2020 2020 2020 2020 2020 2020 4c69                Li
+00011c90: 7374 5b55 6e69 6f6e 5b69 6e74 2c20 666c  st[Union[int, fl
+00011ca0: 6f61 745d 5d5d 5d29 202d 3e20 746f 7263  oat]]]]) -> torc
+00011cb0: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
+00011cc0: 2020 2222 2249 6e76 6f6b 6573 2074 6869    """Invokes thi
+00011cd0: 7320 6c61 7965 722e 0a0a 2020 2020 2020  s layer...      
+00011ce0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00011cf0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00011d00: 2020 2020 2020 2020 696e 7075 7473 3a20          inputs: 
+00011d10: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
+00011d20: 2053 686f 756c 6420 6265 206f 6620 666f   Should be of fo
+00011d30: 726d 2060 696e 7075 7473 3d5b 636f 6f72  rm `inputs=[coor
+00011d40: 6473 2c20 6e62 725f 6c69 7374 5d60 2077  ds, nbr_list]` w
+00011d50: 6865 7265 2060 636f 6f72 6473 6020 6973  here `coords` is
+00011d60: 2061 0a20 2020 2020 2020 2020 2020 2074   a.            t
+00011d70: 656e 736f 7220 6f66 2073 6861 7065 2060  ensor of shape `
+00011d80: 284e 6f6e 652c 204e 2c20 3329 6020 616e  (None, N, 3)` an
+00011d90: 6420 606e 6272 5f6c 6973 7460 2069 7320  d `nbr_list` is 
+00011da0: 6120 6c69 7374 2e0a 0a20 2020 2020 2020  a list...       
+00011db0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+00011dc0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+00011dd0: 2054 656e 736f 7220 6f66 2073 6861 7065   Tensor of shape
+00011de0: 2060 284e 5f61 746f 6d73 2c20 4d5f 6e62   `(N_atoms, M_nb
+00011df0: 7273 2960 2077 6974 6820 696e 7465 7261  rs)` with intera
+00011e00: 746f 6d69 6320 6469 7374 616e 6365 732e  tomic distances.
+00011e10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00011e20: 2020 2020 2069 6620 6c65 6e28 696e 7075       if len(inpu
+00011e30: 7473 2920 213d 2032 3a0a 2020 2020 2020  ts) != 2:.      
+00011e40: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00011e50: 6545 7272 6f72 2822 496e 7465 7261 746f  eError("Interato
+00011e60: 6d69 6344 6973 7461 6e63 6573 2072 6571  micDistances req
+00011e70: 7569 7265 7320 636f 6f72 6473 2c6e 6272  uires coords,nbr
+00011e80: 5f6c 6973 7422 290a 2020 2020 2020 2020  _list").        
+00011e90: 636f 6f72 6473 2c20 6e62 725f 6c69 7374  coords, nbr_list
+00011ea0: 203d 2028 746f 7263 682e 7465 6e73 6f72   = (torch.tensor
+00011eb0: 2869 6e70 7574 735b 305d 292c 2074 6f72  (inputs[0]), tor
+00011ec0: 6368 2e74 656e 736f 7228 696e 7075 7473  ch.tensor(inputs
+00011ed0: 5b31 5d29 290a 2020 2020 2020 2020 4e5f  [1])).        N_
+00011ee0: 6174 6f6d 732c 204d 5f6e 6272 732c 206e  atoms, M_nbrs, n
+00011ef0: 6469 6d20 3d20 7365 6c66 2e4e 5f61 746f  dim = self.N_ato
+00011f00: 6d73 2c20 7365 6c66 2e4d 5f6e 6272 732c  ms, self.M_nbrs,
+00011f10: 2073 656c 662e 6e64 696d 0a20 2020 2020   self.ndim.     
+00011f20: 2020 2023 2053 6861 7065 2028 4e5f 6174     # Shape (N_at
+00011f30: 6f6d 732c 204d 5f6e 6272 732c 206e 6469  oms, M_nbrs, ndi
+00011f40: 6d29 0a20 2020 2020 2020 206e 6272 5f63  m).        nbr_c
+00011f50: 6f6f 7264 7320 3d20 636f 6f72 6473 5b6e  oords = coords[n
+00011f60: 6272 5f6c 6973 742e 6c6f 6e67 2829 5d0a  br_list.long()].
+00011f70: 2020 2020 2020 2020 2320 5368 6170 6520          # Shape 
+00011f80: 284e 5f61 746f 6d73 2c20 4d5f 6e62 7273  (N_atoms, M_nbrs
+00011f90: 2c20 6e64 696d 290a 2020 2020 2020 2020  , ndim).        
+00011fa0: 7469 6c65 645f 636f 6f72 6473 203d 2074  tiled_coords = t
+00011fb0: 6f72 6368 2e74 696c 6528 746f 7263 682e  orch.tile(torch.
+00011fc0: 7265 7368 6170 6528 636f 6f72 6473 2c20  reshape(coords, 
+00011fd0: 284e 5f61 746f 6d73 2c20 312c 206e 6469  (N_atoms, 1, ndi
+00011fe0: 6d29 292c 0a20 2020 2020 2020 2020 2020  m)),.           
+00011ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012000: 2020 2020 2020 2028 312c 204d 5f6e 6272         (1, M_nbr
+00012010: 732c 2031 2929 0a20 2020 2020 2020 2023  s, 1)).        #
+00012020: 2053 6861 7065 2028 4e5f 6174 6f6d 732c   Shape (N_atoms,
+00012030: 204d 5f6e 6272 7329 0a20 2020 2020 2020   M_nbrs).       
+00012040: 2072 6574 7572 6e20 746f 7263 682e 7375   return torch.su
+00012050: 6d28 2874 696c 6564 5f63 6f6f 7264 7320  m((tiled_coords 
+00012060: 2d20 6e62 725f 636f 6f72 6473 292a 2a32  - nbr_coords)**2
+00012070: 2c20 6469 6d3d 3229 0a0a 0a63 6c61 7373  , dim=2)...class
+00012080: 2052 6561 6c4e 5650 4c61 7965 7228 6e6e   RealNVPLayer(nn
+00012090: 2e4d 6f64 756c 6529 3a0a 2020 2020 2222  .Module):.    ""
+000120a0: 2252 6561 6c20 4e56 5020 5472 616e 7366  "Real NVP Transf
+000120b0: 6f72 6d61 7469 6f6e 204c 6179 6572 0a0a  ormation Layer..
+000120c0: 2020 2020 5468 6973 2063 6c61 7373 2063      This class c
+000120d0: 6c61 7373 2069 7320 6120 636f 6e73 7472  lass is a constr
+000120e0: 7563 746f 7220 7472 616e 7366 6f72 6d61  uctor transforma
+000120f0: 7469 6f6e 206c 6179 6572 2075 7365 6420  tion layer used 
+00012100: 6f6e 2061 0a20 2020 204e 6f72 6d61 6c69  on a.    Normali
+00012110: 7a69 6e67 464c 6f77 206d 6f64 656c 2e20  zingFLow model. 
+00012120: 2054 6865 2052 6561 6c20 4e6f 6e2d 5072   The Real Non-Pr
+00012130: 6573 6572 7669 6e67 2d56 6f6c 756d 656e  eserving-Volumen
+00012140: 2028 5265 616c 204e 5650 2920 6973 2061   (Real NVP) is a
+00012150: 2074 7970 650a 2020 2020 6f66 206e 6f72   type.    of nor
+00012160: 6d61 6c69 7a69 6e67 2066 6c6f 7720 6c61  malizing flow la
+00012170: 7965 7220 7768 6963 6820 6769 7665 7320  yer which gives 
+00012180: 6164 7661 6e74 6167 6573 206f 7665 7220  advantages over 
+00012190: 7468 6973 206d 6169 6e6c 7920 6265 6361  this mainly beca
+000121a0: 7573 6520 616e 0a20 2020 2065 6173 6520  use an.    ease 
+000121b0: 746f 2063 6f6d 7075 7465 2074 6865 2069  to compute the i
+000121c0: 6e76 6572 7365 2070 6173 7320 5b31 5d5f  nverse pass [1]_
+000121d0: 2c20 7468 6973 2069 7320 746f 206c 6561  , this is to lea
+000121e0: 726e 2061 2074 6172 6765 740a 2020 2020  rn a target.    
+000121f0: 6469 7374 7269 6275 7469 6f6e 2e0a 0a20  distribution... 
+00012200: 2020 2045 7861 6d70 6c65 0a20 2020 202d     Example.    -
+00012210: 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e 2069  ------.    >>> i
+00012220: 6d70 6f72 7420 746f 7263 680a 2020 2020  mport torch.    
+00012230: 3e3e 3e20 696d 706f 7274 2074 6f72 6368  >>> import torch
+00012240: 2e6e 6e20 6173 206e 6e0a 2020 2020 3e3e  .nn as nn.    >>
+00012250: 3e20 6672 6f6d 2074 6f72 6368 2e64 6973  > from torch.dis
+00012260: 7472 6962 7574 696f 6e73 2069 6d70 6f72  tributions impor
+00012270: 7420 4d75 6c74 6976 6172 6961 7465 4e6f  t MultivariateNo
+00012280: 726d 616c 0a20 2020 203e 3e3e 2066 726f  rmal.    >>> fro
+00012290: 6d20 6465 6570 6368 656d 2e6d 6f64 656c  m deepchem.model
+000122a0: 732e 746f 7263 685f 6d6f 6465 6c73 2e6c  s.torch_models.l
+000122b0: 6179 6572 7320 696d 706f 7274 2052 6561  ayers import Rea
+000122c0: 6c4e 5650 4c61 7965 720a 2020 2020 3e3e  lNVPLayer.    >>
+000122d0: 3e20 6469 6d20 3d20 320a 2020 2020 3e3e  > dim = 2.    >>
+000122e0: 3e20 7361 6d70 6c65 7320 3d20 3936 0a20  > samples = 96. 
+000122f0: 2020 203e 3e3e 2064 6174 6120 3d20 4d75     >>> data = Mu
+00012300: 6c74 6976 6172 6961 7465 4e6f 726d 616c  ltivariateNormal
+00012310: 2874 6f72 6368 2e7a 6572 6f73 2864 696d  (torch.zeros(dim
+00012320: 292c 2074 6f72 6368 2e65 7965 2864 696d  ), torch.eye(dim
+00012330: 2929 0a20 2020 203e 3e3e 2074 656e 736f  )).    >>> tenso
+00012340: 7220 3d20 6461 7461 2e73 616d 706c 6528  r = data.sample(
+00012350: 746f 7263 682e 5369 7a65 2828 7361 6d70  torch.Size((samp
+00012360: 6c65 732c 2064 696d 2929 290a 0a20 2020  les, dim)))..   
+00012370: 203e 3e3e 206c 6179 6572 7320 3d20 340a   >>> layers = 4.
+00012380: 2020 2020 3e3e 3e20 6869 6464 656e 5f73      >>> hidden_s
+00012390: 697a 6520 3d20 3136 0a20 2020 203e 3e3e  ize = 16.    >>>
+000123a0: 206d 6173 6b73 203d 2046 2e6f 6e65 5f68   masks = F.one_h
+000123b0: 6f74 2874 6f72 6368 2e74 656e 736f 7228  ot(torch.tensor(
+000123c0: 5b69 2025 2032 2066 6f72 2069 2069 6e20  [i % 2 for i in 
+000123d0: 7261 6e67 6528 6c61 7965 7273 295d 2929  range(layers)]))
+000123e0: 2e66 6c6f 6174 2829 0a20 2020 203e 3e3e  .float().    >>>
+000123f0: 206c 6179 6572 7320 3d20 6e6e 2e4d 6f64   layers = nn.Mod
+00012400: 756c 654c 6973 7428 5b52 6561 6c4e 5650  uleList([RealNVP
+00012410: 4c61 7965 7228 6d61 736b 2c20 6869 6464  Layer(mask, hidd
+00012420: 656e 5f73 697a 6529 2066 6f72 206d 6173  en_size) for mas
+00012430: 6b20 696e 206d 6173 6b73 5d29 0a0a 2020  k in masks])..  
+00012440: 2020 3e3e 3e20 666f 7220 6c61 7965 7220    >>> for layer 
+00012450: 696e 206c 6179 6572 733a 0a20 2020 202e  in layers:.    .
+00012460: 2e2e 2020 205f 2c20 696e 7665 7273 655f  ..   _, inverse_
+00012470: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
+00012480: 203d 206c 6179 6572 2e69 6e76 6572 7365   = layer.inverse
+00012490: 2874 656e 736f 7229 0a20 2020 202e 2e2e  (tensor).    ...
+000124a0: 2020 2069 6e76 6572 7365 5f6c 6f67 5f64     inverse_log_d
+000124b0: 6574 5f6a 6163 6f62 6961 6e20 3d20 696e  et_jacobian = in
+000124c0: 7665 7273 655f 6c6f 675f 6465 745f 6a61  verse_log_det_ja
+000124d0: 636f 6269 616e 2e64 6574 6163 6828 292e  cobian.detach().
+000124e0: 6e75 6d70 7928 290a 2020 2020 3e3e 3e20  numpy().    >>> 
+000124f0: 6c65 6e28 696e 7665 7273 655f 6c6f 675f  len(inverse_log_
+00012500: 6465 745f 6a61 636f 6269 616e 290a 2020  det_jacobian).  
+00012510: 2020 3936 0a0a 2020 2020 5265 6665 7265    96..    Refere
+00012520: 6e63 6573 0a20 2020 202d 2d2d 2d2d 2d2d  nces.    -------
+00012530: 2d2d 2d0a 2020 2020 2e2e 205b 315d 2053  ---.    .. [1] S
+00012540: 7469 6d70 6572 2c20 562e 2c20 5363 68c3  timper, V., Sch.
+00012550: b66c 6b6f 7066 2c20 422e 2c20 2620 4865  .lkopf, B., & He
+00012560: 726e c3a1 6e64 657a 2d4c 6f62 6174 6f2c  rn..ndez-Lobato,
+00012570: 204a 2e20 4d2e 2028 3230 3231 292e 2052   J. M. (2021). R
+00012580: 6573 616d 706c 696e 6720 4261 7365 0a20  esampling Base. 
+00012590: 2020 2044 6973 7472 6962 7574 696f 6e73     Distributions
+000125a0: 206f 6620 4e6f 726d 616c 697a 696e 6720   of Normalizing 
+000125b0: 466c 6f77 732e 2028 3230 3137 292e 2052  Flows. (2017). R
+000125c0: 6574 7269 6576 6564 2066 726f 6d20 6874  etrieved from ht
+000125d0: 7470 3a2f 2f61 7278 6976 2e6f 7267 2f61  tp://arxiv.org/a
+000125e0: 6273 2f32 3131 302e 3135 3832 380a 2020  bs/2110.15828.  
+000125f0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00012600: 5f69 6e69 745f 5f28 7365 6c66 2c20 6d61  _init__(self, ma
+00012610: 736b 3a20 746f 7263 682e 5465 6e73 6f72  sk: torch.Tensor
+00012620: 2c20 6869 6464 656e 5f73 697a 653a 2069  , hidden_size: i
+00012630: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
+00012640: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012650: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00012660: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a      -----------.
+00012670: 2020 2020 2020 2020 6d61 736b 3a20 746f          mask: to
+00012680: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+00012690: 2020 2020 2020 2054 656e 736f 7220 7769         Tensor wi
+000126a0: 7468 207a 6572 6f73 2061 6e64 206f 6e65  th zeros and one
+000126b0: 7320 616e 6420 6974 7320 7369 7a65 2064  s and its size d
+000126c0: 6570 656e 6465 206f 6e20 7468 6520 6e75  epende on the nu
+000126d0: 6d62 6572 206f 6620 6c61 7965 7273 0a20  mber of layers. 
+000126e0: 2020 2020 2020 2020 2020 2061 6e64 2064             and d
+000126f0: 696d 656e 7373 696f 6e73 2074 6865 2075  imenssions the u
+00012700: 7365 7220 7265 7175 6573 742e 0a20 2020  ser request..   
+00012710: 2020 2020 2068 6964 6465 6e5f 7369 7a65       hidden_size
+00012720: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+00012730: 2020 5468 6520 7369 7a65 206f 6620 7468    The size of th
+00012740: 6520 6f75 7470 7574 7320 616e 6420 696e  e outputs and in
+00012750: 7075 7473 2075 7365 6420 6f6e 2074 6865  puts used on the
+00012760: 2069 6e74 6572 6e61 6c20 6e6f 6465 7320   internal nodes 
+00012770: 6f66 2074 6865 0a20 2020 2020 2020 2020  of the.         
+00012780: 2020 2074 7261 6e73 666f 726d 6174 696f     transformatio
+00012790: 6e20 6c61 7965 722e 0a0a 2020 2020 2020  n layer...      
+000127a0: 2020 2222 220a 2020 2020 2020 2020 7375    """.        su
+000127b0: 7065 7228 5265 616c 4e56 504c 6179 6572  per(RealNVPLayer
+000127c0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
+000127d0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+000127e0: 6d61 736b 203d 206e 6e2e 5061 7261 6d65  mask = nn.Parame
+000127f0: 7465 7228 6d61 736b 2c20 7265 7175 6972  ter(mask, requir
+00012800: 6573 5f67 7261 643d 4661 6c73 6529 0a20  es_grad=False). 
+00012810: 2020 2020 2020 2073 656c 662e 6469 6d20         self.dim 
+00012820: 3d20 6c65 6e28 6d61 736b 290a 0a20 2020  = len(mask)..   
+00012830: 2020 2020 2073 656c 662e 735f 6675 6e63       self.s_func
+00012840: 203d 206e 6e2e 5365 7175 656e 7469 616c   = nn.Sequential
+00012850: 280a 2020 2020 2020 2020 2020 2020 6e6e  (.            nn
+00012860: 2e4c 696e 6561 7228 696e 5f66 6561 7475  .Linear(in_featu
+00012870: 7265 733d 7365 6c66 2e64 696d 2c20 6f75  res=self.dim, ou
+00012880: 745f 6665 6174 7572 6573 3d68 6964 6465  t_features=hidde
+00012890: 6e5f 7369 7a65 292c 0a20 2020 2020 2020  n_size),.       
+000128a0: 2020 2020 206e 6e2e 4c65 616b 7952 654c       nn.LeakyReL
+000128b0: 5528 292c 0a20 2020 2020 2020 2020 2020  U(),.           
+000128c0: 206e 6e2e 4c69 6e65 6172 2869 6e5f 6665   nn.Linear(in_fe
+000128d0: 6174 7572 6573 3d68 6964 6465 6e5f 7369  atures=hidden_si
+000128e0: 7a65 2c20 6f75 745f 6665 6174 7572 6573  ze, out_features
+000128f0: 3d68 6964 6465 6e5f 7369 7a65 292c 0a20  =hidden_size),. 
+00012900: 2020 2020 2020 2020 2020 206e 6e2e 4c65             nn.Le
+00012910: 616b 7952 654c 5528 292c 0a20 2020 2020  akyReLU(),.     
+00012920: 2020 2020 2020 206e 6e2e 4c69 6e65 6172         nn.Linear
+00012930: 2869 6e5f 6665 6174 7572 6573 3d68 6964  (in_features=hid
+00012940: 6465 6e5f 7369 7a65 2c20 6f75 745f 6665  den_size, out_fe
+00012950: 6174 7572 6573 3d73 656c 662e 6469 6d29  atures=self.dim)
+00012960: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00012970: 7363 616c 6520 3d20 6e6e 2e50 6172 616d  scale = nn.Param
+00012980: 6574 6572 2874 6f72 6368 2e54 656e 736f  eter(torch.Tenso
+00012990: 7228 7365 6c66 2e64 696d 2929 0a0a 2020  r(self.dim))..  
+000129a0: 2020 2020 2020 7365 6c66 2e74 5f66 756e        self.t_fun
+000129b0: 6320 3d20 6e6e 2e53 6571 7565 6e74 6961  c = nn.Sequentia
+000129c0: 6c28 0a20 2020 2020 2020 2020 2020 206e  l(.            n
+000129d0: 6e2e 4c69 6e65 6172 2869 6e5f 6665 6174  n.Linear(in_feat
+000129e0: 7572 6573 3d73 656c 662e 6469 6d2c 206f  ures=self.dim, o
+000129f0: 7574 5f66 6561 7475 7265 733d 6869 6464  ut_features=hidd
+00012a00: 656e 5f73 697a 6529 2c0a 2020 2020 2020  en_size),.      
+00012a10: 2020 2020 2020 6e6e 2e4c 6561 6b79 5265        nn.LeakyRe
+00012a20: 4c55 2829 2c0a 2020 2020 2020 2020 2020  LU(),.          
+00012a30: 2020 6e6e 2e4c 696e 6561 7228 696e 5f66    nn.Linear(in_f
+00012a40: 6561 7475 7265 733d 6869 6464 656e 5f73  eatures=hidden_s
+00012a50: 697a 652c 206f 7574 5f66 6561 7475 7265  ize, out_feature
+00012a60: 733d 6869 6464 656e 5f73 697a 6529 2c0a  s=hidden_size),.
+00012a70: 2020 2020 2020 2020 2020 2020 6e6e 2e4c              nn.L
+00012a80: 6561 6b79 5265 4c55 2829 2c0a 2020 2020  eakyReLU(),.    
+00012a90: 2020 2020 2020 2020 6e6e 2e4c 696e 6561          nn.Linea
+00012aa0: 7228 696e 5f66 6561 7475 7265 733d 6869  r(in_features=hi
+00012ab0: 6464 656e 5f73 697a 652c 206f 7574 5f66  dden_size, out_f
+00012ac0: 6561 7475 7265 733d 7365 6c66 2e64 696d  eatures=self.dim
+00012ad0: 2929 0a0a 2020 2020 6465 6620 666f 7277  ))..    def forw
+00012ae0: 6172 6428 7365 6c66 2c20 783a 2053 6571  ard(self, x: Seq
+00012af0: 7565 6e63 6529 202d 3e20 5475 706c 655b  uence) -> Tuple[
+00012b00: 746f 7263 682e 5465 6e73 6f72 2c20 746f  torch.Tensor, to
+00012b10: 7263 682e 5465 6e73 6f72 5d3a 0a20 2020  rch.Tensor]:.   
+00012b20: 2020 2020 2022 2222 466f 7277 6172 6420       """Forward 
+00012b30: 7061 7373 2e0a 0a20 2020 2020 2020 2054  pass...        T
+00012b40: 6869 7320 7061 7274 6963 756c 6172 2074  his particular t
+00012b50: 7261 6e73 666f 726d 6174 696f 6e20 6973  ransformation is
+00012b60: 2072 6570 7265 7365 6e74 6564 2062 7920   represented by 
+00012b70: 7468 6520 666f 6c6c 6f77 696e 6720 6675  the following fu
+00012b80: 6e63 7469 6f6e 3a0a 2020 2020 2020 2020  nction:.        
+00012b90: 7920 3d20 7820 2b20 2831 202d 2078 2920  y = x + (1 - x) 
+00012ba0: 2a20 6578 7028 2073 2878 2929 202b 2074  * exp( s(x)) + t
+00012bb0: 2878 292c 2077 6865 7265 2074 2061 6e64  (x), where t and
+00012bc0: 2073 206e 6565 6473 2061 6e20 6163 7469   s needs an acti
+00012bd0: 7661 7469 6f6e 0a20 2020 2020 2020 2066  vation.        f
+00012be0: 756e 6374 696f 6e2e 2054 6869 7320 636c  unction. This cl
+00012bf0: 6173 7320 616c 736f 2072 6574 7572 6e73  ass also returns
+00012c00: 2074 6865 206c 6f67 6172 6974 686d 206f   the logarithm o
+00012c10: 6620 7468 6520 6a61 636f 6269 616e 730a  f the jacobians.
+00012c20: 2020 2020 2020 2020 6465 7465 726d 696e          determin
+00012c30: 616e 7420 7768 6963 6820 6973 2075 7365  ant which is use
+00012c40: 6675 6c20 7768 656e 2069 6e76 6572 7420  ful when invert 
+00012c50: 6120 7472 616e 7366 6f72 6d61 7469 6f6e  a transformation
+00012c60: 2061 6e64 2063 6f6d 7075 7465 0a20 2020   and compute.   
+00012c70: 2020 2020 2074 6865 2070 726f 6261 6269       the probabi
+00012c80: 6c69 7479 206f 6620 7468 6520 7472 616e  lity of the tran
+00012c90: 7366 6f72 6d61 7469 6f6e 2e0a 0a20 2020  sformation...   
+00012ca0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00012cb0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00012cc0: 2d2d 0a20 2020 2020 2020 2078 203a 2053  --.        x : S
+00012cd0: 6571 7565 6e63 650a 2020 2020 2020 2020  equence.        
+00012ce0: 2020 2020 5465 6e73 6f72 2073 616d 706c      Tensor sampl
+00012cf0: 6520 7769 7468 2074 6865 2069 6e69 7469  e with the initi
+00012d00: 616c 2064 6973 7472 6962 7574 696f 6e20  al distribution 
+00012d10: 6461 7461 2077 6869 6368 2077 696c 6c20  data which will 
+00012d20: 7061 7373 2069 6e74 6f0a 2020 2020 2020  pass into.      
+00012d30: 2020 2020 2020 7468 6520 6e6f 726d 616c        the normal
+00012d40: 697a 696e 6720 616c 676f 7269 7468 6d0a  izing algorithm.
+00012d50: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00012d60: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00012d70: 0a20 2020 2020 2020 2079 203a 2074 6f72  .        y : tor
+00012d80: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00012d90: 2020 2020 2020 5472 616e 7366 6f72 6d65        Transforme
+00012da0: 6420 7465 6e73 6f72 2061 6363 6f72 6469  d tensor accordi
+00012db0: 6e67 2074 6f20 5265 616c 204e 5650 206c  ng to Real NVP l
+00012dc0: 6179 6572 2077 6974 6820 7468 6520 7368  ayer with the sh
+00012dd0: 6170 6520 6f66 2027 7827 2e0a 2020 2020  ape of 'x'..    
+00012de0: 2020 2020 6c6f 675f 6465 745f 6a61 636f      log_det_jaco
+00012df0: 6269 616e 203a 2074 6f72 6368 2e54 656e  bian : torch.Ten
+00012e00: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00012e10: 5465 6e73 6f72 2077 6869 6368 2072 6570  Tensor which rep
+00012e20: 7265 7365 6e74 7320 7468 6520 696e 666f  resents the info
+00012e30: 2061 626f 7574 2074 6865 2064 6576 6961   about the devia
+00012e40: 7469 6f6e 206f 6620 7468 6520 696e 6974  tion of the init
+00012e50: 6961 6c0a 2020 2020 2020 2020 2020 2020  ial.            
+00012e60: 616e 6420 7461 7267 6574 2064 6973 7472  and target distr
+00012e70: 6962 7574 696f 6e2e 0a0a 2020 2020 2020  ibution...      
+00012e80: 2020 2222 220a 2020 2020 2020 2020 785f    """.        x_
+00012e90: 6d61 736b 203d 2078 202a 2073 656c 662e  mask = x * self.
+00012ea0: 6d61 736b 0a20 2020 2020 2020 2073 203d  mask.        s =
+00012eb0: 2073 656c 662e 735f 6675 6e63 2878 5f6d   self.s_func(x_m
+00012ec0: 6173 6b29 202a 2073 656c 662e 7363 616c  ask) * self.scal
+00012ed0: 650a 2020 2020 2020 2020 7420 3d20 7365  e.        t = se
+00012ee0: 6c66 2e74 5f66 756e 6328 785f 6d61 736b  lf.t_func(x_mask
+00012ef0: 290a 0a20 2020 2020 2020 2079 203d 2078  )..        y = x
+00012f00: 5f6d 6173 6b20 2b20 2831 202d 2073 656c  _mask + (1 - sel
+00012f10: 662e 6d61 736b 2920 2a20 2878 202a 2074  f.mask) * (x * t
+00012f20: 6f72 6368 2e65 7870 2873 2920 2b20 7429  orch.exp(s) + t)
+00012f30: 0a0a 2020 2020 2020 2020 6c6f 675f 6465  ..        log_de
+00012f40: 745f 6a61 636f 6269 616e 203d 2028 2831  t_jacobian = ((1
+00012f50: 202d 2073 656c 662e 6d61 736b 2920 2a20   - self.mask) * 
+00012f60: 7329 2e73 756d 282d 3129 0a20 2020 2020  s).sum(-1).     
+00012f70: 2020 2072 6574 7572 6e20 792c 206c 6f67     return y, log
+00012f80: 5f64 6574 5f6a 6163 6f62 6961 6e0a 0a20  _det_jacobian.. 
+00012f90: 2020 2064 6566 2069 6e76 6572 7365 2873     def inverse(s
+00012fa0: 656c 662c 2079 3a20 5365 7175 656e 6365  elf, y: Sequence
+00012fb0: 2920 2d3e 2054 7570 6c65 5b74 6f72 6368  ) -> Tuple[torch
+00012fc0: 2e54 656e 736f 722c 2074 6f72 6368 2e54  .Tensor, torch.T
+00012fd0: 656e 736f 725d 3a0a 2020 2020 2020 2020  ensor]:.        
+00012fe0: 2222 2220 496e 7665 7273 6520 7061 7373  """ Inverse pass
+00012ff0: 0a0a 2020 2020 2020 2020 5468 6973 2063  ..        This c
+00013000: 6c61 7373 2070 6572 666f 726d 7320 7468  lass performs th
+00013010: 6520 696e 7665 7273 6520 6f66 2074 6865  e inverse of the
+00013020: 2070 7265 7669 6f75 7320 6d65 7468 6f64   previous method
+00013030: 2028 666f 726d 7761 7264 292e 0a20 2020   (formward)..   
+00013040: 2020 2020 2041 6c73 6f2c 2074 6869 7320       Also, this 
+00013050: 6d65 7465 686f 6420 7265 7475 726e 7320  metehod returns 
+00013060: 7468 6520 6c6f 6761 7269 7468 6d20 6f66  the logarithm of
+00013070: 2074 6865 206a 6163 6f62 6961 6e73 2064   the jacobians d
+00013080: 6574 6572 6d69 6e61 6e74 0a20 2020 2020  eterminant.     
+00013090: 2020 2077 6869 6368 2069 7320 7573 6566     which is usef
+000130a0: 756c 2074 6f20 636f 6d70 7574 6520 7468  ul to compute th
+000130b0: 6520 6c65 6172 6e65 6162 6c65 2066 6561  e learneable fea
+000130c0: 7475 7265 7320 6f66 2074 6172 6765 7420  tures of target 
+000130d0: 6469 7374 7269 6275 7469 6f6e 2e0a 0a20  distribution... 
+000130e0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+000130f0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00013100: 2d2d 2d2d 0a20 2020 2020 2020 2079 203a  ----.        y :
+00013110: 2053 6571 7565 6e63 650a 2020 2020 2020   Sequence.      
+00013120: 2020 2020 2020 5465 6e73 6f72 2073 616d        Tensor sam
+00013130: 706c 6520 7769 7468 2074 7261 6e73 666f  ple with transfo
+00013140: 726d 6564 2064 6973 7472 6962 7574 696f  rmed distributio
+00013150: 6e20 6461 7461 2077 6869 6368 2077 696c  n data which wil
+00013160: 6c20 6265 2075 7365 6420 696e 0a20 2020  l be used in.   
+00013170: 2020 2020 2020 2020 2074 6865 206e 6f72           the nor
+00013180: 6d61 6c69 7a69 6e67 2061 6c67 6f72 6974  malizing algorit
+00013190: 686d 2069 6e76 6572 7365 2070 6173 732e  hm inverse pass.
+000131a0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+000131b0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+000131c0: 2d0a 2020 2020 2020 2020 7820 3a20 746f  -.        x : to
+000131d0: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+000131e0: 2020 2020 2020 2054 7261 6e73 666f 726d         Transform
+000131f0: 6564 2074 656e 736f 7220 6163 636f 7264  ed tensor accord
+00013200: 696e 6720 746f 2052 6561 6c20 4e56 5020  ing to Real NVP 
+00013210: 6c61 7965 7220 7769 7468 2074 6865 2073  layer with the s
+00013220: 6861 7065 206f 6620 2779 272e 0a20 2020  hape of 'y'..   
+00013230: 2020 2020 2069 6e76 6572 7365 5f6c 6f67       inverse_log
+00013240: 5f64 6574 5f6a 6163 6f62 6961 6e20 3a20  _det_jacobian : 
+00013250: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+00013260: 2020 2020 2020 2020 2054 656e 736f 7220           Tensor 
+00013270: 7768 6963 6820 7265 7072 6573 656e 7473  which represents
+00013280: 2074 6865 2069 6e66 6f72 6d61 7469 6f6e   the information
+00013290: 206f 6620 7468 6520 6465 7669 6174 696f   of the deviatio
+000132a0: 6e20 6f66 2074 6865 2069 6e69 7469 616c  n of the initial
+000132b0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+000132c0: 2074 6172 6765 7420 6469 7374 7269 6275   target distribu
+000132d0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2022  tion...        "
+000132e0: 2222 0a20 2020 2020 2020 2079 5f6d 6173  "".        y_mas
+000132f0: 6b20 3d20 7920 2a20 7365 6c66 2e6d 6173  k = y * self.mas
+00013300: 6b0a 2020 2020 2020 2020 7320 3d20 7365  k.        s = se
+00013310: 6c66 2e73 5f66 756e 6328 795f 6d61 736b  lf.s_func(y_mask
+00013320: 2920 2a20 7365 6c66 2e73 6361 6c65 0a20  ) * self.scale. 
+00013330: 2020 2020 2020 2074 203d 2073 656c 662e         t = self.
+00013340: 745f 6675 6e63 2879 5f6d 6173 6b29 0a0a  t_func(y_mask)..
+00013350: 2020 2020 2020 2020 7820 3d20 795f 6d61          x = y_ma
+00013360: 736b 202b 2028 3120 2d20 7365 6c66 2e6d  sk + (1 - self.m
+00013370: 6173 6b29 202a 2028 7920 2d20 7429 202a  ask) * (y - t) *
+00013380: 2074 6f72 6368 2e65 7870 282d 7329 0a0a   torch.exp(-s)..
+00013390: 2020 2020 2020 2020 696e 7665 7273 655f          inverse_
+000133a0: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
+000133b0: 203d 2028 2831 202d 2073 656c 662e 6d61   = ((1 - self.ma
+000133c0: 736b 2920 2a20 2d73 292e 7375 6d28 2d31  sk) * -s).sum(-1
+000133d0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000133e0: 6e20 782c 2069 6e76 6572 7365 5f6c 6f67  n x, inverse_log
+000133f0: 5f64 6574 5f6a 6163 6f62 6961 6e0a 0a0a  _det_jacobian...
+00013400: 636c 6173 7320 4e65 6967 6862 6f72 4c69  class NeighborLi
+00013410: 7374 286e 6e2e 4d6f 6475 6c65 293a 0a20  st(nn.Module):. 
+00013420: 2020 2022 2222 436f 6d70 7574 6573 2061     """Computes a
+00013430: 206e 6569 6768 626f 722d 6c69 7374 2069   neighbor-list i
+00013440: 6e20 5079 546f 7263 682e 0a0a 2020 2020  n PyTorch...    
+00013450: 4e65 6967 6862 6f72 2d6c 6973 7473 2028  Neighbor-lists (
+00013460: 616c 736f 2063 616c 6c65 6420 5665 726c  also called Verl
+00013470: 6574 204c 6973 7473 2920 6172 6520 6120  et Lists) are a 
+00013480: 746f 6f6c 2066 6f72 2067 726f 7570 696e  tool for groupin
+00013490: 670a 2020 2020 6174 6f6d 7320 7768 6963  g.    atoms whic
+000134a0: 6820 6172 6520 636c 6f73 6520 746f 2065  h are close to e
+000134b0: 6163 6820 6f74 6865 7220 7370 6174 6961  ach other spatia
+000134c0: 6c6c 792e 2054 6869 7320 6c61 7965 7220  lly. This layer 
+000134d0: 636f 6d70 7574 6573 2061 0a20 2020 204e  computes a.    N
+000134e0: 6569 6768 626f 7220 4c69 7374 2066 726f  eighbor List fro
+000134f0: 6d20 6120 7072 6f76 6964 6564 2074 656e  m a provided ten
+00013500: 736f 7220 6f66 2061 746f 6d69 6320 636f  sor of atomic co
+00013510: 6f72 6469 6e61 7465 732e 2059 6f75 2063  ordinates. You c
+00013520: 616e 0a20 2020 2074 6869 6e6b 206f 6620  an.    think of 
+00013530: 7468 6973 2061 7320 6120 6765 6e65 7261  this as a genera
+00013540: 6c20 226b 2d6d 6561 6e73 2220 6c61 7965  l "k-means" laye
+00013550: 722c 2062 7574 206f 7074 696d 697a 6564  r, but optimized
+00013560: 2066 6f72 2074 6865 0a20 2020 2063 6173   for the.    cas
+00013570: 6520 606b 3d3d 3360 2e0a 0a20 2020 2045  e `k==3`...    E
+00013580: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
+00013590: 2d2d 2d2d 0a20 2020 203e 3e3e 204e 5f61  ----.    >>> N_a
+000135a0: 746f 6d73 203d 2035 0a20 2020 203e 3e3e  toms = 5.    >>>
+000135b0: 2073 7461 7274 203d 2030 0a20 2020 203e   start = 0.    >
+000135c0: 3e3e 2073 746f 7020 3d20 3132 0a20 2020  >> stop = 12.   
+000135d0: 203e 3e3e 206e 6272 5f63 7574 6f66 6620   >>> nbr_cutoff 
+000135e0: 3d20 330a 2020 2020 3e3e 3e20 6e64 696d  = 3.    >>> ndim
+000135f0: 203d 2033 0a20 2020 203e 3e3e 204d 5f6e   = 3.    >>> M_n
+00013600: 6272 7320 3d20 320a 2020 2020 3e3e 3e20  brs = 2.    >>> 
+00013610: 636f 6f72 6473 203d 2073 7461 7274 202b  coords = start +
+00013620: 206e 702e 7261 6e64 6f6d 2e72 616e 6428   np.random.rand(
+00013630: 4e5f 6174 6f6d 732c 206e 6469 6d29 202a  N_atoms, ndim) *
+00013640: 2028 7374 6f70 202d 2073 7461 7274 290a   (stop - start).
+00013650: 2020 2020 3e3e 3e20 636f 6f72 6473 203d      >>> coords =
+00013660: 2074 6f72 6368 2e61 735f 7465 6e73 6f72   torch.as_tensor
+00013670: 2863 6f6f 7264 732c 2064 7479 7065 3d74  (coords, dtype=t
+00013680: 6f72 6368 2e66 6c6f 6174 290a 2020 2020  orch.float).    
+00013690: 3e3e 3e20 6c61 7965 7220 3d20 4e65 6967  >>> layer = Neig
+000136a0: 6862 6f72 4c69 7374 284e 5f61 746f 6d73  hborList(N_atoms
+000136b0: 2c20 4d5f 6e62 7273 2c20 6e64 696d 2c20  , M_nbrs, ndim, 
+000136c0: 6e62 725f 6375 746f 6666 2c20 7374 6172  nbr_cutoff, star
+000136d0: 742c 0a20 2020 202e 2e2e 2020 2020 2020  t,.    ...      
+000136e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136f0: 7374 6f70 290a 2020 2020 3e3e 3e20 7265  stop).    >>> re
+00013700: 7375 6c74 203d 206c 6179 6572 2863 6f6f  sult = layer(coo
+00013710: 7264 7329 0a20 2020 203e 3e3e 2072 6573  rds).    >>> res
+00013720: 756c 742e 7368 6170 650a 2020 2020 746f  ult.shape.    to
+00013730: 7263 682e 5369 7a65 285b 352c 2032 5d29  rch.Size([5, 2])
+00013740: 0a0a 2020 2020 544f 444f 2872 6268 6172  ..    TODO(rbhar
+00013750: 6174 6829 3a20 4d61 6b65 2074 6869 7320  ath): Make this 
+00013760: 6c61 7965 7220 7375 7070 6f72 7420 6261  layer support ba
+00013770: 7463 6869 6e67 2e0a 2020 2020 2222 220a  tching..    """.
+00013780: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00013790: 5f28 7365 6c66 2c20 4e5f 6174 6f6d 733a  _(self, N_atoms:
+000137a0: 2069 6e74 2c20 4d5f 6e62 7273 3a20 696e   int, M_nbrs: in
+000137b0: 742c 206e 6469 6d3a 2069 6e74 2c0a 2020  t, ndim: int,.  
+000137c0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000137d0: 6272 5f63 7574 6f66 663a 2055 6e69 6f6e  br_cutoff: Union
+000137e0: 5b69 6e74 2c0a 2020 2020 2020 2020 2020  [int,.          
+000137f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013800: 2020 2020 2020 2020 2066 6c6f 6174 5d2c           float],
+00013810: 2073 7461 7274 3a20 696e 742c 2073 746f   start: int, sto
+00013820: 703a 2069 6e74 2c20 2a2a 6b77 6172 6773  p: int, **kwargs
+00013830: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00013840: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00013850: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00013860: 2d2d 2d2d 0a20 2020 2020 2020 204e 5f61  ----.        N_a
+00013870: 746f 6d73 3a20 696e 740a 2020 2020 2020  toms: int.      
+00013880: 2020 2020 2020 4d61 7869 6d75 6d20 6e75        Maximum nu
+00013890: 6d62 6572 206f 6620 6174 6f6d 7320 7468  mber of atoms th
+000138a0: 6973 206c 6179 6572 2077 696c 6c20 6e65  is layer will ne
+000138b0: 6967 6862 6f72 2d6c 6973 742e 0a20 2020  ighbor-list..   
+000138c0: 2020 2020 204d 5f6e 6272 733a 2069 6e74       M_nbrs: int
+000138d0: 0a20 2020 2020 2020 2020 2020 204d 6178  .            Max
+000138e0: 696d 756d 206e 756d 6265 7220 6f66 2073  imum number of s
+000138f0: 7061 7469 616c 206e 6569 6768 626f 7273  patial neighbors
+00013900: 2070 6f73 7369 626c 6520 666f 7220 6174   possible for at
+00013910: 6f6d 2e0a 2020 2020 2020 2020 6e64 696d  om..        ndim
+00013920: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+00013930: 2020 4469 6d65 6e73 696f 6e61 6c69 7479    Dimensionality
+00013940: 206f 6620 7370 6163 6520 6174 6f6d 7320   of space atoms 
+00013950: 6c69 7665 2069 6e2e 2028 5479 7069 6361  live in. (Typica
+00013960: 6c6c 7920 3344 2c20 6275 7420 736f 6d65  lly 3D, but some
+00013970: 7469 6d65 7320 7769 6c6c 0a20 2020 2020  times will.     
+00013980: 2020 2020 2020 2077 616e 7420 746f 2075         want to u
+00013990: 7365 2068 6967 6865 7220 6469 6d65 6e73  se higher dimens
+000139a0: 696f 6e61 6c20 6465 7363 7269 7074 6f72  ional descriptor
+000139b0: 7320 666f 7220 6174 6f6d 7329 2e0a 2020  s for atoms)..  
+000139c0: 2020 2020 2020 6e62 725f 6375 746f 6666        nbr_cutoff
+000139d0: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+000139e0: 2020 2020 2020 2020 2020 204c 656e 6774             Lengt
+000139f0: 6820 696e 2041 6e67 7374 726f 6d73 2028  h in Angstroms (
+00013a00: 3f29 2061 7420 7768 6963 6820 6174 6f6d  ?) at which atom
+00013a10: 2062 6f78 6573 2061 7265 2067 7269 6464   boxes are gridd
+00013a20: 6564 2e0a 2020 2020 2020 2020 7374 6172  ed..        star
+00013a30: 743a 2069 6e74 0a20 2020 2020 2020 2020  t: int.         
+00013a40: 2020 2053 7461 7274 206f 6620 7261 6e67     Start of rang
+00013a50: 6520 666f 7220 7468 6520 626f 7820 696e  e for the box in
+00013a60: 2077 6869 6368 2074 6865 206c 6f63 6174   which the locat
+00013a70: 696f 6e73 206f 6620 616c 6c20 6772 6964  ions of all grid
+00013a80: 2070 6f69 6e74 7320 7769 6c6c 2062 6520   points will be 
+00013a90: 6361 6c63 756c 6174 6564 2069 6e20 6073  calculated in `s
+00013aa0: 656c 662e 6765 745f 6365 6c6c 7328 2960  elf.get_cells()`
+00013ab0: 2e0a 2020 2020 2020 2020 7374 6f70 3a20  ..        stop: 
+00013ac0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00013ad0: 456e 6420 6f66 2072 616e 6765 2066 6f72  End of range for
+00013ae0: 2074 6865 2062 6f78 2069 6e20 7768 6963   the box in whic
+00013af0: 6820 7468 6520 6c6f 6361 7469 6f6e 7320  h the locations 
+00013b00: 6f66 2061 6c6c 2067 7269 6420 706f 696e  of all grid poin
+00013b10: 7473 2077 696c 6c20 6265 2063 616c 6375  ts will be calcu
+00013b20: 6c61 7465 6420 696e 2060 7365 6c66 2e67  lated in `self.g
+00013b30: 6574 5f63 656c 6c73 2829 602e 0a20 2020  et_cells()`..   
+00013b40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013b50: 2073 7570 6572 284e 6569 6768 626f 724c   super(NeighborL
+00013b60: 6973 742c 2073 656c 6629 2e5f 5f69 6e69  ist, self).__ini
+00013b70: 745f 5f28 2a2a 6b77 6172 6773 290a 2020  t__(**kwargs).  
+00013b80: 2020 2020 2020 7365 6c66 2e4e 5f61 746f        self.N_ato
+00013b90: 6d73 203d 204e 5f61 746f 6d73 0a20 2020  ms = N_atoms.   
+00013ba0: 2020 2020 2073 656c 662e 4d5f 6e62 7273       self.M_nbrs
+00013bb0: 203d 204d 5f6e 6272 730a 2020 2020 2020   = M_nbrs.      
+00013bc0: 2020 7365 6c66 2e6e 6469 6d20 3d20 6e64    self.ndim = nd
+00013bd0: 696d 0a20 2020 2020 2020 2023 204e 756d  im.        # Num
+00013be0: 6265 7220 6f66 2067 7269 6420 6365 6c6c  ber of grid cell
+00013bf0: 730a 2020 2020 2020 2020 6e5f 6365 6c6c  s.        n_cell
+00013c00: 7320 3d20 696e 7428 2828 7374 6f70 202d  s = int(((stop -
+00013c10: 2073 7461 7274 2920 2f20 6e62 725f 6375   start) / nbr_cu
+00013c20: 746f 6666 292a 2a6e 6469 6d29 0a20 2020  toff)**ndim).   
+00013c30: 2020 2020 2073 656c 662e 6e5f 6365 6c6c       self.n_cell
+00013c40: 7320 3d20 6e5f 6365 6c6c 730a 2020 2020  s = n_cells.    
+00013c50: 2020 2020 7365 6c66 2e6e 6272 5f63 7574      self.nbr_cut
+00013c60: 6f66 6620 3d20 6e62 725f 6375 746f 6666  off = nbr_cutoff
+00013c70: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+00013c80: 6172 7420 3d20 7374 6172 740a 2020 2020  art = start.    
+00013c90: 2020 2020 7365 6c66 2e73 746f 7020 3d20      self.stop = 
+00013ca0: 7374 6f70 0a0a 2020 2020 6465 6620 5f5f  stop..    def __
+00013cb0: 7265 7072 5f5f 2873 656c 6629 202d 3e20  repr__(self) -> 
+00013cc0: 7374 723a 0a20 2020 2020 2020 2072 6574  str:.        ret
+00013cd0: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
+00013ce0: 2020 6627 7b73 656c 662e 5f5f 636c 6173    f'{self.__clas
+00013cf0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d28 4e5f  s__.__name__}(N_
+00013d00: 6174 6f6d 733d 7b73 656c 662e 4e5f 6174  atoms={self.N_at
+00013d10: 6f6d 737d 2c20 4d5f 6e62 7273 3d7b 7365  oms}, M_nbrs={se
+00013d20: 6c66 2e4d 5f6e 6272 737d 2c20 6e64 696d  lf.M_nbrs}, ndim
+00013d30: 3d7b 7365 6c66 2e6e 6469 6d7d 2c20 6e5f  ={self.ndim}, n_
+00013d40: 6365 6c6c 733d 7b73 656c 662e 6e5f 6365  cells={self.n_ce
+00013d50: 6c6c 737d 2c20 6e62 725f 6375 746f 6666  lls}, nbr_cutoff
+00013d60: 3d7b 7365 6c66 2e6e 6272 5f63 7574 6f66  ={self.nbr_cutof
+00013d70: 667d 2c20 7374 6172 743d 7b73 656c 662e  f}, start={self.
+00013d80: 7374 6172 747d 2c20 7374 6f70 3d7b 7365  start}, stop={se
+00013d90: 6c66 2e73 746f 707d 2927 0a20 2020 2020  lf.stop})'.     
+00013da0: 2020 2029 0a0a 2020 2020 6465 6620 666f     )..    def fo
+00013db0: 7277 6172 6428 7365 6c66 2c20 696e 7075  rward(self, inpu
+00013dc0: 7473 3a20 746f 7263 682e 5465 6e73 6f72  ts: torch.Tensor
+00013dd0: 2920 2d3e 2074 6f72 6368 2e54 656e 736f  ) -> torch.Tenso
+00013de0: 723a 0a20 2020 2020 2020 2022 2222 496e  r:.        """In
+00013df0: 766f 6b65 7320 7468 6973 206c 6179 6572  vokes this layer
+00013e00: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00013e10: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00013e20: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00013e30: 2069 6e70 7574 733a 2074 6f72 6368 2e54   inputs: torch.T
+00013e40: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00013e50: 2020 5368 6170 6520 286e 756d 5f61 746f    Shape (num_ato
+00013e60: 6d73 2c20 6e64 696d 290a 0a20 2020 2020  ms, ndim)..     
+00013e70: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00013e80: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+00013e90: 2020 206e 6569 6768 626f 725f 6c69 7374     neighbor_list
+00013ea0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+00013eb0: 2020 2020 2020 2020 2020 2053 6861 7065             Shape
+00013ec0: 2060 284e 5f61 746f 6d73 2c20 4d5f 6e62   `(N_atoms, M_nb
+00013ed0: 7273 2960 0a20 2020 2020 2020 2022 2222  rs)`.        """
+00013ee0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00013ef0: 7374 616e 6365 2869 6e70 7574 732c 2053  stance(inputs, S
+00013f00: 6571 7565 6e63 6543 6f6c 6c65 6374 696f  equenceCollectio
+00013f10: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
+00013f20: 6966 206c 656e 2869 6e70 7574 7329 2021  if len(inputs) !
+00013f30: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00013f40: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00013f50: 4572 726f 7228 224e 6569 6768 626f 724c  Error("NeighborL
+00013f60: 6973 7420 6361 6e20 6f6e 6c79 2068 6176  ist can only hav
+00013f70: 6520 6f6e 6520 696e 7075 7422 290a 2020  e one input").  
+00013f80: 2020 2020 2020 2020 2020 696e 7075 7473            inputs
+00013f90: 203d 2069 6e70 7574 735b 305d 0a20 2020   = inputs[0].   
+00013fa0: 2020 2020 2069 6620 6c65 6e28 696e 7075       if len(inpu
+00013fb0: 7473 2e73 6861 7065 2920 213d 2032 3a0a  ts.shape) != 2:.
+00013fc0: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
+00013fd0: 444f 2872 6268 6172 6174 6829 3a20 5375  DO(rbharath): Su
+00013fe0: 7070 6f72 7420 6261 7463 6869 6e67 0a20  pport batching. 
+00013ff0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00014000: 2056 616c 7565 4572 726f 7228 2250 6172   ValueError("Par
+00014010: 656e 7420 7465 6e73 6f72 206d 7573 7420  ent tensor must 
+00014020: 6265 2028 6e75 6d5f 6174 6f6d 732c 206e  be (num_atoms, n
+00014030: 6475 6d29 2229 0a20 2020 2020 2020 2072  dum)").        r
+00014040: 6574 7572 6e20 7365 6c66 2e63 6f6d 7075  eturn self.compu
+00014050: 7465 5f6e 6272 5f6c 6973 7428 696e 7075  te_nbr_list(inpu
+00014060: 7473 290a 0a20 2020 2064 6566 2063 6f6d  ts)..    def com
+00014070: 7075 7465 5f6e 6272 5f6c 6973 7428 7365  pute_nbr_list(se
+00014080: 6c66 2c20 636f 6f72 6473 3a20 746f 7263  lf, coords: torc
+00014090: 682e 5465 6e73 6f72 2920 2d3e 2074 6f72  h.Tensor) -> tor
+000140a0: 6368 2e54 656e 736f 723a 0a20 2020 2020  ch.Tensor:.     
+000140b0: 2020 2022 2222 4765 7420 636c 6f73 6573     """Get closes
+000140c0: 7420 6e65 6967 6862 6f72 7320 666f 7220  t neighbors for 
+000140d0: 6174 6f6d 732e 0a0a 2020 2020 2020 2020  atoms...        
+000140e0: 4e65 6564 7320 746f 2068 616e 646c 6520  Needs to handle 
+000140f0: 7061 6464 696e 6720 666f 7220 6174 6f6d  padding for atom
+00014100: 7320 7769 7468 206e 6f20 6e65 6967 6862  s with no neighb
+00014110: 6f72 732e 0a0a 2020 2020 2020 2020 5061  ors...        Pa
+00014120: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00014130: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00014140: 2020 2020 636f 6f72 6473 3a20 746f 7263      coords: torc
+00014150: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00014160: 2020 2020 2053 6861 7065 2028 4e5f 6174       Shape (N_at
+00014170: 6f6d 732c 206e 6469 6d29 0a0a 2020 2020  oms, ndim)..    
+00014180: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00014190: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+000141a0: 2020 2020 6e62 725f 6c69 7374 3a20 746f      nbr_list: to
+000141b0: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+000141c0: 2020 2020 2020 2053 6861 7065 2028 4e5f         Shape (N_
+000141d0: 6174 6f6d 732c 204d 5f6e 6272 7329 206f  atoms, M_nbrs) o
+000141e0: 6620 6174 6f6d 2069 6e64 6963 6573 0a20  f atom indices. 
+000141f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014200: 2020 2023 2053 6861 7065 2028 6e5f 6365     # Shape (n_ce
+00014210: 6c6c 732c 206e 6469 6d29 0a20 2020 2020  lls, ndim).     
+00014220: 2020 2063 656c 6c73 203d 2073 656c 662e     cells = self.
+00014230: 6765 745f 6365 6c6c 7328 290a 0a20 2020  get_cells()..   
+00014240: 2020 2020 2023 204c 6973 7420 6f66 206c       # List of l
+00014250: 656e 6774 6820 4e5f 6174 6f6d 732c 2065  ength N_atoms, e
+00014260: 6163 6820 656c 656d 656e 7420 6f66 2064  ach element of d
+00014270: 6966 6665 7265 6e74 206c 656e 6774 6820  ifferent length 
+00014280: 756e 6971 7565 735f 690a 2020 2020 2020  uniques_i.      
+00014290: 2020 6e62 7273 203d 2073 656c 662e 6765    nbrs = self.ge
+000142a0: 745f 6174 6f6d 735f 696e 5f6e 6272 7328  t_atoms_in_nbrs(
+000142b0: 636f 6f72 6473 2c20 6365 6c6c 7329 0a20  coords, cells). 
+000142c0: 2020 2020 2020 2070 6164 6469 6e67 203d         padding =
+000142d0: 2074 6f72 6368 2e66 756c 6c28 2873 656c   torch.full((sel
+000142e0: 662e 4d5f 6e62 7273 2c29 2c20 2d31 290a  f.M_nbrs,), -1).
+000142f0: 2020 2020 2020 2020 7061 6464 6564 5f6e          padded_n
+00014300: 6272 7320 3d20 5b0a 2020 2020 2020 2020  brs = [.        
+00014310: 2020 2020 746f 7263 682e 636f 6e63 6174      torch.concat
+00014320: 285b 756e 6971 7565 5f6e 6272 732c 2070  ([unique_nbrs, p
+00014330: 6164 6469 6e67 5d2c 2030 2920 666f 7220  adding], 0) for 
+00014340: 756e 6971 7565 5f6e 6272 7320 696e 206e  unique_nbrs in n
+00014350: 6272 730a 2020 2020 2020 2020 5d0a 0a20  brs.        ].. 
+00014360: 2020 2020 2020 2023 204c 6973 7420 6f66         # List of
+00014370: 206c 656e 6774 6820 4e5f 6174 6f6d 732c   length N_atoms,
+00014380: 2065 6163 6820 656c 656d 656e 7420 6f66   each element of
+00014390: 2064 6966 6665 7265 6e74 206c 656e 6774   different lengt
+000143a0: 6820 756e 6971 7565 735f 690a 2020 2020  h uniques_i.    
+000143b0: 2020 2020 2320 4c69 7374 206f 6620 6c65      # List of le
+000143c0: 6e67 7468 204e 5f61 746f 6d73 2c20 6561  ngth N_atoms, ea
+000143d0: 6368 2061 2074 656e 736f 7220 6f66 2073  ch a tensor of s
+000143e0: 6861 7065 0a20 2020 2020 2020 2023 2028  hape.        # (
+000143f0: 756e 6971 7565 735f 692c 206e 6469 6d29  uniques_i, ndim)
+00014400: 0a20 2020 2020 2020 206e 6272 5f63 6f6f  .        nbr_coo
+00014410: 7264 7320 3d20 5b0a 2020 2020 2020 2020  rds = [.        
+00014420: 2020 2020 746f 7263 682e 696e 6465 785f      torch.index_
+00014430: 7365 6c65 6374 2863 6f6f 7264 732c 2030  select(coords, 0
+00014440: 2c20 6174 6f6d 5f6e 6272 7329 2066 6f72  , atom_nbrs) for
+00014450: 2061 746f 6d5f 6e62 7273 2069 6e20 6e62   atom_nbrs in nb
+00014460: 7273 0a20 2020 2020 2020 205d 0a0a 2020  rs.        ]..  
+00014470: 2020 2020 2020 2320 4164 6420 7068 616e        # Add phan
+00014480: 746f 6d20 6174 6f6d 7320 7468 6174 2065  tom atoms that e
+00014490: 7869 7374 2066 6172 206f 7574 7369 6465  xist far outside
+000144a0: 2074 6865 2062 6f78 0a20 2020 2020 2020   the box.       
+000144b0: 2063 6f6f 7264 5f70 6164 6469 6e67 203d   coord_padding =
+000144c0: 2074 6f72 6368 2e66 756c 6c28 2873 656c   torch.full((sel
+000144d0: 662e 4d5f 6e62 7273 2c20 7365 6c66 2e6e  f.M_nbrs, self.n
+000144e0: 6469 6d29 2c0a 2020 2020 2020 2020 2020  dim),.          
+000144f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014500: 2020 2020 2020 2020 2032 202a 2073 656c           2 * sel
+00014510: 662e 7374 6f70 292e 746f 2874 6f72 6368  f.stop).to(torch
+00014520: 2e66 6c6f 6174 290a 2020 2020 2020 2020  .float).        
+00014530: 7061 6464 6564 5f6e 6272 5f63 6f6f 7264  padded_nbr_coord
+00014540: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+00014550: 2020 746f 7263 682e 6361 7428 5b6e 6272    torch.cat([nbr
+00014560: 5f63 6f6f 7264 2c20 636f 6f72 645f 7061  _coord, coord_pa
+00014570: 6464 696e 675d 2c20 3029 2066 6f72 206e  dding], 0) for n
+00014580: 6272 5f63 6f6f 7264 2069 6e20 6e62 725f  br_coord in nbr_
+00014590: 636f 6f72 6473 0a20 2020 2020 2020 205d  coords.        ]
+000145a0: 0a0a 2020 2020 2020 2020 2320 4c69 7374  ..        # List
+000145b0: 206f 6620 6c65 6e67 7468 204e 5f61 746f   of length N_ato
+000145c0: 6d73 2c20 6561 6368 206f 6620 7368 6170  ms, each of shap
+000145d0: 6520 2831 2c20 6e64 696d 290a 2020 2020  e (1, ndim).    
+000145e0: 2020 2020 6174 6f6d 5f63 6f6f 7264 7320      atom_coords 
+000145f0: 3d20 746f 7263 682e 7465 6e73 6f72 5f73  = torch.tensor_s
+00014600: 706c 6974 2863 6f6f 7264 732c 2073 656c  plit(coords, sel
+00014610: 662e 4e5f 6174 6f6d 7329 0a0a 2020 2020  f.N_atoms)..    
+00014620: 2020 2020 2320 544f 444f 2872 6268 6172      # TODO(rbhar
+00014630: 6174 6829 3a20 486f 7720 646f 6573 2064  ath): How does d
+00014640: 6973 7461 6e63 6520 6e65 6564 2074 6f20  istance need to 
+00014650: 6265 206d 6f64 6966 6965 6420 6865 7265  be modified here
+00014660: 2074 6f0a 2020 2020 2020 2020 2320 6163   to.        # ac
+00014670: 636f 756e 7420 666f 7220 7065 7269 6f64  count for period
+00014680: 6963 2062 6f75 6e64 6172 7920 636f 6e64  ic boundary cond
+00014690: 6974 696f 6e73 3f0a 2020 2020 2020 2020  itions?.        
+000146a0: 2320 4c69 7374 206f 6620 6c65 6e67 7468  # List of length
+000146b0: 204e 5f61 746f 6d73 2065 6163 6820 6f66   N_atoms each of
+000146c0: 2073 6861 7065 2028 4d5f 6e62 7273 290a   shape (M_nbrs).
+000146d0: 2020 2020 2020 2020 7061 6464 6564 5f64          padded_d
+000146e0: 6973 7473 203d 205b 0a20 2020 2020 2020  ists = [.       
+000146f0: 2020 2020 2074 6f72 6368 2e73 756d 2828       torch.sum((
+00014700: 6174 6f6d 5f63 6f6f 7264 202d 2070 6164  atom_coord - pad
+00014710: 6465 645f 6e62 725f 636f 6f72 6429 2a2a  ded_nbr_coord)**
+00014720: 322c 2064 696d 3d2d 3129 0a20 2020 2020  2, dim=-1).     
+00014730: 2020 2020 2020 2066 6f72 2028 6174 6f6d         for (atom
+00014740: 5f63 6f6f 7264 2c0a 2020 2020 2020 2020  _coord,.        
+00014750: 2020 2020 2020 2020 2070 6164 6465 645f           padded_
+00014760: 6e62 725f 636f 6f72 6429 2069 6e20 7a69  nbr_coord) in zi
+00014770: 7028 6174 6f6d 5f63 6f6f 7264 732c 2070  p(atom_coords, p
+00014780: 6164 6465 645f 6e62 725f 636f 6f72 6473  added_nbr_coords
+00014790: 290a 2020 2020 2020 2020 5d0a 0a20 2020  ).        ]..   
+000147a0: 2020 2020 2070 6164 6465 645f 636c 6f73       padded_clos
+000147b0: 6573 745f 6e62 7273 203d 205b 0a20 2020  est_nbrs = [.   
+000147c0: 2020 2020 2020 2020 2074 6f72 6368 2e74           torch.t
+000147d0: 6f70 6b28 7061 6464 6564 5f64 6973 742c  opk(padded_dist,
+000147e0: 206b 3d73 656c 662e 4d5f 6e62 7273 2c20   k=self.M_nbrs, 
+000147f0: 6c61 7267 6573 743d 4661 6c73 6529 5b31  largest=False)[1
+00014800: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+00014810: 7220 7061 6464 6564 5f64 6973 7420 696e  r padded_dist in
+00014820: 2070 6164 6465 645f 6469 7374 730a 2020   padded_dists.  
+00014830: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+00014840: 2023 204e 5f61 746f 6d73 2065 6c74 7320   # N_atoms elts 
+00014850: 6f66 2073 697a 6520 284d 5f6e 6272 732c  of size (M_nbrs,
+00014860: 2920 6561 6368 0a20 2020 2020 2020 2070  ) each.        p
+00014870: 6164 6465 645f 6e65 6967 6862 6f72 5f6c  added_neighbor_l
+00014880: 6973 7420 3d20 5b0a 2020 2020 2020 2020  ist = [.        
+00014890: 2020 2020 746f 7263 682e 6761 7468 6572      torch.gather
+000148a0: 2870 6164 6465 645f 6174 6f6d 5f6e 6272  (padded_atom_nbr
+000148b0: 732c 2030 2c20 7061 6464 6564 5f63 6c6f  s, 0, padded_clo
+000148c0: 7365 7374 5f6e 6272 290a 2020 2020 2020  sest_nbr).      
+000148d0: 2020 2020 2020 666f 7220 2870 6164 6465        for (padde
+000148e0: 645f 6174 6f6d 5f6e 6272 732c 0a20 2020  d_atom_nbrs,.   
+000148f0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00014900: 6464 6564 5f63 6c6f 7365 7374 5f6e 6272  dded_closest_nbr
+00014910: 2920 696e 207a 6970 2870 6164 6465 645f  ) in zip(padded_
+00014920: 6e62 7273 2c20 7061 6464 6564 5f63 6c6f  nbrs, padded_clo
+00014930: 7365 7374 5f6e 6272 7329 0a20 2020 2020  sest_nbrs).     
+00014940: 2020 205d 0a0a 2020 2020 2020 2020 6e65     ]..        ne
+00014950: 6967 6862 6f72 5f6c 6973 7420 3d20 746f  ighbor_list = to
+00014960: 7263 682e 7374 6163 6b28 7061 6464 6564  rch.stack(padded
+00014970: 5f6e 6569 6768 626f 725f 6c69 7374 290a  _neighbor_list).
+00014980: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00014990: 6e65 6967 6862 6f72 5f6c 6973 740a 0a20  neighbor_list.. 
+000149a0: 2020 2064 6566 2067 6574 5f61 746f 6d73     def get_atoms
+000149b0: 5f69 6e5f 6e62 7273 2873 656c 662c 2063  _in_nbrs(self, c
+000149c0: 6f6f 7264 733a 2074 6f72 6368 2e54 656e  oords: torch.Ten
+000149d0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
+000149e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000149f0: 656c 6c73 3a20 746f 7263 682e 5465 6e73  ells: torch.Tens
+00014a00: 6f72 2920 2d3e 204c 6973 745b 746f 7263  or) -> List[torc
+00014a10: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
+00014a20: 2020 2022 2222 4765 7420 7468 6520 6174     """Get the at
+00014a30: 6f6d 7320 696e 206e 6569 6768 626f 7269  oms in neighbori
+00014a40: 6e67 2063 656c 6c73 2066 6f72 2065 6163  ng cells for eac
+00014a50: 6820 6365 6c6c 732e 0a0a 2020 2020 2020  h cells...      
+00014a60: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00014a70: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00014a80: 2020 2020 2020 2020 636f 6f72 6473 3a20          coords: 
+00014a90: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+00014aa0: 2020 2020 2020 2020 2053 6861 7065 2028           Shape (
+00014ab0: 4e5f 6174 6f6d 732c 206e 6469 6d29 0a20  N_atoms, ndim). 
+00014ac0: 2020 2020 2020 2063 656c 6c73 3a20 746f         cells: to
+00014ad0: 7263 682e 5465 6e73 6f72 0a0a 2020 2020  rch.Tensor..    
+00014ae0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00014af0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00014b00: 2020 2020 6174 6f6d 735f 696e 5f6e 6272      atoms_in_nbr
+00014b10: 733a 204c 6973 745b 746f 7263 682e 5465  s: List[torch.Te
+00014b20: 6e73 6f72 5d0a 2020 2020 2020 2020 2020  nsor].          
+00014b30: 2020 284e 5f61 746f 6d73 2c20 6e5f 6e62    (N_atoms, n_nb
+00014b40: 725f 6365 6c6c 732c 204d 5f6e 6272 7329  r_cells, M_nbrs)
+00014b50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00014b60: 2020 2020 2023 2053 6861 7065 2028 4e5f       # Shape (N_
+00014b70: 6174 6f6d 732c 2031 290a 2020 2020 2020  atoms, 1).      
+00014b80: 2020 6365 6c6c 735f 666f 725f 6174 6f6d    cells_for_atom
+00014b90: 7320 3d20 7365 6c66 2e67 6574 5f63 656c  s = self.get_cel
+00014ba0: 6c73 5f66 6f72 5f61 746f 6d73 2863 6f6f  ls_for_atoms(coo
+00014bb0: 7264 732c 2063 656c 6c73 290a 0a20 2020  rds, cells)..   
+00014bc0: 2020 2020 2023 2046 696e 6420 4d5f 6e62       # Find M_nb
+00014bd0: 7273 2061 746f 6d73 2063 6c6f 7365 7374  rs atoms closest
+00014be0: 2074 6f20 6561 6368 2063 656c 6c0a 2020   to each cell.  
+00014bf0: 2020 2020 2020 2320 5368 6170 6520 286e        # Shape (n
+00014c00: 5f63 656c 6c73 2c20 4d5f 6e62 7273 290a  _cells, M_nbrs).
+00014c10: 2020 2020 2020 2020 636c 6f73 6573 745f          closest_
+00014c20: 6174 6f6d 7320 3d20 7365 6c66 2e67 6574  atoms = self.get
+00014c30: 5f63 6c6f 7365 7374 5f61 746f 6d73 2863  _closest_atoms(c
+00014c40: 6f6f 7264 732c 2063 656c 6c73 290a 0a20  oords, cells).. 
+00014c50: 2020 2020 2020 2023 2041 7373 6f63 6961         # Associa
+00014c60: 7465 2065 6163 6820 6365 6c6c 2077 6974  te each cell wit
+00014c70: 6820 6974 7320 6e65 6967 6862 6f72 2063  h its neighbor c
+00014c80: 656c 6c73 2e20 4173 7375 6d65 7320 7065  ells. Assumes pe
+00014c90: 7269 6f64 6963 2062 6f75 6e64 6172 790a  riodic boundary.
+00014ca0: 2020 2020 2020 2020 2320 636f 6e64 6974          # condit
+00014cb0: 696f 6e73 2c20 736f 2064 6f65 7320 7772  ions, so does wr
+00014cc0: 6170 726f 756e 642e 204f 2863 6f6e 7374  apround. O(const
+00014cd0: 616e 7429 0a20 2020 2020 2020 2023 2053  ant).        # S
+00014ce0: 6861 7065 2028 6e5f 6365 6c6c 732c 206e  hape (n_cells, n
+00014cf0: 5f6e 6272 5f63 656c 6c73 290a 2020 2020  _nbr_cells).    
+00014d00: 2020 2020 6e65 6967 6862 6f72 5f63 656c      neighbor_cel
+00014d10: 6c73 203d 2073 656c 662e 6765 745f 6e65  ls = self.get_ne
+00014d20: 6967 6862 6f72 5f63 656c 6c73 2863 656c  ighbor_cells(cel
+00014d30: 6c73 290a 0a20 2020 2020 2020 2023 2053  ls)..        # S
+00014d40: 6861 7065 2028 4e5f 6174 6f6d 732c 206e  hape (N_atoms, n
+00014d50: 5f6e 6272 5f63 656c 6c73 290a 2020 2020  _nbr_cells).    
+00014d60: 2020 2020 6e65 6967 6862 6f72 5f63 656c      neighbor_cel
+00014d70: 6c73 203d 2074 6f72 6368 2e73 7175 6565  ls = torch.squee
+00014d80: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
+00014d90: 746f 7263 682e 696e 6465 785f 7365 6c65  torch.index_sele
+00014da0: 6374 286e 6569 6768 626f 725f 6365 6c6c  ct(neighbor_cell
+00014db0: 732c 2030 2c0a 2020 2020 2020 2020 2020  s, 0,.          
+00014dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014dd0: 2020 2020 2074 6f72 6368 2e73 7175 6565       torch.squee
+00014de0: 7a65 2863 656c 6c73 5f66 6f72 5f61 746f  ze(cells_for_ato
+00014df0: 6d73 2929 290a 0a20 2020 2020 2020 2023  ms)))..        #
+00014e00: 2053 6861 7065 2028 4e5f 6174 6f6d 732c   Shape (N_atoms,
+00014e10: 206e 5f6e 6272 5f63 656c 6c73 2c20 4d5f   n_nbr_cells, M_
+00014e20: 6e62 7273 290a 2020 2020 2020 2020 6174  nbrs).        at
+00014e30: 6f6d 735f 696e 5f6e 6272 7320 3d20 746f  oms_in_nbrs = to
+00014e40: 7263 682e 696e 6465 785f 7365 6c65 6374  rch.index_select
+00014e50: 2863 6c6f 7365 7374 5f61 746f 6d73 2c20  (closest_atoms, 
+00014e60: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
 00014e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e80: 206e 6569 6768 626f 725f 6365 6c6c 732e   neighbor_cells.
-00014e90: 666c 6174 7465 6e28 2929 0a0a 2020 2020  flatten())..    
-00014ea0: 2020 2020 2320 5368 6170 6520 284e 5f61      # Shape (N_a
-00014eb0: 746f 6d73 2c20 6e5f 6e62 725f 6365 6c6c  toms, n_nbr_cell
-00014ec0: 732a 4d5f 6e62 7273 290a 2020 2020 2020  s*M_nbrs).      
-00014ed0: 2020 6174 6f6d 735f 696e 5f6e 6272 7320    atoms_in_nbrs 
-00014ee0: 3d20 746f 7263 682e 7265 7368 6170 6528  = torch.reshape(
-00014ef0: 6174 6f6d 735f 696e 5f6e 6272 732c 205b  atoms_in_nbrs, [
-00014f00: 7365 6c66 2e4e 5f61 746f 6d73 2c20 2d31  self.N_atoms, -1
-00014f10: 5d29 0a0a 2020 2020 2020 2020 2320 4c69  ])..        # Li
-00014f20: 7374 206f 6620 6c65 6e67 7468 204e 5f61  st of length N_a
-00014f30: 746f 6d73 2c20 6561 6368 2065 6c65 6d65  toms, each eleme
-00014f40: 6e74 206c 656e 6774 6820 756e 6971 7565  nt length unique
-00014f50: 735f 690a 2020 2020 2020 2020 6e62 7273  s_i.        nbrs
-00014f60: 5f70 6572 5f61 746f 6d20 3d20 746f 7263  _per_atom = torc
-00014f70: 682e 7370 6c69 7428 6174 6f6d 735f 696e  h.split(atoms_in
-00014f80: 5f6e 6272 732c 2073 656c 662e 4e5f 6174  _nbrs, self.N_at
-00014f90: 6f6d 7329 0a0a 2020 2020 2020 2020 756e  oms)..        un
-00014fa0: 6971 7565 7320 3d20 5b0a 2020 2020 2020  iques = [.      
-00014fb0: 2020 2020 2020 746f 7263 682e 756e 6971        torch.uniq
-00014fc0: 7565 2861 746f 6d5f 6e62 7273 2c20 736f  ue(atom_nbrs, so
-00014fd0: 7274 6564 3d46 616c 7365 290a 2020 2020  rted=False).    
-00014fe0: 2020 2020 2020 2020 666f 7220 6174 6f6d          for atom
-00014ff0: 5f6e 6272 7320 696e 206e 6272 735f 7065  _nbrs in nbrs_pe
-00015000: 725f 6174 6f6d 5b30 5d0a 2020 2020 2020  r_atom[0].      
-00015010: 2020 5d0a 0a20 2020 2020 2020 2023 2054    ]..        # T
-00015020: 4f44 4f28 7262 6861 7261 7468 293a 2046  ODO(rbharath): F
-00015030: 5241 4749 4c45 2120 5573 6573 2066 6163  RAGILE! Uses fac
-00015040: 7420 7468 6174 2069 6465 6e74 6974 7920  t that identity 
-00015050: 7365 656d 7320 746f 2062 6520 7468 6520  seems to be the 
-00015060: 6669 7273 740a 2020 2020 2020 2020 2320  first.        # 
-00015070: 656c 656d 656e 7420 7265 6d6f 7665 6420  element removed 
-00015080: 746f 2072 656d 6f76 6520 7365 6c66 2066  to remove self f
-00015090: 726f 6d20 6c69 7374 206f 6620 6e65 6967  rom list of neig
-000150a0: 6862 6f72 732e 204e 6565 6420 746f 2076  hbors. Need to v
-000150b0: 6572 6966 790a 2020 2020 2020 2020 2320  erify.        # 
-000150c0: 7468 6973 2068 6f6c 6473 206d 6f72 6520  this holds more 
-000150d0: 6272 6f61 646c 7920 6f72 2063 6f6d 6520  broadly or come 
-000150e0: 7570 2077 6974 6820 726f 6275 7374 2061  up with robust a
-000150f0: 6c74 6572 6e61 7469 7665 2e0a 2020 2020  lternative..    
-00015100: 2020 2020 756e 6971 7565 7320 3d20 5b75      uniques = [u
-00015110: 6e69 7175 655b 313a 5d20 666f 7220 756e  nique[1:] for un
-00015120: 6971 7565 2069 6e20 756e 6971 7565 735d  ique in uniques]
-00015130: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00015140: 2075 6e69 7175 6573 0a0a 2020 2020 6465   uniques..    de
-00015150: 6620 6765 745f 636c 6f73 6573 745f 6174  f get_closest_at
-00015160: 6f6d 7328 7365 6c66 2c20 636f 6f72 6473  oms(self, coords
-00015170: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
-00015180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015190: 2020 2020 2020 2020 2020 6365 6c6c 733a            cells:
-000151a0: 2074 6f72 6368 2e54 656e 736f 7229 202d   torch.Tensor) -
-000151b0: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
-000151c0: 2020 2020 2020 2020 2222 2246 6f72 2065          """For e
-000151d0: 6163 6820 6365 6c6c 2c20 6669 6e64 204d  ach cell, find M
-000151e0: 5f6e 6272 7320 636c 6f73 6573 7420 6174  _nbrs closest at
-000151f0: 6f6d 732e 0a0a 2020 2020 2020 2020 4c65  oms...        Le
-00015200: 7420 4e5f 6174 6f6d 7320 6265 2074 6865  t N_atoms be the
-00015210: 206e 756d 6265 7220 6f66 2061 746f 6d73   number of atoms
-00015220: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00015230: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00015240: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00015250: 2063 6f6f 7264 733a 2074 6f72 6368 2e54   coords: torch.T
-00015260: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00015270: 2020 284e 5f61 746f 6d73 2c20 6e64 696d    (N_atoms, ndim
-00015280: 2920 7368 6170 652e 0a20 2020 2020 2020  ) shape..       
-00015290: 2063 656c 6c73 3a20 746f 7263 682e 5465   cells: torch.Te
-000152a0: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-000152b0: 2028 6e5f 6365 6c6c 732c 206e 6469 6d29   (n_cells, ndim)
-000152c0: 2073 6861 7065 2e0a 0a20 2020 2020 2020   shape...       
-000152d0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-000152e0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-000152f0: 2063 6c6f 7365 7374 5f69 6e64 733a 2074   closest_inds: t
-00015300: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-00015310: 2020 2020 2020 2020 4f66 2073 6861 7065          Of shape
-00015320: 2028 6e5f 6365 6c6c 732c 204d 5f6e 6272   (n_cells, M_nbr
-00015330: 7329 0a20 2020 2020 2020 2022 2222 0a20  s).        """. 
-00015340: 2020 2020 2020 204e 5f61 746f 6d73 2c20         N_atoms, 
-00015350: 6e5f 6365 6c6c 732c 206e 6469 6d2c 204d  n_cells, ndim, M
-00015360: 5f6e 6272 7320 3d20 2873 656c 662e 4e5f  _nbrs = (self.N_
-00015370: 6174 6f6d 732c 2073 656c 662e 6e5f 6365  atoms, self.n_ce
-00015380: 6c6c 732c 2073 656c 662e 6e64 696d 2c0a  lls, self.ndim,.
-00015390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e80: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00014e90: 6967 6862 6f72 5f63 656c 6c73 2e66 6c61  ighbor_cells.fla
+00014ea0: 7474 656e 2829 290a 0a20 2020 2020 2020  tten())..       
+00014eb0: 2023 2053 6861 7065 2028 4e5f 6174 6f6d   # Shape (N_atom
+00014ec0: 732c 206e 5f6e 6272 5f63 656c 6c73 2a4d  s, n_nbr_cells*M
+00014ed0: 5f6e 6272 7329 0a20 2020 2020 2020 2061  _nbrs).        a
+00014ee0: 746f 6d73 5f69 6e5f 6e62 7273 203d 2074  toms_in_nbrs = t
+00014ef0: 6f72 6368 2e72 6573 6861 7065 2861 746f  orch.reshape(ato
+00014f00: 6d73 5f69 6e5f 6e62 7273 2c20 5b73 656c  ms_in_nbrs, [sel
+00014f10: 662e 4e5f 6174 6f6d 732c 202d 315d 290a  f.N_atoms, -1]).
+00014f20: 0a20 2020 2020 2020 2023 204c 6973 7420  .        # List 
+00014f30: 6f66 206c 656e 6774 6820 4e5f 6174 6f6d  of length N_atom
+00014f40: 732c 2065 6163 6820 656c 656d 656e 7420  s, each element 
+00014f50: 6c65 6e67 7468 2075 6e69 7175 6573 5f69  length uniques_i
+00014f60: 0a20 2020 2020 2020 206e 6272 735f 7065  .        nbrs_pe
+00014f70: 725f 6174 6f6d 203d 2074 6f72 6368 2e73  r_atom = torch.s
+00014f80: 706c 6974 2861 746f 6d73 5f69 6e5f 6e62  plit(atoms_in_nb
+00014f90: 7273 2c20 7365 6c66 2e4e 5f61 746f 6d73  rs, self.N_atoms
+00014fa0: 290a 0a20 2020 2020 2020 2075 6e69 7175  )..        uniqu
+00014fb0: 6573 203d 205b 0a20 2020 2020 2020 2020  es = [.         
+00014fc0: 2020 2074 6f72 6368 2e75 6e69 7175 6528     torch.unique(
+00014fd0: 6174 6f6d 5f6e 6272 732c 2073 6f72 7465  atom_nbrs, sorte
+00014fe0: 643d 4661 6c73 6529 0a20 2020 2020 2020  d=False).       
+00014ff0: 2020 2020 2066 6f72 2061 746f 6d5f 6e62       for atom_nb
+00015000: 7273 2069 6e20 6e62 7273 5f70 6572 5f61  rs in nbrs_per_a
+00015010: 746f 6d5b 305d 0a20 2020 2020 2020 205d  tom[0].        ]
+00015020: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
+00015030: 2872 6268 6172 6174 6829 3a20 4652 4147  (rbharath): FRAG
+00015040: 494c 4521 2055 7365 7320 6661 6374 2074  ILE! Uses fact t
+00015050: 6861 7420 6964 656e 7469 7479 2073 6565  hat identity see
+00015060: 6d73 2074 6f20 6265 2074 6865 2066 6972  ms to be the fir
+00015070: 7374 0a20 2020 2020 2020 2023 2065 6c65  st.        # ele
+00015080: 6d65 6e74 2072 656d 6f76 6564 2074 6f20  ment removed to 
+00015090: 7265 6d6f 7665 2073 656c 6620 6672 6f6d  remove self from
+000150a0: 206c 6973 7420 6f66 206e 6569 6768 626f   list of neighbo
+000150b0: 7273 2e20 4e65 6564 2074 6f20 7665 7269  rs. Need to veri
+000150c0: 6679 0a20 2020 2020 2020 2023 2074 6869  fy.        # thi
+000150d0: 7320 686f 6c64 7320 6d6f 7265 2062 726f  s holds more bro
+000150e0: 6164 6c79 206f 7220 636f 6d65 2075 7020  adly or come up 
+000150f0: 7769 7468 2072 6f62 7573 7420 616c 7465  with robust alte
+00015100: 726e 6174 6976 652e 0a20 2020 2020 2020  rnative..       
+00015110: 2075 6e69 7175 6573 203d 205b 756e 6971   uniques = [uniq
+00015120: 7565 5b31 3a5d 2066 6f72 2075 6e69 7175  ue[1:] for uniqu
+00015130: 6520 696e 2075 6e69 7175 6573 5d0a 0a20  e in uniques].. 
+00015140: 2020 2020 2020 2072 6574 7572 6e20 756e         return un
+00015150: 6971 7565 730a 0a20 2020 2064 6566 2067  iques..    def g
+00015160: 6574 5f63 6c6f 7365 7374 5f61 746f 6d73  et_closest_atoms
+00015170: 2873 656c 662c 2063 6f6f 7264 733a 2074  (self, coords: t
+00015180: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
+00015190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151a0: 2020 2020 2020 2063 656c 6c73 3a20 746f         cells: to
+000151b0: 7263 682e 5465 6e73 6f72 2920 2d3e 2074  rch.Tensor) -> t
+000151c0: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
+000151d0: 2020 2020 2022 2222 466f 7220 6561 6368       """For each
+000151e0: 2063 656c 6c2c 2066 696e 6420 4d5f 6e62   cell, find M_nb
+000151f0: 7273 2063 6c6f 7365 7374 2061 746f 6d73  rs closest atoms
+00015200: 2e0a 0a20 2020 2020 2020 204c 6574 204e  ...        Let N
+00015210: 5f61 746f 6d73 2062 6520 7468 6520 6e75  _atoms be the nu
+00015220: 6d62 6572 206f 6620 6174 6f6d 732e 0a0a  mber of atoms...
+00015230: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00015240: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00015250: 2d2d 2d2d 2d0a 2020 2020 2020 2020 636f  -----.        co
+00015260: 6f72 6473 3a20 746f 7263 682e 5465 6e73  ords: torch.Tens
+00015270: 6f72 0a20 2020 2020 2020 2020 2020 2028  or.            (
+00015280: 4e5f 6174 6f6d 732c 206e 6469 6d29 2073  N_atoms, ndim) s
+00015290: 6861 7065 2e0a 2020 2020 2020 2020 6365  hape..        ce
+000152a0: 6c6c 733a 2074 6f72 6368 2e54 656e 736f  lls: torch.Tenso
+000152b0: 720a 2020 2020 2020 2020 2020 2020 286e  r.            (n
+000152c0: 5f63 656c 6c73 2c20 6e64 696d 2920 7368  _cells, ndim) sh
+000152d0: 6170 652e 0a0a 2020 2020 2020 2020 5265  ape...        Re
+000152e0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+000152f0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 636c  -----.        cl
+00015300: 6f73 6573 745f 696e 6473 3a20 746f 7263  osest_inds: torc
+00015310: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00015320: 2020 2020 204f 6620 7368 6170 6520 286e       Of shape (n
+00015330: 5f63 656c 6c73 2c20 4d5f 6e62 7273 290a  _cells, M_nbrs).
+00015340: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00015350: 2020 2020 4e5f 6174 6f6d 732c 206e 5f63      N_atoms, n_c
+00015360: 656c 6c73 2c20 6e64 696d 2c20 4d5f 6e62  ells, ndim, M_nb
+00015370: 7273 203d 2028 7365 6c66 2e4e 5f61 746f  rs = (self.N_ato
+00015380: 6d73 2c20 7365 6c66 2e6e 5f63 656c 6c73  ms, self.n_cells
+00015390: 2c20 7365 6c66 2e6e 6469 6d2c 0a20 2020  , self.ndim,.   
 000153a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153b0: 2020 2020 2020 2020 2020 7365 6c66 2e4d            self.M
-000153c0: 5f6e 6272 7329 0a20 2020 2020 2020 2023  _nbrs).        #
-000153d0: 2054 696c 6520 626f 7468 2063 656c 6c73   Tile both cells
-000153e0: 2061 6e64 2063 6f6f 7264 7320 746f 2066   and coords to f
-000153f0: 6f72 6d20 6172 7261 7973 206f 6620 7369  orm arrays of si
-00015400: 7a65 2028 4e5f 6174 6f6d 732a 6e5f 6365  ze (N_atoms*n_ce
-00015410: 6c6c 732c 206e 6469 6d29 0a20 2020 2020  lls, ndim).     
-00015420: 2020 2074 696c 6564 5f63 656c 6c73 203d     tiled_cells =
-00015430: 2074 6f72 6368 2e72 6573 6861 7065 2874   torch.reshape(t
-00015440: 6f72 6368 2e74 696c 6528 6365 6c6c 732c  orch.tile(cells,
-00015450: 2028 312c 204e 5f61 746f 6d73 2929 2c0a   (1, N_atoms)),.
-00015460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153c0: 2020 2020 2020 2073 656c 662e 4d5f 6e62         self.M_nb
+000153d0: 7273 290a 2020 2020 2020 2020 2320 5469  rs).        # Ti
+000153e0: 6c65 2062 6f74 6820 6365 6c6c 7320 616e  le both cells an
+000153f0: 6420 636f 6f72 6473 2074 6f20 666f 726d  d coords to form
+00015400: 2061 7272 6179 7320 6f66 2073 697a 6520   arrays of size 
+00015410: 284e 5f61 746f 6d73 2a6e 5f63 656c 6c73  (N_atoms*n_cells
+00015420: 2c20 6e64 696d 290a 2020 2020 2020 2020  , ndim).        
+00015430: 7469 6c65 645f 6365 6c6c 7320 3d20 746f  tiled_cells = to
+00015440: 7263 682e 7265 7368 6170 6528 746f 7263  rch.reshape(torc
+00015450: 682e 7469 6c65 2863 656c 6c73 2c20 2831  h.tile(cells, (1
+00015460: 2c20 4e5f 6174 6f6d 7329 292c 0a20 2020  , N_atoms)),.   
 00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015480: 2020 2020 284e 5f61 746f 6d73 202a 206e      (N_atoms * n
-00015490: 5f63 656c 6c73 2c20 6e64 696d 2929 0a0a  _cells, ndim))..
-000154a0: 2020 2020 2020 2020 2320 5368 6170 6520          # Shape 
-000154b0: 284e 5f61 746f 6d73 2a6e 5f63 656c 6c73  (N_atoms*n_cells
-000154c0: 2c20 6e64 696d 2920 6166 7465 7220 7469  , ndim) after ti
-000154d0: 6c65 0a20 2020 2020 2020 2074 696c 6564  le.        tiled
-000154e0: 5f63 6f6f 7264 7320 3d20 746f 7263 682e  _coords = torch.
-000154f0: 7469 6c65 2863 6f6f 7264 732c 2028 6e5f  tile(coords, (n_
-00015500: 6365 6c6c 732c 2031 2929 0a0a 2020 2020  cells, 1))..    
-00015510: 2020 2020 2320 5368 6170 6520 284e 5f61      # Shape (N_a
-00015520: 746f 6d73 2a6e 5f63 656c 6c73 290a 2020  toms*n_cells).  
-00015530: 2020 2020 2020 636f 6f72 6473 5f76 6563        coords_vec
-00015540: 203d 2074 6f72 6368 2e73 756d 2828 7469   = torch.sum((ti
-00015550: 6c65 645f 636f 6f72 6473 202d 2074 696c  led_coords - til
-00015560: 6564 5f63 656c 6c73 292a 2a32 2c20 6469  ed_cells)**2, di
-00015570: 6d3d 2d31 290a 2020 2020 2020 2020 2320  m=-1).        # 
-00015580: 5368 6170 6520 286e 5f63 656c 6c73 2c20  Shape (n_cells, 
-00015590: 4e5f 6174 6f6d 7329 0a20 2020 2020 2020  N_atoms).       
-000155a0: 2063 6f6f 7264 735f 6e6f 726d 203d 2074   coords_norm = t
-000155b0: 6f72 6368 2e72 6573 6861 7065 2863 6f6f  orch.reshape(coo
-000155c0: 7264 735f 7665 632c 2028 6e5f 6365 6c6c  rds_vec, (n_cell
-000155d0: 732c 204e 5f61 746f 6d73 2929 0a0a 2020  s, N_atoms))..  
-000155e0: 2020 2020 2020 2320 4669 6e64 206b 2061        # Find k a
-000155f0: 746f 6d73 2063 6c6f 7365 7374 2074 6f20  toms closest to 
-00015600: 7468 6973 2063 656c 6c2e 0a20 2020 2020  this cell..     
-00015610: 2020 2023 2054 656e 736f 7220 6f66 2073     # Tensor of s
-00015620: 6861 7065 2028 6e5f 6365 6c6c 732c 204d  hape (n_cells, M
-00015630: 5f6e 6272 7329 0a20 2020 2020 2020 2063  _nbrs).        c
-00015640: 6c6f 7365 7374 5f69 6e64 7320 3d20 746f  losest_inds = to
-00015650: 7263 682e 746f 706b 2863 6f6f 7264 735f  rch.topk(coords_
-00015660: 6e6f 726d 2c20 6b3d 4d5f 6e62 7273 2c20  norm, k=M_nbrs, 
-00015670: 6c61 7267 6573 743d 4661 6c73 6529 5b31  largest=False)[1
-00015680: 5d0a 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
-00015690: 6e20 636c 6f73 6573 745f 696e 6473 0a0a  n closest_inds..
-000156a0: 2020 2020 6465 6620 6765 745f 6365 6c6c      def get_cell
-000156b0: 735f 666f 725f 6174 6f6d 7328 7365 6c66  s_for_atoms(self
-000156c0: 2c20 636f 6f72 6473 3a20 746f 7263 682e  , coords: torch.
-000156d0: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
-000156e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156f0: 2020 2020 6365 6c6c 733a 2074 6f72 6368      cells: torch
-00015700: 2e54 656e 736f 7229 202d 3e20 746f 7263  .Tensor) -> torc
-00015710: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
-00015720: 2020 2222 2243 6f6d 7075 7465 2074 6865    """Compute the
-00015730: 2063 656c 6c73 2065 6163 6820 6174 6f6d   cells each atom
-00015740: 2062 656c 6f6e 6773 2074 6f2e 0a0a 2020   belongs to...  
-00015750: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00015760: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00015770: 2d2d 2d0a 2020 2020 2020 2020 636f 6f72  ---.        coor
-00015780: 6473 3a20 746f 7263 682e 5465 6e73 6f72  ds: torch.Tensor
-00015790: 0a20 2020 2020 2020 2020 2020 2053 6861  .            Sha
-000157a0: 7065 2028 4e5f 6174 6f6d 732c 206e 6469  pe (N_atoms, ndi
-000157b0: 6d29 0a20 2020 2020 2020 2063 656c 6c73  m).        cells
-000157c0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-000157d0: 2020 2020 2020 2020 2020 2028 6e5f 6365             (n_ce
-000157e0: 6c6c 732c 206e 6469 6d29 2073 6861 7065  lls, ndim) shape
-000157f0: 2e0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00015800: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00015810: 2d0a 2020 2020 2020 2020 6365 6c6c 735f  -.        cells_
-00015820: 666f 725f 6174 6f6d 733a 2074 6f72 6368  for_atoms: torch
-00015830: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-00015840: 2020 2020 5368 6170 6520 284e 5f61 746f      Shape (N_ato
-00015850: 6d73 2c20 3129 0a20 2020 2020 2020 2022  ms, 1).        "
-00015860: 2222 0a20 2020 2020 2020 204e 5f61 746f  "".        N_ato
-00015870: 6d73 2c20 6e5f 6365 6c6c 732c 206e 6469  ms, n_cells, ndi
-00015880: 6d20 3d20 7365 6c66 2e4e 5f61 746f 6d73  m = self.N_atoms
-00015890: 2c20 7365 6c66 2e6e 5f63 656c 6c73 2c20  , self.n_cells, 
-000158a0: 7365 6c66 2e6e 6469 6d0a 2020 2020 2020  self.ndim.      
-000158b0: 2020 6e5f 6365 6c6c 7320 3d20 696e 7428    n_cells = int(
-000158c0: 6e5f 6365 6c6c 7329 0a20 2020 2020 2020  n_cells).       
-000158d0: 2023 2054 696c 6520 626f 7468 2063 656c   # Tile both cel
-000158e0: 6c73 2061 6e64 2063 6f6f 7264 7320 746f  ls and coords to
-000158f0: 2066 6f72 6d20 6172 7261 7973 206f 6620   form arrays of 
-00015900: 7369 7a65 2028 4e5f 6174 6f6d 732a 6e5f  size (N_atoms*n_
-00015910: 6365 6c6c 732c 206e 6469 6d29 0a20 2020  cells, ndim).   
-00015920: 2020 2020 2074 696c 6564 5f63 656c 6c73       tiled_cells
-00015930: 203d 2074 6f72 6368 2e74 696c 6528 6365   = torch.tile(ce
-00015940: 6c6c 732c 2028 4e5f 6174 6f6d 732c 2031  lls, (N_atoms, 1
-00015950: 2929 0a0a 2020 2020 2020 2020 2320 5368  ))..        # Sh
-00015960: 6170 6520 284e 5f61 746f 6d73 2a6e 5f63  ape (N_atoms*n_c
-00015970: 656c 6c73 2c20 3129 2061 6674 6572 2074  ells, 1) after t
-00015980: 696c 650a 2020 2020 2020 2020 7469 6c65  ile.        tile
-00015990: 645f 636f 6f72 6473 203d 2074 6f72 6368  d_coords = torch
-000159a0: 2e72 6573 6861 7065 2874 6f72 6368 2e74  .reshape(torch.t
-000159b0: 696c 6528 636f 6f72 6473 2c20 2831 2c20  ile(coords, (1, 
-000159c0: 6e5f 6365 6c6c 7329 292c 0a20 2020 2020  n_cells)),.     
-000159d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015490: 2028 4e5f 6174 6f6d 7320 2a20 6e5f 6365   (N_atoms * n_ce
+000154a0: 6c6c 732c 206e 6469 6d29 290a 0a20 2020  lls, ndim))..   
+000154b0: 2020 2020 2023 2053 6861 7065 2028 4e5f       # Shape (N_
+000154c0: 6174 6f6d 732a 6e5f 6365 6c6c 732c 206e  atoms*n_cells, n
+000154d0: 6469 6d29 2061 6674 6572 2074 696c 650a  dim) after tile.
+000154e0: 2020 2020 2020 2020 7469 6c65 645f 636f          tiled_co
+000154f0: 6f72 6473 203d 2074 6f72 6368 2e74 696c  ords = torch.til
+00015500: 6528 636f 6f72 6473 2c20 286e 5f63 656c  e(coords, (n_cel
+00015510: 6c73 2c20 3129 290a 0a20 2020 2020 2020  ls, 1))..       
+00015520: 2023 2053 6861 7065 2028 4e5f 6174 6f6d   # Shape (N_atom
+00015530: 732a 6e5f 6365 6c6c 7329 0a20 2020 2020  s*n_cells).     
+00015540: 2020 2063 6f6f 7264 735f 7665 6320 3d20     coords_vec = 
+00015550: 746f 7263 682e 7375 6d28 2874 696c 6564  torch.sum((tiled
+00015560: 5f63 6f6f 7264 7320 2d20 7469 6c65 645f  _coords - tiled_
+00015570: 6365 6c6c 7329 2a2a 322c 2064 696d 3d2d  cells)**2, dim=-
+00015580: 3129 0a20 2020 2020 2020 2023 2053 6861  1).        # Sha
+00015590: 7065 2028 6e5f 6365 6c6c 732c 204e 5f61  pe (n_cells, N_a
+000155a0: 746f 6d73 290a 2020 2020 2020 2020 636f  toms).        co
+000155b0: 6f72 6473 5f6e 6f72 6d20 3d20 746f 7263  ords_norm = torc
+000155c0: 682e 7265 7368 6170 6528 636f 6f72 6473  h.reshape(coords
+000155d0: 5f76 6563 2c20 286e 5f63 656c 6c73 2c20  _vec, (n_cells, 
+000155e0: 4e5f 6174 6f6d 7329 290a 0a20 2020 2020  N_atoms))..     
+000155f0: 2020 2023 2046 696e 6420 6b20 6174 6f6d     # Find k atom
+00015600: 7320 636c 6f73 6573 7420 746f 2074 6869  s closest to thi
+00015610: 7320 6365 6c6c 2e0a 2020 2020 2020 2020  s cell..        
+00015620: 2320 5465 6e73 6f72 206f 6620 7368 6170  # Tensor of shap
+00015630: 6520 286e 5f63 656c 6c73 2c20 4d5f 6e62  e (n_cells, M_nb
+00015640: 7273 290a 2020 2020 2020 2020 636c 6f73  rs).        clos
+00015650: 6573 745f 696e 6473 203d 2074 6f72 6368  est_inds = torch
+00015660: 2e74 6f70 6b28 636f 6f72 6473 5f6e 6f72  .topk(coords_nor
+00015670: 6d2c 206b 3d4d 5f6e 6272 732c 206c 6172  m, k=M_nbrs, lar
+00015680: 6765 7374 3d46 616c 7365 295b 315d 0a0a  gest=False)[1]..
+00015690: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+000156a0: 6c6f 7365 7374 5f69 6e64 730a 0a20 2020  losest_inds..   
+000156b0: 2064 6566 2067 6574 5f63 656c 6c73 5f66   def get_cells_f
+000156c0: 6f72 5f61 746f 6d73 2873 656c 662c 2063  or_atoms(self, c
+000156d0: 6f6f 7264 733a 2074 6f72 6368 2e54 656e  oords: torch.Ten
+000156e0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
+000156f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015700: 2063 656c 6c73 3a20 746f 7263 682e 5465   cells: torch.Te
+00015710: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
+00015720: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
+00015730: 2222 436f 6d70 7574 6520 7468 6520 6365  ""Compute the ce
+00015740: 6c6c 7320 6561 6368 2061 746f 6d20 6265  lls each atom be
+00015750: 6c6f 6e67 7320 746f 2e0a 0a20 2020 2020  longs to...     
+00015760: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00015770: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00015780: 0a20 2020 2020 2020 2063 6f6f 7264 733a  .        coords:
+00015790: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+000157a0: 2020 2020 2020 2020 2020 5368 6170 6520            Shape 
+000157b0: 284e 5f61 746f 6d73 2c20 6e64 696d 290a  (N_atoms, ndim).
+000157c0: 2020 2020 2020 2020 6365 6c6c 733a 2074          cells: t
+000157d0: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+000157e0: 2020 2020 2020 2020 286e 5f63 656c 6c73          (n_cells
+000157f0: 2c20 6e64 696d 2920 7368 6170 652e 0a20  , ndim) shape.. 
+00015800: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00015810: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+00015820: 2020 2020 2020 2063 656c 6c73 5f66 6f72         cells_for
+00015830: 5f61 746f 6d73 3a20 746f 7263 682e 5465  _atoms: torch.Te
+00015840: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+00015850: 2053 6861 7065 2028 4e5f 6174 6f6d 732c   Shape (N_atoms,
+00015860: 2031 290a 2020 2020 2020 2020 2222 220a   1).        """.
+00015870: 2020 2020 2020 2020 4e5f 6174 6f6d 732c          N_atoms,
+00015880: 206e 5f63 656c 6c73 2c20 6e64 696d 203d   n_cells, ndim =
+00015890: 2073 656c 662e 4e5f 6174 6f6d 732c 2073   self.N_atoms, s
+000158a0: 656c 662e 6e5f 6365 6c6c 732c 2073 656c  elf.n_cells, sel
+000158b0: 662e 6e64 696d 0a20 2020 2020 2020 206e  f.ndim.        n
+000158c0: 5f63 656c 6c73 203d 2069 6e74 286e 5f63  _cells = int(n_c
+000158d0: 656c 6c73 290a 2020 2020 2020 2020 2320  ells).        # 
+000158e0: 5469 6c65 2062 6f74 6820 6365 6c6c 7320  Tile both cells 
+000158f0: 616e 6420 636f 6f72 6473 2074 6f20 666f  and coords to fo
+00015900: 726d 2061 7272 6179 7320 6f66 2073 697a  rm arrays of siz
+00015910: 6520 284e 5f61 746f 6d73 2a6e 5f63 656c  e (N_atoms*n_cel
+00015920: 6c73 2c20 6e64 696d 290a 2020 2020 2020  ls, ndim).      
+00015930: 2020 7469 6c65 645f 6365 6c6c 7320 3d20    tiled_cells = 
+00015940: 746f 7263 682e 7469 6c65 2863 656c 6c73  torch.tile(cells
+00015950: 2c20 284e 5f61 746f 6d73 2c20 3129 290a  , (N_atoms, 1)).
+00015960: 0a20 2020 2020 2020 2023 2053 6861 7065  .        # Shape
+00015970: 2028 4e5f 6174 6f6d 732a 6e5f 6365 6c6c   (N_atoms*n_cell
+00015980: 732c 2031 2920 6166 7465 7220 7469 6c65  s, 1) after tile
+00015990: 0a20 2020 2020 2020 2074 696c 6564 5f63  .        tiled_c
+000159a0: 6f6f 7264 7320 3d20 746f 7263 682e 7265  oords = torch.re
+000159b0: 7368 6170 6528 746f 7263 682e 7469 6c65  shape(torch.tile
+000159c0: 2863 6f6f 7264 732c 2028 312c 206e 5f63  (coords, (1, n_c
+000159d0: 656c 6c73 2929 2c0a 2020 2020 2020 2020  ells)),.        
 000159e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159f0: 286e 5f63 656c 6c73 202a 204e 5f61 746f  (n_cells * N_ato
-00015a00: 6d73 2c20 6e64 696d 2929 0a20 2020 2020  ms, ndim)).     
-00015a10: 2020 2063 6f6f 7264 735f 7665 6320 3d20     coords_vec = 
-00015a20: 746f 7263 682e 7375 6d28 2874 696c 6564  torch.sum((tiled
-00015a30: 5f63 6f6f 7264 7320 2d20 7469 6c65 645f  _coords - tiled_
-00015a40: 6365 6c6c 7329 2a2a 322c 2064 696d 3d2d  cells)**2, dim=-
-00015a50: 3129 0a20 2020 2020 2020 2063 6f6f 7264  1).        coord
-00015a60: 735f 6e6f 726d 203d 2074 6f72 6368 2e72  s_norm = torch.r
-00015a70: 6573 6861 7065 2863 6f6f 7264 735f 7665  eshape(coords_ve
-00015a80: 632c 2028 4e5f 6174 6f6d 732c 206e 5f63  c, (N_atoms, n_c
-00015a90: 656c 6c73 2929 0a0a 2020 2020 2020 2020  ells))..        
-00015aa0: 636c 6f73 6573 745f 696e 6473 203d 2074  closest_inds = t
-00015ab0: 6f72 6368 2e74 6f70 6b28 636f 6f72 6473  orch.topk(coords
-00015ac0: 5f6e 6f72 6d2c 206b 3d31 2c20 6c61 7267  _norm, k=1, larg
-00015ad0: 6573 743d 4661 6c73 6529 5b31 5d0a 0a20  est=False)[1].. 
-00015ae0: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
-00015af0: 6f73 6573 745f 696e 6473 0a0a 2020 2020  osest_inds..    
-00015b00: 6465 6620 5f67 6574 5f6e 756d 5f6e 6272  def _get_num_nbr
-00015b10: 7328 7365 6c66 2920 2d3e 2069 6e74 3a0a  s(self) -> int:.
-00015b20: 2020 2020 2020 2020 2222 2247 6574 206e          """Get n
-00015b30: 756d 6265 7220 6f66 206e 6569 6768 626f  umber of neighbo
-00015b40: 7273 2069 6e20 6375 7272 656e 7420 6469  rs in current di
-00015b50: 6d65 6e73 696f 6e61 6c69 7479 2073 7061  mensionality spa
-00015b60: 6365 2e22 2222 0a20 2020 2020 2020 2072  ce.""".        r
-00015b70: 6574 7572 6e20 332a 2a73 656c 662e 6e64  eturn 3**self.nd
-00015b80: 696d 0a0a 2020 2020 6465 6620 6765 745f  im..    def get_
-00015b90: 6e65 6967 6862 6f72 5f63 656c 6c73 2873  neighbor_cells(s
-00015ba0: 656c 662c 2063 656c 6c73 3a20 746f 7263  elf, cells: torc
-00015bb0: 682e 5465 6e73 6f72 2920 2d3e 2074 6f72  h.Tensor) -> tor
-00015bc0: 6368 2e54 656e 736f 723a 0a20 2020 2020  ch.Tensor:.     
-00015bd0: 2020 2022 2222 436f 6d70 7574 6520 6e65     """Compute ne
-00015be0: 6967 6862 6f72 7320 6f66 2063 656c 6c73  ighbors of cells
-00015bf0: 2069 6e20 6772 6964 2e0a 0a20 2020 2020   in grid...     
-00015c00: 2020 2023 2054 4f44 4f28 7262 6861 7261     # TODO(rbhara
-00015c10: 7468 293a 2044 6f20 7765 206e 6565 6420  th): Do we need 
-00015c20: 746f 2068 616e 646c 6520 7065 7269 6f64  to handle period
-00015c30: 6963 2062 6f75 6e64 6172 7920 636f 6e64  ic boundary cond
-00015c40: 6974 696f 6e73 0a20 2020 2020 2020 2070  itions.        p
-00015c50: 726f 7065 726c 7920 6865 7265 3f0a 2020  roperly here?.  
-00015c60: 2020 2020 2020 2320 544f 444f 2872 6268        # TODO(rbh
-00015c70: 6172 6174 6829 3a20 5468 6973 2064 6f65  arath): This doe
-00015c80: 736e 2774 2068 616e 646c 6520 626f 756e  sn't handle boun
-00015c90: 6461 7269 6573 2077 656c 6c2e 2057 6520  daries well. We 
-00015ca0: 6861 7264 2d63 6f64 650a 2020 2020 2020  hard-code.      
-00015cb0: 2020 2320 6c6f 6f6b 696e 6720 666f 7220    # looking for 
-00015cc0: 6e5f 6e62 725f 6365 6c6c 7320 6e65 6967  n_nbr_cells neig
-00015cd0: 6862 6f72 732c 2077 6869 6368 2069 736e  hbors, which isn
-00015ce0: 2774 2072 6967 6874 2066 6f72 2062 6f75  't right for bou
-00015cf0: 6e64 6172 7920 6365 6c6c 7320 696e 0a20  ndary cells in. 
-00015d00: 2020 2020 2020 2023 2074 6865 2063 7562         # the cub
-00015d10: 652e 0a0a 2020 2020 2020 2020 5061 7261  e...        Para
-00015d20: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00015d30: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00015d40: 2020 6365 6c6c 733a 2074 6f72 6368 2e54    cells: torch.T
-00015d50: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00015d60: 2020 286e 5f63 656c 6c73 2c20 6e64 696d    (n_cells, ndim
-00015d70: 2920 7368 6170 652e 0a20 2020 2020 2020  ) shape..       
-00015d80: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00015d90: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-00015da0: 206e 6272 5f63 656c 6c73 3a20 746f 7263   nbr_cells: torc
-00015db0: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00015dc0: 2020 2020 2028 6e5f 6365 6c6c 732c 206e       (n_cells, n
-00015dd0: 5f6e 6272 5f63 656c 6c73 290a 2020 2020  _nbr_cells).    
-00015de0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00015df0: 6e64 696d 2c20 6e5f 6365 6c6c 7320 3d20  ndim, n_cells = 
-00015e00: 7365 6c66 2e6e 6469 6d2c 2073 656c 662e  self.ndim, self.
-00015e10: 6e5f 6365 6c6c 730a 2020 2020 2020 2020  n_cells.        
-00015e20: 6e5f 6e62 725f 6365 6c6c 7320 3d20 7365  n_nbr_cells = se
-00015e30: 6c66 2e5f 6765 745f 6e75 6d5f 6e62 7273  lf._get_num_nbrs
-00015e40: 2829 0a20 2020 2020 2020 2023 2054 696c  ().        # Til
-00015e50: 6520 6365 6c6c 7320 746f 2066 6f72 6d20  e cells to form 
-00015e60: 6172 7261 7973 206f 6620 7369 7a65 2028  arrays of size (
-00015e70: 6e5f 6365 6c6c 732a 6e5f 6365 6c6c 732c  n_cells*n_cells,
-00015e80: 206e 6469 6d29 0a20 2020 2020 2020 2023   ndim).        #
-00015e90: 2054 776f 2074 696c 696e 6773 2028 612c   Two tilings (a,
-00015ea0: 2062 2c20 632c 2061 2c20 622c 2063 2c20   b, c, a, b, c, 
-00015eb0: 2e2e 2e29 2076 732e 2028 612c 2061 2c20  ...) vs. (a, a, 
-00015ec0: 612c 2062 2c20 622c 2062 2c20 6574 632e  a, b, b, b, etc.
-00015ed0: 290a 2020 2020 2020 2020 2320 5469 6c65  ).        # Tile
-00015ee0: 2028 612c 2061 2c20 612c 2062 2c20 622c   (a, a, a, b, b,
-00015ef0: 2062 2c20 6574 632e 290a 2020 2020 2020   b, etc.).      
-00015f00: 2020 7469 6c65 645f 6365 6e74 6572 7320    tiled_centers 
-00015f10: 3d20 746f 7263 682e 7265 7368 6170 6528  = torch.reshape(
-00015f20: 746f 7263 682e 7469 6c65 2863 656c 6c73  torch.tile(cells
-00015f30: 2c20 2831 2c20 6e5f 6365 6c6c 7329 292c  , (1, n_cells)),
-00015f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000159f0: 2020 2020 2020 2020 2020 2020 2028 6e5f               (n_
+00015a00: 6365 6c6c 7320 2a20 4e5f 6174 6f6d 732c  cells * N_atoms,
+00015a10: 206e 6469 6d29 290a 2020 2020 2020 2020   ndim)).        
+00015a20: 636f 6f72 6473 5f76 6563 203d 2074 6f72  coords_vec = tor
+00015a30: 6368 2e73 756d 2828 7469 6c65 645f 636f  ch.sum((tiled_co
+00015a40: 6f72 6473 202d 2074 696c 6564 5f63 656c  ords - tiled_cel
+00015a50: 6c73 292a 2a32 2c20 6469 6d3d 2d31 290a  ls)**2, dim=-1).
+00015a60: 2020 2020 2020 2020 636f 6f72 6473 5f6e          coords_n
+00015a70: 6f72 6d20 3d20 746f 7263 682e 7265 7368  orm = torch.resh
+00015a80: 6170 6528 636f 6f72 6473 5f76 6563 2c20  ape(coords_vec, 
+00015a90: 284e 5f61 746f 6d73 2c20 6e5f 6365 6c6c  (N_atoms, n_cell
+00015aa0: 7329 290a 0a20 2020 2020 2020 2063 6c6f  s))..        clo
+00015ab0: 7365 7374 5f69 6e64 7320 3d20 746f 7263  sest_inds = torc
+00015ac0: 682e 746f 706b 2863 6f6f 7264 735f 6e6f  h.topk(coords_no
+00015ad0: 726d 2c20 6b3d 312c 206c 6172 6765 7374  rm, k=1, largest
+00015ae0: 3d46 616c 7365 295b 315d 0a0a 2020 2020  =False)[1]..    
+00015af0: 2020 2020 7265 7475 726e 2063 6c6f 7365      return close
+00015b00: 7374 5f69 6e64 730a 0a20 2020 2064 6566  st_inds..    def
+00015b10: 205f 6765 745f 6e75 6d5f 6e62 7273 2873   _get_num_nbrs(s
+00015b20: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
+00015b30: 2020 2020 2022 2222 4765 7420 6e75 6d62       """Get numb
+00015b40: 6572 206f 6620 6e65 6967 6862 6f72 7320  er of neighbors 
+00015b50: 696e 2063 7572 7265 6e74 2064 696d 656e  in current dimen
+00015b60: 7369 6f6e 616c 6974 7920 7370 6163 652e  sionality space.
+00015b70: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00015b80: 726e 2033 2a2a 7365 6c66 2e6e 6469 6d0a  rn 3**self.ndim.
+00015b90: 0a20 2020 2064 6566 2067 6574 5f6e 6569  .    def get_nei
+00015ba0: 6768 626f 725f 6365 6c6c 7328 7365 6c66  ghbor_cells(self
+00015bb0: 2c20 6365 6c6c 733a 2074 6f72 6368 2e54  , cells: torch.T
+00015bc0: 656e 736f 7229 202d 3e20 746f 7263 682e  ensor) -> torch.
+00015bd0: 5465 6e73 6f72 3a0a 2020 2020 2020 2020  Tensor:.        
+00015be0: 2222 2243 6f6d 7075 7465 206e 6569 6768  """Compute neigh
+00015bf0: 626f 7273 206f 6620 6365 6c6c 7320 696e  bors of cells in
+00015c00: 2067 7269 642e 0a0a 2020 2020 2020 2020   grid...        
+00015c10: 2320 544f 444f 2872 6268 6172 6174 6829  # TODO(rbharath)
+00015c20: 3a20 446f 2077 6520 6e65 6564 2074 6f20  : Do we need to 
+00015c30: 6861 6e64 6c65 2070 6572 696f 6469 6320  handle periodic 
+00015c40: 626f 756e 6461 7279 2063 6f6e 6469 7469  boundary conditi
+00015c50: 6f6e 730a 2020 2020 2020 2020 7072 6f70  ons.        prop
+00015c60: 6572 6c79 2068 6572 653f 0a20 2020 2020  erly here?.     
+00015c70: 2020 2023 2054 4f44 4f28 7262 6861 7261     # TODO(rbhara
+00015c80: 7468 293a 2054 6869 7320 646f 6573 6e27  th): This doesn'
+00015c90: 7420 6861 6e64 6c65 2062 6f75 6e64 6172  t handle boundar
+00015ca0: 6965 7320 7765 6c6c 2e20 5765 2068 6172  ies well. We har
+00015cb0: 642d 636f 6465 0a20 2020 2020 2020 2023  d-code.        #
+00015cc0: 206c 6f6f 6b69 6e67 2066 6f72 206e 5f6e   looking for n_n
+00015cd0: 6272 5f63 656c 6c73 206e 6569 6768 626f  br_cells neighbo
+00015ce0: 7273 2c20 7768 6963 6820 6973 6e27 7420  rs, which isn't 
+00015cf0: 7269 6768 7420 666f 7220 626f 756e 6461  right for bounda
+00015d00: 7279 2063 656c 6c73 2069 6e0a 2020 2020  ry cells in.    
+00015d10: 2020 2020 2320 7468 6520 6375 6265 2e0a      # the cube..
+00015d20: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00015d30: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00015d40: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2063  ------.        c
+00015d50: 656c 6c73 3a20 746f 7263 682e 5465 6e73  ells: torch.Tens
+00015d60: 6f72 0a20 2020 2020 2020 2020 2020 2028  or.            (
+00015d70: 6e5f 6365 6c6c 732c 206e 6469 6d29 2073  n_cells, ndim) s
+00015d80: 6861 7065 2e0a 2020 2020 2020 2020 5265  hape..        Re
+00015d90: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+00015da0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6e62  -----.        nb
+00015db0: 725f 6365 6c6c 733a 2074 6f72 6368 2e54  r_cells: torch.T
+00015dc0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00015dd0: 2020 286e 5f63 656c 6c73 2c20 6e5f 6e62    (n_cells, n_nb
+00015de0: 725f 6365 6c6c 7329 0a20 2020 2020 2020  r_cells).       
+00015df0: 2022 2222 0a20 2020 2020 2020 206e 6469   """.        ndi
+00015e00: 6d2c 206e 5f63 656c 6c73 203d 2073 656c  m, n_cells = sel
+00015e10: 662e 6e64 696d 2c20 7365 6c66 2e6e 5f63  f.ndim, self.n_c
+00015e20: 656c 6c73 0a20 2020 2020 2020 206e 5f6e  ells.        n_n
+00015e30: 6272 5f63 656c 6c73 203d 2073 656c 662e  br_cells = self.
+00015e40: 5f67 6574 5f6e 756d 5f6e 6272 7328 290a  _get_num_nbrs().
+00015e50: 2020 2020 2020 2020 2320 5469 6c65 2063          # Tile c
+00015e60: 656c 6c73 2074 6f20 666f 726d 2061 7272  ells to form arr
+00015e70: 6179 7320 6f66 2073 697a 6520 286e 5f63  ays of size (n_c
+00015e80: 656c 6c73 2a6e 5f63 656c 6c73 2c20 6e64  ells*n_cells, nd
+00015e90: 696d 290a 2020 2020 2020 2020 2320 5477  im).        # Tw
+00015ea0: 6f20 7469 6c69 6e67 7320 2861 2c20 622c  o tilings (a, b,
+00015eb0: 2063 2c20 612c 2062 2c20 632c 202e 2e2e   c, a, b, c, ...
+00015ec0: 2920 7673 2e20 2861 2c20 612c 2061 2c20  ) vs. (a, a, a, 
+00015ed0: 622c 2062 2c20 622c 2065 7463 2e29 0a20  b, b, b, etc.). 
+00015ee0: 2020 2020 2020 2023 2054 696c 6520 2861         # Tile (a
+00015ef0: 2c20 612c 2061 2c20 622c 2062 2c20 622c  , a, a, b, b, b,
+00015f00: 2065 7463 2e29 0a20 2020 2020 2020 2074   etc.).        t
+00015f10: 696c 6564 5f63 656e 7465 7273 203d 2074  iled_centers = t
+00015f20: 6f72 6368 2e72 6573 6861 7065 2874 6f72  orch.reshape(tor
+00015f30: 6368 2e74 696c 6528 6365 6c6c 732c 2028  ch.tile(cells, (
+00015f40: 312c 206e 5f63 656c 6c73 2929 2c0a 2020  1, n_cells)),.  
 00015f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f60: 2020 2020 2020 2028 6e5f 6365 6c6c 7320         (n_cells 
-00015f70: 2a20 6e5f 6365 6c6c 732c 206e 6469 6d29  * n_cells, ndim)
-00015f80: 290a 2020 2020 2020 2020 2320 5469 6c65  ).        # Tile
-00015f90: 2028 612c 2062 2c20 632c 2061 2c20 622c   (a, b, c, a, b,
-00015fa0: 2063 2c20 2e2e 2e29 0a20 2020 2020 2020   c, ...).       
-00015fb0: 2074 696c 6564 5f63 656c 6c73 203d 2074   tiled_cells = t
-00015fc0: 6f72 6368 2e74 696c 6528 6365 6c6c 732c  orch.tile(cells,
-00015fd0: 2028 6e5f 6365 6c6c 732c 2031 2929 0a0a   (n_cells, 1))..
-00015fe0: 2020 2020 2020 2020 636f 6f72 6473 5f76          coords_v
-00015ff0: 6563 203d 2074 6f72 6368 2e73 756d 2828  ec = torch.sum((
-00016000: 7469 6c65 645f 6365 6e74 6572 7320 2d20  tiled_centers - 
-00016010: 7469 6c65 645f 6365 6c6c 7329 2a2a 322c  tiled_cells)**2,
-00016020: 2064 696d 3d2d 3129 0a20 2020 2020 2020   dim=-1).       
-00016030: 2063 6f6f 7264 735f 6e6f 726d 203d 2074   coords_norm = t
-00016040: 6f72 6368 2e72 6573 6861 7065 2863 6f6f  orch.reshape(coo
-00016050: 7264 735f 7665 632c 2028 6e5f 6365 6c6c  rds_vec, (n_cell
-00016060: 732c 206e 5f63 656c 6c73 2929 0a20 2020  s, n_cells)).   
-00016070: 2020 2020 2063 6c6f 7365 7374 5f69 6e64       closest_ind
-00016080: 7320 3d20 746f 7263 682e 746f 706b 2863  s = torch.topk(c
-00016090: 6f6f 7264 735f 6e6f 726d 2c20 6b3d 6e5f  oords_norm, k=n_
-000160a0: 6e62 725f 6365 6c6c 732c 206c 6172 6765  nbr_cells, large
-000160b0: 7374 3d46 616c 7365 295b 315d 0a0a 2020  st=False)[1]..  
-000160c0: 2020 2020 2020 7265 7475 726e 2063 6c6f        return clo
-000160d0: 7365 7374 5f69 6e64 730a 0a20 2020 2064  sest_inds..    d
-000160e0: 6566 2067 6574 5f63 656c 6c73 2873 656c  ef get_cells(sel
-000160f0: 6629 202d 3e20 746f 7263 682e 5465 6e73  f) -> torch.Tens
-00016100: 6f72 3a0a 2020 2020 2020 2020 2222 2252  or:.        """R
-00016110: 6574 7572 6e73 2074 6865 206c 6f63 6174  eturns the locat
-00016120: 696f 6e73 206f 6620 616c 6c20 6772 6964  ions of all grid
-00016130: 2070 6f69 6e74 7320 696e 2062 6f78 2e0a   points in box..
-00016140: 0a20 2020 2020 2020 2053 7570 706f 7365  .        Suppose
-00016150: 2073 7461 7274 2069 7320 2d31 3020 416e   start is -10 An
-00016160: 6773 7472 6f6d 2c20 7374 6f70 2069 7320  gstrom, stop is 
-00016170: 3130 2041 6e67 7374 726f 6d2c 206e 6272  10 Angstrom, nbr
-00016180: 5f63 7574 6f66 6620 6973 2031 2e0a 2020  _cutoff is 1..  
-00016190: 2020 2020 2020 5468 656e 2077 6f75 6c64        Then would
-000161a0: 2072 6574 7572 6e20 6120 6c69 7374 206f   return a list o
-000161b0: 6620 6c65 6e67 7468 2032 305e 3320 7768  f length 20^3 wh
-000161c0: 6f73 6520 656e 7472 6965 7320 776f 756c  ose entries woul
-000161d0: 6420 6265 0a20 2020 2020 2020 205b 282d  d be.        [(-
-000161e0: 3130 2c20 2d31 302c 202d 3130 292c 2028  10, -10, -10), (
-000161f0: 2d31 302c 202d 3130 2c20 2d39 292c 202e  -10, -10, -9), .
-00016200: 2e2e 2c20 2839 2c20 392c 2039 295d 0a0a  .., (9, 9, 9)]..
-00016210: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00016220: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00016230: 2020 2020 2020 2020 6365 6c6c 733a 2074          cells: t
-00016240: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-00016250: 2020 2020 2020 286e 5f63 656c 6c73 2c20        (n_cells, 
-00016260: 6e64 696d 2920 7368 6170 652e 0a20 2020  ndim) shape..   
-00016270: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016280: 2073 7461 7274 2c20 7374 6f70 2c20 6e62   start, stop, nb
-00016290: 725f 6375 746f 6666 203d 2073 656c 662e  r_cutoff = self.
-000162a0: 7374 6172 742c 2073 656c 662e 7374 6f70  start, self.stop
-000162b0: 2c20 7365 6c66 2e6e 6272 5f63 7574 6f66  , self.nbr_cutof
-000162c0: 660a 2020 2020 2020 2020 6d65 7368 5f61  f.        mesh_a
-000162d0: 7267 7320 3d20 5b0a 2020 2020 2020 2020  rgs = [.        
-000162e0: 2020 2020 746f 7263 682e 6172 616e 6765      torch.arange
-000162f0: 2873 7461 7274 2c20 7374 6f70 2c20 6e62  (start, stop, nb
-00016300: 725f 6375 746f 6666 2920 666f 7220 5f20  r_cutoff) for _ 
-00016310: 696e 2072 616e 6765 2873 656c 662e 6e64  in range(self.nd
-00016320: 696d 290a 2020 2020 2020 2020 5d0a 2020  im).        ].  
-00016330: 2020 2020 2020 7265 7475 726e 2074 6f72        return tor
-00016340: 6368 2e72 6573 6861 7065 280a 2020 2020  ch.reshape(.    
-00016350: 2020 2020 2020 2020 746f 7263 682e 7065          torch.pe
-00016360: 726d 7574 6528 0a20 2020 2020 2020 2020  rmute(.         
-00016370: 2020 2020 2020 2074 6f72 6368 2e73 7461         torch.sta
-00016380: 636b 2874 6f72 6368 2e6d 6573 6867 7269  ck(torch.meshgri
-00016390: 6428 2a6d 6573 685f 6172 6773 2c20 696e  d(*mesh_args, in
-000163a0: 6465 7869 6e67 3d27 7879 2729 292c 0a20  dexing='xy')),. 
-000163b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000163c0: 7570 6c65 2872 616e 6765 2873 656c 662e  uple(range(self.
-000163d0: 6e64 696d 2c20 2d31 2c20 2d31 2929 292c  ndim, -1, -1))),
-000163e0: 0a20 2020 2020 2020 2020 2020 2028 7365  .            (se
-000163f0: 6c66 2e6e 5f63 656c 6c73 2c20 7365 6c66  lf.n_cells, self
-00016400: 2e6e 6469 6d29 292e 746f 2874 6f72 6368  .ndim)).to(torch
-00016410: 2e66 6c6f 6174 290a 0a0a 636c 6173 7320  .float)...class 
-00016420: 4c53 544d 5374 6570 286e 6e2e 4d6f 6475  LSTMStep(nn.Modu
-00016430: 6c65 293a 0a20 2020 2022 2222 4c61 7965  le):.    """Laye
-00016440: 7220 7468 6174 2070 6572 666f 726d 7320  r that performs 
-00016450: 6120 7369 6e67 6c65 2073 7465 7020 4c53  a single step LS
-00016460: 544d 2075 7064 6174 652e 0a0a 2020 2020  TM update...    
-00016470: 5468 6973 2069 7320 7468 6520 546f 7263  This is the Torc
-00016480: 6820 6571 7569 7661 6c65 6e74 206f 6620  h equivalent of 
-00016490: 7468 6520 6f72 6967 696e 616c 2069 6d70  the original imp
-000164a0: 6c65 6d65 6e74 6174 696f 6e20 7573 696e  lementation usin
-000164b0: 6720 4b65 7261 732e 0a20 2020 2022 2222  g Keras..    """
-000164c0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-000164d0: 5f5f 2873 656c 662c 0a20 2020 2020 2020  __(self,.       
-000164e0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-000164f0: 5f64 696d 2c0a 2020 2020 2020 2020 2020  _dim,.          
-00016500: 2020 2020 2020 2069 6e70 7574 5f64 696d         input_dim
-00016510: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016520: 2020 2069 6e69 745f 666e 3d27 7861 7669     init_fn='xavi
-00016530: 6572 5f75 6e69 666f 726d 5f27 2c0a 2020  er_uniform_',.  
-00016540: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016550: 6e6e 6572 5f69 6e69 745f 666e 3d27 6f72  nner_init_fn='or
-00016560: 7468 6f67 6f6e 616c 5f27 2c0a 2020 2020  thogonal_',.    
-00016570: 2020 2020 2020 2020 2020 2020 2061 6374               act
-00016580: 6976 6174 696f 6e5f 666e 3d27 7461 6e68  ivation_fn='tanh
-00016590: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-000165a0: 2020 2020 696e 6e65 725f 6163 7469 7661      inner_activa
-000165b0: 7469 6f6e 5f66 6e3d 2768 6172 6473 6967  tion_fn='hardsig
-000165c0: 6d6f 6964 272c 0a20 2020 2020 2020 2020  moid',.         
-000165d0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-000165e0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-000165f0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00016600: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00016610: 2d2d 2d2d 0a20 2020 2020 2020 206f 7574  ----.        out
-00016620: 7075 745f 6469 6d3a 2069 6e74 0a20 2020  put_dim: int.   
-00016630: 2020 2020 2020 2020 2044 696d 656e 7369           Dimensi
-00016640: 6f6e 616c 6974 7920 6f66 206f 7574 7075  onality of outpu
-00016650: 7420 7665 6374 6f72 732e 0a20 2020 2020  t vectors..     
-00016660: 2020 2069 6e70 7574 5f64 696d 3a20 696e     input_dim: in
-00016670: 740a 2020 2020 2020 2020 2020 2020 4469  t.            Di
-00016680: 6d65 6e73 696f 6e61 6c69 7479 206f 6620  mensionality of 
-00016690: 696e 7075 7420 7665 6374 6f72 732e 0a20  input vectors.. 
-000166a0: 2020 2020 2020 2069 6e69 745f 666e 3a20         init_fn: 
-000166b0: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-000166c0: 5079 546f 7263 6820 696e 6974 6961 6c69  PyTorch initiali
-000166d0: 7a61 7469 6f6e 2074 6f20 7573 6520 666f  zation to use fo
-000166e0: 7220 572e 0a20 2020 2020 2020 2069 6e6e  r W..        inn
-000166f0: 6572 5f69 6e69 745f 666e 3a20 7374 720a  er_init_fn: str.
-00016700: 2020 2020 2020 2020 2020 2020 5079 546f              PyTo
-00016710: 7263 6820 696e 6974 6961 6c69 7a61 7469  rch initializati
-00016720: 6f6e 2074 6f20 7573 6520 666f 7220 552e  on to use for U.
-00016730: 0a20 2020 2020 2020 2061 6374 6976 6174  .        activat
-00016740: 696f 6e5f 666e 3a20 7374 720a 2020 2020  ion_fn: str.    
-00016750: 2020 2020 2020 2020 5079 546f 7263 6820          PyTorch 
-00016760: 6163 7469 7661 7469 6f6e 2074 6f20 7573  activation to us
-00016770: 6520 666f 7220 6f75 7470 7574 2e0a 2020  e for output..  
-00016780: 2020 2020 2020 696e 6e65 725f 6163 7469        inner_acti
-00016790: 7661 7469 6f6e 5f66 6e3a 2073 7472 0a20  vation_fn: str. 
-000167a0: 2020 2020 2020 2020 2020 2050 7954 6f72             PyTor
-000167b0: 6368 2061 6374 6976 6174 696f 6e20 746f  ch activation to
-000167c0: 2075 7365 2066 6f72 2069 6e6e 6572 2073   use for inner s
-000167d0: 7465 7073 2e0a 2020 2020 2020 2020 2222  teps..        ""
-000167e0: 220a 0a20 2020 2020 2020 2073 7570 6572  "..        super
-000167f0: 284c 5354 4d53 7465 702c 2073 656c 6629  (LSTMStep, self)
-00016800: 2e5f 5f69 6e69 745f 5f28 2a2a 6b77 6172  .__init__(**kwar
-00016810: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
-00016820: 2e69 6e69 7420 3d20 696e 6974 5f66 6e0a  .init = init_fn.
-00016830: 2020 2020 2020 2020 7365 6c66 2e69 6e6e          self.inn
-00016840: 6572 5f69 6e69 7420 3d20 696e 6e65 725f  er_init = inner_
-00016850: 696e 6974 5f66 6e0a 2020 2020 2020 2020  init_fn.        
-00016860: 7365 6c66 2e6f 7574 7075 745f 6469 6d20  self.output_dim 
-00016870: 3d20 6f75 7470 7574 5f64 696d 0a20 2020  = output_dim.   
-00016880: 2020 2020 2023 204e 6f20 6f74 6865 7220       # No other 
-00016890: 666f 7267 6574 2062 6961 7365 7320 7375  forget biases su
-000168a0: 7070 6f72 7465 6420 7269 6768 7420 6e6f  pported right no
-000168b0: 772e 0a20 2020 2020 2020 2073 656c 662e  w..        self.
-000168c0: 6163 7469 7661 7469 6f6e 203d 2061 6374  activation = act
-000168d0: 6976 6174 696f 6e5f 666e 0a20 2020 2020  ivation_fn.     
-000168e0: 2020 2073 656c 662e 696e 6e65 725f 6163     self.inner_ac
-000168f0: 7469 7661 7469 6f6e 203d 2069 6e6e 6572  tivation = inner
-00016900: 5f61 6374 6976 6174 696f 6e5f 666e 0a20  _activation_fn. 
-00016910: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
-00016920: 7661 7469 6f6e 5f66 6e20 3d20 6765 745f  vation_fn = get_
-00016930: 6163 7469 7661 7469 6f6e 2861 6374 6976  activation(activ
-00016940: 6174 696f 6e5f 666e 290a 2020 2020 2020  ation_fn).      
-00016950: 2020 7365 6c66 2e69 6e6e 6572 5f61 6374    self.inner_act
-00016960: 6976 6174 696f 6e5f 666e 203d 2067 6574  ivation_fn = get
-00016970: 5f61 6374 6976 6174 696f 6e28 696e 6e65  _activation(inne
-00016980: 725f 6163 7469 7661 7469 6f6e 5f66 6e29  r_activation_fn)
-00016990: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-000169a0: 7075 745f 6469 6d20 3d20 696e 7075 745f  put_dim = input_
-000169b0: 6469 6d0a 2020 2020 2020 2020 7365 6c66  dim.        self
-000169c0: 2e62 7569 6c64 2829 0a0a 2020 2020 6465  .build()..    de
-000169d0: 6620 6765 745f 636f 6e66 6967 2873 656c  f get_config(sel
-000169e0: 6629 3a0a 2020 2020 2020 2020 636f 6e66  f):.        conf
-000169f0: 6967 203d 2073 7570 6572 284c 5354 4d53  ig = super(LSTMS
-00016a00: 7465 702c 2073 656c 6629 2e67 6574 5f63  tep, self).get_c
-00016a10: 6f6e 6669 6728 290a 2020 2020 2020 2020  onfig().        
-00016a20: 636f 6e66 6967 5b27 6f75 7470 7574 5f64  config['output_d
-00016a30: 696d 275d 203d 2073 656c 662e 6f75 7470  im'] = self.outp
-00016a40: 7574 5f64 696d 0a20 2020 2020 2020 2063  ut_dim.        c
-00016a50: 6f6e 6669 675b 2769 6e70 7574 5f64 696d  onfig['input_dim
-00016a60: 275d 203d 2073 656c 662e 696e 7075 745f  '] = self.input_
-00016a70: 6469 6d0a 2020 2020 2020 2020 636f 6e66  dim.        conf
-00016a80: 6967 5b27 696e 6974 5f66 6e27 5d20 3d20  ig['init_fn'] = 
-00016a90: 7365 6c66 2e69 6e69 740a 2020 2020 2020  self.init.      
-00016aa0: 2020 636f 6e66 6967 5b27 696e 6e65 725f    config['inner_
-00016ab0: 696e 6974 5f66 6e27 5d20 3d20 7365 6c66  init_fn'] = self
-00016ac0: 2e69 6e6e 6572 5f69 6e69 740a 2020 2020  .inner_init.    
-00016ad0: 2020 2020 636f 6e66 6967 5b27 6163 7469      config['acti
-00016ae0: 7661 7469 6f6e 5f66 6e27 5d20 3d20 7365  vation_fn'] = se
-00016af0: 6c66 2e61 6374 6976 6174 696f 6e0a 2020  lf.activation.  
-00016b00: 2020 2020 2020 636f 6e66 6967 5b27 696e        config['in
-00016b10: 6e65 725f 6163 7469 7661 7469 6f6e 5f66  ner_activation_f
-00016b20: 6e27 5d20 3d20 7365 6c66 2e69 6e6e 6572  n'] = self.inner
-00016b30: 5f61 6374 6976 6174 696f 6e0a 2020 2020  _activation.    
-00016b40: 2020 2020 7265 7475 726e 2063 6f6e 6669      return confi
-00016b50: 670a 0a20 2020 2064 6566 2067 6574 5f69  g..    def get_i
-00016b60: 6e69 7469 616c 5f73 7461 7465 7328 7365  nitial_states(se
-00016b70: 6c66 2c20 696e 7075 745f 7368 6170 6529  lf, input_shape)
-00016b80: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00016b90: 205b 746f 7263 682e 7a65 726f 7328 696e   [torch.zeros(in
-00016ba0: 7075 745f 7368 6170 6529 2c20 746f 7263  put_shape), torc
-00016bb0: 682e 7a65 726f 7328 696e 7075 745f 7368  h.zeros(input_sh
-00016bc0: 6170 6529 5d0a 0a20 2020 2064 6566 2062  ape)]..    def b
-00016bd0: 7569 6c64 2873 656c 6629 3a0a 2020 2020  uild(self):.    
-00016be0: 2020 2020 2222 2243 6f6e 7374 7275 6374      """Construct
-00016bf0: 7320 6c65 6172 6e61 626c 6520 7765 6967  s learnable weig
-00016c00: 6874 7320 666f 7220 7468 6973 206c 6179  hts for this lay
-00016c10: 6572 2e22 2222 0a20 2020 2020 2020 2069  er.""".        i
-00016c20: 6e69 7420 3d20 6765 7461 7474 7228 696e  nit = getattr(in
-00016c30: 6974 6961 6c69 7a65 7273 2c20 7365 6c66  itializers, self
-00016c40: 2e69 6e69 7429 0a20 2020 2020 2020 2069  .init).        i
-00016c50: 6e6e 6572 5f69 6e69 7420 3d20 6765 7461  nner_init = geta
-00016c60: 7474 7228 696e 6974 6961 6c69 7a65 7273  ttr(initializers
-00016c70: 2c20 7365 6c66 2e69 6e6e 6572 5f69 6e69  , self.inner_ini
-00016c80: 7429 0a20 2020 2020 2020 2073 656c 662e  t).        self.
-00016c90: 5720 3d20 696e 6974 2874 6f72 6368 2e65  W = init(torch.e
-00016ca0: 6d70 7479 2873 656c 662e 696e 7075 745f  mpty(self.input_
-00016cb0: 6469 6d2c 2034 202a 2073 656c 662e 6f75  dim, 4 * self.ou
-00016cc0: 7470 7574 5f64 696d 2929 0a20 2020 2020  tput_dim)).     
-00016cd0: 2020 2073 656c 662e 5520 3d20 696e 6e65     self.U = inne
-00016ce0: 725f 696e 6974 2874 6f72 6368 2e65 6d70  r_init(torch.emp
-00016cf0: 7479 2873 656c 662e 6f75 7470 7574 5f64  ty(self.output_d
-00016d00: 696d 2c20 3420 2a20 7365 6c66 2e6f 7574  im, 4 * self.out
-00016d10: 7075 745f 6469 6d29 290a 0a20 2020 2020  put_dim))..     
-00016d20: 2020 2073 656c 662e 6220 3d20 746f 7263     self.b = torc
-00016d30: 682e 7465 6e73 6f72 286e 702e 6873 7461  h.tensor(np.hsta
-00016d40: 636b 280a 2020 2020 2020 2020 2020 2020  ck(.            
-00016d50: 286e 702e 7a65 726f 7328 7365 6c66 2e6f  (np.zeros(self.o
-00016d60: 7574 7075 745f 6469 6d29 2c20 6e70 2e6f  utput_dim), np.o
-00016d70: 6e65 7328 7365 6c66 2e6f 7574 7075 745f  nes(self.output_
-00016d80: 6469 6d29 2c0a 2020 2020 2020 2020 2020  dim),.          
-00016d90: 2020 206e 702e 7a65 726f 7328 7365 6c66     np.zeros(self
-00016da0: 2e6f 7574 7075 745f 6469 6d29 2c20 6e70  .output_dim), np
-00016db0: 2e7a 6572 6f73 2873 656c 662e 6f75 7470  .zeros(self.outp
-00016dc0: 7574 5f64 696d 2929 292c 0a20 2020 2020  ut_dim))),.     
-00016dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016de0: 2020 2020 2020 2020 2064 7479 7065 3d74           dtype=t
-00016df0: 6f72 6368 2e66 6c6f 6174 3332 290a 0a20  orch.float32).. 
-00016e00: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
-00016e10: 656c 662c 2069 6e70 7574 7329 3a0a 2020  elf, inputs):.  
-00016e20: 2020 2020 2020 2222 2245 7865 6375 7465        """Execute
-00016e30: 2074 6869 7320 6c61 7965 7220 6f6e 2069   this layer on i
-00016e40: 6e70 7574 2074 656e 736f 7273 2e0a 0a20  nput tensors... 
-00016e50: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00016e60: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00016e70: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e70  ----.        inp
-00016e80: 7574 733a 206c 6973 740a 2020 2020 2020  uts: list.      
-00016e90: 2020 2020 2020 4c69 7374 206f 6620 7468        List of th
-00016ea0: 7265 6520 7465 6e73 6f72 7320 2878 2c20  ree tensors (x, 
-00016eb0: 685f 746d 312c 2063 5f74 6d31 292e 2068  h_tm1, c_tm1). h
-00016ec0: 5f74 6d31 206d 6561 6e73 2022 682c 2074  _tm1 means "h, t
-00016ed0: 2d31 222e 0a0a 2020 2020 2020 2020 5265  -1"...        Re
-00016ee0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-00016ef0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6c69  -----.        li
-00016f00: 7374 0a20 2020 2020 2020 2020 2020 2052  st.            R
-00016f10: 6574 7572 6e73 2068 2c20 5b68 2c20 635d  eturns h, [h, c]
-00016f20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016f30: 2020 2020 2078 2c20 685f 746d 312c 2063       x, h_tm1, c
-00016f40: 5f74 6d31 203d 2069 6e70 7574 730a 2020  _tm1 = inputs.  
-00016f50: 2020 2020 2020 782c 2068 5f74 6d31 2c20        x, h_tm1, 
-00016f60: 635f 746d 3120 3d20 746f 7263 682e 7465  c_tm1 = torch.te
-00016f70: 6e73 6f72 2878 292c 2074 6f72 6368 2e74  nsor(x), torch.t
-00016f80: 656e 736f 7228 685f 746d 3129 2c20 746f  ensor(h_tm1), to
-00016f90: 7263 682e 7465 6e73 6f72 280a 2020 2020  rch.tensor(.    
-00016fa0: 2020 2020 2020 2020 635f 746d 3129 0a0a          c_tm1)..
-00016fb0: 2020 2020 2020 2020 7a20 3d20 746f 7263          z = torc
-00016fc0: 682e 6d61 746d 756c 2878 2c20 7365 6c66  h.matmul(x, self
-00016fd0: 2e57 2920 2b20 746f 7263 682e 6d61 746d  .W) + torch.matm
-00016fe0: 756c 2868 5f74 6d31 2c20 7365 6c66 2e55  ul(h_tm1, self.U
-00016ff0: 2920 2b20 7365 6c66 2e62 0a0a 2020 2020  ) + self.b..    
-00017000: 2020 2020 7a30 203d 207a 5b3a 2c20 3a73      z0 = z[:, :s
-00017010: 656c 662e 6f75 7470 7574 5f64 696d 5d0a  elf.output_dim].
-00017020: 2020 2020 2020 2020 7a31 203d 207a 5b3a          z1 = z[:
-00017030: 2c20 7365 6c66 2e6f 7574 7075 745f 6469  , self.output_di
-00017040: 6d3a 3220 2a20 7365 6c66 2e6f 7574 7075  m:2 * self.outpu
-00017050: 745f 6469 6d5d 0a20 2020 2020 2020 207a  t_dim].        z
-00017060: 3220 3d20 7a5b 3a2c 2032 202a 2073 656c  2 = z[:, 2 * sel
-00017070: 662e 6f75 7470 7574 5f64 696d 3a33 202a  f.output_dim:3 *
-00017080: 2073 656c 662e 6f75 7470 7574 5f64 696d   self.output_dim
-00017090: 5d0a 2020 2020 2020 2020 7a33 203d 207a  ].        z3 = z
-000170a0: 5b3a 2c20 3320 2a20 7365 6c66 2e6f 7574  [:, 3 * self.out
-000170b0: 7075 745f 6469 6d3a 5d0a 0a20 2020 2020  put_dim:]..     
-000170c0: 2020 2069 203d 2073 656c 662e 696e 6e65     i = self.inne
-000170d0: 725f 6163 7469 7661 7469 6f6e 5f66 6e28  r_activation_fn(
-000170e0: 7a30 290a 2020 2020 2020 2020 6620 3d20  z0).        f = 
-000170f0: 7365 6c66 2e69 6e6e 6572 5f61 6374 6976  self.inner_activ
-00017100: 6174 696f 6e5f 666e 287a 3129 0a20 2020  ation_fn(z1).   
-00017110: 2020 2020 2063 203d 2066 202a 2063 5f74       c = f * c_t
-00017120: 6d31 202b 2069 202a 2073 656c 662e 6163  m1 + i * self.ac
-00017130: 7469 7661 7469 6f6e 5f66 6e28 7a32 290a  tivation_fn(z2).
-00017140: 2020 2020 2020 2020 6f20 3d20 7365 6c66          o = self
-00017150: 2e69 6e6e 6572 5f61 6374 6976 6174 696f  .inner_activatio
-00017160: 6e5f 666e 287a 3329 0a0a 2020 2020 2020  n_fn(z3)..      
-00017170: 2020 6820 3d20 6f20 2a20 7365 6c66 2e61    h = o * self.a
-00017180: 6374 6976 6174 696f 6e5f 666e 2863 290a  ctivation_fn(c).
-00017190: 2020 2020 2020 2020 7265 7475 726e 2068          return h
-000171a0: 2c20 5b68 2c20 635d 0a0a 0a63 6c61 7373  , [h, c]...class
-000171b0: 2041 746f 6d69 6343 6f6e 766f 6c75 7469   AtomicConvoluti
-000171c0: 6f6e 286e 6e2e 4d6f 6475 6c65 293a 0a20  on(nn.Module):. 
-000171d0: 2020 2022 2222 496d 706c 656d 656e 7473     """Implements
-000171e0: 2074 6865 2041 746f 6d69 6320 436f 6e76   the Atomic Conv
-000171f0: 6f6c 7574 696f 6e61 6c20 7472 616e 7366  olutional transf
-00017200: 6f72 6d2c 2069 6e74 726f 6475 6365 6420  orm, introduced 
-00017210: 696e 0a0a 2020 2020 476f 6d65 732c 204a  in..    Gomes, J
-00017220: 6f73 6570 682c 2065 7420 616c 2e20 2241  oseph, et al. "A
-00017230: 746f 6d69 6320 636f 6e76 6f6c 7574 696f  tomic convolutio
-00017240: 6e61 6c20 6e65 7477 6f72 6b73 2066 6f72  nal networks for
-00017250: 2070 7265 6469 6374 696e 670a 2020 2020   predicting.    
-00017260: 7072 6f74 6569 6e2d 6c69 6761 6e64 2062  protein-ligand b
-00017270: 696e 6469 6e67 2061 6666 696e 6974 792e  inding affinity.
-00017280: 2220 6172 5869 7620 7072 6570 7269 6e74  " arXiv preprint
-00017290: 2061 7258 6976 3a31 3730 332e 3130 3630   arXiv:1703.1060
-000172a0: 330a 2020 2020 2832 3031 3729 2e0a 0a20  3.    (2017)... 
-000172b0: 2020 2041 7420 6120 6869 6768 206c 6576     At a high lev
-000172c0: 656c 2c20 7468 6973 2074 7261 6e73 666f  el, this transfo
-000172d0: 726d 2070 6572 666f 726d 7320 6120 6772  rm performs a gr
-000172e0: 6170 6820 636f 6e76 6f6c 7574 696f 6e0a  aph convolution.
-000172f0: 2020 2020 6f6e 2074 6865 206e 6561 7265      on the neare
-00017300: 7374 206e 6569 6768 626f 7273 2067 7261  st neighbors gra
-00017310: 7068 2069 6e20 3344 2073 7061 6365 2e0a  ph in 3D space..
-00017320: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
-00017330: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
-00017340: 3e3e 2062 6174 6368 5f73 697a 6520 3d20  >> batch_size = 
-00017350: 340a 2020 2020 3e3e 3e20 6d61 785f 6174  4.    >>> max_at
-00017360: 6f6d 7320 3d20 350a 2020 2020 3e3e 3e20  oms = 5.    >>> 
-00017370: 6d61 785f 6e65 6967 6862 6f72 7320 3d20  max_neighbors = 
-00017380: 320a 2020 2020 3e3e 3e20 6469 6d65 6e73  2.    >>> dimens
-00017390: 696f 6e73 203d 2033 0a20 2020 203e 3e3e  ions = 3.    >>>
-000173a0: 2072 6164 6961 6c5f 7061 7261 6d73 203d   radial_params =
-000173b0: 2074 6f72 6368 2e74 656e 736f 7228 5b5b   torch.tensor([[
-000173c0: 352e 302c 2032 2e30 2c20 302e 355d 2c20  5.0, 2.0, 0.5], 
-000173d0: 5b31 302e 302c 2032 2e30 2c20 302e 355d  [10.0, 2.0, 0.5]
-000173e0: 2c0a 2020 2020 2e2e 2e20 2020 2020 2020  ,.    ...       
-000173f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017400: 2020 2020 2020 2020 5b35 2e30 2c20 312e          [5.0, 1.
-00017410: 302c 2030 2e32 5d5d 290a 2020 2020 3e3e  0, 0.2]]).    >>
-00017420: 3e20 696e 7075 7431 203d 206e 702e 7261  > input1 = np.ra
-00017430: 6e64 6f6d 2e72 616e 6428 6261 7463 685f  ndom.rand(batch_
-00017440: 7369 7a65 2c20 6d61 785f 6174 6f6d 732c  size, max_atoms,
-00017450: 2064 696d 656e 7369 6f6e 7329 2e61 7374   dimensions).ast
-00017460: 7970 6528 6e70 2e66 6c6f 6174 3332 290a  ype(np.float32).
-00017470: 2020 2020 3e3e 3e20 696e 7075 7432 203d      >>> input2 =
-00017480: 206e 702e 7261 6e64 6f6d 2e72 616e 6469   np.random.randi
-00017490: 6e74 286d 6178 5f61 746f 6d73 2c0a 2020  nt(max_atoms,.  
-000174a0: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
-000174b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174c0: 2073 697a 653d 2862 6174 6368 5f73 697a   size=(batch_siz
-000174d0: 652c 206d 6178 5f61 746f 6d73 2c20 6d61  e, max_atoms, ma
-000174e0: 785f 6e65 6967 6862 6f72 7329 290a 2020  x_neighbors)).  
-000174f0: 2020 3e3e 3e20 696e 7075 7433 203d 206e    >>> input3 = n
-00017500: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
-00017510: 2831 2c20 3130 2c20 7369 7a65 3d28 6261  (1, 10, size=(ba
-00017520: 7463 685f 7369 7a65 2c20 6d61 785f 6174  tch_size, max_at
-00017530: 6f6d 732c 206d 6178 5f6e 6569 6768 626f  oms, max_neighbo
-00017540: 7273 2929 0a20 2020 203e 3e3e 206c 6179  rs)).    >>> lay
-00017550: 6572 203d 2041 746f 6d69 6343 6f6e 766f  er = AtomicConvo
-00017560: 6c75 7469 6f6e 2872 6164 6961 6c5f 7061  lution(radial_pa
-00017570: 7261 6d73 3d72 6164 6961 6c5f 7061 7261  rams=radial_para
-00017580: 6d73 290a 2020 2020 3e3e 3e20 7265 7375  ms).    >>> resu
-00017590: 6c74 203d 206c 6179 6572 285b 696e 7075  lt = layer([inpu
-000175a0: 7431 2c20 696e 7075 7432 2c20 696e 7075  t1, input2, inpu
-000175b0: 7433 5d29 0a20 2020 203e 3e3e 2072 6573  t3]).    >>> res
-000175c0: 756c 742e 7368 6170 650a 2020 2020 746f  ult.shape.    to
-000175d0: 7263 682e 5369 7a65 285b 342c 2035 2c20  rch.Size([4, 5, 
-000175e0: 335d 290a 2020 2020 2222 220a 0a20 2020  3]).    """..   
-000175f0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00017600: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00017610: 2020 2020 2061 746f 6d5f 7479 7065 733a       atom_types:
-00017620: 204f 7074 696f 6e61 6c5b 556e 696f 6e5b   Optional[Union[
-00017630: 4172 7261 794c 696b 652c 2074 6f72 6368  ArrayLike, torch
-00017640: 2e54 656e 736f 725d 5d20 3d20 4e6f 6e65  .Tensor]] = None
-00017650: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00017660: 2020 2072 6164 6961 6c5f 7061 7261 6d73     radial_params
-00017670: 3a20 556e 696f 6e5b 4172 7261 794c 696b  : Union[ArrayLik
-00017680: 652c 2074 6f72 6368 2e54 656e 736f 725d  e, torch.Tensor]
-00017690: 203d 206c 6973 7428 292c 0a20 2020 2020   = list(),.     
-000176a0: 2020 2020 2020 2020 2020 2020 626f 785f              box_
-000176b0: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b55  size: Optional[U
-000176c0: 6e69 6f6e 5b41 7272 6179 4c69 6b65 2c20  nion[ArrayLike, 
-000176d0: 746f 7263 682e 5465 6e73 6f72 5d5d 203d  torch.Tensor]] =
-000176e0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-000176f0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00017700: 293a 0a20 2020 2020 2020 2022 2222 496e  ):.        """In
-00017710: 6974 6961 6c69 7a65 2074 6869 7320 6c61  itialize this la
-00017720: 7965 722e 0a0a 2020 2020 2020 2020 5061  yer...        Pa
-00017730: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00017740: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00017750: 2020 2020 6174 6f6d 5f74 7970 6573 203a      atom_types :
-00017760: 2055 6e69 6f6e 5b41 7272 6179 4c69 6b65   Union[ArrayLike
-00017770: 2c20 746f 7263 682e 5465 6e73 6f72 5d2c  , torch.Tensor],
-00017780: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00017790: 2020 2020 2020 4c69 7374 206f 6620 6174        List of at
-000177a0: 6f6d 2074 7970 6573 2e0a 2020 2020 2020  om types..      
-000177b0: 2020 7261 6469 616c 5f70 6172 616d 7320    radial_params 
-000177c0: 3a20 556e 696f 6e5b 4172 7261 794c 696b  : Union[ArrayLik
-000177d0: 652c 2074 6f72 6368 2e54 656e 736f 725d  e, torch.Tensor]
-000177e0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-000177f0: 2020 2020 2020 204c 6973 7420 6f66 2072         List of r
-00017800: 6164 6961 6c20 7061 7261 6d73 2e0a 2020  adial params..  
-00017810: 2020 2020 2020 626f 785f 7369 7a65 203a        box_size :
-00017820: 2055 6e69 6f6e 5b41 7272 6179 4c69 6b65   Union[ArrayLike
-00017830: 2c20 746f 7263 682e 5465 6e73 6f72 5d2c  , torch.Tensor],
-00017840: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00017850: 2020 2020 2020 4c65 6e67 7468 206d 7573        Length mus
-00017860: 7420 6265 2065 7175 616c 2074 6f20 7468  t be equal to th
-00017870: 6520 6e75 6d62 6572 206f 6620 6665 6174  e number of feat
-00017880: 7572 6573 2e0a 2020 2020 2020 2020 2222  ures..        ""
-00017890: 220a 0a20 2020 2020 2020 2073 7570 6572  "..        super
-000178a0: 2841 746f 6d69 6343 6f6e 766f 6c75 7469  (AtomicConvoluti
-000178b0: 6f6e 2c20 7365 6c66 292e 5f5f 696e 6974  on, self).__init
-000178c0: 5f5f 282a 2a6b 7761 7267 7329 0a20 2020  __(**kwargs).   
-000178d0: 2020 2020 2073 656c 662e 6174 6f6d 5f74       self.atom_t
-000178e0: 7970 6573 203d 2061 746f 6d5f 7479 7065  ypes = atom_type
-000178f0: 730a 2020 2020 2020 2020 7365 6c66 2e72  s.        self.r
-00017900: 6164 6961 6c5f 7061 7261 6d73 203d 2072  adial_params = r
-00017910: 6164 6961 6c5f 7061 7261 6d73 0a0a 2020  adial_params..  
-00017920: 2020 2020 2020 6966 2062 6f78 5f73 697a        if box_siz
-00017930: 6520 6973 204e 6f6e 6520 6f72 2069 7369  e is None or isi
-00017940: 6e73 7461 6e63 6528 626f 785f 7369 7a65  nstance(box_size
-00017950: 2c20 746f 7263 682e 5465 6e73 6f72 293a  , torch.Tensor):
-00017960: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00017970: 662e 626f 785f 7369 7a65 203d 2062 6f78  f.box_size = box
-00017980: 5f73 697a 650a 2020 2020 2020 2020 656c  _size.        el
-00017990: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000179a0: 7365 6c66 2e62 6f78 5f73 697a 6520 3d20  self.box_size = 
-000179b0: 746f 7263 682e 7465 6e73 6f72 2862 6f78  torch.tensor(box
-000179c0: 5f73 697a 6529 0a0a 2020 2020 2020 2020  _size)..        
-000179d0: 7661 7273 203d 205b 5d0a 2020 2020 2020  vars = [].      
-000179e0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-000179f0: 2833 293a 0a20 2020 2020 2020 2020 2020  (3):.           
-00017a00: 2076 616c 203d 206e 702e 6172 7261 7928   val = np.array(
-00017a10: 5b70 5b69 5d20 666f 7220 7020 696e 2073  [p[i] for p in s
-00017a20: 656c 662e 7261 6469 616c 5f70 6172 616d  elf.radial_param
-00017a30: 735d 292e 7265 7368 6170 6528 0a20 2020  s]).reshape(.   
-00017a40: 2020 2020 2020 2020 2020 2020 2028 2d31               (-1
-00017a50: 2c20 312c 2031 2c20 3129 290a 2020 2020  , 1, 1, 1)).    
-00017a60: 2020 2020 2020 2020 7661 7273 2e61 7070          vars.app
-00017a70: 656e 6428 746f 7263 682e 7465 6e73 6f72  end(torch.tensor
-00017a80: 2876 616c 2c20 6474 7970 653d 746f 7263  (val, dtype=torc
-00017a90: 682e 666c 6f61 7429 290a 2020 2020 2020  h.float)).      
-00017aa0: 2020 7365 6c66 2e72 6320 3d20 6e6e 2e50    self.rc = nn.P
-00017ab0: 6172 616d 6574 6572 2876 6172 735b 305d  arameter(vars[0]
-00017ac0: 290a 2020 2020 2020 2020 7365 6c66 2e72  ).        self.r
-00017ad0: 7320 3d20 6e6e 2e50 6172 616d 6574 6572  s = nn.Parameter
-00017ae0: 2876 6172 735b 315d 290a 2020 2020 2020  (vars[1]).      
-00017af0: 2020 7365 6c66 2e72 6520 3d20 6e6e 2e50    self.re = nn.P
-00017b00: 6172 616d 6574 6572 2876 6172 735b 325d  arameter(vars[2]
-00017b10: 290a 0a20 2020 2064 6566 205f 5f72 6570  )..    def __rep
-00017b20: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-00017b30: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
-00017b40: 2020 2020 2020 2020 6627 7b73 656c 662e          f'{self.
-00017b50: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00017b60: 5f5f 7d28 6174 6f6d 5f74 7970 6573 3d7b  __}(atom_types={
-00017b70: 7365 6c66 2e61 746f 6d5f 7479 7065 737d  self.atom_types}
-00017b80: 2c20 7261 6469 616c 5f70 6172 616d 733d  , radial_params=
-00017b90: 7b73 656c 662e 7261 6469 616c 5f70 6172  {self.radial_par
-00017ba0: 616d 737d 2c20 626f 785f 7369 7a65 3d7b  ams}, box_size={
-00017bb0: 7365 6c66 2e62 6f78 5f73 697a 657d 2c20  self.box_size}, 
-00017bc0: 7263 3d7b 7365 6c66 2e72 637d 2c20 7273  rc={self.rc}, rs
-00017bd0: 3d7b 7365 6c66 2e72 737d 2c20 7265 3d7b  ={self.rs}, re={
-00017be0: 7365 6c66 2e72 657d 2927 0a20 2020 2020  self.re})'.     
-00017bf0: 2020 2029 0a0a 2020 2020 6465 6620 666f     )..    def fo
-00017c00: 7277 6172 6428 0a20 2020 2020 2020 2020  rward(.         
-00017c10: 2020 2073 656c 662c 2069 6e70 7574 733a     self, inputs:
-00017c20: 2053 6571 7565 6e63 655b 556e 696f 6e5b   Sequence[Union[
-00017c30: 4172 7261 794c 696b 652c 0a20 2020 2020  ArrayLike,.     
-00017c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f70: 2020 2020 286e 5f63 656c 6c73 202a 206e      (n_cells * n
+00015f80: 5f63 656c 6c73 2c20 6e64 696d 2929 0a20  _cells, ndim)). 
+00015f90: 2020 2020 2020 2023 2054 696c 6520 2861         # Tile (a
+00015fa0: 2c20 622c 2063 2c20 612c 2062 2c20 632c  , b, c, a, b, c,
+00015fb0: 202e 2e2e 290a 2020 2020 2020 2020 7469   ...).        ti
+00015fc0: 6c65 645f 6365 6c6c 7320 3d20 746f 7263  led_cells = torc
+00015fd0: 682e 7469 6c65 2863 656c 6c73 2c20 286e  h.tile(cells, (n
+00015fe0: 5f63 656c 6c73 2c20 3129 290a 0a20 2020  _cells, 1))..   
+00015ff0: 2020 2020 2063 6f6f 7264 735f 7665 6320       coords_vec 
+00016000: 3d20 746f 7263 682e 7375 6d28 2874 696c  = torch.sum((til
+00016010: 6564 5f63 656e 7465 7273 202d 2074 696c  ed_centers - til
+00016020: 6564 5f63 656c 6c73 292a 2a32 2c20 6469  ed_cells)**2, di
+00016030: 6d3d 2d31 290a 2020 2020 2020 2020 636f  m=-1).        co
+00016040: 6f72 6473 5f6e 6f72 6d20 3d20 746f 7263  ords_norm = torc
+00016050: 682e 7265 7368 6170 6528 636f 6f72 6473  h.reshape(coords
+00016060: 5f76 6563 2c20 286e 5f63 656c 6c73 2c20  _vec, (n_cells, 
+00016070: 6e5f 6365 6c6c 7329 290a 2020 2020 2020  n_cells)).      
+00016080: 2020 636c 6f73 6573 745f 696e 6473 203d    closest_inds =
+00016090: 2074 6f72 6368 2e74 6f70 6b28 636f 6f72   torch.topk(coor
+000160a0: 6473 5f6e 6f72 6d2c 206b 3d6e 5f6e 6272  ds_norm, k=n_nbr
+000160b0: 5f63 656c 6c73 2c20 6c61 7267 6573 743d  _cells, largest=
+000160c0: 4661 6c73 6529 5b31 5d0a 0a20 2020 2020  False)[1]..     
+000160d0: 2020 2072 6574 7572 6e20 636c 6f73 6573     return closes
+000160e0: 745f 696e 6473 0a0a 2020 2020 6465 6620  t_inds..    def 
+000160f0: 6765 745f 6365 6c6c 7328 7365 6c66 2920  get_cells(self) 
+00016100: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
+00016110: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00016120: 726e 7320 7468 6520 6c6f 6361 7469 6f6e  rns the location
+00016130: 7320 6f66 2061 6c6c 2067 7269 6420 706f  s of all grid po
+00016140: 696e 7473 2069 6e20 626f 782e 0a0a 2020  ints in box...  
+00016150: 2020 2020 2020 5375 7070 6f73 6520 7374        Suppose st
+00016160: 6172 7420 6973 202d 3130 2041 6e67 7374  art is -10 Angst
+00016170: 726f 6d2c 2073 746f 7020 6973 2031 3020  rom, stop is 10 
+00016180: 416e 6773 7472 6f6d 2c20 6e62 725f 6375  Angstrom, nbr_cu
+00016190: 746f 6666 2069 7320 312e 0a20 2020 2020  toff is 1..     
+000161a0: 2020 2054 6865 6e20 776f 756c 6420 7265     Then would re
+000161b0: 7475 726e 2061 206c 6973 7420 6f66 206c  turn a list of l
+000161c0: 656e 6774 6820 3230 5e33 2077 686f 7365  ength 20^3 whose
+000161d0: 2065 6e74 7269 6573 2077 6f75 6c64 2062   entries would b
+000161e0: 650a 2020 2020 2020 2020 5b28 2d31 302c  e.        [(-10,
+000161f0: 202d 3130 2c20 2d31 3029 2c20 282d 3130   -10, -10), (-10
+00016200: 2c20 2d31 302c 202d 3929 2c20 2e2e 2e2c  , -10, -9), ...,
+00016210: 2028 392c 2039 2c20 3929 5d0a 0a20 2020   (9, 9, 9)]..   
+00016220: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00016230: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00016240: 2020 2020 2063 656c 6c73 3a20 746f 7263       cells: torc
+00016250: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00016260: 2020 2028 6e5f 6365 6c6c 732c 206e 6469     (n_cells, ndi
+00016270: 6d29 2073 6861 7065 2e0a 2020 2020 2020  m) shape..      
+00016280: 2020 2222 220a 2020 2020 2020 2020 7374    """.        st
+00016290: 6172 742c 2073 746f 702c 206e 6272 5f63  art, stop, nbr_c
+000162a0: 7574 6f66 6620 3d20 7365 6c66 2e73 7461  utoff = self.sta
+000162b0: 7274 2c20 7365 6c66 2e73 746f 702c 2073  rt, self.stop, s
+000162c0: 656c 662e 6e62 725f 6375 746f 6666 0a20  elf.nbr_cutoff. 
+000162d0: 2020 2020 2020 206d 6573 685f 6172 6773         mesh_args
+000162e0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+000162f0: 2074 6f72 6368 2e61 7261 6e67 6528 7374   torch.arange(st
+00016300: 6172 742c 2073 746f 702c 206e 6272 5f63  art, stop, nbr_c
+00016310: 7574 6f66 6629 2066 6f72 205f 2069 6e20  utoff) for _ in 
+00016320: 7261 6e67 6528 7365 6c66 2e6e 6469 6d29  range(self.ndim)
+00016330: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+00016340: 2020 2072 6574 7572 6e20 746f 7263 682e     return torch.
+00016350: 7265 7368 6170 6528 0a20 2020 2020 2020  reshape(.       
+00016360: 2020 2020 2074 6f72 6368 2e70 6572 6d75       torch.permu
+00016370: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
+00016380: 2020 2020 746f 7263 682e 7374 6163 6b28      torch.stack(
+00016390: 746f 7263 682e 6d65 7368 6772 6964 282a  torch.meshgrid(*
+000163a0: 6d65 7368 5f61 7267 732c 2069 6e64 6578  mesh_args, index
+000163b0: 696e 673d 2778 7927 2929 2c0a 2020 2020  ing='xy')),.    
+000163c0: 2020 2020 2020 2020 2020 2020 7475 706c              tupl
+000163d0: 6528 7261 6e67 6528 7365 6c66 2e6e 6469  e(range(self.ndi
+000163e0: 6d2c 202d 312c 202d 3129 2929 2c0a 2020  m, -1, -1))),.  
+000163f0: 2020 2020 2020 2020 2020 2873 656c 662e            (self.
+00016400: 6e5f 6365 6c6c 732c 2073 656c 662e 6e64  n_cells, self.nd
+00016410: 696d 2929 2e74 6f28 746f 7263 682e 666c  im)).to(torch.fl
+00016420: 6f61 7429 0a0a 0a63 6c61 7373 204c 5354  oat)...class LST
+00016430: 4d53 7465 7028 6e6e 2e4d 6f64 756c 6529  MStep(nn.Module)
+00016440: 3a0a 2020 2020 2222 224c 6179 6572 2074  :.    """Layer t
+00016450: 6861 7420 7065 7266 6f72 6d73 2061 2073  hat performs a s
+00016460: 696e 676c 6520 7374 6570 204c 5354 4d20  ingle step LSTM 
+00016470: 7570 6461 7465 2e0a 0a20 2020 2054 6869  update...    Thi
+00016480: 7320 6973 2074 6865 2054 6f72 6368 2065  s is the Torch e
+00016490: 7175 6976 616c 656e 7420 6f66 2074 6865  quivalent of the
+000164a0: 206f 7269 6769 6e61 6c20 696d 706c 656d   original implem
+000164b0: 656e 7461 7469 6f6e 2075 7369 6e67 204b  entation using K
+000164c0: 6572 6173 2e0a 2020 2020 2222 220a 0a20  eras..    """.. 
+000164d0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+000164e0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+000164f0: 2020 2020 2020 206f 7574 7075 745f 6469         output_di
+00016500: 6d2c 0a20 2020 2020 2020 2020 2020 2020  m,.             
+00016510: 2020 2020 696e 7075 745f 6469 6d2c 0a20      input_dim,. 
+00016520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016530: 696e 6974 5f66 6e3d 2778 6176 6965 725f  init_fn='xavier_
+00016540: 756e 6966 6f72 6d5f 272c 0a20 2020 2020  uniform_',.     
+00016550: 2020 2020 2020 2020 2020 2020 696e 6e65              inne
+00016560: 725f 696e 6974 5f66 6e3d 276f 7274 686f  r_init_fn='ortho
+00016570: 676f 6e61 6c5f 272c 0a20 2020 2020 2020  gonal_',.       
+00016580: 2020 2020 2020 2020 2020 6163 7469 7661            activa
+00016590: 7469 6f6e 5f66 6e3d 2774 616e 6827 2c0a  tion_fn='tanh',.
+000165a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165b0: 2069 6e6e 6572 5f61 6374 6976 6174 696f   inner_activatio
+000165c0: 6e5f 666e 3d27 6861 7264 7369 676d 6f69  n_fn='hardsigmoi
+000165d0: 6427 2c0a 2020 2020 2020 2020 2020 2020  d',.            
+000165e0: 2020 2020 202a 2a6b 7761 7267 7329 3a0a       **kwargs):.
+000165f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016600: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00016610: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00016620: 2d0a 2020 2020 2020 2020 6f75 7470 7574  -.        output
+00016630: 5f64 696d 3a20 696e 740a 2020 2020 2020  _dim: int.      
+00016640: 2020 2020 2020 4469 6d65 6e73 696f 6e61        Dimensiona
+00016650: 6c69 7479 206f 6620 6f75 7470 7574 2076  lity of output v
+00016660: 6563 746f 7273 2e0a 2020 2020 2020 2020  ectors..        
+00016670: 696e 7075 745f 6469 6d3a 2069 6e74 0a20  input_dim: int. 
+00016680: 2020 2020 2020 2020 2020 2044 696d 656e             Dimen
+00016690: 7369 6f6e 616c 6974 7920 6f66 2069 6e70  sionality of inp
+000166a0: 7574 2076 6563 746f 7273 2e0a 2020 2020  ut vectors..    
+000166b0: 2020 2020 696e 6974 5f66 6e3a 2073 7472      init_fn: str
+000166c0: 0a20 2020 2020 2020 2020 2020 2050 7954  .            PyT
+000166d0: 6f72 6368 2069 6e69 7469 616c 697a 6174  orch initializat
+000166e0: 696f 6e20 746f 2075 7365 2066 6f72 2057  ion to use for W
+000166f0: 2e0a 2020 2020 2020 2020 696e 6e65 725f  ..        inner_
+00016700: 696e 6974 5f66 6e3a 2073 7472 0a20 2020  init_fn: str.   
+00016710: 2020 2020 2020 2020 2050 7954 6f72 6368           PyTorch
+00016720: 2069 6e69 7469 616c 697a 6174 696f 6e20   initialization 
+00016730: 746f 2075 7365 2066 6f72 2055 2e0a 2020  to use for U..  
+00016740: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
+00016750: 5f66 6e3a 2073 7472 0a20 2020 2020 2020  _fn: str.       
+00016760: 2020 2020 2050 7954 6f72 6368 2061 6374       PyTorch act
+00016770: 6976 6174 696f 6e20 746f 2075 7365 2066  ivation to use f
+00016780: 6f72 206f 7574 7075 742e 0a20 2020 2020  or output..     
+00016790: 2020 2069 6e6e 6572 5f61 6374 6976 6174     inner_activat
+000167a0: 696f 6e5f 666e 3a20 7374 720a 2020 2020  ion_fn: str.    
+000167b0: 2020 2020 2020 2020 5079 546f 7263 6820          PyTorch 
+000167c0: 6163 7469 7661 7469 6f6e 2074 6f20 7573  activation to us
+000167d0: 6520 666f 7220 696e 6e65 7220 7374 6570  e for inner step
+000167e0: 732e 0a20 2020 2020 2020 2022 2222 0a0a  s..        """..
+000167f0: 2020 2020 2020 2020 7375 7065 7228 4c53          super(LS
+00016800: 544d 5374 6570 2c20 7365 6c66 292e 5f5f  TMStep, self).__
+00016810: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
+00016820: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+00016830: 6974 203d 2069 6e69 745f 666e 0a20 2020  it = init_fn.   
+00016840: 2020 2020 2073 656c 662e 696e 6e65 725f       self.inner_
+00016850: 696e 6974 203d 2069 6e6e 6572 5f69 6e69  init = inner_ini
+00016860: 745f 666e 0a20 2020 2020 2020 2073 656c  t_fn.        sel
+00016870: 662e 6f75 7470 7574 5f64 696d 203d 206f  f.output_dim = o
+00016880: 7574 7075 745f 6469 6d0a 2020 2020 2020  utput_dim.      
+00016890: 2020 2320 4e6f 206f 7468 6572 2066 6f72    # No other for
+000168a0: 6765 7420 6269 6173 6573 2073 7570 706f  get biases suppo
+000168b0: 7274 6564 2072 6967 6874 206e 6f77 2e0a  rted right now..
+000168c0: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
+000168d0: 6976 6174 696f 6e20 3d20 6163 7469 7661  ivation = activa
+000168e0: 7469 6f6e 5f66 6e0a 2020 2020 2020 2020  tion_fn.        
+000168f0: 7365 6c66 2e69 6e6e 6572 5f61 6374 6976  self.inner_activ
+00016900: 6174 696f 6e20 3d20 696e 6e65 725f 6163  ation = inner_ac
+00016910: 7469 7661 7469 6f6e 5f66 6e0a 2020 2020  tivation_fn.    
+00016920: 2020 2020 7365 6c66 2e61 6374 6976 6174      self.activat
+00016930: 696f 6e5f 666e 203d 2067 6574 5f61 6374  ion_fn = get_act
+00016940: 6976 6174 696f 6e28 6163 7469 7661 7469  ivation(activati
+00016950: 6f6e 5f66 6e29 0a20 2020 2020 2020 2073  on_fn).        s
+00016960: 656c 662e 696e 6e65 725f 6163 7469 7661  elf.inner_activa
+00016970: 7469 6f6e 5f66 6e20 3d20 6765 745f 6163  tion_fn = get_ac
+00016980: 7469 7661 7469 6f6e 2869 6e6e 6572 5f61  tivation(inner_a
+00016990: 6374 6976 6174 696f 6e5f 666e 290a 2020  ctivation_fn).  
+000169a0: 2020 2020 2020 7365 6c66 2e69 6e70 7574        self.input
+000169b0: 5f64 696d 203d 2069 6e70 7574 5f64 696d  _dim = input_dim
+000169c0: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
+000169d0: 696c 6428 290a 0a20 2020 2064 6566 2067  ild()..    def g
+000169e0: 6574 5f63 6f6e 6669 6728 7365 6c66 293a  et_config(self):
+000169f0: 0a20 2020 2020 2020 2063 6f6e 6669 6720  .        config 
+00016a00: 3d20 7375 7065 7228 4c53 544d 5374 6570  = super(LSTMStep
+00016a10: 2c20 7365 6c66 292e 6765 745f 636f 6e66  , self).get_conf
+00016a20: 6967 2829 0a20 2020 2020 2020 2063 6f6e  ig().        con
+00016a30: 6669 675b 276f 7574 7075 745f 6469 6d27  fig['output_dim'
+00016a40: 5d20 3d20 7365 6c66 2e6f 7574 7075 745f  ] = self.output_
+00016a50: 6469 6d0a 2020 2020 2020 2020 636f 6e66  dim.        conf
+00016a60: 6967 5b27 696e 7075 745f 6469 6d27 5d20  ig['input_dim'] 
+00016a70: 3d20 7365 6c66 2e69 6e70 7574 5f64 696d  = self.input_dim
+00016a80: 0a20 2020 2020 2020 2063 6f6e 6669 675b  .        config[
+00016a90: 2769 6e69 745f 666e 275d 203d 2073 656c  'init_fn'] = sel
+00016aa0: 662e 696e 6974 0a20 2020 2020 2020 2063  f.init.        c
+00016ab0: 6f6e 6669 675b 2769 6e6e 6572 5f69 6e69  onfig['inner_ini
+00016ac0: 745f 666e 275d 203d 2073 656c 662e 696e  t_fn'] = self.in
+00016ad0: 6e65 725f 696e 6974 0a20 2020 2020 2020  ner_init.       
+00016ae0: 2063 6f6e 6669 675b 2761 6374 6976 6174   config['activat
+00016af0: 696f 6e5f 666e 275d 203d 2073 656c 662e  ion_fn'] = self.
+00016b00: 6163 7469 7661 7469 6f6e 0a20 2020 2020  activation.     
+00016b10: 2020 2063 6f6e 6669 675b 2769 6e6e 6572     config['inner
+00016b20: 5f61 6374 6976 6174 696f 6e5f 666e 275d  _activation_fn']
+00016b30: 203d 2073 656c 662e 696e 6e65 725f 6163   = self.inner_ac
+00016b40: 7469 7661 7469 6f6e 0a20 2020 2020 2020  tivation.       
+00016b50: 2072 6574 7572 6e20 636f 6e66 6967 0a0a   return config..
+00016b60: 2020 2020 6465 6620 6765 745f 696e 6974      def get_init
+00016b70: 6961 6c5f 7374 6174 6573 2873 656c 662c  ial_states(self,
+00016b80: 2069 6e70 7574 5f73 6861 7065 293a 0a20   input_shape):. 
+00016b90: 2020 2020 2020 2072 6574 7572 6e20 5b74         return [t
+00016ba0: 6f72 6368 2e7a 6572 6f73 2869 6e70 7574  orch.zeros(input
+00016bb0: 5f73 6861 7065 292c 2074 6f72 6368 2e7a  _shape), torch.z
+00016bc0: 6572 6f73 2869 6e70 7574 5f73 6861 7065  eros(input_shape
+00016bd0: 295d 0a0a 2020 2020 6465 6620 6275 696c  )]..    def buil
+00016be0: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
+00016bf0: 2022 2222 436f 6e73 7472 7563 7473 206c   """Constructs l
+00016c00: 6561 726e 6162 6c65 2077 6569 6768 7473  earnable weights
+00016c10: 2066 6f72 2074 6869 7320 6c61 7965 722e   for this layer.
+00016c20: 2222 220a 2020 2020 2020 2020 696e 6974  """.        init
+00016c30: 203d 2067 6574 6174 7472 2869 6e69 7469   = getattr(initi
+00016c40: 616c 697a 6572 732c 2073 656c 662e 696e  alizers, self.in
+00016c50: 6974 290a 2020 2020 2020 2020 696e 6e65  it).        inne
+00016c60: 725f 696e 6974 203d 2067 6574 6174 7472  r_init = getattr
+00016c70: 2869 6e69 7469 616c 697a 6572 732c 2073  (initializers, s
+00016c80: 656c 662e 696e 6e65 725f 696e 6974 290a  elf.inner_init).
+00016c90: 2020 2020 2020 2020 7365 6c66 2e57 203d          self.W =
+00016ca0: 2069 6e69 7428 746f 7263 682e 656d 7074   init(torch.empt
+00016cb0: 7928 7365 6c66 2e69 6e70 7574 5f64 696d  y(self.input_dim
+00016cc0: 2c20 3420 2a20 7365 6c66 2e6f 7574 7075  , 4 * self.outpu
+00016cd0: 745f 6469 6d29 290a 2020 2020 2020 2020  t_dim)).        
+00016ce0: 7365 6c66 2e55 203d 2069 6e6e 6572 5f69  self.U = inner_i
+00016cf0: 6e69 7428 746f 7263 682e 656d 7074 7928  nit(torch.empty(
+00016d00: 7365 6c66 2e6f 7574 7075 745f 6469 6d2c  self.output_dim,
+00016d10: 2034 202a 2073 656c 662e 6f75 7470 7574   4 * self.output
+00016d20: 5f64 696d 2929 0a0a 2020 2020 2020 2020  _dim))..        
+00016d30: 7365 6c66 2e62 203d 2074 6f72 6368 2e74  self.b = torch.t
+00016d40: 656e 736f 7228 6e70 2e68 7374 6163 6b28  ensor(np.hstack(
+00016d50: 0a20 2020 2020 2020 2020 2020 2028 6e70  .            (np
+00016d60: 2e7a 6572 6f73 2873 656c 662e 6f75 7470  .zeros(self.outp
+00016d70: 7574 5f64 696d 292c 206e 702e 6f6e 6573  ut_dim), np.ones
+00016d80: 2873 656c 662e 6f75 7470 7574 5f64 696d  (self.output_dim
+00016d90: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00016da0: 6e70 2e7a 6572 6f73 2873 656c 662e 6f75  np.zeros(self.ou
+00016db0: 7470 7574 5f64 696d 292c 206e 702e 7a65  tput_dim), np.ze
+00016dc0: 726f 7328 7365 6c66 2e6f 7574 7075 745f  ros(self.output_
+00016dd0: 6469 6d29 2929 2c0a 2020 2020 2020 2020  dim))),.        
+00016de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016df0: 2020 2020 2020 6474 7970 653d 746f 7263        dtype=torc
+00016e00: 682e 666c 6f61 7433 3229 0a0a 2020 2020  h.float32)..    
+00016e10: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
+00016e20: 2c20 696e 7075 7473 293a 0a20 2020 2020  , inputs):.     
+00016e30: 2020 2022 2222 4578 6563 7574 6520 7468     """Execute th
+00016e40: 6973 206c 6179 6572 206f 6e20 696e 7075  is layer on inpu
+00016e50: 7420 7465 6e73 6f72 732e 0a0a 2020 2020  t tensors...    
+00016e60: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00016e70: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00016e80: 2d0a 2020 2020 2020 2020 696e 7075 7473  -.        inputs
+00016e90: 3a20 6c69 7374 0a20 2020 2020 2020 2020  : list.         
+00016ea0: 2020 204c 6973 7420 6f66 2074 6872 6565     List of three
+00016eb0: 2074 656e 736f 7273 2028 782c 2068 5f74   tensors (x, h_t
+00016ec0: 6d31 2c20 635f 746d 3129 2e20 685f 746d  m1, c_tm1). h_tm
+00016ed0: 3120 6d65 616e 7320 2268 2c20 742d 3122  1 means "h, t-1"
+00016ee0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00016ef0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00016f00: 2d2d 0a20 2020 2020 2020 206c 6973 740a  --.        list.
+00016f10: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
+00016f20: 726e 7320 682c 205b 682c 2063 5d0a 2020  rns h, [h, c].  
+00016f30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016f40: 2020 782c 2068 5f74 6d31 2c20 635f 746d    x, h_tm1, c_tm
+00016f50: 3120 3d20 696e 7075 7473 0a20 2020 2020  1 = inputs.     
+00016f60: 2020 2078 2c20 685f 746d 312c 2063 5f74     x, h_tm1, c_t
+00016f70: 6d31 203d 2074 6f72 6368 2e74 656e 736f  m1 = torch.tenso
+00016f80: 7228 7829 2c20 746f 7263 682e 7465 6e73  r(x), torch.tens
+00016f90: 6f72 2868 5f74 6d31 292c 2074 6f72 6368  or(h_tm1), torch
+00016fa0: 2e74 656e 736f 7228 0a20 2020 2020 2020  .tensor(.       
+00016fb0: 2020 2020 2063 5f74 6d31 290a 0a20 2020       c_tm1)..   
+00016fc0: 2020 2020 207a 203d 2074 6f72 6368 2e6d       z = torch.m
+00016fd0: 6174 6d75 6c28 782c 2073 656c 662e 5729  atmul(x, self.W)
+00016fe0: 202b 2074 6f72 6368 2e6d 6174 6d75 6c28   + torch.matmul(
+00016ff0: 685f 746d 312c 2073 656c 662e 5529 202b  h_tm1, self.U) +
+00017000: 2073 656c 662e 620a 0a20 2020 2020 2020   self.b..       
+00017010: 207a 3020 3d20 7a5b 3a2c 203a 7365 6c66   z0 = z[:, :self
+00017020: 2e6f 7574 7075 745f 6469 6d5d 0a20 2020  .output_dim].   
+00017030: 2020 2020 207a 3120 3d20 7a5b 3a2c 2073       z1 = z[:, s
+00017040: 656c 662e 6f75 7470 7574 5f64 696d 3a32  elf.output_dim:2
+00017050: 202a 2073 656c 662e 6f75 7470 7574 5f64   * self.output_d
+00017060: 696d 5d0a 2020 2020 2020 2020 7a32 203d  im].        z2 =
+00017070: 207a 5b3a 2c20 3220 2a20 7365 6c66 2e6f   z[:, 2 * self.o
+00017080: 7574 7075 745f 6469 6d3a 3320 2a20 7365  utput_dim:3 * se
+00017090: 6c66 2e6f 7574 7075 745f 6469 6d5d 0a20  lf.output_dim]. 
+000170a0: 2020 2020 2020 207a 3320 3d20 7a5b 3a2c         z3 = z[:,
+000170b0: 2033 202a 2073 656c 662e 6f75 7470 7574   3 * self.output
+000170c0: 5f64 696d 3a5d 0a0a 2020 2020 2020 2020  _dim:]..        
+000170d0: 6920 3d20 7365 6c66 2e69 6e6e 6572 5f61  i = self.inner_a
+000170e0: 6374 6976 6174 696f 6e5f 666e 287a 3029  ctivation_fn(z0)
+000170f0: 0a20 2020 2020 2020 2066 203d 2073 656c  .        f = sel
+00017100: 662e 696e 6e65 725f 6163 7469 7661 7469  f.inner_activati
+00017110: 6f6e 5f66 6e28 7a31 290a 2020 2020 2020  on_fn(z1).      
+00017120: 2020 6320 3d20 6620 2a20 635f 746d 3120    c = f * c_tm1 
+00017130: 2b20 6920 2a20 7365 6c66 2e61 6374 6976  + i * self.activ
+00017140: 6174 696f 6e5f 666e 287a 3229 0a20 2020  ation_fn(z2).   
+00017150: 2020 2020 206f 203d 2073 656c 662e 696e       o = self.in
+00017160: 6e65 725f 6163 7469 7661 7469 6f6e 5f66  ner_activation_f
+00017170: 6e28 7a33 290a 0a20 2020 2020 2020 2068  n(z3)..        h
+00017180: 203d 206f 202a 2073 656c 662e 6163 7469   = o * self.acti
+00017190: 7661 7469 6f6e 5f66 6e28 6329 0a20 2020  vation_fn(c).   
+000171a0: 2020 2020 2072 6574 7572 6e20 682c 205b       return h, [
+000171b0: 682c 2063 5d0a 0a0a 636c 6173 7320 4174  h, c]...class At
+000171c0: 6f6d 6963 436f 6e76 6f6c 7574 696f 6e28  omicConvolution(
+000171d0: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
+000171e0: 2222 2249 6d70 6c65 6d65 6e74 7320 7468  """Implements th
+000171f0: 6520 4174 6f6d 6963 2043 6f6e 766f 6c75  e Atomic Convolu
+00017200: 7469 6f6e 616c 2074 7261 6e73 666f 726d  tional transform
+00017210: 2c20 696e 7472 6f64 7563 6564 2069 6e0a  , introduced in.
+00017220: 0a20 2020 2047 6f6d 6573 2c20 4a6f 7365  .    Gomes, Jose
+00017230: 7068 2c20 6574 2061 6c2e 2022 4174 6f6d  ph, et al. "Atom
+00017240: 6963 2063 6f6e 766f 6c75 7469 6f6e 616c  ic convolutional
+00017250: 206e 6574 776f 726b 7320 666f 7220 7072   networks for pr
+00017260: 6564 6963 7469 6e67 0a20 2020 2070 726f  edicting.    pro
+00017270: 7465 696e 2d6c 6967 616e 6420 6269 6e64  tein-ligand bind
+00017280: 696e 6720 6166 6669 6e69 7479 2e22 2061  ing affinity." a
+00017290: 7258 6976 2070 7265 7072 696e 7420 6172  rXiv preprint ar
+000172a0: 5869 763a 3137 3033 2e31 3036 3033 0a20  Xiv:1703.10603. 
+000172b0: 2020 2028 3230 3137 292e 0a0a 2020 2020     (2017)...    
+000172c0: 4174 2061 2068 6967 6820 6c65 7665 6c2c  At a high level,
+000172d0: 2074 6869 7320 7472 616e 7366 6f72 6d20   this transform 
+000172e0: 7065 7266 6f72 6d73 2061 2067 7261 7068  performs a graph
+000172f0: 2063 6f6e 766f 6c75 7469 6f6e 0a20 2020   convolution.   
+00017300: 206f 6e20 7468 6520 6e65 6172 6573 7420   on the nearest 
+00017310: 6e65 6967 6862 6f72 7320 6772 6170 6820  neighbors graph 
+00017320: 696e 2033 4420 7370 6163 652e 0a0a 2020  in 3D space...  
+00017330: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+00017340: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+00017350: 6261 7463 685f 7369 7a65 203d 2034 0a20  batch_size = 4. 
+00017360: 2020 203e 3e3e 206d 6178 5f61 746f 6d73     >>> max_atoms
+00017370: 203d 2035 0a20 2020 203e 3e3e 206d 6178   = 5.    >>> max
+00017380: 5f6e 6569 6768 626f 7273 203d 2032 0a20  _neighbors = 2. 
+00017390: 2020 203e 3e3e 2064 696d 656e 7369 6f6e     >>> dimension
+000173a0: 7320 3d20 330a 2020 2020 3e3e 3e20 7261  s = 3.    >>> ra
+000173b0: 6469 616c 5f70 6172 616d 7320 3d20 746f  dial_params = to
+000173c0: 7263 682e 7465 6e73 6f72 285b 5b35 2e30  rch.tensor([[5.0
+000173d0: 2c20 322e 302c 2030 2e35 5d2c 205b 3130  , 2.0, 0.5], [10
+000173e0: 2e30 2c20 322e 302c 2030 2e35 5d2c 0a20  .0, 2.0, 0.5],. 
+000173f0: 2020 202e 2e2e 2020 2020 2020 2020 2020     ...          
+00017400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017410: 2020 2020 205b 352e 302c 2031 2e30 2c20       [5.0, 1.0, 
+00017420: 302e 325d 5d29 0a20 2020 203e 3e3e 2069  0.2]]).    >>> i
+00017430: 6e70 7574 3120 3d20 6e70 2e72 616e 646f  nput1 = np.rando
+00017440: 6d2e 7261 6e64 2862 6174 6368 5f73 697a  m.rand(batch_siz
+00017450: 652c 206d 6178 5f61 746f 6d73 2c20 6469  e, max_atoms, di
+00017460: 6d65 6e73 696f 6e73 292e 6173 7479 7065  mensions).astype
+00017470: 286e 702e 666c 6f61 7433 3229 0a20 2020  (np.float32).   
+00017480: 203e 3e3e 2069 6e70 7574 3220 3d20 6e70   >>> input2 = np
+00017490: 2e72 616e 646f 6d2e 7261 6e64 696e 7428  .random.randint(
+000174a0: 6d61 785f 6174 6f6d 732c 0a20 2020 202e  max_atoms,.    .
+000174b0: 2e2e 2020 2020 2020 2020 2020 2020 2020  ..              
+000174c0: 2020 2020 2020 2020 2020 2020 2020 7369                si
+000174d0: 7a65 3d28 6261 7463 685f 7369 7a65 2c20  ze=(batch_size, 
+000174e0: 6d61 785f 6174 6f6d 732c 206d 6178 5f6e  max_atoms, max_n
+000174f0: 6569 6768 626f 7273 2929 0a20 2020 203e  eighbors)).    >
+00017500: 3e3e 2069 6e70 7574 3320 3d20 6e70 2e72  >> input3 = np.r
+00017510: 616e 646f 6d2e 7261 6e64 696e 7428 312c  andom.randint(1,
+00017520: 2031 302c 2073 697a 653d 2862 6174 6368   10, size=(batch
+00017530: 5f73 697a 652c 206d 6178 5f61 746f 6d73  _size, max_atoms
+00017540: 2c20 6d61 785f 6e65 6967 6862 6f72 7329  , max_neighbors)
+00017550: 290a 2020 2020 3e3e 3e20 6c61 7965 7220  ).    >>> layer 
+00017560: 3d20 4174 6f6d 6963 436f 6e76 6f6c 7574  = AtomicConvolut
+00017570: 696f 6e28 7261 6469 616c 5f70 6172 616d  ion(radial_param
+00017580: 733d 7261 6469 616c 5f70 6172 616d 7329  s=radial_params)
+00017590: 0a20 2020 203e 3e3e 2072 6573 756c 7420  .    >>> result 
+000175a0: 3d20 6c61 7965 7228 5b69 6e70 7574 312c  = layer([input1,
+000175b0: 2069 6e70 7574 322c 2069 6e70 7574 335d   input2, input3]
+000175c0: 290a 2020 2020 3e3e 3e20 7265 7375 6c74  ).    >>> result
+000175d0: 2e73 6861 7065 0a20 2020 2074 6f72 6368  .shape.    torch
+000175e0: 2e53 697a 6528 5b34 2c20 352c 2033 5d29  .Size([4, 5, 3])
+000175f0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00017600: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00017610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017620: 2020 6174 6f6d 5f74 7970 6573 3a20 4f70    atom_types: Op
+00017630: 7469 6f6e 616c 5b55 6e69 6f6e 5b41 7272  tional[Union[Arr
+00017640: 6179 4c69 6b65 2c20 746f 7263 682e 5465  ayLike, torch.Te
+00017650: 6e73 6f72 5d5d 203d 204e 6f6e 652c 0a20  nsor]] = None,. 
+00017660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017670: 7261 6469 616c 5f70 6172 616d 733a 2055  radial_params: U
+00017680: 6e69 6f6e 5b41 7272 6179 4c69 6b65 2c20  nion[ArrayLike, 
+00017690: 746f 7263 682e 5465 6e73 6f72 5d20 3d20  torch.Tensor] = 
+000176a0: 6c69 7374 2829 2c0a 2020 2020 2020 2020  list(),.        
+000176b0: 2020 2020 2020 2020 2062 6f78 5f73 697a           box_siz
+000176c0: 653a 204f 7074 696f 6e61 6c5b 556e 696f  e: Optional[Unio
+000176d0: 6e5b 4172 7261 794c 696b 652c 2074 6f72  n[ArrayLike, tor
+000176e0: 6368 2e54 656e 736f 725d 5d20 3d20 4e6f  ch.Tensor]] = No
+000176f0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+00017700: 2020 2020 202a 2a6b 7761 7267 7329 3a0a       **kwargs):.
+00017710: 2020 2020 2020 2020 2222 2249 6e69 7469          """Initi
+00017720: 616c 697a 6520 7468 6973 206c 6179 6572  alize this layer
+00017730: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00017740: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00017750: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00017760: 2061 746f 6d5f 7479 7065 7320 3a20 556e   atom_types : Un
+00017770: 696f 6e5b 4172 7261 794c 696b 652c 2074  ion[ArrayLike, t
+00017780: 6f72 6368 2e54 656e 736f 725d 2c20 6f70  orch.Tensor], op
+00017790: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+000177a0: 2020 204c 6973 7420 6f66 2061 746f 6d20     List of atom 
+000177b0: 7479 7065 732e 0a20 2020 2020 2020 2072  types..        r
+000177c0: 6164 6961 6c5f 7061 7261 6d73 203a 2055  adial_params : U
+000177d0: 6e69 6f6e 5b41 7272 6179 4c69 6b65 2c20  nion[ArrayLike, 
+000177e0: 746f 7263 682e 5465 6e73 6f72 5d2c 206f  torch.Tensor], o
+000177f0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00017800: 2020 2020 4c69 7374 206f 6620 7261 6469      List of radi
+00017810: 616c 2070 6172 616d 732e 0a20 2020 2020  al params..     
+00017820: 2020 2062 6f78 5f73 697a 6520 3a20 556e     box_size : Un
+00017830: 696f 6e5b 4172 7261 794c 696b 652c 2074  ion[ArrayLike, t
+00017840: 6f72 6368 2e54 656e 736f 725d 2c20 6f70  orch.Tensor], op
+00017850: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00017860: 2020 204c 656e 6774 6820 6d75 7374 2062     Length must b
+00017870: 6520 6571 7561 6c20 746f 2074 6865 206e  e equal to the n
+00017880: 756d 6265 7220 6f66 2066 6561 7475 7265  umber of feature
+00017890: 732e 0a20 2020 2020 2020 2022 2222 0a0a  s..        """..
+000178a0: 2020 2020 2020 2020 7375 7065 7228 4174          super(At
+000178b0: 6f6d 6963 436f 6e76 6f6c 7574 696f 6e2c  omicConvolution,
+000178c0: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
+000178d0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+000178e0: 2020 7365 6c66 2e61 746f 6d5f 7479 7065    self.atom_type
+000178f0: 7320 3d20 6174 6f6d 5f74 7970 6573 0a20  s = atom_types. 
+00017900: 2020 2020 2020 2073 656c 662e 7261 6469         self.radi
+00017910: 616c 5f70 6172 616d 7320 3d20 7261 6469  al_params = radi
+00017920: 616c 5f70 6172 616d 730a 0a20 2020 2020  al_params..     
+00017930: 2020 2069 6620 626f 785f 7369 7a65 2069     if box_size i
+00017940: 7320 4e6f 6e65 206f 7220 6973 696e 7374  s None or isinst
+00017950: 616e 6365 2862 6f78 5f73 697a 652c 2074  ance(box_size, t
+00017960: 6f72 6368 2e54 656e 736f 7229 3a0a 2020  orch.Tensor):.  
+00017970: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+00017980: 6f78 5f73 697a 6520 3d20 626f 785f 7369  ox_size = box_si
+00017990: 7a65 0a20 2020 2020 2020 2065 6c73 653a  ze.        else:
+000179a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000179b0: 662e 626f 785f 7369 7a65 203d 2074 6f72  f.box_size = tor
+000179c0: 6368 2e74 656e 736f 7228 626f 785f 7369  ch.tensor(box_si
+000179d0: 7a65 290a 0a20 2020 2020 2020 2076 6172  ze)..        var
+000179e0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
+000179f0: 6f72 2069 2069 6e20 7261 6e67 6528 3329  or i in range(3)
+00017a00: 3a0a 2020 2020 2020 2020 2020 2020 7661  :.            va
+00017a10: 6c20 3d20 6e70 2e61 7272 6179 285b 705b  l = np.array([p[
+00017a20: 695d 2066 6f72 2070 2069 6e20 7365 6c66  i] for p in self
+00017a30: 2e72 6164 6961 6c5f 7061 7261 6d73 5d29  .radial_params])
+00017a40: 2e72 6573 6861 7065 280a 2020 2020 2020  .reshape(.      
+00017a50: 2020 2020 2020 2020 2020 282d 312c 2031            (-1, 1
+00017a60: 2c20 312c 2031 2929 0a20 2020 2020 2020  , 1, 1)).       
+00017a70: 2020 2020 2076 6172 732e 6170 7065 6e64       vars.append
+00017a80: 2874 6f72 6368 2e74 656e 736f 7228 7661  (torch.tensor(va
+00017a90: 6c2c 2064 7479 7065 3d74 6f72 6368 2e66  l, dtype=torch.f
+00017aa0: 6c6f 6174 2929 0a20 2020 2020 2020 2073  loat)).        s
+00017ab0: 656c 662e 7263 203d 206e 6e2e 5061 7261  elf.rc = nn.Para
+00017ac0: 6d65 7465 7228 7661 7273 5b30 5d29 0a20  meter(vars[0]). 
+00017ad0: 2020 2020 2020 2073 656c 662e 7273 203d         self.rs =
+00017ae0: 206e 6e2e 5061 7261 6d65 7465 7228 7661   nn.Parameter(va
+00017af0: 7273 5b31 5d29 0a20 2020 2020 2020 2073  rs[1]).        s
+00017b00: 656c 662e 7265 203d 206e 6e2e 5061 7261  elf.re = nn.Para
+00017b10: 6d65 7465 7228 7661 7273 5b32 5d29 0a0a  meter(vars[2])..
+00017b20: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
+00017b30: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00017b40: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
+00017b50: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
+00017b60: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00017b70: 2861 746f 6d5f 7479 7065 733d 7b73 656c  (atom_types={sel
+00017b80: 662e 6174 6f6d 5f74 7970 6573 7d2c 2072  f.atom_types}, r
+00017b90: 6164 6961 6c5f 7061 7261 6d73 3d7b 7365  adial_params={se
+00017ba0: 6c66 2e72 6164 6961 6c5f 7061 7261 6d73  lf.radial_params
+00017bb0: 7d2c 2062 6f78 5f73 697a 653d 7b73 656c  }, box_size={sel
+00017bc0: 662e 626f 785f 7369 7a65 7d2c 2072 633d  f.box_size}, rc=
+00017bd0: 7b73 656c 662e 7263 7d2c 2072 733d 7b73  {self.rc}, rs={s
+00017be0: 656c 662e 7273 7d2c 2072 653d 7b73 656c  elf.rs}, re={sel
+00017bf0: 662e 7265 7d29 270a 2020 2020 2020 2020  f.re})'.        
+00017c00: 290a 0a20 2020 2064 6566 2066 6f72 7761  )..    def forwa
+00017c10: 7264 280a 2020 2020 2020 2020 2020 2020  rd(.            
+00017c20: 7365 6c66 2c20 696e 7075 7473 3a20 5365  self, inputs: Se
+00017c30: 7175 656e 6365 5b55 6e69 6f6e 5b41 7272  quence[Union[Arr
+00017c40: 6179 4c69 6b65 2c0a 2020 2020 2020 2020  ayLike,.        
 00017c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c60: 2020 2020 746f 7263 682e 5465 6e73 6f72      torch.Tensor
-00017c70: 5d5d 2920 2d3e 2074 6f72 6368 2e54 656e  ]]) -> torch.Ten
-00017c80: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
-00017c90: 496e 766f 6b65 2074 6869 7320 6c61 7965  Invoke this laye
-00017ca0: 722e 0a0a 2020 2020 2020 2020 422c 204e  r...        B, N
-00017cb0: 2c20 4d2c 2064 2c20 6c20 3d20 6261 7463  , M, d, l = batc
-00017cc0: 685f 7369 7a65 2c20 6d61 785f 6e75 6d5f  h_size, max_num_
-00017cd0: 6174 6f6d 732c 206d 6178 5f6e 756d 5f6e  atoms, max_num_n
-00017ce0: 6569 6768 626f 7273 2c20 6e75 6d5f 6665  eighbors, num_fe
-00017cf0: 6174 7572 6573 2c20 6c65 6e28 7261 6469  atures, len(radi
-00017d00: 616c 5f70 6172 616d 7329 202a 206c 656e  al_params) * len
-00017d10: 2861 746f 6d5f 7479 7065 7329 0a0a 2020  (atom_types)..  
-00017d20: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00017d30: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00017d40: 2d2d 2d0a 2020 2020 2020 2020 696e 7075  ---.        inpu
-00017d50: 7473 3a20 5365 7175 656e 6365 5b55 6e69  ts: Sequence[Uni
-00017d60: 6f6e 5b41 7272 6179 4c69 6b65 2c20 746f  on[ArrayLike, to
-00017d70: 7263 682e 5465 6e73 6f72 5d5d 0a20 2020  rch.Tensor]].   
-00017d80: 2020 2020 2020 2020 2046 6972 7374 2069           First i
-00017d90: 6e70 7574 2061 7265 2074 6865 2063 6f6f  nput are the coo
-00017da0: 7264 696e 6174 6573 2f66 6561 7475 7265  rdinates/feature
-00017db0: 732c 206f 6620 7368 6170 6520 2842 2c20  s, of shape (B, 
-00017dc0: 4e2c 2064 290a 2020 2020 2020 2020 2020  N, d).          
-00017dd0: 2020 5365 636f 6e64 2069 6e70 7574 2069    Second input i
-00017de0: 7320 7468 6520 6e65 6967 6862 6f72 206c  s the neighbor l
-00017df0: 6973 742c 206f 6620 7368 6170 6520 2842  ist, of shape (B
-00017e00: 2c20 4e2c 204d 290a 2020 2020 2020 2020  , N, M).        
-00017e10: 2020 2020 5468 6972 6420 696e 7075 7420      Third input 
-00017e20: 6172 6520 7468 6520 6174 6f6d 6963 206e  are the atomic n
-00017e30: 756d 6265 7273 206f 6620 6e65 6967 6862  umbers of neighb
-00017e40: 6f72 2061 746f 6d73 2c20 6f66 2073 6861  or atoms, of sha
-00017e50: 7065 2028 422c 204e 2c20 4d29 0a0a 2020  pe (B, N, M)..  
-00017e60: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00017e70: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00017e80: 2020 2020 2020 746f 7263 682e 5465 6e73        torch.Tens
-00017e90: 6f72 206f 6620 7368 6170 6520 2842 2c20  or of shape (B, 
-00017ea0: 4e2c 206c 290a 2020 2020 2020 2020 2020  N, l).          
-00017eb0: 2020 4f75 7470 7574 206f 6620 6174 6f6d    Output of atom
-00017ec0: 6963 2063 6f6e 766f 6c75 7469 6f6e 206c  ic convolution l
-00017ed0: 6179 6572 2e0a 0a20 2020 2020 2020 2052  ayer...        R
-00017ee0: 6169 7365 730a 2020 2020 2020 2020 2d2d  aises.        --
-00017ef0: 2d2d 2d2d 0a20 2020 2020 2020 2056 616c  ----.        Val
-00017f00: 7565 4572 726f 720a 2020 2020 2020 2020  ueError.        
-00017f10: 2020 2020 5768 656e 2074 6865 206c 656e      When the len
-00017f20: 6774 6820 6f66 2060 696e 7075 7473 6020  gth of `inputs` 
-00017f30: 6973 206e 6f74 2065 7175 616c 2074 6f20  is not equal to 
-00017f40: 332e 0a20 2020 2020 2020 2022 2222 0a20  3..        """. 
-00017f50: 2020 2020 2020 2069 6620 6c65 6e28 696e         if len(in
-00017f60: 7075 7473 2920 213d 2033 3a0a 2020 2020  puts) != 3:.    
-00017f70: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00017f80: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00017f90: 2020 2020 2020 2020 2020 6622 6069 6e70            f"`inp
-00017fa0: 7574 7360 2068 6173 2074 6f20 6265 206f  uts` has to be o
-00017fb0: 6620 6c65 6e67 7468 2033 2c20 676f 743a  f length 3, got:
-00017fc0: 207b 6c65 6e28 696e 7075 7473 297d 2229   {len(inputs)}")
-00017fd0: 0a0a 2020 2020 2020 2020 5820 3d20 746f  ..        X = to
-00017fe0: 7263 682e 7465 6e73 6f72 2869 6e70 7574  rch.tensor(input
-00017ff0: 735b 305d 290a 2020 2020 2020 2020 4e62  s[0]).        Nb
-00018000: 7273 203d 2074 6f72 6368 2e74 656e 736f  rs = torch.tenso
-00018010: 7228 696e 7075 7473 5b31 5d2c 2064 7479  r(inputs[1], dty
-00018020: 7065 3d74 6f72 6368 2e69 6e74 3634 290a  pe=torch.int64).
-00018030: 2020 2020 2020 2020 4e62 7273 5f5a 203d          Nbrs_Z =
-00018040: 2074 6f72 6368 2e74 656e 736f 7228 696e   torch.tensor(in
-00018050: 7075 7473 5b32 5d29 0a0a 2020 2020 2020  puts[2])..      
-00018060: 2020 422c 204e 2c20 6420 3d20 582e 7368    B, N, d = X.sh
-00018070: 6170 650a 2020 2020 2020 2020 4d20 3d20  ape.        M = 
-00018080: 4e62 7273 2e73 6861 7065 5b2d 315d 0a0a  Nbrs.shape[-1]..
-00018090: 2020 2020 2020 2020 4420 3d20 7365 6c66          D = self
-000180a0: 2e64 6973 7461 6e63 655f 7465 6e73 6f72  .distance_tensor
-000180b0: 2858 2c20 4e62 7273 2c20 7365 6c66 2e62  (X, Nbrs, self.b
-000180c0: 6f78 5f73 697a 652c 2042 2c20 4e2c 204d  ox_size, B, N, M
-000180d0: 2c20 6429 0a20 2020 2020 2020 2052 203d  , d).        R =
-000180e0: 2073 656c 662e 6469 7374 616e 6365 5f6d   self.distance_m
-000180f0: 6174 7269 7828 4429 0a20 2020 2020 2020  atrix(D).       
-00018100: 2052 203d 2074 6f72 6368 2e75 6e73 7175   R = torch.unsqu
-00018110: 6565 7a65 2852 2c20 3029 0a20 2020 2020  eeze(R, 0).     
-00018120: 2020 2072 7366 203d 2073 656c 662e 7261     rsf = self.ra
-00018130: 6469 616c 5f73 796d 6d65 7472 795f 6675  dial_symmetry_fu
-00018140: 6e63 7469 6f6e 2852 2c20 7365 6c66 2e72  nction(R, self.r
-00018150: 632c 2073 656c 662e 7273 2c20 7365 6c66  c, self.rs, self
-00018160: 2e72 6529 0a0a 2020 2020 2020 2020 6966  .re)..        if
-00018170: 206e 6f74 2073 656c 662e 6174 6f6d 5f74   not self.atom_t
-00018180: 7970 6573 3a0a 2020 2020 2020 2020 2020  ypes:.          
-00018190: 2020 636f 6e64 203d 2074 6f72 6368 2e6e    cond = torch.n
-000181a0: 6f74 5f65 7175 616c 284e 6272 735f 5a2c  ot_equal(Nbrs_Z,
-000181b0: 2030 292e 746f 2874 6f72 6368 2e66 6c6f   0).to(torch.flo
-000181c0: 6174 292e 7265 7368 6170 6528 0a20 2020  at).reshape(.   
-000181d0: 2020 2020 2020 2020 2020 2020 2028 312c               (1,
-000181e0: 202d 312c 204e 2c20 4d29 290a 2020 2020   -1, N, M)).    
-000181f0: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
-00018200: 746f 7263 682e 7375 6d28 636f 6e64 202a  torch.sum(cond *
-00018210: 2072 7366 2c20 3329 0a20 2020 2020 2020   rsf, 3).       
-00018220: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00018230: 2020 2023 2053 756d 2074 6865 2070 6169     # Sum the pai
-00018240: 7277 6973 652d 696e 7465 7261 6374 696f  rwise-interactio
-00018250: 6e73 2062 6574 7765 656e 2061 746f 6d73  ns between atoms
-00018260: 2074 6861 7420 6172 6520 6f66 2060 6174   that are of `at
-00018270: 6f6d 5f74 7970 6560 2061 6e64 2069 7473  om_type` and its
-00018280: 206e 6569 6768 626f 7273 2066 6f72 2065   neighbors for e
-00018290: 6163 6820 6174 6f6d 2074 7970 6520 696e  ach atom type in
-000182a0: 2060 6174 6f6d 5f74 7970 6573 602e 0a20   `atom_types`.. 
-000182b0: 2020 2020 2020 2020 2020 2073 796d 6d65             symme
-000182c0: 7472 6965 7320 3d20 5b5d 0a20 2020 2020  tries = [].     
-000182d0: 2020 2020 2020 2066 6f72 2061 746f 6d5f         for atom_
-000182e0: 7479 7065 2069 6e20 7365 6c66 2e61 746f  type in self.ato
-000182f0: 6d5f 7479 7065 733a 0a20 2020 2020 2020  m_types:.       
-00018300: 2020 2020 2020 2020 2063 6f6e 6420 3d20           cond = 
-00018310: 746f 7263 682e 6571 284e 6272 735f 5a2c  torch.eq(Nbrs_Z,
-00018320: 2061 746f 6d5f 7479 7065 292e 746f 2874   atom_type).to(t
-00018330: 6f72 6368 2e66 6c6f 6174 292e 7265 7368  orch.float).resh
-00018340: 6170 6528 0a20 2020 2020 2020 2020 2020  ape(.           
-00018350: 2020 2020 2020 2020 2028 312c 202d 312c           (1, -1,
-00018360: 204e 2c20 4d29 290a 2020 2020 2020 2020   N, M)).        
-00018370: 2020 2020 2020 2020 7379 6d6d 6574 7269          symmetri
-00018380: 6573 2e61 7070 656e 6428 746f 7263 682e  es.append(torch.
-00018390: 7375 6d28 636f 6e64 202a 2072 7366 2c20  sum(cond * rsf, 
-000183a0: 3329 290a 2020 2020 2020 2020 2020 2020  3)).            
-000183b0: 6c61 7965 7220 3d20 746f 7263 682e 636f  layer = torch.co
-000183c0: 6e63 6174 2873 796d 6d65 7472 6965 732c  ncat(symmetries,
-000183d0: 2030 290a 0a20 2020 2020 2020 206c 6179   0)..        lay
-000183e0: 6572 203d 2074 6f72 6368 2e70 6572 6d75  er = torch.permu
-000183f0: 7465 286c 6179 6572 2c20 5b31 2c20 322c  te(layer, [1, 2,
-00018400: 2030 5d29 0a20 2020 2020 2020 2076 6172   0]).        var
-00018410: 2c20 6d65 616e 203d 2074 6f72 6368 2e76  , mean = torch.v
-00018420: 6172 5f6d 6561 6e28 6c61 7965 722c 205b  ar_mean(layer, [
-00018430: 302c 2032 5d29 0a20 2020 2020 2020 2076  0, 2]).        v
-00018440: 6172 2c20 6d65 616e 203d 2076 6172 2e64  ar, mean = var.d
-00018450: 6574 6163 6828 292c 206d 6561 6e2e 6465  etach(), mean.de
-00018460: 7461 6368 2829 0a0a 2020 2020 2020 2020  tach()..        
-00018470: 7265 7475 726e 2046 2e62 6174 6368 5f6e  return F.batch_n
-00018480: 6f72 6d28 6c61 7965 722c 206d 6561 6e2c  orm(layer, mean,
-00018490: 2076 6172 290a 0a20 2020 2064 6566 2064   var)..    def d
-000184a0: 6973 7461 6e63 655f 7465 6e73 6f72 2873  istance_tensor(s
-000184b0: 656c 662c 2058 3a20 746f 7263 682e 5465  elf, X: torch.Te
-000184c0: 6e73 6f72 2c20 4e62 7273 3a20 746f 7263  nsor, Nbrs: torc
-000184d0: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
-000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184f0: 2020 626f 785f 7369 7a65 3a20 556e 696f    box_size: Unio
-00018500: 6e5b 746f 7263 682e 5465 6e73 6f72 2c20  n[torch.Tensor, 
-00018510: 4e6f 6e65 5d2c 2042 3a20 696e 742c 204e  None], B: int, N
-00018520: 3a20 696e 742c 0a20 2020 2020 2020 2020  : int,.         
-00018530: 2020 2020 2020 2020 2020 2020 2020 204d                 M
-00018540: 3a20 696e 742c 2064 3a20 696e 7429 202d  : int, d: int) -
-00018550: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
-00018560: 2020 2020 2020 2020 2222 2243 616c 6375          """Calcu
-00018570: 6c61 7465 2064 6973 7461 6e63 6520 7465  late distance te
-00018580: 6e73 6f72 2066 6f72 2061 2062 6174 6368  nsor for a batch
-00018590: 206f 6620 6d6f 6c65 6375 6c65 732e 0a0a   of molecules...
-000185a0: 2020 2020 2020 2020 422c 204e 2c20 4d2c          B, N, M,
-000185b0: 2064 203d 2062 6174 6368 5f73 697a 652c   d = batch_size,
-000185c0: 206d 6178 5f6e 756d 5f61 746f 6d73 2c20   max_num_atoms, 
-000185d0: 6d61 785f 6e75 6d5f 6e65 6967 6862 6f72  max_num_neighbor
-000185e0: 732c 206e 756d 5f66 6561 7475 7265 730a  s, num_features.
-000185f0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00018600: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00018610: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2058  ------.        X
-00018620: 203a 2074 6f72 6368 2e54 656e 736f 7220   : torch.Tensor 
-00018630: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
-00018640: 6429 0a20 2020 2020 2020 2020 2020 2043  d).            C
-00018650: 6f6f 7264 696e 6174 6573 2f66 6561 7475  oordinates/featu
-00018660: 7265 732e 0a20 2020 2020 2020 204e 6272  res..        Nbr
-00018670: 7320 3a20 746f 7263 682e 5465 6e73 6f72  s : torch.Tensor
-00018680: 206f 6620 7368 6170 6520 2842 2c20 4e2c   of shape (B, N,
-00018690: 204d 290a 2020 2020 2020 2020 2020 2020   M).            
-000186a0: 4e65 6967 6862 6f72 206c 6973 742e 0a20  Neighbor list.. 
-000186b0: 2020 2020 2020 2062 6f78 5f73 697a 6520         box_size 
-000186c0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-000186d0: 2020 2020 2020 2020 2020 204c 656e 6774             Lengt
-000186e0: 6820 6d75 7374 2062 6520 6571 7561 6c20  h must be equal 
-000186f0: 746f 2060 6460 2e0a 2020 2020 2020 2020  to `d`..        
-00018700: 4220 3a20 696e 740a 2020 2020 2020 2020  B : int.        
-00018710: 2020 2020 4261 7463 6820 7369 7a65 0a20      Batch size. 
-00018720: 2020 2020 2020 204e 203a 2069 6e74 0a20         N : int. 
-00018730: 2020 2020 2020 2020 2020 204d 6178 696d             Maxim
-00018740: 756d 206e 756d 6265 7220 6f66 2061 746f  um number of ato
-00018750: 6d73 0a20 2020 2020 2020 204d 203a 2069  ms.        M : i
-00018760: 6e74 0a20 2020 2020 2020 2020 2020 204d  nt.            M
-00018770: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
-00018780: 206e 6569 6768 626f 7273 0a20 2020 2020   neighbors.     
-00018790: 2020 2064 203a 2069 6e74 0a20 2020 2020     d : int.     
-000187a0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-000187b0: 2066 6561 7475 7265 730a 0a20 2020 2020   features..     
-000187c0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-000187d0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-000187e0: 2020 2074 6f72 6368 2e54 656e 736f 7220     torch.Tensor 
-000187f0: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
-00018800: 4d2c 2064 290a 2020 2020 2020 2020 2020  M, d).          
-00018810: 2020 436f 6f72 6469 6e61 7465 732f 6665    Coordinates/fe
-00018820: 6174 7572 6573 2064 6973 7461 6e63 6520  atures distance 
-00018830: 7465 6e73 6f72 2e0a 0a20 2020 2020 2020  tensor...       
-00018840: 2052 6169 7365 730a 2020 2020 2020 2020   Raises.        
-00018850: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2056  ------.        V
-00018860: 616c 7565 4572 726f 720a 2020 2020 2020  alueError.      
-00018870: 2020 2020 2020 5768 656e 2074 6865 206c        When the l
-00018880: 656e 6774 6820 6f66 2060 626f 785f 7369  ength of `box_si
-00018890: 7a65 6020 6973 206e 6f74 2065 7175 616c  ze` is not equal
-000188a0: 2074 6f20 6064 602e 0a20 2020 2020 2020   to `d`..       
-000188b0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-000188c0: 626f 785f 7369 7a65 2069 7320 6e6f 7420  box_size is not 
-000188d0: 4e6f 6e65 2061 6e64 206c 656e 2862 6f78  None and len(box
-000188e0: 5f73 697a 6529 2021 3d20 643a 0a20 2020  _size) != d:.   
-000188f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00018900: 616c 7565 4572 726f 7228 224c 656e 6774  alueError("Lengt
-00018910: 6820 6f66 2060 626f 785f 7369 7a65 6020  h of `box_size` 
-00018920: 6d75 7374 2062 6520 6571 7561 6c20 746f  must be equal to
-00018930: 2060 6460 2229 0a0a 2020 2020 2020 2020   `d`")..        
-00018940: 666c 6174 5f6e 6569 6768 626f 7273 203d  flat_neighbors =
-00018950: 2074 6f72 6368 2e72 6573 6861 7065 284e   torch.reshape(N
-00018960: 6272 732c 2028 2d31 2c20 4e20 2a20 4d29  brs, (-1, N * M)
-00018970: 290a 2020 2020 2020 2020 6e65 6967 6862  ).        neighb
-00018980: 6f72 5f63 6f6f 7264 7320 3d20 746f 7263  or_coords = torc
-00018990: 682e 7374 6163 6b28 0a20 2020 2020 2020  h.stack(.       
-000189a0: 2020 2020 205b 585b 622c 2066 6c61 745f       [X[b, flat_
-000189b0: 6e65 6967 6862 6f72 735b 625d 5d20 666f  neighbors[b]] fo
-000189c0: 7220 6220 696e 2072 616e 6765 2842 295d  r b in range(B)]
-000189d0: 290a 2020 2020 2020 2020 6e65 6967 6862  ).        neighb
-000189e0: 6f72 5f63 6f6f 7264 7320 3d20 746f 7263  or_coords = torc
-000189f0: 682e 7265 7368 6170 6528 6e65 6967 6862  h.reshape(neighb
-00018a00: 6f72 5f63 6f6f 7264 732c 2028 2d31 2c20  or_coords, (-1, 
-00018a10: 4e2c 204d 2c20 6429 290a 2020 2020 2020  N, M, d)).      
-00018a20: 2020 4420 3d20 6e65 6967 6862 6f72 5f63    D = neighbor_c
-00018a30: 6f6f 7264 7320 2d20 746f 7263 682e 756e  oords - torch.un
-00018a40: 7371 7565 657a 6528 582c 2032 290a 2020  squeeze(X, 2).  
-00018a50: 2020 2020 2020 6966 2062 6f78 5f73 697a        if box_siz
-00018a60: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00018a70: 2020 2020 2020 2020 2020 2062 6f78 5f73             box_s
-00018a80: 697a 6520 3d20 746f 7263 682e 7265 7368  ize = torch.resh
-00018a90: 6170 6528 626f 785f 7369 7a65 2c20 2831  ape(box_size, (1
-00018aa0: 2c20 312c 2031 2c20 6429 290a 2020 2020  , 1, 1, d)).    
-00018ab0: 2020 2020 2020 2020 4420 2d3d 2074 6f72          D -= tor
-00018ac0: 6368 2e72 6f75 6e64 2844 202f 2062 6f78  ch.round(D / box
-00018ad0: 5f73 697a 6529 202a 2062 6f78 5f73 697a  _size) * box_siz
-00018ae0: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-00018af0: 6e20 440a 0a20 2020 2064 6566 2064 6973  n D..    def dis
-00018b00: 7461 6e63 655f 6d61 7472 6978 2873 656c  tance_matrix(sel
-00018b10: 662c 2044 3a20 746f 7263 682e 5465 6e73  f, D: torch.Tens
-00018b20: 6f72 2920 2d3e 2074 6f72 6368 2e54 656e  or) -> torch.Ten
-00018b30: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
-00018b40: 4361 6c63 756c 6174 6520 6120 6469 7374  Calculate a dist
-00018b50: 616e 6365 206d 6174 7269 782c 2067 6976  ance matrix, giv
-00018b60: 656e 2061 2064 6973 7461 6e63 6520 7465  en a distance te
-00018b70: 6e73 6f72 2e0a 0a20 2020 2020 2020 2042  nsor...        B
-00018b80: 2c20 4e2c 204d 2c20 6420 3d20 6261 7463  , N, M, d = batc
-00018b90: 685f 7369 7a65 2c20 6d61 785f 6e75 6d5f  h_size, max_num_
-00018ba0: 6174 6f6d 732c 206d 6178 5f6e 756d 5f6e  atoms, max_num_n
-00018bb0: 6569 6768 626f 7273 2c20 6e75 6d5f 6665  eighbors, num_fe
-00018bc0: 6174 7572 6573 0a0a 2020 2020 2020 2020  atures..        
-00018bd0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00018be0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00018bf0: 2020 2020 2020 4420 3a20 746f 7263 682e        D : torch.
-00018c00: 5465 6e73 6f72 206f 6620 7368 6170 6520  Tensor of shape 
-00018c10: 2842 2c20 4e2c 204d 2c20 6429 0a20 2020  (B, N, M, d).   
-00018c20: 2020 2020 2020 2020 2044 6973 7461 6e63           Distanc
-00018c30: 6520 7465 6e73 6f72 0a0a 2020 2020 2020  e tensor..      
-00018c40: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00018c50: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00018c60: 2020 746f 7263 682e 5465 6e73 6f72 206f    torch.Tensor o
-00018c70: 6620 7368 6170 6520 2842 2c20 4e2c 204d  f shape (B, N, M
-00018c80: 290a 2020 2020 2020 2020 2020 2020 4469  ).            Di
-00018c90: 7374 616e 6365 206d 6174 7269 782e 0a20  stance matrix.. 
-00018ca0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00018cb0: 2020 2072 6574 7572 6e20 746f 7263 682e     return torch.
-00018cc0: 7371 7274 2874 6f72 6368 2e73 756d 2874  sqrt(torch.sum(t
-00018cd0: 6f72 6368 2e6d 756c 2844 2c20 4429 2c20  orch.mul(D, D), 
-00018ce0: 3329 290a 0a20 2020 2064 6566 2067 6175  3))..    def gau
-00018cf0: 7373 6961 6e5f 6469 7374 616e 6365 5f6d  ssian_distance_m
-00018d00: 6174 7269 7828 7365 6c66 2c20 523a 2074  atrix(self, R: t
-00018d10: 6f72 6368 2e54 656e 736f 722c 2072 733a  orch.Tensor, rs:
-00018d20: 2074 6f72 6368 2e54 656e 736f 722c 0a20   torch.Tensor,. 
-00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c70: 2074 6f72 6368 2e54 656e 736f 725d 5d29   torch.Tensor]])
+00017c80: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
+00017c90: 3a0a 2020 2020 2020 2020 2222 2249 6e76  :.        """Inv
+00017ca0: 6f6b 6520 7468 6973 206c 6179 6572 2e0a  oke this layer..
+00017cb0: 0a20 2020 2020 2020 2042 2c20 4e2c 204d  .        B, N, M
+00017cc0: 2c20 642c 206c 203d 2062 6174 6368 5f73  , d, l = batch_s
+00017cd0: 697a 652c 206d 6178 5f6e 756d 5f61 746f  ize, max_num_ato
+00017ce0: 6d73 2c20 6d61 785f 6e75 6d5f 6e65 6967  ms, max_num_neig
+00017cf0: 6862 6f72 732c 206e 756d 5f66 6561 7475  hbors, num_featu
+00017d00: 7265 732c 206c 656e 2872 6164 6961 6c5f  res, len(radial_
+00017d10: 7061 7261 6d73 2920 2a20 6c65 6e28 6174  params) * len(at
+00017d20: 6f6d 5f74 7970 6573 290a 0a20 2020 2020  om_types)..     
+00017d30: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00017d40: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00017d50: 0a20 2020 2020 2020 2069 6e70 7574 733a  .        inputs:
+00017d60: 2053 6571 7565 6e63 655b 556e 696f 6e5b   Sequence[Union[
+00017d70: 4172 7261 794c 696b 652c 2074 6f72 6368  ArrayLike, torch
+00017d80: 2e54 656e 736f 725d 5d0a 2020 2020 2020  .Tensor]].      
+00017d90: 2020 2020 2020 4669 7273 7420 696e 7075        First inpu
+00017da0: 7420 6172 6520 7468 6520 636f 6f72 6469  t are the coordi
+00017db0: 6e61 7465 732f 6665 6174 7572 6573 2c20  nates/features, 
+00017dc0: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
+00017dd0: 6429 0a20 2020 2020 2020 2020 2020 2053  d).            S
+00017de0: 6563 6f6e 6420 696e 7075 7420 6973 2074  econd input is t
+00017df0: 6865 206e 6569 6768 626f 7220 6c69 7374  he neighbor list
+00017e00: 2c20 6f66 2073 6861 7065 2028 422c 204e  , of shape (B, N
+00017e10: 2c20 4d29 0a20 2020 2020 2020 2020 2020  , M).           
+00017e20: 2054 6869 7264 2069 6e70 7574 2061 7265   Third input are
+00017e30: 2074 6865 2061 746f 6d69 6320 6e75 6d62   the atomic numb
+00017e40: 6572 7320 6f66 206e 6569 6768 626f 7220  ers of neighbor 
+00017e50: 6174 6f6d 732c 206f 6620 7368 6170 6520  atoms, of shape 
+00017e60: 2842 2c20 4e2c 204d 290a 0a20 2020 2020  (B, N, M)..     
+00017e70: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00017e80: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+00017e90: 2020 2074 6f72 6368 2e54 656e 736f 7220     torch.Tensor 
+00017ea0: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
+00017eb0: 6c29 0a20 2020 2020 2020 2020 2020 204f  l).            O
+00017ec0: 7574 7075 7420 6f66 2061 746f 6d69 6320  utput of atomic 
+00017ed0: 636f 6e76 6f6c 7574 696f 6e20 6c61 7965  convolution laye
+00017ee0: 722e 0a0a 2020 2020 2020 2020 5261 6973  r...        Rais
+00017ef0: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
+00017f00: 2d0a 2020 2020 2020 2020 5661 6c75 6545  -.        ValueE
+00017f10: 7272 6f72 0a20 2020 2020 2020 2020 2020  rror.           
+00017f20: 2057 6865 6e20 7468 6520 6c65 6e67 7468   When the length
+00017f30: 206f 6620 6069 6e70 7574 7360 2069 7320   of `inputs` is 
+00017f40: 6e6f 7420 6571 7561 6c20 746f 2033 2e0a  not equal to 3..
+00017f50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00017f60: 2020 2020 6966 206c 656e 2869 6e70 7574      if len(input
+00017f70: 7329 2021 3d20 333a 0a20 2020 2020 2020  s) != 3:.       
+00017f80: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00017f90: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00017fa0: 2020 2020 2020 2066 2260 696e 7075 7473         f"`inputs
+00017fb0: 6020 6861 7320 746f 2062 6520 6f66 206c  ` has to be of l
+00017fc0: 656e 6774 6820 332c 2067 6f74 3a20 7b6c  ength 3, got: {l
+00017fd0: 656e 2869 6e70 7574 7329 7d22 290a 0a20  en(inputs)}").. 
+00017fe0: 2020 2020 2020 2058 203d 2074 6f72 6368         X = torch
+00017ff0: 2e74 656e 736f 7228 696e 7075 7473 5b30  .tensor(inputs[0
+00018000: 5d29 0a20 2020 2020 2020 204e 6272 7320  ]).        Nbrs 
+00018010: 3d20 746f 7263 682e 7465 6e73 6f72 2869  = torch.tensor(i
+00018020: 6e70 7574 735b 315d 2c20 6474 7970 653d  nputs[1], dtype=
+00018030: 746f 7263 682e 696e 7436 3429 0a20 2020  torch.int64).   
+00018040: 2020 2020 204e 6272 735f 5a20 3d20 746f       Nbrs_Z = to
+00018050: 7263 682e 7465 6e73 6f72 2869 6e70 7574  rch.tensor(input
+00018060: 735b 325d 290a 0a20 2020 2020 2020 2042  s[2])..        B
+00018070: 2c20 4e2c 2064 203d 2058 2e73 6861 7065  , N, d = X.shape
+00018080: 0a20 2020 2020 2020 204d 203d 204e 6272  .        M = Nbr
+00018090: 732e 7368 6170 655b 2d31 5d0a 0a20 2020  s.shape[-1]..   
+000180a0: 2020 2020 2044 203d 2073 656c 662e 6469       D = self.di
+000180b0: 7374 616e 6365 5f74 656e 736f 7228 582c  stance_tensor(X,
+000180c0: 204e 6272 732c 2073 656c 662e 626f 785f   Nbrs, self.box_
+000180d0: 7369 7a65 2c20 422c 204e 2c20 4d2c 2064  size, B, N, M, d
+000180e0: 290a 2020 2020 2020 2020 5220 3d20 7365  ).        R = se
+000180f0: 6c66 2e64 6973 7461 6e63 655f 6d61 7472  lf.distance_matr
+00018100: 6978 2844 290a 2020 2020 2020 2020 5220  ix(D).        R 
+00018110: 3d20 746f 7263 682e 756e 7371 7565 657a  = torch.unsqueez
+00018120: 6528 522c 2030 290a 2020 2020 2020 2020  e(R, 0).        
+00018130: 7273 6620 3d20 7365 6c66 2e72 6164 6961  rsf = self.radia
+00018140: 6c5f 7379 6d6d 6574 7279 5f66 756e 6374  l_symmetry_funct
+00018150: 696f 6e28 522c 2073 656c 662e 7263 2c20  ion(R, self.rc, 
+00018160: 7365 6c66 2e72 732c 2073 656c 662e 7265  self.rs, self.re
+00018170: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+00018180: 7420 7365 6c66 2e61 746f 6d5f 7479 7065  t self.atom_type
+00018190: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
+000181a0: 6f6e 6420 3d20 746f 7263 682e 6e6f 745f  ond = torch.not_
+000181b0: 6571 7561 6c28 4e62 7273 5f5a 2c20 3029  equal(Nbrs_Z, 0)
+000181c0: 2e74 6f28 746f 7263 682e 666c 6f61 7429  .to(torch.float)
+000181d0: 2e72 6573 6861 7065 280a 2020 2020 2020  .reshape(.      
+000181e0: 2020 2020 2020 2020 2020 2831 2c20 2d31            (1, -1
+000181f0: 2c20 4e2c 204d 2929 0a20 2020 2020 2020  , N, M)).       
+00018200: 2020 2020 206c 6179 6572 203d 2074 6f72       layer = tor
+00018210: 6368 2e73 756d 2863 6f6e 6420 2a20 7273  ch.sum(cond * rs
+00018220: 662c 2033 290a 2020 2020 2020 2020 656c  f, 3).        el
+00018230: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00018240: 2320 5375 6d20 7468 6520 7061 6972 7769  # Sum the pairwi
+00018250: 7365 2d69 6e74 6572 6163 7469 6f6e 7320  se-interactions 
+00018260: 6265 7477 6565 6e20 6174 6f6d 7320 7468  between atoms th
+00018270: 6174 2061 7265 206f 6620 6061 746f 6d5f  at are of `atom_
+00018280: 7479 7065 6020 616e 6420 6974 7320 6e65  type` and its ne
+00018290: 6967 6862 6f72 7320 666f 7220 6561 6368  ighbors for each
+000182a0: 2061 746f 6d20 7479 7065 2069 6e20 6061   atom type in `a
+000182b0: 746f 6d5f 7479 7065 7360 2e0a 2020 2020  tom_types`..    
+000182c0: 2020 2020 2020 2020 7379 6d6d 6574 7269          symmetri
+000182d0: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
+000182e0: 2020 2020 666f 7220 6174 6f6d 5f74 7970      for atom_typ
+000182f0: 6520 696e 2073 656c 662e 6174 6f6d 5f74  e in self.atom_t
+00018300: 7970 6573 3a0a 2020 2020 2020 2020 2020  ypes:.          
+00018310: 2020 2020 2020 636f 6e64 203d 2074 6f72        cond = tor
+00018320: 6368 2e65 7128 4e62 7273 5f5a 2c20 6174  ch.eq(Nbrs_Z, at
+00018330: 6f6d 5f74 7970 6529 2e74 6f28 746f 7263  om_type).to(torc
+00018340: 682e 666c 6f61 7429 2e72 6573 6861 7065  h.float).reshape
+00018350: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00018360: 2020 2020 2020 2831 2c20 2d31 2c20 4e2c        (1, -1, N,
+00018370: 204d 2929 0a20 2020 2020 2020 2020 2020   M)).           
+00018380: 2020 2020 2073 796d 6d65 7472 6965 732e       symmetries.
+00018390: 6170 7065 6e64 2874 6f72 6368 2e73 756d  append(torch.sum
+000183a0: 2863 6f6e 6420 2a20 7273 662c 2033 2929  (cond * rsf, 3))
+000183b0: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+000183c0: 6572 203d 2074 6f72 6368 2e63 6f6e 6361  er = torch.conca
+000183d0: 7428 7379 6d6d 6574 7269 6573 2c20 3029  t(symmetries, 0)
+000183e0: 0a0a 2020 2020 2020 2020 6c61 7965 7220  ..        layer 
+000183f0: 3d20 746f 7263 682e 7065 726d 7574 6528  = torch.permute(
+00018400: 6c61 7965 722c 205b 312c 2032 2c20 305d  layer, [1, 2, 0]
+00018410: 290a 2020 2020 2020 2020 7661 722c 206d  ).        var, m
+00018420: 6561 6e20 3d20 746f 7263 682e 7661 725f  ean = torch.var_
+00018430: 6d65 616e 286c 6179 6572 2c20 5b30 2c20  mean(layer, [0, 
+00018440: 325d 290a 2020 2020 2020 2020 7661 722c  2]).        var,
+00018450: 206d 6561 6e20 3d20 7661 722e 6465 7461   mean = var.deta
+00018460: 6368 2829 2c20 6d65 616e 2e64 6574 6163  ch(), mean.detac
+00018470: 6828 290a 0a20 2020 2020 2020 2072 6574  h()..        ret
+00018480: 7572 6e20 462e 6261 7463 685f 6e6f 726d  urn F.batch_norm
+00018490: 286c 6179 6572 2c20 6d65 616e 2c20 7661  (layer, mean, va
+000184a0: 7229 0a0a 2020 2020 6465 6620 6469 7374  r)..    def dist
+000184b0: 616e 6365 5f74 656e 736f 7228 7365 6c66  ance_tensor(self
+000184c0: 2c20 583a 2074 6f72 6368 2e54 656e 736f  , X: torch.Tenso
+000184d0: 722c 204e 6272 733a 2074 6f72 6368 2e54  r, Nbrs: torch.T
+000184e0: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
+000184f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00018500: 6f78 5f73 697a 653a 2055 6e69 6f6e 5b74  ox_size: Union[t
+00018510: 6f72 6368 2e54 656e 736f 722c 204e 6f6e  orch.Tensor, Non
+00018520: 655d 2c20 423a 2069 6e74 2c20 4e3a 2069  e], B: int, N: i
+00018530: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+00018540: 2020 2020 2020 2020 2020 2020 4d3a 2069              M: i
+00018550: 6e74 2c20 643a 2069 6e74 2920 2d3e 2074  nt, d: int) -> t
+00018560: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
+00018570: 2020 2020 2022 2222 4361 6c63 756c 6174       """Calculat
+00018580: 6520 6469 7374 616e 6365 2074 656e 736f  e distance tenso
+00018590: 7220 666f 7220 6120 6261 7463 6820 6f66  r for a batch of
+000185a0: 206d 6f6c 6563 756c 6573 2e0a 0a20 2020   molecules...   
+000185b0: 2020 2020 2042 2c20 4e2c 204d 2c20 6420       B, N, M, d 
+000185c0: 3d20 6261 7463 685f 7369 7a65 2c20 6d61  = batch_size, ma
+000185d0: 785f 6e75 6d5f 6174 6f6d 732c 206d 6178  x_num_atoms, max
+000185e0: 5f6e 756d 5f6e 6569 6768 626f 7273 2c20  _num_neighbors, 
+000185f0: 6e75 6d5f 6665 6174 7572 6573 0a0a 2020  num_features..  
+00018600: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00018610: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00018620: 2d2d 2d0a 2020 2020 2020 2020 5820 3a20  ---.        X : 
+00018630: 746f 7263 682e 5465 6e73 6f72 206f 6620  torch.Tensor of 
+00018640: 7368 6170 6520 2842 2c20 4e2c 2064 290a  shape (B, N, d).
+00018650: 2020 2020 2020 2020 2020 2020 436f 6f72              Coor
+00018660: 6469 6e61 7465 732f 6665 6174 7572 6573  dinates/features
+00018670: 2e0a 2020 2020 2020 2020 4e62 7273 203a  ..        Nbrs :
+00018680: 2074 6f72 6368 2e54 656e 736f 7220 6f66   torch.Tensor of
+00018690: 2073 6861 7065 2028 422c 204e 2c20 4d29   shape (B, N, M)
+000186a0: 0a20 2020 2020 2020 2020 2020 204e 6569  .            Nei
+000186b0: 6768 626f 7220 6c69 7374 2e0a 2020 2020  ghbor list..    
+000186c0: 2020 2020 626f 785f 7369 7a65 203a 2074      box_size : t
+000186d0: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+000186e0: 2020 2020 2020 2020 4c65 6e67 7468 206d          Length m
+000186f0: 7573 7420 6265 2065 7175 616c 2074 6f20  ust be equal to 
+00018700: 6064 602e 0a20 2020 2020 2020 2042 203a  `d`..        B :
+00018710: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
+00018720: 2042 6174 6368 2073 697a 650a 2020 2020   Batch size.    
+00018730: 2020 2020 4e20 3a20 696e 740a 2020 2020      N : int.    
+00018740: 2020 2020 2020 2020 4d61 7869 6d75 6d20          Maximum 
+00018750: 6e75 6d62 6572 206f 6620 6174 6f6d 730a  number of atoms.
+00018760: 2020 2020 2020 2020 4d20 3a20 696e 740a          M : int.
+00018770: 2020 2020 2020 2020 2020 2020 4d61 7869              Maxi
+00018780: 6d75 6d20 6e75 6d62 6572 206f 6620 6e65  mum number of ne
+00018790: 6967 6862 6f72 730a 2020 2020 2020 2020  ighbors.        
+000187a0: 6420 3a20 696e 740a 2020 2020 2020 2020  d : int.        
+000187b0: 2020 2020 4e75 6d62 6572 206f 6620 6665      Number of fe
+000187c0: 6174 7572 6573 0a0a 2020 2020 2020 2020  atures..        
+000187d0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+000187e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+000187f0: 746f 7263 682e 5465 6e73 6f72 206f 6620  torch.Tensor of 
+00018800: 7368 6170 6520 2842 2c20 4e2c 204d 2c20  shape (B, N, M, 
+00018810: 6429 0a20 2020 2020 2020 2020 2020 2043  d).            C
+00018820: 6f6f 7264 696e 6174 6573 2f66 6561 7475  oordinates/featu
+00018830: 7265 7320 6469 7374 616e 6365 2074 656e  res distance ten
+00018840: 736f 722e 0a0a 2020 2020 2020 2020 5261  sor...        Ra
+00018850: 6973 6573 0a20 2020 2020 2020 202d 2d2d  ises.        ---
+00018860: 2d2d 2d0a 2020 2020 2020 2020 5661 6c75  ---.        Valu
+00018870: 6545 7272 6f72 0a20 2020 2020 2020 2020  eError.         
+00018880: 2020 2057 6865 6e20 7468 6520 6c65 6e67     When the leng
+00018890: 7468 206f 6620 6062 6f78 5f73 697a 6560  th of `box_size`
+000188a0: 2069 7320 6e6f 7420 6571 7561 6c20 746f   is not equal to
+000188b0: 2060 6460 2e0a 2020 2020 2020 2020 2222   `d`..        ""
+000188c0: 220a 2020 2020 2020 2020 6966 2062 6f78  ".        if box
+000188d0: 5f73 697a 6520 6973 206e 6f74 204e 6f6e  _size is not Non
+000188e0: 6520 616e 6420 6c65 6e28 626f 785f 7369  e and len(box_si
+000188f0: 7a65 2920 213d 2064 3a0a 2020 2020 2020  ze) != d:.      
+00018900: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00018910: 6545 7272 6f72 2822 4c65 6e67 7468 206f  eError("Length o
+00018920: 6620 6062 6f78 5f73 697a 6560 206d 7573  f `box_size` mus
+00018930: 7420 6265 2065 7175 616c 2074 6f20 6064  t be equal to `d
+00018940: 6022 290a 0a20 2020 2020 2020 2066 6c61  `")..        fla
+00018950: 745f 6e65 6967 6862 6f72 7320 3d20 746f  t_neighbors = to
+00018960: 7263 682e 7265 7368 6170 6528 4e62 7273  rch.reshape(Nbrs
+00018970: 2c20 282d 312c 204e 202a 204d 2929 0a20  , (-1, N * M)). 
+00018980: 2020 2020 2020 206e 6569 6768 626f 725f         neighbor_
+00018990: 636f 6f72 6473 203d 2074 6f72 6368 2e73  coords = torch.s
+000189a0: 7461 636b 280a 2020 2020 2020 2020 2020  tack(.          
+000189b0: 2020 5b58 5b62 2c20 666c 6174 5f6e 6569    [X[b, flat_nei
+000189c0: 6768 626f 7273 5b62 5d5d 2066 6f72 2062  ghbors[b]] for b
+000189d0: 2069 6e20 7261 6e67 6528 4229 5d29 0a20   in range(B)]). 
+000189e0: 2020 2020 2020 206e 6569 6768 626f 725f         neighbor_
+000189f0: 636f 6f72 6473 203d 2074 6f72 6368 2e72  coords = torch.r
+00018a00: 6573 6861 7065 286e 6569 6768 626f 725f  eshape(neighbor_
+00018a10: 636f 6f72 6473 2c20 282d 312c 204e 2c20  coords, (-1, N, 
+00018a20: 4d2c 2064 2929 0a20 2020 2020 2020 2044  M, d)).        D
+00018a30: 203d 206e 6569 6768 626f 725f 636f 6f72   = neighbor_coor
+00018a40: 6473 202d 2074 6f72 6368 2e75 6e73 7175  ds - torch.unsqu
+00018a50: 6565 7a65 2858 2c20 3229 0a20 2020 2020  eeze(X, 2).     
+00018a60: 2020 2069 6620 626f 785f 7369 7a65 2069     if box_size i
+00018a70: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00018a80: 2020 2020 2020 2020 626f 785f 7369 7a65          box_size
+00018a90: 203d 2074 6f72 6368 2e72 6573 6861 7065   = torch.reshape
+00018aa0: 2862 6f78 5f73 697a 652c 2028 312c 2031  (box_size, (1, 1
+00018ab0: 2c20 312c 2064 2929 0a20 2020 2020 2020  , 1, d)).       
+00018ac0: 2020 2020 2044 202d 3d20 746f 7263 682e       D -= torch.
+00018ad0: 726f 756e 6428 4420 2f20 626f 785f 7369  round(D / box_si
+00018ae0: 7a65 2920 2a20 626f 785f 7369 7a65 0a0a  ze) * box_size..
+00018af0: 2020 2020 2020 2020 7265 7475 726e 2044          return D
+00018b00: 0a0a 2020 2020 6465 6620 6469 7374 616e  ..    def distan
+00018b10: 6365 5f6d 6174 7269 7828 7365 6c66 2c20  ce_matrix(self, 
+00018b20: 443a 2074 6f72 6368 2e54 656e 736f 7229  D: torch.Tensor)
+00018b30: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
+00018b40: 3a0a 2020 2020 2020 2020 2222 2243 616c  :.        """Cal
+00018b50: 6375 6c61 7465 2061 2064 6973 7461 6e63  culate a distanc
+00018b60: 6520 6d61 7472 6978 2c20 6769 7665 6e20  e matrix, given 
+00018b70: 6120 6469 7374 616e 6365 2074 656e 736f  a distance tenso
+00018b80: 722e 0a0a 2020 2020 2020 2020 422c 204e  r...        B, N
+00018b90: 2c20 4d2c 2064 203d 2062 6174 6368 5f73  , M, d = batch_s
+00018ba0: 697a 652c 206d 6178 5f6e 756d 5f61 746f  ize, max_num_ato
+00018bb0: 6d73 2c20 6d61 785f 6e75 6d5f 6e65 6967  ms, max_num_neig
+00018bc0: 6862 6f72 732c 206e 756d 5f66 6561 7475  hbors, num_featu
+00018bd0: 7265 730a 0a20 2020 2020 2020 2050 6172  res..        Par
+00018be0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+00018bf0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00018c00: 2020 2044 203a 2074 6f72 6368 2e54 656e     D : torch.Ten
+00018c10: 736f 7220 6f66 2073 6861 7065 2028 422c  sor of shape (B,
+00018c20: 204e 2c20 4d2c 2064 290a 2020 2020 2020   N, M, d).      
+00018c30: 2020 2020 2020 4469 7374 616e 6365 2074        Distance t
+00018c40: 656e 736f 720a 0a20 2020 2020 2020 2052  ensor..        R
+00018c50: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+00018c60: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2074  ------.        t
+00018c70: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
+00018c80: 6861 7065 2028 422c 204e 2c20 4d29 0a20  hape (B, N, M). 
+00018c90: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
+00018ca0: 6e63 6520 6d61 7472 6978 2e0a 2020 2020  nce matrix..    
+00018cb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00018cc0: 7265 7475 726e 2074 6f72 6368 2e73 7172  return torch.sqr
+00018cd0: 7428 746f 7263 682e 7375 6d28 746f 7263  t(torch.sum(torc
+00018ce0: 682e 6d75 6c28 442c 2044 292c 2033 2929  h.mul(D, D), 3))
+00018cf0: 0a0a 2020 2020 6465 6620 6761 7573 7369  ..    def gaussi
+00018d00: 616e 5f64 6973 7461 6e63 655f 6d61 7472  an_distance_matr
+00018d10: 6978 2873 656c 662c 2052 3a20 746f 7263  ix(self, R: torc
+00018d20: 682e 5465 6e73 6f72 2c20 7273 3a20 746f  h.Tensor, rs: to
+00018d30: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
 00018d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d50: 7265 3a20 746f 7263 682e 5465 6e73 6f72  re: torch.Tensor
-00018d60: 2920 2d3e 2074 6f72 6368 2e54 656e 736f  ) -> torch.Tenso
-00018d70: 723a 0a20 2020 2020 2020 2022 2222 4361  r:.        """Ca
-00018d80: 6c63 756c 6174 6520 6120 4761 7573 7369  lculate a Gaussi
-00018d90: 616e 2064 6973 7461 6e63 6520 6d61 7472  an distance matr
-00018da0: 6978 2e0a 0a20 2020 2020 2020 2042 2c20  ix...        B, 
-00018db0: 4e2c 204d 2c20 6c20 3d20 6261 7463 685f  N, M, l = batch_
-00018dc0: 7369 7a65 2c20 6d61 785f 6e75 6d5f 6174  size, max_num_at
-00018dd0: 6f6d 732c 206d 6178 5f6e 756d 5f6e 6569  oms, max_num_nei
-00018de0: 6768 626f 7273 2c20 6c65 6e28 7261 6469  ghbors, len(radi
-00018df0: 616c 5f70 6172 616d 7329 0a0a 2020 2020  al_params)..    
-00018e00: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00018e10: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00018e20: 2d0a 2020 2020 2020 2020 5220 3a20 746f  -.        R : to
-00018e30: 7263 682e 5465 6e73 6f72 206f 6620 7368  rch.Tensor of sh
-00018e40: 6170 6520 2842 2c20 4e2c 204d 290a 2020  ape (B, N, M).  
-00018e50: 2020 2020 2020 2020 2020 4469 7374 616e            Distan
-00018e60: 6365 206d 6174 7269 782e 0a20 2020 2020  ce matrix..     
-00018e70: 2020 2072 7320 3a20 746f 7263 682e 5465     rs : torch.Te
-00018e80: 6e73 6f72 206f 6620 7368 6170 6520 286c  nsor of shape (l
-00018e90: 2c20 312c 2031 2c20 3129 0a20 2020 2020  , 1, 1, 1).     
-00018ea0: 2020 2020 2020 2047 6175 7373 6961 6e20         Gaussian 
-00018eb0: 6469 7374 616e 6365 206d 6174 7269 7820  distance matrix 
-00018ec0: 6d65 616e 2e0a 2020 2020 2020 2020 7265  mean..        re
-00018ed0: 203a 2074 6f72 6368 2e54 656e 736f 7220   : torch.Tensor 
-00018ee0: 6f66 2073 6861 7065 2028 6c2c 2031 2c20  of shape (l, 1, 
-00018ef0: 312c 2031 290a 2020 2020 2020 2020 2020  1, 1).          
-00018f00: 2020 4761 7573 7369 616e 2064 6973 7461    Gaussian dista
-00018f10: 6e63 6520 6d61 7472 6978 2077 6964 7468  nce matrix width
-00018f20: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00018f30: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00018f40: 2d2d 0a20 2020 2020 2020 2074 6f72 6368  --.        torch
-00018f50: 2e54 656e 736f 7220 6f66 2073 6861 7065  .Tensor of shape
-00018f60: 2028 422c 204e 2c20 4d29 0a20 2020 2020   (B, N, M).     
-00018f70: 2020 2020 2020 2047 6175 7373 6961 6e20         Gaussian 
-00018f80: 6469 7374 616e 6365 206d 6174 7269 782e  distance matrix.
-00018f90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00018fa0: 2020 2020 2072 6574 7572 6e20 746f 7263       return torc
-00018fb0: 682e 6578 7028 2d72 6520 2a20 2852 202d  h.exp(-re * (R -
-00018fc0: 2072 7329 2a2a 3229 0a0a 2020 2020 6465   rs)**2)..    de
-00018fd0: 6620 7261 6469 616c 5f63 7574 6f66 6628  f radial_cutoff(
-00018fe0: 7365 6c66 2c20 523a 2074 6f72 6368 2e54  self, R: torch.T
-00018ff0: 656e 736f 722c 2072 633a 2074 6f72 6368  ensor, rc: torch
-00019000: 2e54 656e 736f 7229 202d 3e20 746f 7263  .Tensor) -> torc
-00019010: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
-00019020: 2020 2222 2243 616c 6375 6c61 7465 2061    """Calculate a
-00019030: 2072 6164 6961 6c20 6375 742d 6f66 6620   radial cut-off 
-00019040: 6d61 7472 6978 2e0a 0a20 2020 2020 2020  matrix...       
-00019050: 2042 2c20 4e2c 204d 2c20 6c20 3d20 6261   B, N, M, l = ba
-00019060: 7463 685f 7369 7a65 2c20 6d61 785f 6e75  tch_size, max_nu
-00019070: 6d5f 6174 6f6d 732c 206d 6178 5f6e 756d  m_atoms, max_num
-00019080: 5f6e 6569 6768 626f 7273 2c20 6c65 6e28  _neighbors, len(
-00019090: 7261 6469 616c 5f70 6172 616d 7329 0a0a  radial_params)..
-000190a0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-000190b0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-000190c0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 5220  -----.        R 
-000190d0: 3a20 746f 7263 682e 5465 6e73 6f72 206f  : torch.Tensor o
-000190e0: 6620 7368 6170 6520 2842 2c20 4e2c 204d  f shape (B, N, M
-000190f0: 290a 2020 2020 2020 2020 2020 2020 4469  ).            Di
-00019100: 7374 616e 6365 206d 6174 7269 782e 0a20  stance matrix.. 
-00019110: 2020 2020 2020 2072 6320 3a20 746f 7263         rc : torc
-00019120: 682e 5465 6e73 6f72 206f 6620 7368 6170  h.Tensor of shap
-00019130: 6520 286c 2c20 312c 2031 2c20 3129 0a20  e (l, 1, 1, 1). 
-00019140: 2020 2020 2020 2020 2020 2049 6e74 6572             Inter
-00019150: 6163 7469 6f6e 2063 7574 6f66 6620 2869  action cutoff (i
-00019160: 6e20 616e 6773 7472 6f6d 292e 0a0a 2020  n angstrom)...  
-00019170: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00019180: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00019190: 2020 2020 2020 746f 7263 682e 5465 6e73        torch.Tens
-000191a0: 6f72 206f 6620 7368 6170 6520 2842 2c20  or of shape (B, 
-000191b0: 4e2c 204d 290a 2020 2020 2020 2020 2020  N, M).          
-000191c0: 2020 5261 6469 616c 2063 7574 6f66 6620    Radial cutoff 
-000191d0: 6d61 7472 6978 2e0a 2020 2020 2020 2020  matrix..        
-000191e0: 2222 220a 2020 2020 2020 2020 5420 3d20  """.        T = 
-000191f0: 302e 3520 2a20 2874 6f72 6368 2e63 6f73  0.5 * (torch.cos
-00019200: 286e 702e 7069 202a 2052 202f 2072 6329  (np.pi * R / rc)
-00019210: 202b 2031 290a 2020 2020 2020 2020 4520   + 1).        E 
-00019220: 3d20 746f 7263 682e 7a65 726f 735f 6c69  = torch.zeros_li
-00019230: 6b65 2854 290a 2020 2020 2020 2020 636f  ke(T).        co
-00019240: 6e64 203d 2074 6f72 6368 2e6c 6573 735f  nd = torch.less_
-00019250: 6571 7561 6c28 522c 2072 6329 0a20 2020  equal(R, rc).   
-00019260: 2020 2020 2046 4320 3d20 746f 7263 682e       FC = torch.
-00019270: 7768 6572 6528 636f 6e64 2c20 542c 2045  where(cond, T, E
-00019280: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00019290: 6e20 4643 0a0a 2020 2020 6465 6620 7261  n FC..    def ra
-000192a0: 6469 616c 5f73 796d 6d65 7472 795f 6675  dial_symmetry_fu
-000192b0: 6e63 7469 6f6e 2873 656c 662c 2052 3a20  nction(self, R: 
-000192c0: 746f 7263 682e 5465 6e73 6f72 2c20 7263  torch.Tensor, rc
-000192d0: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
-000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d50: 2020 2020 2020 2020 2020 2020 2072 653a               re:
+00018d60: 2074 6f72 6368 2e54 656e 736f 7229 202d   torch.Tensor) -
+00018d70: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
+00018d80: 2020 2020 2020 2020 2222 2243 616c 6375          """Calcu
+00018d90: 6c61 7465 2061 2047 6175 7373 6961 6e20  late a Gaussian 
+00018da0: 6469 7374 616e 6365 206d 6174 7269 782e  distance matrix.
+00018db0: 0a0a 2020 2020 2020 2020 422c 204e 2c20  ..        B, N, 
+00018dc0: 4d2c 206c 203d 2062 6174 6368 5f73 697a  M, l = batch_siz
+00018dd0: 652c 206d 6178 5f6e 756d 5f61 746f 6d73  e, max_num_atoms
+00018de0: 2c20 6d61 785f 6e75 6d5f 6e65 6967 6862  , max_num_neighb
+00018df0: 6f72 732c 206c 656e 2872 6164 6961 6c5f  ors, len(radial_
+00018e00: 7061 7261 6d73 290a 0a20 2020 2020 2020  params)..       
+00018e10: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00018e20: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00018e30: 2020 2020 2020 2052 203a 2074 6f72 6368         R : torch
+00018e40: 2e54 656e 736f 7220 6f66 2073 6861 7065  .Tensor of shape
+00018e50: 2028 422c 204e 2c20 4d29 0a20 2020 2020   (B, N, M).     
+00018e60: 2020 2020 2020 2044 6973 7461 6e63 6520         Distance 
+00018e70: 6d61 7472 6978 2e0a 2020 2020 2020 2020  matrix..        
+00018e80: 7273 203a 2074 6f72 6368 2e54 656e 736f  rs : torch.Tenso
+00018e90: 7220 6f66 2073 6861 7065 2028 6c2c 2031  r of shape (l, 1
+00018ea0: 2c20 312c 2031 290a 2020 2020 2020 2020  , 1, 1).        
+00018eb0: 2020 2020 4761 7573 7369 616e 2064 6973      Gaussian dis
+00018ec0: 7461 6e63 6520 6d61 7472 6978 206d 6561  tance matrix mea
+00018ed0: 6e2e 0a20 2020 2020 2020 2072 6520 3a20  n..        re : 
+00018ee0: 746f 7263 682e 5465 6e73 6f72 206f 6620  torch.Tensor of 
+00018ef0: 7368 6170 6520 286c 2c20 312c 2031 2c20  shape (l, 1, 1, 
+00018f00: 3129 0a20 2020 2020 2020 2020 2020 2047  1).            G
+00018f10: 6175 7373 6961 6e20 6469 7374 616e 6365  aussian distance
+00018f20: 206d 6174 7269 7820 7769 6474 682e 0a0a   matrix width...
+00018f30: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00018f40: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+00018f50: 2020 2020 2020 2020 746f 7263 682e 5465          torch.Te
+00018f60: 6e73 6f72 206f 6620 7368 6170 6520 2842  nsor of shape (B
+00018f70: 2c20 4e2c 204d 290a 2020 2020 2020 2020  , N, M).        
+00018f80: 2020 2020 4761 7573 7369 616e 2064 6973      Gaussian dis
+00018f90: 7461 6e63 6520 6d61 7472 6978 2e0a 2020  tance matrix..  
+00018fa0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00018fb0: 2020 7265 7475 726e 2074 6f72 6368 2e65    return torch.e
+00018fc0: 7870 282d 7265 202a 2028 5220 2d20 7273  xp(-re * (R - rs
+00018fd0: 292a 2a32 290a 0a20 2020 2064 6566 2072  )**2)..    def r
+00018fe0: 6164 6961 6c5f 6375 746f 6666 2873 656c  adial_cutoff(sel
+00018ff0: 662c 2052 3a20 746f 7263 682e 5465 6e73  f, R: torch.Tens
+00019000: 6f72 2c20 7263 3a20 746f 7263 682e 5465  or, rc: torch.Te
+00019010: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
+00019020: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
+00019030: 2222 4361 6c63 756c 6174 6520 6120 7261  ""Calculate a ra
+00019040: 6469 616c 2063 7574 2d6f 6666 206d 6174  dial cut-off mat
+00019050: 7269 782e 0a0a 2020 2020 2020 2020 422c  rix...        B,
+00019060: 204e 2c20 4d2c 206c 203d 2062 6174 6368   N, M, l = batch
+00019070: 5f73 697a 652c 206d 6178 5f6e 756d 5f61  _size, max_num_a
+00019080: 746f 6d73 2c20 6d61 785f 6e75 6d5f 6e65  toms, max_num_ne
+00019090: 6967 6862 6f72 732c 206c 656e 2872 6164  ighbors, len(rad
+000190a0: 6961 6c5f 7061 7261 6d73 290a 0a20 2020  ial_params)..   
+000190b0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+000190c0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000190d0: 2d2d 0a20 2020 2020 2020 2052 203a 2074  --.        R : t
+000190e0: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
+000190f0: 6861 7065 2028 422c 204e 2c20 4d29 0a20  hape (B, N, M). 
+00019100: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
+00019110: 6e63 6520 6d61 7472 6978 2e0a 2020 2020  nce matrix..    
+00019120: 2020 2020 7263 203a 2074 6f72 6368 2e54      rc : torch.T
+00019130: 656e 736f 7220 6f66 2073 6861 7065 2028  ensor of shape (
+00019140: 6c2c 2031 2c20 312c 2031 290a 2020 2020  l, 1, 1, 1).    
+00019150: 2020 2020 2020 2020 496e 7465 7261 6374          Interact
+00019160: 696f 6e20 6375 746f 6666 2028 696e 2061  ion cutoff (in a
+00019170: 6e67 7374 726f 6d29 2e0a 0a20 2020 2020  ngstrom)...     
+00019180: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00019190: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+000191a0: 2020 2074 6f72 6368 2e54 656e 736f 7220     torch.Tensor 
+000191b0: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
+000191c0: 4d29 0a20 2020 2020 2020 2020 2020 2052  M).            R
+000191d0: 6164 6961 6c20 6375 746f 6666 206d 6174  adial cutoff mat
+000191e0: 7269 782e 0a20 2020 2020 2020 2022 2222  rix..        """
+000191f0: 0a20 2020 2020 2020 2054 203d 2030 2e35  .        T = 0.5
+00019200: 202a 2028 746f 7263 682e 636f 7328 6e70   * (torch.cos(np
+00019210: 2e70 6920 2a20 5220 2f20 7263 2920 2b20  .pi * R / rc) + 
+00019220: 3129 0a20 2020 2020 2020 2045 203d 2074  1).        E = t
+00019230: 6f72 6368 2e7a 6572 6f73 5f6c 696b 6528  orch.zeros_like(
+00019240: 5429 0a20 2020 2020 2020 2063 6f6e 6420  T).        cond 
+00019250: 3d20 746f 7263 682e 6c65 7373 5f65 7175  = torch.less_equ
+00019260: 616c 2852 2c20 7263 290a 2020 2020 2020  al(R, rc).      
+00019270: 2020 4643 203d 2074 6f72 6368 2e77 6865    FC = torch.whe
+00019280: 7265 2863 6f6e 642c 2054 2c20 4529 0a0a  re(cond, T, E)..
+00019290: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000192a0: 430a 0a20 2020 2064 6566 2072 6164 6961  C..    def radia
+000192b0: 6c5f 7379 6d6d 6574 7279 5f66 756e 6374  l_symmetry_funct
+000192c0: 696f 6e28 7365 6c66 2c20 523a 2074 6f72  ion(self, R: tor
+000192d0: 6368 2e54 656e 736f 722c 2072 633a 2074  ch.Tensor, rc: t
+000192e0: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
 000192f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019300: 2072 733a 2074 6f72 6368 2e54 656e 736f   rs: torch.Tenso
-00019310: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00019300: 2020 2020 2020 2020 2020 2020 2020 7273                rs
+00019310: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
 00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019330: 2020 2020 7265 3a20 746f 7263 682e 5465      re: torch.Te
-00019340: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
-00019350: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
-00019360: 2222 4361 6c63 756c 6174 6520 6120 7261  ""Calculate a ra
-00019370: 6469 616c 2073 796d 6d65 7472 7920 6675  dial symmetry fu
-00019380: 6e63 7469 6f6e 2e0a 0a20 2020 2020 2020  nction...       
-00019390: 2042 2c20 4e2c 204d 2c20 6c20 3d20 6261   B, N, M, l = ba
-000193a0: 7463 685f 7369 7a65 2c20 6d61 785f 6e75  tch_size, max_nu
-000193b0: 6d5f 6174 6f6d 732c 206d 6178 5f6e 756d  m_atoms, max_num
-000193c0: 5f6e 6569 6768 626f 7273 2c20 6c65 6e28  _neighbors, len(
-000193d0: 7261 6469 616c 5f70 6172 616d 7329 0a0a  radial_params)..
-000193e0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-000193f0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00019400: 2d2d 2d2d 2d0a 2020 2020 2020 2020 5220  -----.        R 
-00019410: 3a20 746f 7263 682e 5465 6e73 6f72 206f  : torch.Tensor o
-00019420: 6620 7368 6170 6520 2842 2c20 4e2c 204d  f shape (B, N, M
-00019430: 290a 2020 2020 2020 2020 2020 2020 4469  ).            Di
-00019440: 7374 616e 6365 206d 6174 7269 782e 0a20  stance matrix.. 
-00019450: 2020 2020 2020 2072 6320 3a20 746f 7263         rc : torc
-00019460: 682e 5465 6e73 6f72 206f 6620 7368 6170  h.Tensor of shap
-00019470: 6520 286c 2c20 312c 2031 2c20 3129 0a20  e (l, 1, 1, 1). 
-00019480: 2020 2020 2020 2020 2020 2049 6e74 6572             Inter
-00019490: 6163 7469 6f6e 2063 7574 6f66 6620 2869  action cutoff (i
-000194a0: 6e20 616e 6773 7472 6f6d 292e 0a20 2020  n angstrom)..   
-000194b0: 2020 2020 2072 7320 3a20 746f 7263 682e       rs : torch.
-000194c0: 5465 6e73 6f72 206f 6620 7368 6170 6520  Tensor of shape 
-000194d0: 286c 2c20 312c 2031 2c20 3129 0a20 2020  (l, 1, 1, 1).   
-000194e0: 2020 2020 2020 2020 2047 6175 7373 6961           Gaussia
-000194f0: 6e20 6469 7374 616e 6365 206d 6174 7269  n distance matri
-00019500: 7820 6d65 616e 2e0a 2020 2020 2020 2020  x mean..        
-00019510: 7265 203a 2074 6f72 6368 2e54 656e 736f  re : torch.Tenso
-00019520: 7220 6f66 2073 6861 7065 2028 6c2c 2031  r of shape (l, 1
-00019530: 2c20 312c 2031 290a 2020 2020 2020 2020  , 1, 1).        
-00019540: 2020 2020 4761 7573 7369 616e 2064 6973      Gaussian dis
-00019550: 7461 6e63 6520 6d61 7472 6978 2077 6964  tance matrix wid
-00019560: 7468 2e0a 2020 2020 2020 2020 5265 7475  th..        Retu
-00019570: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00019580: 2d2d 2d0a 2020 2020 2020 2020 746f 7263  ---.        torc
-00019590: 682e 5465 6e73 6f72 206f 6620 7368 6170  h.Tensor of shap
-000195a0: 6520 2842 2c20 4e2c 204d 290a 2020 2020  e (B, N, M).    
-000195b0: 2020 2020 2020 2020 5072 652d 7375 6d6d          Pre-summ
-000195c0: 6174 696f 6e20 7261 6469 616c 2073 796d  ation radial sym
-000195d0: 6d65 7472 7920 6675 6e63 7469 6f6e 2e0a  metry function..
-000195e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000195f0: 2020 2020 4b20 3d20 7365 6c66 2e67 6175      K = self.gau
-00019600: 7373 6961 6e5f 6469 7374 616e 6365 5f6d  ssian_distance_m
-00019610: 6174 7269 7828 522c 2072 732c 2072 6529  atrix(R, rs, re)
-00019620: 0a20 2020 2020 2020 2046 4320 3d20 7365  .        FC = se
-00019630: 6c66 2e72 6164 6961 6c5f 6375 746f 6666  lf.radial_cutoff
-00019640: 2852 2c20 7263 290a 0a20 2020 2020 2020  (R, rc)..       
-00019650: 2072 6574 7572 6e20 746f 7263 682e 6d75   return torch.mu
-00019660: 6c28 4b2c 2046 4329 0a0a 0a63 6c61 7373  l(K, FC)...class
-00019670: 2043 6f6d 6269 6e65 4d65 616e 5374 6428   CombineMeanStd(
-00019680: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
-00019690: 2222 2247 656e 6572 6174 6520 4761 7573  """Generate Gaus
-000196a0: 7369 616e 206e 6f69 7365 2e0a 0a20 2020  sian noise...   
-000196b0: 2054 6869 7320 6973 2074 6865 2054 6f72   This is the Tor
-000196c0: 6368 2065 7175 6976 616c 656e 7420 6f66  ch equivalent of
-000196d0: 2074 6865 206f 7269 6769 6e61 6c20 696d   the original im
-000196e0: 706c 656d 656e 7461 7469 6f6e 2075 7369  plementation usi
-000196f0: 6e67 204b 6572 6173 2e0a 2020 2020 2222  ng Keras..    ""
-00019700: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-00019710: 745f 5f28 7365 6c66 2c0a 2020 2020 2020  t__(self,.      
-00019720: 2020 2020 2020 2020 2020 2074 7261 696e             train
-00019730: 696e 675f 6f6e 6c79 3a20 626f 6f6c 203d  ing_only: bool =
-00019740: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00019750: 2020 2020 2020 2020 206e 6f69 7365 5f65           noise_e
-00019760: 7073 696c 6f6e 3a20 666c 6f61 7420 3d20  psilon: float = 
-00019770: 312e 302c 0a20 2020 2020 2020 2020 2020  1.0,.           
-00019780: 2020 2020 2020 2a2a 6b77 6172 6773 293a        **kwargs):
-00019790: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
-000197a0: 7465 2061 2043 6f6d 6269 6e65 4d65 616e  te a CombineMean
-000197b0: 5374 6420 6c61 7965 722e 0a0a 2020 2020  Std layer...    
-000197c0: 2020 2020 5468 6973 206c 6179 6572 2073      This layer s
-000197d0: 686f 756c 6420 6861 7665 2074 776f 2069  hould have two i
-000197e0: 6e70 7574 7320 7769 7468 2074 6865 2073  nputs with the s
-000197f0: 616d 6520 7368 6170 652c 2061 6e64 2069  ame shape, and i
-00019800: 7473 0a20 2020 2020 2020 206f 7574 7075  ts.        outpu
-00019810: 7420 616c 736f 2068 6173 2074 6865 2073  t also has the s
-00019820: 616d 6520 7368 6170 652e 2020 4561 6368  ame shape.  Each
-00019830: 2065 6c65 6d65 6e74 206f 6620 7468 6520   element of the 
-00019840: 6f75 7470 7574 2069 7320 610a 2020 2020  output is a.    
-00019850: 2020 2020 4761 7573 7369 616e 2064 6973      Gaussian dis
-00019860: 7472 6962 7574 6564 2072 616e 646f 6d20  tributed random 
-00019870: 6e75 6d62 6572 2077 686f 7365 206d 6561  number whose mea
-00019880: 6e20 6973 2074 6865 2063 6f72 7265 7370  n is the corresp
-00019890: 6f6e 6469 6e67 0a20 2020 2020 2020 2065  onding.        e
-000198a0: 6c65 6d65 6e74 206f 6620 7468 6520 6669  lement of the fi
-000198b0: 7273 7420 696e 7075 742c 2061 6e64 2077  rst input, and w
-000198c0: 686f 7365 2073 7461 6e64 6172 6420 6465  hose standard de
-000198d0: 7669 6174 696f 6e20 6973 2074 6865 0a20  viation is the. 
-000198e0: 2020 2020 2020 2063 6f72 7265 7370 6f6e         correspon
-000198f0: 6469 6e67 2065 6c65 6d65 6e74 206f 6620  ding element of 
-00019900: 7468 6520 7365 636f 6e64 2069 6e70 7574  the second input
-00019910: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00019920: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00019930: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00019940: 2074 7261 696e 696e 675f 6f6e 6c79 3a20   training_only: 
-00019950: 626f 6f6c 2c20 6f70 7469 6f6e 616c 2028  bool, optional (
-00019960: 6465 6661 756c 7420 4661 6c73 6529 2e0a  default False)..
-00019970: 2020 2020 2020 2020 2020 2020 6966 2054              if T
-00019980: 7275 652c 206e 6f69 7365 2069 7320 6f6e  rue, noise is on
-00019990: 6c79 2067 656e 6572 6174 6564 2064 7572  ly generated dur
-000199a0: 696e 6720 7472 6169 6e69 6e67 2e20 2044  ing training.  D
-000199b0: 7572 696e 670a 2020 2020 2020 2020 2020  uring.          
-000199c0: 2020 7072 6564 6963 7469 6f6e 2c20 7468    prediction, th
-000199d0: 6520 6f75 7470 7574 2069 7320 7369 6d70  e output is simp
-000199e0: 6c79 2065 7175 616c 2074 6f20 7468 6520  ly equal to the 
-000199f0: 6669 7273 7420 696e 7075 7420 2874 6861  first input (tha
-00019a00: 740a 2020 2020 2020 2020 2020 2020 6973  t.            is
-00019a10: 2c20 7468 6520 6d65 616e 206f 6620 7468  , the mean of th
-00019a20: 6520 6469 7374 7269 6275 7469 6f6e 2075  e distribution u
-00019a30: 7365 6420 6475 7269 6e67 2074 7261 696e  sed during train
-00019a40: 696e 6729 2e0a 2020 2020 2020 2020 6e6f  ing)..        no
-00019a50: 6973 655f 6570 7369 6c6f 6e3a 2066 6c6f  ise_epsilon: flo
-00019a60: 6174 2c20 6f70 7469 6f6e 616c 2028 6465  at, optional (de
-00019a70: 6661 756c 7420 312e 3029 2e0a 2020 2020  fault 1.0)..    
-00019a80: 2020 2020 2020 2020 5468 6520 6e6f 6973          The nois
-00019a90: 6520 6973 2073 6361 6c65 6420 6279 2074  e is scaled by t
-00019aa0: 6869 7320 6661 6374 6f72 0a20 2020 2020  his factor.     
-00019ab0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-00019ac0: 7570 6572 2843 6f6d 6269 6e65 4d65 616e  uper(CombineMean
-00019ad0: 5374 642c 2073 656c 6629 2e5f 5f69 6e69  Std, self).__ini
-00019ae0: 745f 5f28 2a2a 6b77 6172 6773 290a 2020  t__(**kwargs).  
-00019af0: 2020 2020 2020 7365 6c66 2e74 7261 696e        self.train
-00019b00: 696e 675f 6f6e 6c79 203d 2074 7261 696e  ing_only = train
-00019b10: 696e 675f 6f6e 6c79 0a20 2020 2020 2020  ing_only.       
-00019b20: 2073 656c 662e 6e6f 6973 655f 6570 7369   self.noise_epsi
-00019b30: 6c6f 6e20 3d20 6e6f 6973 655f 6570 7369  lon = noise_epsi
-00019b40: 6c6f 6e0a 0a20 2020 2064 6566 205f 5f72  lon..    def __r
-00019b50: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
-00019b60: 7472 3a0a 2020 2020 2020 2020 7265 7475  tr:.        retu
-00019b70: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-00019b80: 2066 277b 7365 6c66 2e5f 5f63 6c61 7373   f'{self.__class
-00019b90: 5f5f 2e5f 5f6e 616d 655f 5f7d 2874 7261  __.__name__}(tra
-00019ba0: 696e 696e 675f 6f6e 6c79 3d7b 7365 6c66  ining_only={self
-00019bb0: 2e74 7261 696e 696e 675f 6f6e 6c79 7d2c  .training_only},
-00019bc0: 206e 6f69 7365 5f65 7073 696c 6f6e 3d7b   noise_epsilon={
-00019bd0: 7365 6c66 2e6e 6f69 7365 5f65 7073 696c  self.noise_epsil
-00019be0: 6f6e 7d29 270a 2020 2020 2020 2020 290a  on})'.        ).
-00019bf0: 0a20 2020 2064 6566 2066 6f72 7761 7264  .    def forward
-00019c00: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
-00019c10: 2020 2020 2020 2069 6e70 7574 733a 2053         inputs: S
-00019c20: 6571 7565 6e63 655b 4172 7261 794c 696b  equence[ArrayLik
-00019c30: 655d 2c0a 2020 2020 2020 2020 2020 2020  e],.            
-00019c40: 2020 2020 7472 6169 6e69 6e67 3a20 626f      training: bo
-00019c50: 6f6c 203d 2054 7275 6529 202d 3e20 746f  ol = True) -> to
-00019c60: 7263 682e 5465 6e73 6f72 3a0a 2020 2020  rch.Tensor:.    
-00019c70: 2020 2020 2222 2249 6e76 6f6b 6520 7468      """Invoke th
-00019c80: 6973 206c 6179 6572 2e0a 0a20 2020 2020  is layer...     
-00019c90: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00019ca0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00019cb0: 0a20 2020 2020 2020 2069 6e70 7574 733a  .        inputs:
-00019cc0: 2053 6571 7565 6e63 655b 4172 7261 794c   Sequence[ArrayL
-00019cd0: 696b 655d 0a20 2020 2020 2020 2020 2020  ike].           
-00019ce0: 2046 6972 7374 2065 6c65 6d65 6e74 2061   First element a
-00019cf0: 7265 2074 6865 206d 6561 6e73 2066 6f72  re the means for
-00019d00: 2074 6865 2072 616e 646f 6d20 6765 6e65   the random gene
-00019d10: 7261 7465 6420 6e75 6d62 6572 732e 0a20  rated numbers.. 
-00019d20: 2020 2020 2020 2020 2020 2053 6563 6f6e             Secon
-00019d30: 6420 656c 656d 656e 7420 6172 6520 7468  d element are th
-00019d40: 6520 7374 616e 6461 7264 2064 6576 6961  e standard devia
-00019d50: 7469 6f6e 7320 666f 7220 7468 6520 7261  tions for the ra
-00019d60: 6e64 6f6d 2067 656e 6572 6174 6564 206e  ndom generated n
-00019d70: 756d 6265 7273 2e0a 2020 2020 2020 2020  umbers..        
-00019d80: 7472 6169 6e69 6e67 3a20 626f 6f6c 2c20  training: bool, 
-00019d90: 6f70 7469 6f6e 616c 2028 6465 6661 756c  optional (defaul
-00019da0: 7420 5472 7565 292e 0a20 2020 2020 2020  t True)..       
-00019db0: 2020 2020 2053 7065 6369 6669 6573 2077       Specifies w
-00019dc0: 6865 7468 6572 2074 6f20 6765 6e65 7261  hether to genera
-00019dd0: 7465 206e 6f69 7365 2e0a 2020 2020 2020  te noise..      
-00019de0: 2020 2020 2020 4e6f 6973 6520 6973 206f        Noise is o
-00019df0: 6e6c 7920 6164 6465 6420 7768 656e 2074  nly added when t
-00019e00: 7261 696e 696e 672e 0a0a 2020 2020 2020  raining...      
-00019e10: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00019e20: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00019e30: 2020 5465 6e73 6f72 206f 6620 4761 7573    Tensor of Gaus
-00019e40: 7369 616e 2064 6973 7472 6962 7574 6564  sian distributed
-00019e50: 2072 616e 646f 6d20 6e75 6d62 6572 733a   random numbers:
-00019e60: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-00019e70: 2020 2020 2020 2020 2020 5361 6d65 2073            Same s
-00019e80: 6861 7065 2061 7320 7468 6520 6d65 616e  hape as the mean
-00019e90: 7320 616e 6420 7374 616e 6461 7264 2064  s and standard d
-00019ea0: 6576 6961 7469 6f6e 7320 6672 6f6d 2060  eviations from `
-00019eb0: 696e 7075 7473 602e 0a20 2020 2020 2020  inputs`..       
-00019ec0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00019ed0: 6c65 6e28 696e 7075 7473 2920 213d 2032  len(inputs) != 2
-00019ee0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00019ef0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-00019f00: 4d75 7374 2068 6176 6520 7477 6f20 696e  Must have two in
-00019f10: 5f6c 6179 6572 7322 290a 0a20 2020 2020  _layers")..     
-00019f20: 2020 206d 6561 6e5f 7061 7265 6e74 2c20     mean_parent, 
-00019f30: 7374 645f 7061 7265 6e74 203d 2074 6f72  std_parent = tor
-00019f40: 6368 2e74 656e 736f 7228 696e 7075 7473  ch.tensor(inputs
-00019f50: 5b30 5d29 2c20 746f 7263 682e 7465 6e73  [0]), torch.tens
-00019f60: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00019f70: 696e 7075 7473 5b31 5d29 0a20 2020 2020  inputs[1]).     
-00019f80: 2020 206e 6f69 7365 5f73 6361 6c65 203d     noise_scale =
-00019f90: 2074 6f72 6368 2e74 656e 736f 7228 7472   torch.tensor(tr
-00019fa0: 6169 6e69 6e67 206f 720a 2020 2020 2020  aining or.      
-00019fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fc0: 2020 2020 2020 2020 2020 2020 206e 6f74               not
-00019fd0: 2073 656c 662e 7472 6169 6e69 6e67 5f6f   self.training_o
-00019fe0: 6e6c 7929 2e74 6f28 746f 7263 682e 666c  nly).to(torch.fl
-00019ff0: 6f61 7429 0a20 2020 2020 2020 2073 616d  oat).        sam
-0001a000: 706c 655f 6e6f 6973 6520 3d20 746f 7263  ple_noise = torc
-0001a010: 682e 6e6f 726d 616c 2830 2e30 2c20 7365  h.normal(0.0, se
-0001a020: 6c66 2e6e 6f69 7365 5f65 7073 696c 6f6e  lf.noise_epsilon
-0001a030: 2c20 6d65 616e 5f70 6172 656e 742e 7368  , mean_parent.sh
-0001a040: 6170 6529 0a20 2020 2020 2020 2072 6574  ape).        ret
-0001a050: 7572 6e20 6d65 616e 5f70 6172 656e 7420  urn mean_parent 
-0001a060: 2b20 6e6f 6973 655f 7363 616c 6520 2a20  + noise_scale * 
-0001a070: 7374 645f 7061 7265 6e74 202a 2073 616d  std_parent * sam
-0001a080: 706c 655f 6e6f 6973 650a 0a0a 636c 6173  ple_noise...clas
-0001a090: 7320 4761 7465 6452 6563 7572 7265 6e74  s GatedRecurrent
-0001a0a0: 556e 6974 286e 6e2e 4d6f 6475 6c65 293a  Unit(nn.Module):
-0001a0b0: 0a20 2020 2022 2222 2053 7562 6d6f 6475  .    """ Submodu
-0001a0c0: 6c65 2066 6f72 204d 6573 7361 6765 2050  le for Message P
-0001a0d0: 6173 7369 6e67 2022 2222 0a0a 2020 2020  assing """..    
-0001a0e0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0001a0f0: 662c 206e 5f68 6964 6465 6e3d 3130 302c  f, n_hidden=100,
-0001a100: 2069 6e69 743d 2778 6176 6965 725f 756e   init='xavier_un
-0001a110: 6966 6f72 6d5f 272c 202a 2a6b 7761 7267  iform_', **kwarg
-0001a120: 7329 3a0a 2020 2020 2020 2020 7375 7065  s):.        supe
-0001a130: 7228 4761 7465 6452 6563 7572 7265 6e74  r(GatedRecurrent
-0001a140: 556e 6974 2c20 7365 6c66 292e 5f5f 696e  Unit, self).__in
-0001a150: 6974 5f5f 282a 2a6b 7761 7267 7329 0a20  it__(**kwargs). 
-0001a160: 2020 2020 2020 2073 656c 662e 6e5f 6869         self.n_hi
-0001a170: 6464 656e 203d 206e 5f68 6964 6465 6e0a  dden = n_hidden.
-0001a180: 2020 2020 2020 2020 7365 6c66 2e69 6e69          self.ini
-0001a190: 7420 3d20 696e 6974 0a20 2020 2020 2020  t = init.       
-0001a1a0: 2069 6e69 7420 3d20 6765 7461 7474 7228   init = getattr(
-0001a1b0: 696e 6974 6961 6c69 7a65 7273 2c20 7365  initializers, se
-0001a1c0: 6c66 2e69 6e69 7429 0a20 2020 2020 2020  lf.init).       
-0001a1d0: 2073 656c 662e 577a 203d 2069 6e69 7428   self.Wz = init(
-0001a1e0: 746f 7263 682e 656d 7074 7928 6e5f 6869  torch.empty(n_hi
-0001a1f0: 6464 656e 2c20 6e5f 6869 6464 656e 2929  dden, n_hidden))
-0001a200: 0a20 2020 2020 2020 2073 656c 662e 5772  .        self.Wr
-0001a210: 203d 2069 6e69 7428 746f 7263 682e 656d   = init(torch.em
-0001a220: 7074 7928 6e5f 6869 6464 656e 2c20 6e5f  pty(n_hidden, n_
-0001a230: 6869 6464 656e 2929 0a20 2020 2020 2020  hidden)).       
-0001a240: 2073 656c 662e 5768 203d 2069 6e69 7428   self.Wh = init(
-0001a250: 746f 7263 682e 656d 7074 7928 6e5f 6869  torch.empty(n_hi
-0001a260: 6464 656e 2c20 6e5f 6869 6464 656e 2929  dden, n_hidden))
-0001a270: 0a20 2020 2020 2020 2073 656c 662e 557a  .        self.Uz
-0001a280: 203d 2069 6e69 7428 746f 7263 682e 656d   = init(torch.em
-0001a290: 7074 7928 6e5f 6869 6464 656e 2c20 6e5f  pty(n_hidden, n_
-0001a2a0: 6869 6464 656e 2929 0a20 2020 2020 2020  hidden)).       
-0001a2b0: 2073 656c 662e 5572 203d 2069 6e69 7428   self.Ur = init(
-0001a2c0: 746f 7263 682e 656d 7074 7928 6e5f 6869  torch.empty(n_hi
-0001a2d0: 6464 656e 2c20 6e5f 6869 6464 656e 2929  dden, n_hidden))
-0001a2e0: 0a20 2020 2020 2020 2073 656c 662e 5568  .        self.Uh
-0001a2f0: 203d 2069 6e69 7428 746f 7263 682e 656d   = init(torch.em
-0001a300: 7074 7928 6e5f 6869 6464 656e 2c20 6e5f  pty(n_hidden, n_
-0001a310: 6869 6464 656e 2929 0a20 2020 2020 2020  hidden)).       
-0001a320: 2073 656c 662e 627a 203d 2074 6f72 6368   self.bz = torch
-0001a330: 2e7a 6572 6f73 2828 6e5f 6869 6464 656e  .zeros((n_hidden
-0001a340: 2c29 290a 2020 2020 2020 2020 7365 6c66  ,)).        self
-0001a350: 2e62 7220 3d20 746f 7263 682e 7a65 726f  .br = torch.zero
-0001a360: 7328 286e 5f68 6964 6465 6e2c 2929 0a20  s((n_hidden,)). 
-0001a370: 2020 2020 2020 2073 656c 662e 6268 203d         self.bh =
-0001a380: 2074 6f72 6368 2e7a 6572 6f73 2828 6e5f   torch.zeros((n_
-0001a390: 6869 6464 656e 2c29 290a 0a20 2020 2064  hidden,))..    d
-0001a3a0: 6566 2066 6f72 7761 7264 2873 656c 662c  ef forward(self,
-0001a3b0: 2069 6e70 7574 7329 3a0a 2020 2020 2020   inputs):.      
-0001a3c0: 2020 7369 676d 6f69 6420 3d20 6765 745f    sigmoid = get_
-0001a3d0: 6163 7469 7661 7469 6f6e 2827 7369 676d  activation('sigm
-0001a3e0: 6f69 6427 290a 2020 2020 2020 2020 7461  oid').        ta
-0001a3f0: 6e68 203d 2067 6574 5f61 6374 6976 6174  nh = get_activat
-0001a400: 696f 6e28 2774 616e 6827 290a 2020 2020  ion('tanh').    
-0001a410: 2020 2020 685f 746d 312c 2078 203d 2069      h_tm1, x = i
-0001a420: 6e70 7574 730a 2020 2020 2020 2020 7a20  nputs.        z 
-0001a430: 3d20 7369 676d 6f69 6428 0a20 2020 2020  = sigmoid(.     
-0001a440: 2020 2020 2020 2074 6f72 6368 2e6d 6174         torch.mat
-0001a450: 6d75 6c28 782c 2073 656c 662e 577a 2920  mul(x, self.Wz) 
-0001a460: 2b20 746f 7263 682e 6d61 746d 756c 2868  + torch.matmul(h
-0001a470: 5f74 6d31 2c20 7365 6c66 2e55 7a29 202b  _tm1, self.Uz) +
-0001a480: 2073 656c 662e 627a 290a 2020 2020 2020   self.bz).      
-0001a490: 2020 7220 3d20 7369 676d 6f69 6428 0a20    r = sigmoid(. 
-0001a4a0: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
-0001a4b0: 2e6d 6174 6d75 6c28 782c 2073 656c 662e  .matmul(x, self.
-0001a4c0: 5772 2920 2b20 746f 7263 682e 6d61 746d  Wr) + torch.matm
-0001a4d0: 756c 2868 5f74 6d31 2c20 7365 6c66 2e55  ul(h_tm1, self.U
-0001a4e0: 7229 202b 2073 656c 662e 6272 290a 2020  r) + self.br).  
-0001a4f0: 2020 2020 2020 6820 3d20 2831 202d 207a        h = (1 - z
-0001a500: 2920 2a20 7461 6e68 280a 2020 2020 2020  ) * tanh(.      
-0001a510: 2020 2020 2020 746f 7263 682e 6d61 746d        torch.matm
-0001a520: 756c 2878 2c20 7365 6c66 2e57 6829 202b  ul(x, self.Wh) +
-0001a530: 2074 6f72 6368 2e6d 6174 6d75 6c28 685f   torch.matmul(h_
-0001a540: 746d 3120 2a20 722c 2073 656c 662e 5568  tm1 * r, self.Uh
-0001a550: 2920 2b0a 2020 2020 2020 2020 2020 2020  ) +.            
-0001a560: 7365 6c66 2e62 6829 202b 207a 202a 2078  self.bh) + z * x
-0001a570: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001a580: 680a 0a0a 636c 6173 7320 5765 6967 6874  h...class Weight
-0001a590: 6564 4c69 6e65 6172 436f 6d62 6f28 6e6e  edLinearCombo(nn
-0001a5a0: 2e4d 6f64 756c 6529 3a0a 2020 2020 2222  .Module):.    ""
-0001a5b0: 2243 6f6d 7075 7465 2061 2077 6569 6768  "Compute a weigh
-0001a5c0: 7465 6420 6c69 6e65 6172 2063 6f6d 6269  ted linear combi
-0001a5d0: 6e61 7469 6f6e 206f 6620 696e 7075 7420  nation of input 
-0001a5e0: 6c61 7965 7273 2c20 7768 6572 6520 7468  layers, where th
-0001a5f0: 6520 7765 6967 6874 2076 6172 6961 626c  e weight variabl
-0001a600: 6573 2061 7265 2074 7261 696e 6564 2e0a  es are trained..
-0001a610: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
-0001a620: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
-0001a630: 3e3e 2069 6e70 7574 3120 3d20 6e70 2e72  >> input1 = np.r
-0001a640: 616e 646f 6d2e 7261 6e64 2835 2c20 3130  andom.rand(5, 10
-0001a650: 292e 6173 7479 7065 286e 702e 666c 6f61  ).astype(np.floa
-0001a660: 7433 3229 0a20 2020 203e 3e3e 2069 6e70  t32).    >>> inp
-0001a670: 7574 3220 3d20 6e70 2e72 616e 646f 6d2e  ut2 = np.random.
-0001a680: 7261 6e64 2835 2c20 3130 292e 6173 7479  rand(5, 10).asty
-0001a690: 7065 286e 702e 666c 6f61 7433 3229 0a20  pe(np.float32). 
-0001a6a0: 2020 203e 3e3e 206c 6179 6572 203d 2057     >>> layer = W
-0001a6b0: 6569 6768 7465 644c 696e 6561 7243 6f6d  eightedLinearCom
-0001a6c0: 626f 286c 656e 285b 696e 7075 7431 2c20  bo(len([input1, 
-0001a6d0: 696e 7075 7432 5d29 290a 2020 2020 3e3e  input2])).    >>
-0001a6e0: 3e20 7265 7375 6c74 203d 206c 6179 6572  > result = layer
-0001a6f0: 285b 696e 7075 7431 2c20 696e 7075 7432  ([input1, input2
-0001a700: 5d29 0a20 2020 203e 3e3e 2072 6573 756c  ]).    >>> resul
-0001a710: 742e 7368 6170 650a 2020 2020 746f 7263  t.shape.    torc
-0001a720: 682e 5369 7a65 285b 352c 2031 305d 290a  h.Size([5, 10]).
-0001a730: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-0001a740: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0001a750: 6e75 6d5f 696e 7075 7473 3a20 696e 742c  num_inputs: int,
-0001a760: 2073 7464 3a20 666c 6f61 7420 3d20 302e   std: float = 0.
-0001a770: 332c 202a 2a6b 7761 7267 7329 3a0a 2020  3, **kwargs):.  
-0001a780: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0001a790: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0001a7a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0001a7b0: 0a20 2020 2020 2020 206e 756d 5f69 6e70  .        num_inp
-0001a7c0: 7574 733a 2069 6e74 0a20 2020 2020 2020  uts: int.       
-0001a7d0: 2020 2020 204e 756d 6265 7220 6f66 2069       Number of i
-0001a7e0: 6e70 7574 7320 6769 7665 6e20 746f 2060  nputs given to `
-0001a7f0: 7365 6c66 2e66 6f72 7761 7264 2829 600a  self.forward()`.
-0001a800: 2020 2020 2020 2020 2020 2020 5468 6973              This
-0001a810: 2069 7320 7573 6564 2074 6f20 696e 6974   is used to init
-0001a820: 6961 6c69 7a65 2074 6865 2063 6f72 7265  ialize the corre
-0001a830: 6374 2061 6d6f 756e 7420 6f66 2077 6569  ct amount of wei
-0001a840: 6768 7420 7661 7269 6162 6c65 7320 746f  ght variables to
-0001a850: 2062 6520 7472 6169 6e65 642e 0a20 2020   be trained..   
-0001a860: 2020 2020 2073 7464 3a20 666c 6f61 740a       std: float.
-0001a870: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-0001a880: 7374 616e 6461 7264 2064 6576 6961 7469  standard deviati
-0001a890: 6f6e 2066 6f72 2074 6865 206e 6f72 6d61  on for the norma
-0001a8a0: 6c20 6469 7374 7269 6275 7469 6f6e 2074  l distribution t
-0001a8b0: 6861 7420 6973 2075 7365 6420 746f 2069  hat is used to i
-0001a8c0: 6e69 7469 616c 697a 6520 7468 6520 7472  nitialize the tr
-0001a8d0: 6169 6e61 626c 6520 7765 6967 6874 732e  ainable weights.
-0001a8e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001a8f0: 2020 2020 2073 7570 6572 2857 6569 6768       super(Weigh
-0001a900: 7465 644c 696e 6561 7243 6f6d 626f 2c20  tedLinearCombo, 
-0001a910: 7365 6c66 292e 5f5f 696e 6974 5f5f 282a  self).__init__(*
-0001a920: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0001a930: 2073 656c 662e 6e75 6d5f 696e 7075 7473   self.num_inputs
-0001a940: 203d 206e 756d 5f69 6e70 7574 730a 2020   = num_inputs.  
-0001a950: 2020 2020 2020 7365 6c66 2e73 7464 203d        self.std =
-0001a960: 2073 7464 0a20 2020 2020 2020 2073 656c   std.        sel
-0001a970: 662e 696e 7075 745f 7765 6967 6874 7320  f.input_weights 
-0001a980: 3d20 6e6e 2e50 6172 616d 6574 6572 2874  = nn.Parameter(t
-0001a990: 6f72 6368 2e65 6d70 7479 2873 656c 662e  orch.empty(self.
-0001a9a0: 6e75 6d5f 696e 7075 7473 2929 0a20 2020  num_inputs)).   
-0001a9b0: 2020 2020 206e 6e2e 696e 6974 2e6e 6f72       nn.init.nor
-0001a9c0: 6d61 6c5f 2873 656c 662e 696e 7075 745f  mal_(self.input_
-0001a9d0: 7765 6967 6874 732c 2073 7464 3d73 7464  weights, std=std
-0001a9e0: 290a 0a20 2020 2064 6566 205f 5f72 6570  )..    def __rep
-0001a9f0: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-0001aa00: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
-0001aa10: 2020 2020 2020 2020 6627 7b73 656c 662e          f'{self.
-0001aa20: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0001aa30: 5f5f 7d28 6e75 6d5f 696e 7075 7473 3d7b  __}(num_inputs={
-0001aa40: 7365 6c66 2e6e 756d 5f69 6e70 7574 737d  self.num_inputs}
-0001aa50: 2c20 7374 643d 7b73 656c 662e 7374 647d  , std={self.std}
-0001aa60: 2c20 696e 7075 745f 7765 6967 6874 733d  , input_weights=
-0001aa70: 7b73 656c 662e 696e 7075 745f 7765 6967  {self.input_weig
-0001aa80: 6874 737d 2927 0a20 2020 2020 2020 2029  hts})'.        )
-0001aa90: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-0001aaa0: 6428 0a20 2020 2020 2020 2073 656c 662c  d(.        self,
-0001aab0: 2069 6e70 7574 733a 2053 6571 7565 6e63   inputs: Sequenc
-0001aac0: 655b 556e 696f 6e5b 4172 7261 794c 696b  e[Union[ArrayLik
-0001aad0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019340: 2072 653a 2074 6f72 6368 2e54 656e 736f   re: torch.Tenso
+00019350: 7229 202d 3e20 746f 7263 682e 5465 6e73  r) -> torch.Tens
+00019360: 6f72 3a0a 2020 2020 2020 2020 2222 2243  or:.        """C
+00019370: 616c 6375 6c61 7465 2061 2072 6164 6961  alculate a radia
+00019380: 6c20 7379 6d6d 6574 7279 2066 756e 6374  l symmetry funct
+00019390: 696f 6e2e 0a0a 2020 2020 2020 2020 422c  ion...        B,
+000193a0: 204e 2c20 4d2c 206c 203d 2062 6174 6368   N, M, l = batch
+000193b0: 5f73 697a 652c 206d 6178 5f6e 756d 5f61  _size, max_num_a
+000193c0: 746f 6d73 2c20 6d61 785f 6e75 6d5f 6e65  toms, max_num_ne
+000193d0: 6967 6862 6f72 732c 206c 656e 2872 6164  ighbors, len(rad
+000193e0: 6961 6c5f 7061 7261 6d73 290a 0a20 2020  ial_params)..   
+000193f0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00019400: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00019410: 2d2d 0a20 2020 2020 2020 2052 203a 2074  --.        R : t
+00019420: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
+00019430: 6861 7065 2028 422c 204e 2c20 4d29 0a20  hape (B, N, M). 
+00019440: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
+00019450: 6e63 6520 6d61 7472 6978 2e0a 2020 2020  nce matrix..    
+00019460: 2020 2020 7263 203a 2074 6f72 6368 2e54      rc : torch.T
+00019470: 656e 736f 7220 6f66 2073 6861 7065 2028  ensor of shape (
+00019480: 6c2c 2031 2c20 312c 2031 290a 2020 2020  l, 1, 1, 1).    
+00019490: 2020 2020 2020 2020 496e 7465 7261 6374          Interact
+000194a0: 696f 6e20 6375 746f 6666 2028 696e 2061  ion cutoff (in a
+000194b0: 6e67 7374 726f 6d29 2e0a 2020 2020 2020  ngstrom)..      
+000194c0: 2020 7273 203a 2074 6f72 6368 2e54 656e    rs : torch.Ten
+000194d0: 736f 7220 6f66 2073 6861 7065 2028 6c2c  sor of shape (l,
+000194e0: 2031 2c20 312c 2031 290a 2020 2020 2020   1, 1, 1).      
+000194f0: 2020 2020 2020 4761 7573 7369 616e 2064        Gaussian d
+00019500: 6973 7461 6e63 6520 6d61 7472 6978 206d  istance matrix m
+00019510: 6561 6e2e 0a20 2020 2020 2020 2072 6520  ean..        re 
+00019520: 3a20 746f 7263 682e 5465 6e73 6f72 206f  : torch.Tensor o
+00019530: 6620 7368 6170 6520 286c 2c20 312c 2031  f shape (l, 1, 1
+00019540: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
+00019550: 2047 6175 7373 6961 6e20 6469 7374 616e   Gaussian distan
+00019560: 6365 206d 6174 7269 7820 7769 6474 682e  ce matrix width.
+00019570: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00019580: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00019590: 0a20 2020 2020 2020 2074 6f72 6368 2e54  .        torch.T
+000195a0: 656e 736f 7220 6f66 2073 6861 7065 2028  ensor of shape (
+000195b0: 422c 204e 2c20 4d29 0a20 2020 2020 2020  B, N, M).       
+000195c0: 2020 2020 2050 7265 2d73 756d 6d61 7469       Pre-summati
+000195d0: 6f6e 2072 6164 6961 6c20 7379 6d6d 6574  on radial symmet
+000195e0: 7279 2066 756e 6374 696f 6e2e 0a20 2020  ry function..   
+000195f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00019600: 204b 203d 2073 656c 662e 6761 7573 7369   K = self.gaussi
+00019610: 616e 5f64 6973 7461 6e63 655f 6d61 7472  an_distance_matr
+00019620: 6978 2852 2c20 7273 2c20 7265 290a 2020  ix(R, rs, re).  
+00019630: 2020 2020 2020 4643 203d 2073 656c 662e        FC = self.
+00019640: 7261 6469 616c 5f63 7574 6f66 6628 522c  radial_cutoff(R,
+00019650: 2072 6329 0a0a 2020 2020 2020 2020 7265   rc)..        re
+00019660: 7475 726e 2074 6f72 6368 2e6d 756c 284b  turn torch.mul(K
+00019670: 2c20 4643 290a 0a0a 636c 6173 7320 436f  , FC)...class Co
+00019680: 6d62 696e 654d 6561 6e53 7464 286e 6e2e  mbineMeanStd(nn.
+00019690: 4d6f 6475 6c65 293a 0a20 2020 2022 2222  Module):.    """
+000196a0: 4765 6e65 7261 7465 2047 6175 7373 6961  Generate Gaussia
+000196b0: 6e20 6e6f 6973 652e 0a0a 2020 2020 5468  n noise...    Th
+000196c0: 6973 2069 7320 7468 6520 546f 7263 6820  is is the Torch 
+000196d0: 6571 7569 7661 6c65 6e74 206f 6620 7468  equivalent of th
+000196e0: 6520 6f72 6967 696e 616c 2069 6d70 6c65  e original imple
+000196f0: 6d65 6e74 6174 696f 6e20 7573 696e 6720  mentation using 
+00019700: 4b65 7261 732e 0a20 2020 2022 2222 0a0a  Keras..    """..
+00019710: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00019720: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+00019730: 2020 2020 2020 2020 7472 6169 6e69 6e67          training
+00019740: 5f6f 6e6c 793a 2062 6f6f 6c20 3d20 4661  _only: bool = Fa
+00019750: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+00019760: 2020 2020 2020 6e6f 6973 655f 6570 7369        noise_epsi
+00019770: 6c6f 6e3a 2066 6c6f 6174 203d 2031 2e30  lon: float = 1.0
+00019780: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019790: 2020 202a 2a6b 7761 7267 7329 3a0a 2020     **kwargs):.  
+000197a0: 2020 2020 2020 2222 2243 7265 6174 6520        """Create 
+000197b0: 6120 436f 6d62 696e 654d 6561 6e53 7464  a CombineMeanStd
+000197c0: 206c 6179 6572 2e0a 0a20 2020 2020 2020   layer...       
+000197d0: 2054 6869 7320 6c61 7965 7220 7368 6f75   This layer shou
+000197e0: 6c64 2068 6176 6520 7477 6f20 696e 7075  ld have two inpu
+000197f0: 7473 2077 6974 6820 7468 6520 7361 6d65  ts with the same
+00019800: 2073 6861 7065 2c20 616e 6420 6974 730a   shape, and its.
+00019810: 2020 2020 2020 2020 6f75 7470 7574 2061          output a
+00019820: 6c73 6f20 6861 7320 7468 6520 7361 6d65  lso has the same
+00019830: 2073 6861 7065 2e20 2045 6163 6820 656c   shape.  Each el
+00019840: 656d 656e 7420 6f66 2074 6865 206f 7574  ement of the out
+00019850: 7075 7420 6973 2061 0a20 2020 2020 2020  put is a.       
+00019860: 2047 6175 7373 6961 6e20 6469 7374 7269   Gaussian distri
+00019870: 6275 7465 6420 7261 6e64 6f6d 206e 756d  buted random num
+00019880: 6265 7220 7768 6f73 6520 6d65 616e 2069  ber whose mean i
+00019890: 7320 7468 6520 636f 7272 6573 706f 6e64  s the correspond
+000198a0: 696e 670a 2020 2020 2020 2020 656c 656d  ing.        elem
+000198b0: 656e 7420 6f66 2074 6865 2066 6972 7374  ent of the first
+000198c0: 2069 6e70 7574 2c20 616e 6420 7768 6f73   input, and whos
+000198d0: 6520 7374 616e 6461 7264 2064 6576 6961  e standard devia
+000198e0: 7469 6f6e 2069 7320 7468 650a 2020 2020  tion is the.    
+000198f0: 2020 2020 636f 7272 6573 706f 6e64 696e      correspondin
+00019900: 6720 656c 656d 656e 7420 6f66 2074 6865  g element of the
+00019910: 2073 6563 6f6e 6420 696e 7075 742e 0a0a   second input...
+00019920: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00019930: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00019940: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7472  -----.        tr
+00019950: 6169 6e69 6e67 5f6f 6e6c 793a 2062 6f6f  aining_only: boo
+00019960: 6c2c 206f 7074 696f 6e61 6c20 2864 6566  l, optional (def
+00019970: 6175 6c74 2046 616c 7365 292e 0a20 2020  ault False)..   
+00019980: 2020 2020 2020 2020 2069 6620 5472 7565           if True
+00019990: 2c20 6e6f 6973 6520 6973 206f 6e6c 7920  , noise is only 
+000199a0: 6765 6e65 7261 7465 6420 6475 7269 6e67  generated during
+000199b0: 2074 7261 696e 696e 672e 2020 4475 7269   training.  Duri
+000199c0: 6e67 0a20 2020 2020 2020 2020 2020 2070  ng.            p
+000199d0: 7265 6469 6374 696f 6e2c 2074 6865 206f  rediction, the o
+000199e0: 7574 7075 7420 6973 2073 696d 706c 7920  utput is simply 
+000199f0: 6571 7561 6c20 746f 2074 6865 2066 6972  equal to the fir
+00019a00: 7374 2069 6e70 7574 2028 7468 6174 0a20  st input (that. 
+00019a10: 2020 2020 2020 2020 2020 2069 732c 2074             is, t
+00019a20: 6865 206d 6561 6e20 6f66 2074 6865 2064  he mean of the d
+00019a30: 6973 7472 6962 7574 696f 6e20 7573 6564  istribution used
+00019a40: 2064 7572 696e 6720 7472 6169 6e69 6e67   during training
+00019a50: 292e 0a20 2020 2020 2020 206e 6f69 7365  )..        noise
+00019a60: 5f65 7073 696c 6f6e 3a20 666c 6f61 742c  _epsilon: float,
+00019a70: 206f 7074 696f 6e61 6c20 2864 6566 6175   optional (defau
+00019a80: 6c74 2031 2e30 292e 0a20 2020 2020 2020  lt 1.0)..       
+00019a90: 2020 2020 2054 6865 206e 6f69 7365 2069       The noise i
+00019aa0: 7320 7363 616c 6564 2062 7920 7468 6973  s scaled by this
+00019ab0: 2066 6163 746f 720a 2020 2020 2020 2020   factor.        
+00019ac0: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
+00019ad0: 7228 436f 6d62 696e 654d 6561 6e53 7464  r(CombineMeanStd
+00019ae0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
+00019af0: 282a 2a6b 7761 7267 7329 0a20 2020 2020  (**kwargs).     
+00019b00: 2020 2073 656c 662e 7472 6169 6e69 6e67     self.training
+00019b10: 5f6f 6e6c 7920 3d20 7472 6169 6e69 6e67  _only = training
+00019b20: 5f6f 6e6c 790a 2020 2020 2020 2020 7365  _only.        se
+00019b30: 6c66 2e6e 6f69 7365 5f65 7073 696c 6f6e  lf.noise_epsilon
+00019b40: 203d 206e 6f69 7365 5f65 7073 696c 6f6e   = noise_epsilon
+00019b50: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+00019b60: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
+00019b70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00019b80: 280a 2020 2020 2020 2020 2020 2020 6627  (.            f'
+00019b90: 7b73 656c 662e 5f5f 636c 6173 735f 5f2e  {self.__class__.
+00019ba0: 5f5f 6e61 6d65 5f5f 7d28 7472 6169 6e69  __name__}(traini
+00019bb0: 6e67 5f6f 6e6c 793d 7b73 656c 662e 7472  ng_only={self.tr
+00019bc0: 6169 6e69 6e67 5f6f 6e6c 797d 2c20 6e6f  aining_only}, no
+00019bd0: 6973 655f 6570 7369 6c6f 6e3d 7b73 656c  ise_epsilon={sel
+00019be0: 662e 6e6f 6973 655f 6570 7369 6c6f 6e7d  f.noise_epsilon}
+00019bf0: 2927 0a20 2020 2020 2020 2029 0a0a 2020  )'.        )..  
+00019c00: 2020 6465 6620 666f 7277 6172 6428 7365    def forward(se
+00019c10: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00019c20: 2020 2020 696e 7075 7473 3a20 5365 7175      inputs: Sequ
+00019c30: 656e 6365 5b41 7272 6179 4c69 6b65 5d2c  ence[ArrayLike],
+00019c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019c50: 2074 7261 696e 696e 673a 2062 6f6f 6c20   training: bool 
+00019c60: 3d20 5472 7565 2920 2d3e 2074 6f72 6368  = True) -> torch
+00019c70: 2e54 656e 736f 723a 0a20 2020 2020 2020  .Tensor:.       
+00019c80: 2022 2222 496e 766f 6b65 2074 6869 7320   """Invoke this 
+00019c90: 6c61 7965 722e 0a0a 2020 2020 2020 2020  layer...        
+00019ca0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00019cb0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00019cc0: 2020 2020 2020 696e 7075 7473 3a20 5365        inputs: Se
+00019cd0: 7175 656e 6365 5b41 7272 6179 4c69 6b65  quence[ArrayLike
+00019ce0: 5d0a 2020 2020 2020 2020 2020 2020 4669  ].            Fi
+00019cf0: 7273 7420 656c 656d 656e 7420 6172 6520  rst element are 
+00019d00: 7468 6520 6d65 616e 7320 666f 7220 7468  the means for th
+00019d10: 6520 7261 6e64 6f6d 2067 656e 6572 6174  e random generat
+00019d20: 6564 206e 756d 6265 7273 2e0a 2020 2020  ed numbers..    
+00019d30: 2020 2020 2020 2020 5365 636f 6e64 2065          Second e
+00019d40: 6c65 6d65 6e74 2061 7265 2074 6865 2073  lement are the s
+00019d50: 7461 6e64 6172 6420 6465 7669 6174 696f  tandard deviatio
+00019d60: 6e73 2066 6f72 2074 6865 2072 616e 646f  ns for the rando
+00019d70: 6d20 6765 6e65 7261 7465 6420 6e75 6d62  m generated numb
+00019d80: 6572 732e 0a20 2020 2020 2020 2074 7261  ers..        tra
+00019d90: 696e 696e 673a 2062 6f6f 6c2c 206f 7074  ining: bool, opt
+00019da0: 696f 6e61 6c20 2864 6566 6175 6c74 2054  ional (default T
+00019db0: 7275 6529 2e0a 2020 2020 2020 2020 2020  rue)..          
+00019dc0: 2020 5370 6563 6966 6965 7320 7768 6574    Specifies whet
+00019dd0: 6865 7220 746f 2067 656e 6572 6174 6520  her to generate 
+00019de0: 6e6f 6973 652e 0a20 2020 2020 2020 2020  noise..         
+00019df0: 2020 204e 6f69 7365 2069 7320 6f6e 6c79     Noise is only
+00019e00: 2061 6464 6564 2077 6865 6e20 7472 6169   added when trai
+00019e10: 6e69 6e67 2e0a 0a20 2020 2020 2020 2052  ning...        R
+00019e20: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+00019e30: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2054  ------.        T
+00019e40: 656e 736f 7220 6f66 2047 6175 7373 6961  ensor of Gaussia
+00019e50: 6e20 6469 7374 7269 6275 7465 6420 7261  n distributed ra
+00019e60: 6e64 6f6d 206e 756d 6265 7273 3a20 746f  ndom numbers: to
+00019e70: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+00019e80: 2020 2020 2020 2053 616d 6520 7368 6170         Same shap
+00019e90: 6520 6173 2074 6865 206d 6561 6e73 2061  e as the means a
+00019ea0: 6e64 2073 7461 6e64 6172 6420 6465 7669  nd standard devi
+00019eb0: 6174 696f 6e73 2066 726f 6d20 6069 6e70  ations from `inp
+00019ec0: 7574 7360 2e0a 2020 2020 2020 2020 2222  uts`..        ""
+00019ed0: 220a 2020 2020 2020 2020 6966 206c 656e  ".        if len
+00019ee0: 2869 6e70 7574 7329 2021 3d20 323a 0a20  (inputs) != 2:. 
+00019ef0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00019f00: 2056 616c 7565 4572 726f 7228 224d 7573   ValueError("Mus
+00019f10: 7420 6861 7665 2074 776f 2069 6e5f 6c61  t have two in_la
+00019f20: 7965 7273 2229 0a0a 2020 2020 2020 2020  yers")..        
+00019f30: 6d65 616e 5f70 6172 656e 742c 2073 7464  mean_parent, std
+00019f40: 5f70 6172 656e 7420 3d20 746f 7263 682e  _parent = torch.
+00019f50: 7465 6e73 6f72 2869 6e70 7574 735b 305d  tensor(inputs[0]
+00019f60: 292c 2074 6f72 6368 2e74 656e 736f 7228  ), torch.tensor(
+00019f70: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+00019f80: 7574 735b 315d 290a 2020 2020 2020 2020  uts[1]).        
+00019f90: 6e6f 6973 655f 7363 616c 6520 3d20 746f  noise_scale = to
+00019fa0: 7263 682e 7465 6e73 6f72 2874 7261 696e  rch.tensor(train
+00019fb0: 696e 6720 6f72 0a20 2020 2020 2020 2020  ing or.         
+00019fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fd0: 2020 2020 2020 2020 2020 6e6f 7420 7365            not se
+00019fe0: 6c66 2e74 7261 696e 696e 675f 6f6e 6c79  lf.training_only
+00019ff0: 292e 746f 2874 6f72 6368 2e66 6c6f 6174  ).to(torch.float
+0001a000: 290a 2020 2020 2020 2020 7361 6d70 6c65  ).        sample
+0001a010: 5f6e 6f69 7365 203d 2074 6f72 6368 2e6e  _noise = torch.n
+0001a020: 6f72 6d61 6c28 302e 302c 2073 656c 662e  ormal(0.0, self.
+0001a030: 6e6f 6973 655f 6570 7369 6c6f 6e2c 206d  noise_epsilon, m
+0001a040: 6561 6e5f 7061 7265 6e74 2e73 6861 7065  ean_parent.shape
+0001a050: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001a060: 206d 6561 6e5f 7061 7265 6e74 202b 206e   mean_parent + n
+0001a070: 6f69 7365 5f73 6361 6c65 202a 2073 7464  oise_scale * std
+0001a080: 5f70 6172 656e 7420 2a20 7361 6d70 6c65  _parent * sample
+0001a090: 5f6e 6f69 7365 0a0a 0a63 6c61 7373 2047  _noise...class G
+0001a0a0: 6174 6564 5265 6375 7272 656e 7455 6e69  atedRecurrentUni
+0001a0b0: 7428 6e6e 2e4d 6f64 756c 6529 3a0a 2020  t(nn.Module):.  
+0001a0c0: 2020 2222 2220 5375 626d 6f64 756c 6520    """ Submodule 
+0001a0d0: 666f 7220 4d65 7373 6167 6520 5061 7373  for Message Pass
+0001a0e0: 696e 6720 2222 220a 0a20 2020 2064 6566  ing """..    def
+0001a0f0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+0001a100: 6e5f 6869 6464 656e 3d31 3030 2c20 696e  n_hidden=100, in
+0001a110: 6974 3d27 7861 7669 6572 5f75 6e69 666f  it='xavier_unifo
+0001a120: 726d 5f27 2c20 2a2a 6b77 6172 6773 293a  rm_', **kwargs):
+0001a130: 0a20 2020 2020 2020 2073 7570 6572 2847  .        super(G
+0001a140: 6174 6564 5265 6375 7272 656e 7455 6e69  atedRecurrentUni
+0001a150: 742c 2073 656c 6629 2e5f 5f69 6e69 745f  t, self).__init_
+0001a160: 5f28 2a2a 6b77 6172 6773 290a 2020 2020  _(**kwargs).    
+0001a170: 2020 2020 7365 6c66 2e6e 5f68 6964 6465      self.n_hidde
+0001a180: 6e20 3d20 6e5f 6869 6464 656e 0a20 2020  n = n_hidden.   
+0001a190: 2020 2020 2073 656c 662e 696e 6974 203d       self.init =
+0001a1a0: 2069 6e69 740a 2020 2020 2020 2020 696e   init.        in
+0001a1b0: 6974 203d 2067 6574 6174 7472 2869 6e69  it = getattr(ini
+0001a1c0: 7469 616c 697a 6572 732c 2073 656c 662e  tializers, self.
+0001a1d0: 696e 6974 290a 2020 2020 2020 2020 7365  init).        se
+0001a1e0: 6c66 2e57 7a20 3d20 696e 6974 2874 6f72  lf.Wz = init(tor
+0001a1f0: 6368 2e65 6d70 7479 286e 5f68 6964 6465  ch.empty(n_hidde
+0001a200: 6e2c 206e 5f68 6964 6465 6e29 290a 2020  n, n_hidden)).  
+0001a210: 2020 2020 2020 7365 6c66 2e57 7220 3d20        self.Wr = 
+0001a220: 696e 6974 2874 6f72 6368 2e65 6d70 7479  init(torch.empty
+0001a230: 286e 5f68 6964 6465 6e2c 206e 5f68 6964  (n_hidden, n_hid
+0001a240: 6465 6e29 290a 2020 2020 2020 2020 7365  den)).        se
+0001a250: 6c66 2e57 6820 3d20 696e 6974 2874 6f72  lf.Wh = init(tor
+0001a260: 6368 2e65 6d70 7479 286e 5f68 6964 6465  ch.empty(n_hidde
+0001a270: 6e2c 206e 5f68 6964 6465 6e29 290a 2020  n, n_hidden)).  
+0001a280: 2020 2020 2020 7365 6c66 2e55 7a20 3d20        self.Uz = 
+0001a290: 696e 6974 2874 6f72 6368 2e65 6d70 7479  init(torch.empty
+0001a2a0: 286e 5f68 6964 6465 6e2c 206e 5f68 6964  (n_hidden, n_hid
+0001a2b0: 6465 6e29 290a 2020 2020 2020 2020 7365  den)).        se
+0001a2c0: 6c66 2e55 7220 3d20 696e 6974 2874 6f72  lf.Ur = init(tor
+0001a2d0: 6368 2e65 6d70 7479 286e 5f68 6964 6465  ch.empty(n_hidde
+0001a2e0: 6e2c 206e 5f68 6964 6465 6e29 290a 2020  n, n_hidden)).  
+0001a2f0: 2020 2020 2020 7365 6c66 2e55 6820 3d20        self.Uh = 
+0001a300: 696e 6974 2874 6f72 6368 2e65 6d70 7479  init(torch.empty
+0001a310: 286e 5f68 6964 6465 6e2c 206e 5f68 6964  (n_hidden, n_hid
+0001a320: 6465 6e29 290a 2020 2020 2020 2020 7365  den)).        se
+0001a330: 6c66 2e62 7a20 3d20 746f 7263 682e 7a65  lf.bz = torch.ze
+0001a340: 726f 7328 286e 5f68 6964 6465 6e2c 2929  ros((n_hidden,))
+0001a350: 0a20 2020 2020 2020 2073 656c 662e 6272  .        self.br
+0001a360: 203d 2074 6f72 6368 2e7a 6572 6f73 2828   = torch.zeros((
+0001a370: 6e5f 6869 6464 656e 2c29 290a 2020 2020  n_hidden,)).    
+0001a380: 2020 2020 7365 6c66 2e62 6820 3d20 746f      self.bh = to
+0001a390: 7263 682e 7a65 726f 7328 286e 5f68 6964  rch.zeros((n_hid
+0001a3a0: 6465 6e2c 2929 0a0a 2020 2020 6465 6620  den,))..    def 
+0001a3b0: 666f 7277 6172 6428 7365 6c66 2c20 696e  forward(self, in
+0001a3c0: 7075 7473 293a 0a20 2020 2020 2020 2073  puts):.        s
+0001a3d0: 6967 6d6f 6964 203d 2067 6574 5f61 6374  igmoid = get_act
+0001a3e0: 6976 6174 696f 6e28 2773 6967 6d6f 6964  ivation('sigmoid
+0001a3f0: 2729 0a20 2020 2020 2020 2074 616e 6820  ').        tanh 
+0001a400: 3d20 6765 745f 6163 7469 7661 7469 6f6e  = get_activation
+0001a410: 2827 7461 6e68 2729 0a20 2020 2020 2020  ('tanh').       
+0001a420: 2068 5f74 6d31 2c20 7820 3d20 696e 7075   h_tm1, x = inpu
+0001a430: 7473 0a20 2020 2020 2020 207a 203d 2073  ts.        z = s
+0001a440: 6967 6d6f 6964 280a 2020 2020 2020 2020  igmoid(.        
+0001a450: 2020 2020 746f 7263 682e 6d61 746d 756c      torch.matmul
+0001a460: 2878 2c20 7365 6c66 2e57 7a29 202b 2074  (x, self.Wz) + t
+0001a470: 6f72 6368 2e6d 6174 6d75 6c28 685f 746d  orch.matmul(h_tm
+0001a480: 312c 2073 656c 662e 557a 2920 2b20 7365  1, self.Uz) + se
+0001a490: 6c66 2e62 7a29 0a20 2020 2020 2020 2072  lf.bz).        r
+0001a4a0: 203d 2073 6967 6d6f 6964 280a 2020 2020   = sigmoid(.    
+0001a4b0: 2020 2020 2020 2020 746f 7263 682e 6d61          torch.ma
+0001a4c0: 746d 756c 2878 2c20 7365 6c66 2e57 7229  tmul(x, self.Wr)
+0001a4d0: 202b 2074 6f72 6368 2e6d 6174 6d75 6c28   + torch.matmul(
+0001a4e0: 685f 746d 312c 2073 656c 662e 5572 2920  h_tm1, self.Ur) 
+0001a4f0: 2b20 7365 6c66 2e62 7229 0a20 2020 2020  + self.br).     
+0001a500: 2020 2068 203d 2028 3120 2d20 7a29 202a     h = (1 - z) *
+0001a510: 2074 616e 6828 0a20 2020 2020 2020 2020   tanh(.         
+0001a520: 2020 2074 6f72 6368 2e6d 6174 6d75 6c28     torch.matmul(
+0001a530: 782c 2073 656c 662e 5768 2920 2b20 746f  x, self.Wh) + to
+0001a540: 7263 682e 6d61 746d 756c 2868 5f74 6d31  rch.matmul(h_tm1
+0001a550: 202a 2072 2c20 7365 6c66 2e55 6829 202b   * r, self.Uh) +
+0001a560: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001a570: 662e 6268 2920 2b20 7a20 2a20 780a 2020  f.bh) + z * x.  
+0001a580: 2020 2020 2020 7265 7475 726e 2068 0a0a        return h..
+0001a590: 0a63 6c61 7373 2057 6569 6768 7465 644c  .class WeightedL
+0001a5a0: 696e 6561 7243 6f6d 626f 286e 6e2e 4d6f  inearCombo(nn.Mo
+0001a5b0: 6475 6c65 293a 0a20 2020 2022 2222 436f  dule):.    """Co
+0001a5c0: 6d70 7574 6520 6120 7765 6967 6874 6564  mpute a weighted
+0001a5d0: 206c 696e 6561 7220 636f 6d62 696e 6174   linear combinat
+0001a5e0: 696f 6e20 6f66 2069 6e70 7574 206c 6179  ion of input lay
+0001a5f0: 6572 732c 2077 6865 7265 2074 6865 2077  ers, where the w
+0001a600: 6569 6768 7420 7661 7269 6162 6c65 7320  eight variables 
+0001a610: 6172 6520 7472 6169 6e65 642e 0a0a 2020  are trained...  
+0001a620: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+0001a630: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+0001a640: 696e 7075 7431 203d 206e 702e 7261 6e64  input1 = np.rand
+0001a650: 6f6d 2e72 616e 6428 352c 2031 3029 2e61  om.rand(5, 10).a
+0001a660: 7374 7970 6528 6e70 2e66 6c6f 6174 3332  stype(np.float32
+0001a670: 290a 2020 2020 3e3e 3e20 696e 7075 7432  ).    >>> input2
+0001a680: 203d 206e 702e 7261 6e64 6f6d 2e72 616e   = np.random.ran
+0001a690: 6428 352c 2031 3029 2e61 7374 7970 6528  d(5, 10).astype(
+0001a6a0: 6e70 2e66 6c6f 6174 3332 290a 2020 2020  np.float32).    
+0001a6b0: 3e3e 3e20 6c61 7965 7220 3d20 5765 6967  >>> layer = Weig
+0001a6c0: 6874 6564 4c69 6e65 6172 436f 6d62 6f28  htedLinearCombo(
+0001a6d0: 6c65 6e28 5b69 6e70 7574 312c 2069 6e70  len([input1, inp
+0001a6e0: 7574 325d 2929 0a20 2020 203e 3e3e 2072  ut2])).    >>> r
+0001a6f0: 6573 756c 7420 3d20 6c61 7965 7228 5b69  esult = layer([i
+0001a700: 6e70 7574 312c 2069 6e70 7574 325d 290a  nput1, input2]).
+0001a710: 2020 2020 3e3e 3e20 7265 7375 6c74 2e73      >>> result.s
+0001a720: 6861 7065 0a20 2020 2074 6f72 6368 2e53  hape.    torch.S
+0001a730: 697a 6528 5b35 2c20 3130 5d29 0a20 2020  ize([5, 10]).   
+0001a740: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+0001a750: 696e 6974 5f5f 2873 656c 662c 206e 756d  init__(self, num
+0001a760: 5f69 6e70 7574 733a 2069 6e74 2c20 7374  _inputs: int, st
+0001a770: 643a 2066 6c6f 6174 203d 2030 2e33 2c20  d: float = 0.3, 
+0001a780: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+0001a790: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0001a7a0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0001a7b0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0001a7c0: 2020 2020 2020 6e75 6d5f 696e 7075 7473        num_inputs
+0001a7d0: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+0001a7e0: 2020 4e75 6d62 6572 206f 6620 696e 7075    Number of inpu
+0001a7f0: 7473 2067 6976 656e 2074 6f20 6073 656c  ts given to `sel
+0001a800: 662e 666f 7277 6172 6428 2960 0a20 2020  f.forward()`.   
+0001a810: 2020 2020 2020 2020 2054 6869 7320 6973           This is
+0001a820: 2075 7365 6420 746f 2069 6e69 7469 616c   used to initial
+0001a830: 697a 6520 7468 6520 636f 7272 6563 7420  ize the correct 
+0001a840: 616d 6f75 6e74 206f 6620 7765 6967 6874  amount of weight
+0001a850: 2076 6172 6961 626c 6573 2074 6f20 6265   variables to be
+0001a860: 2074 7261 696e 6564 2e0a 2020 2020 2020   trained..      
+0001a870: 2020 7374 643a 2066 6c6f 6174 0a20 2020    std: float.   
+0001a880: 2020 2020 2020 2020 2054 6865 2073 7461           The sta
+0001a890: 6e64 6172 6420 6465 7669 6174 696f 6e20  ndard deviation 
+0001a8a0: 666f 7220 7468 6520 6e6f 726d 616c 2064  for the normal d
+0001a8b0: 6973 7472 6962 7574 696f 6e20 7468 6174  istribution that
+0001a8c0: 2069 7320 7573 6564 2074 6f20 696e 6974   is used to init
+0001a8d0: 6961 6c69 7a65 2074 6865 2074 7261 696e  ialize the train
+0001a8e0: 6162 6c65 2077 6569 6768 7473 2e0a 2020  able weights..  
+0001a8f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001a900: 2020 7375 7065 7228 5765 6967 6874 6564    super(Weighted
+0001a910: 4c69 6e65 6172 436f 6d62 6f2c 2073 656c  LinearCombo, sel
+0001a920: 6629 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  f).__init__(**kw
+0001a930: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
+0001a940: 6c66 2e6e 756d 5f69 6e70 7574 7320 3d20  lf.num_inputs = 
+0001a950: 6e75 6d5f 696e 7075 7473 0a20 2020 2020  num_inputs.     
+0001a960: 2020 2073 656c 662e 7374 6420 3d20 7374     self.std = st
+0001a970: 640a 2020 2020 2020 2020 7365 6c66 2e69  d.        self.i
+0001a980: 6e70 7574 5f77 6569 6768 7473 203d 206e  nput_weights = n
+0001a990: 6e2e 5061 7261 6d65 7465 7228 746f 7263  n.Parameter(torc
+0001a9a0: 682e 656d 7074 7928 7365 6c66 2e6e 756d  h.empty(self.num
+0001a9b0: 5f69 6e70 7574 7329 290a 2020 2020 2020  _inputs)).      
+0001a9c0: 2020 6e6e 2e69 6e69 742e 6e6f 726d 616c    nn.init.normal
+0001a9d0: 5f28 7365 6c66 2e69 6e70 7574 5f77 6569  _(self.input_wei
+0001a9e0: 6768 7473 2c20 7374 643d 7374 6429 0a0a  ghts, std=std)..
+0001a9f0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
+0001aa00: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001aa10: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
+0001aa20: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
+0001aa30: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0001aa40: 286e 756d 5f69 6e70 7574 733d 7b73 656c  (num_inputs={sel
+0001aa50: 662e 6e75 6d5f 696e 7075 7473 7d2c 2073  f.num_inputs}, s
+0001aa60: 7464 3d7b 7365 6c66 2e73 7464 7d2c 2069  td={self.std}, i
+0001aa70: 6e70 7574 5f77 6569 6768 7473 3d7b 7365  nput_weights={se
+0001aa80: 6c66 2e69 6e70 7574 5f77 6569 6768 7473  lf.input_weights
+0001aa90: 7d29 270a 2020 2020 2020 2020 290a 0a20  })'.        ).. 
+0001aaa0: 2020 2064 6566 2066 6f72 7761 7264 280a     def forward(.
+0001aab0: 2020 2020 2020 2020 7365 6c66 2c20 696e          self, in
+0001aac0: 7075 7473 3a20 5365 7175 656e 6365 5b55  puts: Sequence[U
+0001aad0: 6e69 6f6e 5b41 7272 6179 4c69 6b65 2c0a  nion[ArrayLike,.
 0001aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aaf0: 2020 2020 2020 2020 746f 7263 682e 5465          torch.Te
-0001ab00: 6e73 6f72 5d5d 2920 2d3e 204f 7074 696f  nsor]]) -> Optio
-0001ab10: 6e61 6c5b 746f 7263 682e 5465 6e73 6f72  nal[torch.Tensor
-0001ab20: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
-0001ab30: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0001ab40: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0001ab50: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e70  ----.        inp
-0001ab60: 7574 733a 2053 6571 7565 6e63 655b 556e  uts: Sequence[Un
-0001ab70: 696f 6e5b 4172 7261 794c 696b 652c 2074  ion[ArrayLike, t
-0001ab80: 6f72 6368 2e54 656e 736f 725d 5d0a 2020  orch.Tensor]].  
-0001ab90: 2020 2020 2020 2020 2020 5468 6520 696e            The in
-0001aba0: 6974 6961 6c20 696e 7075 7420 6c61 7965  itial input laye
-0001abb0: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
-0001abc0: 5468 6520 6c65 6e67 7468 206d 7573 7420  The length must 
-0001abd0: 6265 2074 6865 2073 616d 6520 6173 2060  be the same as `
-0001abe0: 7365 6c66 2e6e 756d 5f69 6e70 7574 7360  self.num_inputs`
-0001abf0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0001ac00: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-0001ac10: 2d2d 0a20 2020 2020 2020 206f 7574 5f74  --.        out_t
-0001ac20: 656e 736f 723a 2074 6f72 6368 2e54 656e  ensor: torch.Ten
-0001ac30: 736f 7220 6f72 204e 6f6e 650a 2020 2020  sor or None.    
-0001ac40: 2020 2020 2020 2020 5468 6520 7465 6e73          The tens
-0001ac50: 6f72 2063 6f6e 7461 696e 696e 6720 7468  or containing th
-0001ac60: 6520 7765 6967 6874 6564 206c 696e 6561  e weighted linea
-0001ac70: 7220 636f 6d62 696e 6174 696f 6e2e 0a20  r combination.. 
-0001ac80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001ac90: 2020 206f 7574 5f74 656e 736f 7220 3d20     out_tensor = 
-0001aca0: 4e6f 6e65 0a20 2020 2020 2020 2066 6f72  None.        for
-0001acb0: 2069 6e5f 7465 6e73 6f72 2c20 7720 696e   in_tensor, w in
-0001acc0: 207a 6970 2869 6e70 7574 732c 2073 656c   zip(inputs, sel
-0001acd0: 662e 696e 7075 745f 7765 6967 6874 7329  f.input_weights)
-0001ace0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-0001acf0: 5f74 656e 736f 7220 3d20 746f 7263 682e  _tensor = torch.
-0001ad00: 466c 6f61 7454 656e 736f 7228 696e 5f74  FloatTensor(in_t
-0001ad10: 656e 736f 7229 0a20 2020 2020 2020 2020  ensor).         
-0001ad20: 2020 2069 6620 6f75 745f 7465 6e73 6f72     if out_tensor
-0001ad30: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001ad40: 2020 2020 2020 2020 2020 6f75 745f 7465            out_te
-0001ad50: 6e73 6f72 203d 2077 202a 2069 6e5f 7465  nsor = w * in_te
-0001ad60: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-0001ad70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001ad80: 2020 2020 2020 206f 7574 5f74 656e 736f         out_tenso
-0001ad90: 7220 2b3d 2077 202a 2069 6e5f 7465 6e73  r += w * in_tens
-0001ada0: 6f72 0a20 2020 2020 2020 2072 6574 7572  or.        retur
-0001adb0: 6e20 6f75 745f 7465 6e73 6f72 0a0a 0a63  n out_tensor...c
-0001adc0: 6c61 7373 2053 6574 4761 7468 6572 286e  lass SetGather(n
-0001add0: 6e2e 4d6f 6475 6c65 293a 0a20 2020 2022  n.Module):.    "
-0001ade0: 2222 7365 7432 7365 7420 6761 7468 6572  ""set2set gather
-0001adf0: 206c 6179 6572 2066 6f72 2067 7261 7068   layer for graph
-0001ae00: 2d62 6173 6564 206d 6f64 656c 0a0a 2020  -based model..  
-0001ae10: 2020 4d6f 6465 6c73 2075 7369 6e67 2074    Models using t
-0001ae20: 6869 7320 6c61 7965 7220 6d75 7374 2073  his layer must s
-0001ae30: 6574 2060 7061 645f 6261 7463 6865 733d  et `pad_batches=
-0001ae40: 5472 7565 600a 0a20 2020 2054 6f72 6368  True`..    Torch
-0001ae50: 2045 7175 6976 616c 656e 7420 6f66 204b   Equivalent of K
-0001ae60: 6572 6173 2053 6574 4761 7468 6572 206c  eras SetGather l
-0001ae70: 6179 6572 0a0a 2020 2020 5061 7261 6d65  ayer..    Parame
-0001ae80: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-0001ae90: 2d2d 2d0a 2020 2020 4d3a 2069 6e74 0a20  ---.    M: int. 
-0001aea0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-0001aeb0: 204c 5354 4d20 7374 6570 730a 2020 2020   LSTM steps.    
-0001aec0: 6261 7463 685f 7369 7a65 3a20 696e 740a  batch_size: int.
-0001aed0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-0001aee0: 6620 7361 6d70 6c65 7320 696e 2061 2062  f samples in a b
-0001aef0: 6174 6368 2861 6c6c 2062 6174 6368 6573  atch(all batches
-0001af00: 206d 7573 7420 6861 7665 2073 616d 6520   must have same 
-0001af10: 7369 7a65 290a 2020 2020 6e5f 6869 6464  size).    n_hidd
-0001af20: 656e 3a20 696e 742c 206f 7074 696f 6e61  en: int, optiona
-0001af30: 6c0a 2020 2020 2020 2020 6e75 6d62 6572  l.        number
-0001af40: 206f 6620 6869 6464 656e 2075 6e69 7473   of hidden units
-0001af50: 2069 6e20 7468 6520 7061 7373 696e 6720   in the passing 
-0001af60: 7068 6173 650a 0a20 2020 2045 7861 6d70  phase..    Examp
-0001af70: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-0001af80: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
-0001af90: 6465 6570 6368 656d 2061 7320 6463 0a20  deepchem as dc. 
-0001afa0: 2020 203e 3e3e 2069 6d70 6f72 7420 6e75     >>> import nu
-0001afb0: 6d70 7920 6173 206e 700a 2020 2020 3e3e  mpy as np.    >>
-0001afc0: 3e20 6672 6f6d 2064 6565 7063 6865 6d2e  > from deepchem.
-0001afd0: 6d6f 6465 6c73 2e74 6f72 6368 5f6d 6f64  models.torch_mod
-0001afe0: 656c 7320 696d 706f 7274 206c 6179 6572  els import layer
-0001aff0: 730a 2020 2020 3e3e 3e20 746f 7461 6c5f  s.    >>> total_
-0001b000: 6e5f 6174 6f6d 7320 3d20 340a 2020 2020  n_atoms = 4.    
-0001b010: 3e3e 3e20 6e5f 6174 6f6d 5f66 6561 7420  >>> n_atom_feat 
-0001b020: 3d20 340a 2020 2020 3e3e 3e20 6174 6f6d  = 4.    >>> atom
-0001b030: 5f66 6561 7420 3d20 6e70 2e72 616e 646f  _feat = np.rando
-0001b040: 6d2e 7261 6e64 2874 6f74 616c 5f6e 5f61  m.rand(total_n_a
-0001b050: 746f 6d73 2c20 6e5f 6174 6f6d 5f66 6561  toms, n_atom_fea
-0001b060: 7429 0a20 2020 203e 3e3e 2061 746f 6d5f  t).    >>> atom_
-0001b070: 7370 6c69 7420 3d20 6e70 2e61 7272 6179  split = np.array
-0001b080: 285b 302c 2030 2c20 312c 2031 5d2c 2064  ([0, 0, 1, 1], d
-0001b090: 7479 7065 3d6e 702e 696e 7433 3229 0a20  type=np.int32). 
-0001b0a0: 2020 203e 3e3e 2067 6174 6865 7220 3d20     >>> gather = 
-0001b0b0: 6c61 7965 7273 2e53 6574 4761 7468 6572  layers.SetGather
-0001b0c0: 2832 2c20 322c 206e 5f68 6964 6465 6e3d  (2, 2, n_hidden=
-0001b0d0: 3429 0a20 2020 203e 3e3e 206f 7574 7075  4).    >>> outpu
-0001b0e0: 745f 6d6f 6c65 6375 6c65 7320 3d20 6761  t_molecules = ga
-0001b0f0: 7468 6572 285b 6174 6f6d 5f66 6561 742c  ther([atom_feat,
-0001b100: 2061 746f 6d5f 7370 6c69 745d 290a 2020   atom_split]).  
-0001b110: 2020 3e3e 3e20 7072 696e 7428 6f75 7470    >>> print(outp
-0001b120: 7574 5f6d 6f6c 6563 756c 6573 2e73 6861  ut_molecules.sha
-0001b130: 7065 290a 2020 2020 746f 7263 682e 5369  pe).    torch.Si
-0001b140: 7a65 285b 322c 2038 5d29 0a0a 2020 2020  ze([2, 8])..    
-0001b150: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-0001b160: 6e69 745f 5f28 7365 6c66 2c0a 2020 2020  nit__(self,.    
-0001b170: 2020 2020 2020 2020 2020 2020 204d 3a20               M: 
-0001b180: 696e 742c 0a20 2020 2020 2020 2020 2020  int,.           
-0001b190: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
-0001b1a0: 3a20 696e 742c 0a20 2020 2020 2020 2020  : int,.         
-0001b1b0: 2020 2020 2020 2020 6e5f 6869 6464 656e          n_hidden
-0001b1c0: 3a20 696e 7420 3d20 3130 302c 0a20 2020  : int = 100,.   
-0001b1d0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0001b1e0: 6974 3d27 6f72 7468 6f67 6f6e 616c 272c  it='orthogonal',
-0001b1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b200: 2020 2a2a 6b77 6172 6773 293a 0a0a 2020    **kwargs):..  
-0001b210: 2020 2020 2020 7375 7065 7228 5365 7447        super(SetG
-0001b220: 6174 6865 722c 2073 656c 6629 2e5f 5f69  ather, self).__i
-0001b230: 6e69 745f 5f28 2a2a 6b77 6172 6773 290a  nit__(**kwargs).
-0001b240: 2020 2020 2020 2020 7365 6c66 2e4d 203d          self.M =
-0001b250: 204d 0a20 2020 2020 2020 2073 656c 662e   M.        self.
-0001b260: 6261 7463 685f 7369 7a65 203d 2062 6174  batch_size = bat
-0001b270: 6368 5f73 697a 650a 2020 2020 2020 2020  ch_size.        
-0001b280: 7365 6c66 2e6e 5f68 6964 6465 6e20 3d20  self.n_hidden = 
-0001b290: 6e5f 6869 6464 656e 0a20 2020 2020 2020  n_hidden.       
-0001b2a0: 2073 656c 662e 696e 6974 203d 2069 6e69   self.init = ini
-0001b2b0: 740a 0a20 2020 2020 2020 2073 656c 662e  t..        self.
-0001b2c0: 5520 3d20 6e6e 2e50 6172 616d 6574 6572  U = nn.Parameter
-0001b2d0: 280a 2020 2020 2020 2020 2020 2020 746f  (.            to
-0001b2e0: 7263 682e 5465 6e73 6f72 2832 202a 2073  rch.Tensor(2 * s
-0001b2f0: 656c 662e 6e5f 6869 6464 656e 2c20 3420  elf.n_hidden, 4 
-0001b300: 2a20 7365 6c66 2e6e 5f68 6964 6465 6e29  * self.n_hidden)
-0001b310: 2e6e 6f72 6d61 6c5f 286d 6561 6e3d 302e  .normal_(mean=0.
-0001b320: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab00: 2020 2020 2074 6f72 6368 2e54 656e 736f       torch.Tenso
+0001ab10: 725d 5d29 202d 3e20 4f70 7469 6f6e 616c  r]]) -> Optional
+0001ab20: 5b74 6f72 6368 2e54 656e 736f 725d 3a0a  [torch.Tensor]:.
+0001ab30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ab40: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0001ab50: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0001ab60: 2d0a 2020 2020 2020 2020 696e 7075 7473  -.        inputs
+0001ab70: 3a20 5365 7175 656e 6365 5b55 6e69 6f6e  : Sequence[Union
+0001ab80: 5b41 7272 6179 4c69 6b65 2c20 746f 7263  [ArrayLike, torc
+0001ab90: 682e 5465 6e73 6f72 5d5d 0a20 2020 2020  h.Tensor]].     
+0001aba0: 2020 2020 2020 2054 6865 2069 6e69 7469         The initi
+0001abb0: 616c 2069 6e70 7574 206c 6179 6572 732e  al input layers.
+0001abc0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+0001abd0: 206c 656e 6774 6820 6d75 7374 2062 6520   length must be 
+0001abe0: 7468 6520 7361 6d65 2061 7320 6073 656c  the same as `sel
+0001abf0: 662e 6e75 6d5f 696e 7075 7473 602e 0a0a  f.num_inputs`...
+0001ac00: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+0001ac10: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+0001ac20: 2020 2020 2020 2020 6f75 745f 7465 6e73          out_tens
+0001ac30: 6f72 3a20 746f 7263 682e 5465 6e73 6f72  or: torch.Tensor
+0001ac40: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
+0001ac50: 2020 2020 2054 6865 2074 656e 736f 7220       The tensor 
+0001ac60: 636f 6e74 6169 6e69 6e67 2074 6865 2077  containing the w
+0001ac70: 6569 6768 7465 6420 6c69 6e65 6172 2063  eighted linear c
+0001ac80: 6f6d 6269 6e61 7469 6f6e 2e0a 2020 2020  ombination..    
+0001ac90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001aca0: 6f75 745f 7465 6e73 6f72 203d 204e 6f6e  out_tensor = Non
+0001acb0: 650a 2020 2020 2020 2020 666f 7220 696e  e.        for in
+0001acc0: 5f74 656e 736f 722c 2077 2069 6e20 7a69  _tensor, w in zi
+0001acd0: 7028 696e 7075 7473 2c20 7365 6c66 2e69  p(inputs, self.i
+0001ace0: 6e70 7574 5f77 6569 6768 7473 293a 0a20  nput_weights):. 
+0001acf0: 2020 2020 2020 2020 2020 2069 6e5f 7465             in_te
+0001ad00: 6e73 6f72 203d 2074 6f72 6368 2e46 6c6f  nsor = torch.Flo
+0001ad10: 6174 5465 6e73 6f72 2869 6e5f 7465 6e73  atTensor(in_tens
+0001ad20: 6f72 290a 2020 2020 2020 2020 2020 2020  or).            
+0001ad30: 6966 206f 7574 5f74 656e 736f 7220 6973  if out_tensor is
+0001ad40: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001ad50: 2020 2020 2020 206f 7574 5f74 656e 736f         out_tenso
+0001ad60: 7220 3d20 7720 2a20 696e 5f74 656e 736f  r = w * in_tenso
+0001ad70: 720a 2020 2020 2020 2020 2020 2020 656c  r.            el
+0001ad80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001ad90: 2020 2020 6f75 745f 7465 6e73 6f72 202b      out_tensor +
+0001ada0: 3d20 7720 2a20 696e 5f74 656e 736f 720a  = w * in_tensor.
+0001adb0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0001adc0: 7574 5f74 656e 736f 720a 0a0a 636c 6173  ut_tensor...clas
+0001add0: 7320 5365 7447 6174 6865 7228 6e6e 2e4d  s SetGather(nn.M
+0001ade0: 6f64 756c 6529 3a0a 2020 2020 2222 2273  odule):.    """s
+0001adf0: 6574 3273 6574 2067 6174 6865 7220 6c61  et2set gather la
+0001ae00: 7965 7220 666f 7220 6772 6170 682d 6261  yer for graph-ba
+0001ae10: 7365 6420 6d6f 6465 6c0a 0a20 2020 204d  sed model..    M
+0001ae20: 6f64 656c 7320 7573 696e 6720 7468 6973  odels using this
+0001ae30: 206c 6179 6572 206d 7573 7420 7365 7420   layer must set 
+0001ae40: 6070 6164 5f62 6174 6368 6573 3d54 7275  `pad_batches=Tru
+0001ae50: 6560 0a0a 2020 2020 546f 7263 6820 4571  e`..    Torch Eq
+0001ae60: 7569 7661 6c65 6e74 206f 6620 4b65 7261  uivalent of Kera
+0001ae70: 7320 5365 7447 6174 6865 7220 6c61 7965  s SetGather laye
+0001ae80: 720a 0a20 2020 2050 6172 616d 6574 6572  r..    Parameter
+0001ae90: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+0001aea0: 0a20 2020 204d 3a20 696e 740a 2020 2020  .    M: int.    
+0001aeb0: 2020 2020 4e75 6d62 6572 206f 6620 4c53      Number of LS
+0001aec0: 544d 2073 7465 7073 0a20 2020 2062 6174  TM steps.    bat
+0001aed0: 6368 5f73 697a 653a 2069 6e74 0a20 2020  ch_size: int.   
+0001aee0: 2020 2020 204e 756d 6265 7220 6f66 2073       Number of s
+0001aef0: 616d 706c 6573 2069 6e20 6120 6261 7463  amples in a batc
+0001af00: 6828 616c 6c20 6261 7463 6865 7320 6d75  h(all batches mu
+0001af10: 7374 2068 6176 6520 7361 6d65 2073 697a  st have same siz
+0001af20: 6529 0a20 2020 206e 5f68 6964 6465 6e3a  e).    n_hidden:
+0001af30: 2069 6e74 2c20 6f70 7469 6f6e 616c 0a20   int, optional. 
+0001af40: 2020 2020 2020 206e 756d 6265 7220 6f66         number of
+0001af50: 2068 6964 6465 6e20 756e 6974 7320 696e   hidden units in
+0001af60: 2074 6865 2070 6173 7369 6e67 2070 6861   the passing pha
+0001af70: 7365 0a0a 2020 2020 4578 616d 706c 6573  se..    Examples
+0001af80: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+0001af90: 2020 3e3e 3e20 696d 706f 7274 2064 6565    >>> import dee
+0001afa0: 7063 6865 6d20 6173 2064 630a 2020 2020  pchem as dc.    
+0001afb0: 3e3e 3e20 696d 706f 7274 206e 756d 7079  >>> import numpy
+0001afc0: 2061 7320 6e70 0a20 2020 203e 3e3e 2066   as np.    >>> f
+0001afd0: 726f 6d20 6465 6570 6368 656d 2e6d 6f64  rom deepchem.mod
+0001afe0: 656c 732e 746f 7263 685f 6d6f 6465 6c73  els.torch_models
+0001aff0: 2069 6d70 6f72 7420 6c61 7965 7273 0a20   import layers. 
+0001b000: 2020 203e 3e3e 2074 6f74 616c 5f6e 5f61     >>> total_n_a
+0001b010: 746f 6d73 203d 2034 0a20 2020 203e 3e3e  toms = 4.    >>>
+0001b020: 206e 5f61 746f 6d5f 6665 6174 203d 2034   n_atom_feat = 4
+0001b030: 0a20 2020 203e 3e3e 2061 746f 6d5f 6665  .    >>> atom_fe
+0001b040: 6174 203d 206e 702e 7261 6e64 6f6d 2e72  at = np.random.r
+0001b050: 616e 6428 746f 7461 6c5f 6e5f 6174 6f6d  and(total_n_atom
+0001b060: 732c 206e 5f61 746f 6d5f 6665 6174 290a  s, n_atom_feat).
+0001b070: 2020 2020 3e3e 3e20 6174 6f6d 5f73 706c      >>> atom_spl
+0001b080: 6974 203d 206e 702e 6172 7261 7928 5b30  it = np.array([0
+0001b090: 2c20 302c 2031 2c20 315d 2c20 6474 7970  , 0, 1, 1], dtyp
+0001b0a0: 653d 6e70 2e69 6e74 3332 290a 2020 2020  e=np.int32).    
+0001b0b0: 3e3e 3e20 6761 7468 6572 203d 206c 6179  >>> gather = lay
+0001b0c0: 6572 732e 5365 7447 6174 6865 7228 322c  ers.SetGather(2,
+0001b0d0: 2032 2c20 6e5f 6869 6464 656e 3d34 290a   2, n_hidden=4).
+0001b0e0: 2020 2020 3e3e 3e20 6f75 7470 7574 5f6d      >>> output_m
+0001b0f0: 6f6c 6563 756c 6573 203d 2067 6174 6865  olecules = gathe
+0001b100: 7228 5b61 746f 6d5f 6665 6174 2c20 6174  r([atom_feat, at
+0001b110: 6f6d 5f73 706c 6974 5d29 0a20 2020 203e  om_split]).    >
+0001b120: 3e3e 2070 7269 6e74 286f 7574 7075 745f  >> print(output_
+0001b130: 6d6f 6c65 6375 6c65 732e 7368 6170 6529  molecules.shape)
+0001b140: 0a20 2020 2074 6f72 6368 2e53 697a 6528  .    torch.Size(
+0001b150: 5b32 2c20 385d 290a 0a20 2020 2022 2222  [2, 8])..    """
+0001b160: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0001b170: 5f5f 2873 656c 662c 0a20 2020 2020 2020  __(self,.       
+0001b180: 2020 2020 2020 2020 2020 4d3a 2069 6e74            M: int
+0001b190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b1a0: 2020 2062 6174 6368 5f73 697a 653a 2069     batch_size: i
+0001b1b0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+0001b1c0: 2020 2020 206e 5f68 6964 6465 6e3a 2069       n_hidden: i
+0001b1d0: 6e74 203d 2031 3030 2c0a 2020 2020 2020  nt = 100,.      
+0001b1e0: 2020 2020 2020 2020 2020 2069 6e69 743d             init=
+0001b1f0: 276f 7274 686f 676f 6e61 6c27 2c0a 2020  'orthogonal',.  
+0001b200: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0001b210: 2a6b 7761 7267 7329 3a0a 0a20 2020 2020  *kwargs):..     
+0001b220: 2020 2073 7570 6572 2853 6574 4761 7468     super(SetGath
+0001b230: 6572 2c20 7365 6c66 292e 5f5f 696e 6974  er, self).__init
+0001b240: 5f5f 282a 2a6b 7761 7267 7329 0a20 2020  __(**kwargs).   
+0001b250: 2020 2020 2073 656c 662e 4d20 3d20 4d0a       self.M = M.
+0001b260: 2020 2020 2020 2020 7365 6c66 2e62 6174          self.bat
+0001b270: 6368 5f73 697a 6520 3d20 6261 7463 685f  ch_size = batch_
+0001b280: 7369 7a65 0a20 2020 2020 2020 2073 656c  size.        sel
+0001b290: 662e 6e5f 6869 6464 656e 203d 206e 5f68  f.n_hidden = n_h
+0001b2a0: 6964 6465 6e0a 2020 2020 2020 2020 7365  idden.        se
+0001b2b0: 6c66 2e69 6e69 7420 3d20 696e 6974 0a0a  lf.init = init..
+0001b2c0: 2020 2020 2020 2020 7365 6c66 2e55 203d          self.U =
+0001b2d0: 206e 6e2e 5061 7261 6d65 7465 7228 0a20   nn.Parameter(. 
+0001b2e0: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+0001b2f0: 2e54 656e 736f 7228 3220 2a20 7365 6c66  .Tensor(2 * self
+0001b300: 2e6e 5f68 6964 6465 6e2c 2034 202a 2073  .n_hidden, 4 * s
+0001b310: 656c 662e 6e5f 6869 6464 656e 292e 6e6f  elf.n_hidden).no
+0001b320: 726d 616c 5f28 6d65 616e 3d30 2e30 2c0a  rmal_(mean=0.0,.
 0001b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b360: 2020 2020 2020 2020 2020 7374 643d 302e            std=0.
-0001b370: 3129 290a 2020 2020 2020 2020 7365 6c66  1)).        self
-0001b380: 2e62 203d 206e 6e2e 5061 7261 6d65 7465  .b = nn.Paramete
-0001b390: 7228 0a20 2020 2020 2020 2020 2020 2074  r(.            t
-0001b3a0: 6f72 6368 2e63 6174 2828 746f 7263 682e  orch.cat((torch.
-0001b3b0: 7a65 726f 7328 7365 6c66 2e6e 5f68 6964  zeros(self.n_hid
-0001b3c0: 6465 6e29 2c20 746f 7263 682e 6f6e 6573  den), torch.ones
-0001b3d0: 2873 656c 662e 6e5f 6869 6464 656e 292c  (self.n_hidden),
-0001b3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b3f0: 2020 2020 2020 2020 746f 7263 682e 7a65          torch.ze
-0001b400: 726f 7328 7365 6c66 2e6e 5f68 6964 6465  ros(self.n_hidde
-0001b410: 6e29 2c20 746f 7263 682e 7a65 726f 7328  n), torch.zeros(
-0001b420: 7365 6c66 2e6e 5f68 6964 6465 6e29 2929  self.n_hidden)))
-0001b430: 290a 2020 2020 2020 2020 7365 6c66 2e62  ).        self.b
-0001b440: 7569 6c74 203d 2054 7275 650a 0a20 2020  uilt = True..   
-0001b450: 2064 6566 205f 5f72 6570 725f 5f28 7365   def __repr__(se
-0001b460: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
-0001b470: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-0001b480: 2020 2020 2020 2020 2066 277b 7365 6c66           f'{self
-0001b490: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-0001b4a0: 655f 5f7d 284d 3d7b 7365 6c66 2e4d 7d2c  e__}(M={self.M},
-0001b4b0: 2062 6174 6368 5f73 697a 653d 7b73 656c   batch_size={sel
-0001b4c0: 662e 6261 7463 685f 7369 7a65 7d2c 206e  f.batch_size}, n
-0001b4d0: 5f68 6964 6465 6e3d 7b73 656c 662e 6e5f  _hidden={self.n_
-0001b4e0: 6869 6464 656e 7d2c 2069 6e69 743d 7b73  hidden}, init={s
-0001b4f0: 656c 662e 696e 6974 7d29 270a 2020 2020  elf.init})'.    
-0001b500: 2020 2020 290a 0a20 2020 2064 6566 2066      )..    def f
-0001b510: 6f72 7761 7264 2873 656c 662c 2069 6e70  orward(self, inp
-0001b520: 7574 733a 204c 6973 7429 202d 3e20 746f  uts: List) -> to
-0001b530: 7263 682e 5465 6e73 6f72 3a0a 2020 2020  rch.Tensor:.    
-0001b540: 2020 2020 2222 2250 6572 666f 726d 204d      """Perform M
-0001b550: 2073 7465 7073 206f 6620 7365 7432 7365   steps of set2se
-0001b560: 7420 6761 7468 6572 2c0a 0a20 2020 2020  t gather,..     
-0001b570: 2020 2044 6574 6169 6c65 6420 6465 7363     Detailed desc
-0001b580: 7269 7074 696f 6e73 2069 6e3a 2068 7474  riptions in: htt
-0001b590: 7073 3a2f 2f61 7278 6976 2e6f 7267 2f61  ps://arxiv.org/a
-0001b5a0: 6273 2f31 3531 312e 3036 3339 310a 0a20  bs/1511.06391.. 
-0001b5b0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0001b5c0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0001b5d0: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e70  ----.        inp
-0001b5e0: 7574 733a 204c 6973 740a 2020 2020 2020  uts: List.      
-0001b5f0: 2020 2020 2020 5468 6973 2063 6f6e 7461        This conta
-0001b600: 696e 7320 7477 6f20 656c 656d 656e 7473  ins two elements
-0001b610: 2e0a 2020 2020 2020 2020 2020 2020 6174  ..            at
-0001b620: 6f6d 5f66 6561 7475 7265 733a 206e 702e  om_features: np.
-0001b630: 6e64 6172 7261 790a 2020 2020 2020 2020  ndarray.        
-0001b640: 2020 2020 6174 6f6d 5f73 706c 6974 3a20      atom_split: 
-0001b650: 6e70 2e6e 6461 7272 6179 0a0a 2020 2020  np.ndarray..    
-0001b660: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-0001b670: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-0001b680: 2020 2020 715f 7374 6172 3a20 746f 7263      q_star: torc
-0001b690: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-0001b6a0: 2020 2020 2046 696e 616c 2073 7461 7465       Final state
-0001b6b0: 206f 6620 7468 6520 6d6f 6465 6c20 6166   of the model af
-0001b6c0: 7465 7220 616c 6c20 4d20 7374 6570 732e  ter all M steps.
-0001b6d0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0001b6e0: 2020 2020 2020 6174 6f6d 5f66 6561 7475        atom_featu
-0001b6f0: 7265 732c 2061 746f 6d5f 7370 6c69 7420  res, atom_split 
-0001b700: 3d20 696e 7075 7473 0a20 2020 2020 2020  = inputs.       
-0001b710: 2063 203d 2074 6f72 6368 2e7a 6572 6f73   c = torch.zeros
-0001b720: 2828 7365 6c66 2e62 6174 6368 5f73 697a  ((self.batch_siz
-0001b730: 652c 2073 656c 662e 6e5f 6869 6464 656e  e, self.n_hidden
-0001b740: 2929 0a20 2020 2020 2020 2068 203d 2074  )).        h = t
-0001b750: 6f72 6368 2e7a 6572 6f73 2828 7365 6c66  orch.zeros((self
-0001b760: 2e62 6174 6368 5f73 697a 652c 2073 656c  .batch_size, sel
-0001b770: 662e 6e5f 6869 6464 656e 2929 0a0a 2020  f.n_hidden))..  
-0001b780: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-0001b790: 616e 6765 2873 656c 662e 4d29 3a0a 2020  ange(self.M):.  
-0001b7a0: 2020 2020 2020 2020 2020 715f 6578 7061            q_expa
-0001b7b0: 6e64 6564 203d 2068 5b61 746f 6d5f 7370  nded = h[atom_sp
-0001b7c0: 6c69 745d 0a20 2020 2020 2020 2020 2020  lit].           
-0001b7d0: 2065 203d 2028 746f 7263 682e 6672 6f6d   e = (torch.from
-0001b7e0: 5f6e 756d 7079 2861 746f 6d5f 6665 6174  _numpy(atom_feat
-0001b7f0: 7572 6573 2920 2a20 715f 6578 7061 6e64  ures) * q_expand
-0001b800: 6564 292e 7375 6d28 6469 6d3d 2d31 290a  ed).sum(dim=-1).
-0001b810: 2020 2020 2020 2020 2020 2020 655f 6d6f              e_mo
-0001b820: 6c73 203d 2073 656c 662e 5f64 796e 616d  ls = self._dynam
-0001b830: 6963 5f70 6172 7469 7469 6f6e 2865 2c20  ic_partition(e, 
-0001b840: 6174 6f6d 5f73 706c 6974 2c20 7365 6c66  atom_split, self
-0001b850: 2e62 6174 6368 5f73 697a 6529 0a0a 2020  .batch_size)..  
-0001b860: 2020 2020 2020 2020 2020 2320 4164 6420            # Add 
-0001b870: 616e 6f74 6865 7220 7661 6c75 6528 7e2d  another value(~-
-0001b880: 496e 6629 2074 6f20 7072 6576 656e 7420  Inf) to prevent 
-0001b890: 6572 726f 7220 696e 2073 6f66 746d 6178  error in softmax
-0001b8a0: 0a20 2020 2020 2020 2020 2020 2065 5f6d  .            e_m
-0001b8b0: 6f6c 7320 3d20 5b0a 2020 2020 2020 2020  ols = [.        
-0001b8c0: 2020 2020 2020 2020 746f 7263 682e 6361          torch.ca
-0001b8d0: 7428 5b65 5f6d 6f6c 2c20 746f 7263 682e  t([e_mol, torch.
-0001b8e0: 7465 6e73 6f72 285b 2d31 3030 302e 5d29  tensor([-1000.])
-0001b8f0: 5d2c 2064 696d 3d30 290a 2020 2020 2020  ], dim=0).      
-0001b900: 2020 2020 2020 2020 2020 666f 7220 655f            for e_
-0001b910: 6d6f 6c20 696e 2065 5f6d 6f6c 730a 2020  mol in e_mols.  
-0001b920: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-0001b930: 2020 2020 2020 2020 6120 3d20 746f 7263          a = torc
-0001b940: 682e 6361 7428 5b0a 2020 2020 2020 2020  h.cat([.        
-0001b950: 2020 2020 2020 2020 746f 7263 682e 6e6e          torch.nn
-0001b960: 2e66 756e 6374 696f 6e61 6c2e 736f 6674  .functional.soft
-0001b970: 6d61 7828 655f 6d6f 6c5b 3a2d 315d 2c20  max(e_mol[:-1], 
-0001b980: 6469 6d3d 3029 0a20 2020 2020 2020 2020  dim=0).         
-0001b990: 2020 2020 2020 2066 6f72 2065 5f6d 6f6c         for e_mol
-0001b9a0: 2069 6e20 655f 6d6f 6c73 0a20 2020 2020   in e_mols.     
-0001b9b0: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
-0001b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9d0: 2020 2020 6469 6d3d 3029 0a0a 2020 2020      dim=0)..    
-0001b9e0: 2020 2020 2020 2020 7220 3d20 7363 6174          r = scat
-0001b9f0: 7465 7228 746f 7263 682e 7265 7368 6170  ter(torch.reshap
-0001ba00: 6528 612c 205b 2d31 2c20 315d 2920 2a20  e(a, [-1, 1]) * 
-0001ba10: 6174 6f6d 5f66 6561 7475 7265 732c 0a20  atom_features,. 
-0001ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba30: 2020 2020 2020 2074 6f72 6368 2e66 726f         torch.fro
-0001ba40: 6d5f 6e75 6d70 7928 6174 6f6d 5f73 706c  m_numpy(atom_spl
-0001ba50: 6974 292e 6c6f 6e67 2829 2c0a 2020 2020  it).long(),.    
-0001ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba70: 2020 2020 6469 6d3d 3029 0a20 2020 2020      dim=0).     
-0001ba80: 2020 2020 2020 2023 204d 6f64 656c 2075         # Model u
-0001ba90: 7369 6e67 2074 6869 7320 6c61 7965 7220  sing this layer 
-0001baa0: 6d75 7374 2073 6574 2060 7061 645f 6261  must set `pad_ba
-0001bab0: 7463 6865 733d 5472 7565 600a 2020 2020  tches=True`.    
-0001bac0: 2020 2020 2020 2020 715f 7374 6172 203d          q_star =
-0001bad0: 2074 6f72 6368 2e63 6174 285b 682c 2072   torch.cat([h, r
-0001bae0: 5d2c 2064 696d 3d31 290a 2020 2020 2020  ], dim=1).      
-0001baf0: 2020 2020 2020 682c 2063 203d 2073 656c        h, c = sel
-0001bb00: 662e 5f4c 5354 4d53 7465 7028 715f 7374  f._LSTMStep(q_st
-0001bb10: 6172 2c20 6329 0a20 2020 2020 2020 2072  ar, c).        r
-0001bb20: 6574 7572 6e20 715f 7374 6172 0a0a 2020  eturn q_star..  
-0001bb30: 2020 6465 6620 5f4c 5354 4d53 7465 7028    def _LSTMStep(
-0001bb40: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-0001bb50: 2020 2020 2020 2020 683a 2074 6f72 6368          h: torch
-0001bb60: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
-0001bb70: 2020 2020 2020 2020 2020 2063 3a20 746f             c: to
-0001bb80: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
-0001bb90: 2020 2020 2020 2020 2020 2020 2020 783d                x=
-0001bba0: 4e6f 6e65 2920 2d3e 2054 7570 6c65 5b74  None) -> Tuple[t
-0001bbb0: 6f72 6368 2e54 656e 736f 722c 2074 6f72  orch.Tensor, tor
-0001bbc0: 6368 2e54 656e 736f 725d 3a0a 2020 2020  ch.Tensor]:.    
-0001bbd0: 2020 2020 2222 2254 6869 7320 6d65 7468      """This meth
-0001bbe0: 6f72 6420 7065 7266 6f72 6d73 2061 2073  ord performs a s
-0001bbf0: 696e 676c 6520 7374 6570 206f 6620 6120  ingle step of a 
-0001bc00: 4c6f 6e67 2053 686f 7274 2d54 6572 6d20  Long Short-Term 
-0001bc10: 4d65 6d6f 7279 2028 4c53 544d 2920 6365  Memory (LSTM) ce
-0001bc20: 6c6c 2c0a 0a20 2020 2020 2020 2050 6172  ll,..        Par
-0001bc30: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-0001bc40: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-0001bc50: 2020 2068 3a20 746f 7263 682e 5465 6e73     h: torch.Tens
-0001bc60: 6f72 0a20 2020 2020 2020 2020 2020 2054  or.            T
-0001bc70: 6865 2068 6964 6465 6e20 7374 6174 6520  he hidden state 
-0001bc80: 6f66 2074 6865 204c 5354 4d20 6365 6c6c  of the LSTM cell
-0001bc90: 2e0a 2020 2020 2020 2020 633a 2074 6f72  ..        c: tor
-0001bca0: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-0001bcb0: 2020 2020 2020 5468 6520 6365 6c6c 2073        The cell s
-0001bcc0: 7461 7465 206f 6620 7468 6520 4c53 544d  tate of the LSTM
-0001bcd0: 2063 656c 6c2e 0a0a 2020 2020 2020 2020   cell...        
-0001bce0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-0001bcf0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0001bd00: 685f 6f75 743a 2074 6f72 6368 2e54 656e  h_out: torch.Ten
-0001bd10: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-0001bd20: 5468 6520 7570 6461 7465 6420 6869 6464  The updated hidd
-0001bd30: 656e 2073 7461 7465 206f 6620 7468 6520  en state of the 
-0001bd40: 4c53 544d 2063 656c 6c2e 0a20 2020 2020  LSTM cell..     
-0001bd50: 2020 2063 5f6f 7574 3a20 746f 7263 682e     c_out: torch.
-0001bd60: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-0001bd70: 2020 2054 6865 2075 7064 6174 6564 2063     The updated c
-0001bd80: 656c 6c20 7374 6174 6520 6f66 2074 6865  ell state of the
-0001bd90: 204c 5354 4d20 6365 6c6c 2e0a 0a20 2020   LSTM cell...   
-0001bda0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001bdb0: 2023 207a 203d 2074 6f72 6368 2e6d 6d28   # z = torch.mm(
-0001bdc0: 682c 2073 656c 662e 5529 202b 2073 656c  h, self.U) + sel
-0001bdd0: 662e 620a 2020 2020 2020 2020 7a20 3d20  f.b.        z = 
-0001bde0: 462e 6c69 6e65 6172 2868 2e66 6c6f 6174  F.linear(h.float
-0001bdf0: 2829 2e64 6574 6163 6828 292c 0a20 2020  ().detach(),.   
-0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be10: 2020 7365 6c66 2e55 2e66 6c6f 6174 2829    self.U.float()
-0001be20: 2e54 2e64 6574 6163 6828 292c 2073 656c  .T.detach(), sel
-0001be30: 662e 622e 6465 7461 6368 2829 290a 2020  f.b.detach()).  
-0001be40: 2020 2020 2020 6920 3d20 746f 7263 682e        i = torch.
-0001be50: 7369 676d 6f69 6428 7a5b 3a2c 203a 7365  sigmoid(z[:, :se
-0001be60: 6c66 2e6e 5f68 6964 6465 6e5d 290a 2020  lf.n_hidden]).  
-0001be70: 2020 2020 2020 6620 3d20 746f 7263 682e        f = torch.
-0001be80: 7369 676d 6f69 6428 7a5b 3a2c 2073 656c  sigmoid(z[:, sel
-0001be90: 662e 6e5f 6869 6464 656e 3a32 202a 2073  f.n_hidden:2 * s
-0001bea0: 656c 662e 6e5f 6869 6464 656e 5d29 0a20  elf.n_hidden]). 
-0001beb0: 2020 2020 2020 206f 203d 2074 6f72 6368         o = torch
-0001bec0: 2e73 6967 6d6f 6964 287a 5b3a 2c20 3220  .sigmoid(z[:, 2 
-0001bed0: 2a20 7365 6c66 2e6e 5f68 6964 6465 6e3a  * self.n_hidden:
-0001bee0: 3320 2a20 7365 6c66 2e6e 5f68 6964 6465  3 * self.n_hidde
-0001bef0: 6e5d 290a 2020 2020 2020 2020 7a33 203d  n]).        z3 =
-0001bf00: 207a 5b3a 2c20 3320 2a20 7365 6c66 2e6e   z[:, 3 * self.n
-0001bf10: 5f68 6964 6465 6e3a 5d0a 2020 2020 2020  _hidden:].      
-0001bf20: 2020 635f 6f75 7420 3d20 6620 2a20 6320    c_out = f * c 
-0001bf30: 2b20 6920 2a20 746f 7263 682e 7461 6e68  + i * torch.tanh
-0001bf40: 287a 3329 0a20 2020 2020 2020 2068 5f6f  (z3).        h_o
-0001bf50: 7574 203d 206f 202a 2074 6f72 6368 2e74  ut = o * torch.t
-0001bf60: 616e 6828 635f 6f75 7429 0a20 2020 2020  anh(c_out).     
-0001bf70: 2020 2072 6574 7572 6e20 685f 6f75 742c     return h_out,
-0001bf80: 2063 5f6f 7574 0a0a 2020 2020 6465 6620   c_out..    def 
-0001bf90: 5f64 796e 616d 6963 5f70 6172 7469 7469  _dynamic_partiti
-0001bfa0: 6f6e 2873 656c 662c 2069 6e70 7574 5f74  on(self, input_t
-0001bfb0: 656e 736f 723a 2074 6f72 6368 2e54 656e  ensor: torch.Ten
-0001bfc0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
-0001bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfe0: 7061 7274 6974 696f 6e5f 7465 6e73 6f72  partition_tensor
-0001bff0: 3a20 6e70 2e6e 6461 7272 6179 2c0a 2020  : np.ndarray,.  
-0001c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c010: 2020 2020 2020 2020 206e 756d 5f70 6172           num_par
-0001c020: 7469 7469 6f6e 733a 2069 6e74 2920 2d3e  titions: int) ->
-0001c030: 204c 6973 745b 746f 7263 682e 5465 6e73   List[torch.Tens
-0001c040: 6f72 5d3a 0a20 2020 2020 2020 2022 2222  or]:.        """
-0001c050: 5061 7274 6974 696f 6e73 2060 6461 7461  Partitions `data
-0001c060: 6020 696e 746f 2060 6e75 6d5f 7061 7274  ` into `num_part
-0001c070: 6974 696f 6e73 6020 7465 6e73 6f72 7320  itions` tensors 
-0001c080: 7573 696e 6720 696e 6469 6365 7320 6672  using indices fr
-0001c090: 6f6d 2060 7061 7274 6974 696f 6e73 602e  om `partitions`.
-0001c0a0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0001c0b0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0001c0c0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0001c0d0: 696e 7075 745f 7465 6e73 6f72 3a20 746f  input_tensor: to
-0001c0e0: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-0001c0f0: 2020 2020 2020 2054 6865 2074 656e 736f         The tenso
-0001c100: 7220 746f 2062 6520 7061 7274 6974 696f  r to be partitio
-0001c110: 6e65 642e 0a20 2020 2020 2020 2070 6172  ned..        par
-0001c120: 7469 7469 6f6e 5f74 656e 736f 723a 206e  tition_tensor: n
-0001c130: 702e 6e64 6172 7261 790a 2020 2020 2020  p.ndarray.      
-0001c140: 2020 2020 2020 4120 312d 4420 7465 6e73        A 1-D tens
-0001c150: 6f72 2077 686f 7365 2073 697a 6520 6973  or whose size is
-0001c160: 2065 7175 616c 2074 6f20 7468 6520 6669   equal to the fi
-0001c170: 7273 7420 6469 6d65 6e73 696f 6e20 6f66  rst dimension of
-0001c180: 2060 696e 7075 745f 7465 6e73 6f72 602e   `input_tensor`.
-0001c190: 0a20 2020 2020 2020 206e 756d 5f70 6172  .        num_par
-0001c1a0: 7469 7469 6f6e 733a 2069 6e74 0a20 2020  titions: int.   
-0001c1b0: 2020 2020 2020 2020 2054 6865 206e 756d           The num
-0001c1c0: 6265 7220 6f66 2070 6172 7469 7469 6f6e  ber of partition
-0001c1d0: 7320 746f 206f 7574 7075 742e 0a0a 2020  s to output...  
-0001c1e0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-0001c1f0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-0001c200: 2020 2020 2020 7061 7274 6974 696f 6e73        partitions
-0001c210: 3a20 4c69 7374 5b74 6f72 6368 2e54 656e  : List[torch.Ten
-0001c220: 736f 725d 0a20 2020 2020 2020 2020 2020  sor].           
-0001c230: 2041 206c 6973 7420 6f66 2060 6e75 6d5f   A list of `num_
-0001c240: 7061 7274 6974 696f 6e73 6020 6054 656e  partitions` `Ten
-0001c250: 736f 7260 206f 626a 6563 7473 2077 6974  sor` objects wit
-0001c260: 6820 7468 6520 7361 6d65 2074 7970 6520  h the same type 
-0001c270: 6173 2060 6461 7461 602e 0a0a 2020 2020  as `data`...    
-0001c280: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001c290: 2320 6372 6561 7465 2061 2062 6f6f 6c65  # create a boole
-0001c2a0: 616e 206d 6173 6b20 666f 7220 6561 6368  an mask for each
-0001c2b0: 2070 6172 7469 7469 6f6e 0a20 2020 2020   partition.     
-0001c2c0: 2020 2070 6172 7469 7469 6f6e 5f6d 6173     partition_mas
-0001c2d0: 6b73 203d 205b 7061 7274 6974 696f 6e5f  ks = [partition_
-0001c2e0: 7465 6e73 6f72 203d 3d20 6920 666f 7220  tensor == i for 
-0001c2f0: 6920 696e 2072 616e 6765 286e 756d 5f70  i in range(num_p
-0001c300: 6172 7469 7469 6f6e 7329 5d0a 0a20 2020  artitions)]..   
-0001c310: 2020 2020 2023 2070 6172 7469 7469 6f6e       # partition
-0001c320: 2074 6865 2069 6e70 7574 2074 656e 736f   the input tenso
-0001c330: 7220 7573 696e 6720 7468 6520 6d61 736b  r using the mask
-0001c340: 730a 2020 2020 2020 2020 7061 7274 6974  s.        partit
-0001c350: 696f 6e73 203d 205b 696e 7075 745f 7465  ions = [input_te
-0001c360: 6e73 6f72 5b6d 6173 6b5d 2066 6f72 206d  nsor[mask] for m
-0001c370: 6173 6b20 696e 2070 6172 7469 7469 6f6e  ask in partition
-0001c380: 5f6d 6173 6b73 5d0a 0a20 2020 2020 2020  _masks]..       
-0001c390: 2072 6574 7572 6e20 7061 7274 6974 696f   return partitio
-0001c3a0: 6e73 0a0a 0a63 6c61 7373 2044 544e 4e45  ns...class DTNNE
-0001c3b0: 6d62 6564 6469 6e67 286e 6e2e 4d6f 6475  mbedding(nn.Modu
-0001c3c0: 6c65 293a 0a20 2020 2022 2222 4454 4e4e  le):.    """DTNN
-0001c3d0: 456d 6265 6464 696e 6720 6c61 7965 7220  Embedding layer 
-0001c3e0: 666f 7220 4454 4e4e 206d 6f64 656c 2e0a  for DTNN model..
-0001c3f0: 0a20 2020 2041 7373 6967 6e20 696e 6974  .    Assign init
-0001c400: 6961 6c20 6174 6f6d 6963 2064 6573 6372  ial atomic descr
-0001c410: 6970 746f 7273 2e20 5b31 5d5f 0a0a 2020  iptors. [1]_..  
-0001c420: 2020 5468 6973 206c 6179 6572 2063 7265    This layer cre
-0001c430: 6174 6573 2027 6e27 206e 756d 6265 7220  ates 'n' number 
-0001c440: 6f66 2065 6d62 6564 6469 6e67 7320 6173  of embeddings as
-0001c450: 2069 6e69 7469 616c 2061 746f 6d69 6320   initial atomic 
-0001c460: 6465 7363 7269 7074 6f72 732e 2041 6363  descriptors. Acc
-0001c470: 6f72 6469 6e67 2074 6f20 7468 6520 7265  ording to the re
-0001c480: 7175 6972 6564 2077 6569 6768 7420 696e  quired weight in
-0001c490: 6974 6961 6c69 7a65 7220 616e 6420 7065  itializer and pe
-0001c4a0: 7269 6f64 6963 5f74 6162 6c65 5f6c 656e  riodic_table_len
-0001c4b0: 6774 6820 2854 6f74 616c 206e 756d 6265  gth (Total numbe
-0001c4c0: 7220 6f66 2075 6e69 7175 6520 6174 6f6d  r of unique atom
-0001c4d0: 7329 2e0a 0a20 2020 2052 6566 6572 656e  s)...    Referen
-0001c4e0: 6365 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ces.    --------
-0001c4f0: 2d2d 0a20 2020 205b 315d 2053 6368 c3bc  --.    [1] Sch..
-0001c500: 7474 2c20 4b72 6973 746f 6620 542e 2c20  tt, Kristof T., 
-0001c510: 6574 2061 6c2e 2022 5175 616e 7475 6d2d  et al. "Quantum-
-0001c520: 6368 656d 6963 616c 2069 6e73 6967 6874  chemical insight
-0001c530: 7320 6672 6f6d 2064 6565 700a 2020 2020  s from deep.    
-0001c540: 2020 2020 7465 6e73 6f72 206e 6575 7261      tensor neura
-0001c550: 6c20 6e65 7477 6f72 6b73 2e22 204e 6174  l networks." Nat
-0001c560: 7572 6520 636f 6d6d 756e 6963 6174 696f  ure communicatio
-0001c570: 6e73 2038 2e31 2028 3230 3137 293a 2031  ns 8.1 (2017): 1
-0001c580: 2d38 2e0a 0a20 2020 2050 6172 616d 6574  -8...    Paramet
-0001c590: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-0001c5a0: 2d2d 0a20 2020 206e 5f65 6d62 6564 6469  --.    n_embeddi
-0001c5b0: 6e67 3a20 696e 742c 206f 7074 696f 6e61  ng: int, optiona
-0001c5c0: 6c0a 2020 2020 2020 2020 4e75 6d62 6572  l.        Number
-0001c5d0: 206f 6620 6665 6174 7572 6573 2066 6f72   of features for
-0001c5e0: 2065 6163 6820 6174 6f6d 0a20 2020 2070   each atom.    p
-0001c5f0: 6572 696f 6469 635f 7461 626c 655f 6c65  eriodic_table_le
-0001c600: 6e67 7468 3a20 696e 742c 206f 7074 696f  ngth: int, optio
-0001c610: 6e61 6c0a 2020 2020 2020 2020 4c65 6e67  nal.        Leng
-0001c620: 7468 206f 6620 656d 6265 6464 696e 672c  th of embedding,
-0001c630: 2038 333d 4269 0a20 2020 2069 6e69 7461   83=Bi.    inita
-0001c640: 6c69 7a65 723a 2073 7472 2c20 6f70 7469  lizer: str, opti
-0001c650: 6f6e 616c 0a20 2020 2020 2020 2057 6569  onal.        Wei
-0001c660: 6768 7420 696e 6974 6961 6c69 7a61 7469  ght initializati
-0001c670: 6f6e 2066 6f72 2066 696c 7465 7273 2e0a  on for filters..
-0001c680: 2020 2020 2020 2020 4f70 7469 6f6e 733a          Options:
-0001c690: 207b 7861 7669 6572 5f75 6e69 666f 726d   {xavier_uniform
-0001c6a0: 5f2c 2078 6176 6965 725f 6e6f 726d 616c  _, xavier_normal
-0001c6b0: 5f2c 206b 6169 6d69 6e67 5f75 6e69 666f  _, kaiming_unifo
-0001c6c0: 726d 5f2c 206b 6169 6d69 6e67 5f6e 6f72  rm_, kaiming_nor
-0001c6d0: 6d61 6c5f 2c20 7472 756e 635f 6e6f 726d  mal_, trunc_norm
-0001c6e0: 616c 5f7d 0a0a 2020 2020 4578 616d 706c  al_}..    Exampl
-0001c6f0: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
-0001c700: 2020 2020 3e3e 3e20 6672 6f6d 2064 6565      >>> from dee
-0001c710: 7063 6865 6d2e 6d6f 6465 6c73 2e74 6f72  pchem.models.tor
-0001c720: 6368 5f6d 6f64 656c 7320 696d 706f 7274  ch_models import
-0001c730: 206c 6179 6572 730a 2020 2020 3e3e 3e20   layers.    >>> 
-0001c740: 696d 706f 7274 2074 6f72 6368 0a20 2020  import torch.   
-0001c750: 203e 3e3e 206c 6179 6572 203d 206c 6179   >>> layer = lay
-0001c760: 6572 732e 4454 4e4e 456d 6265 6464 696e  ers.DTNNEmbeddin
-0001c770: 6728 3330 2c20 3330 2c20 2778 6176 6965  g(30, 30, 'xavie
-0001c780: 725f 756e 6966 6f72 6d5f 2729 0a20 2020  r_uniform_').   
-0001c790: 203e 3e3e 206f 7574 7075 7420 3d20 6c61   >>> output = la
-0001c7a0: 7965 7228 746f 7263 682e 7465 6e73 6f72  yer(torch.tensor
-0001c7b0: 285b 302c 2031 2c20 322c 2033 2c20 342c  ([0, 1, 2, 3, 4,
-0001c7c0: 2035 2c20 362c 2037 2c20 382c 2039 5d29   5, 6, 7, 8, 9])
-0001c7d0: 290a 2020 2020 3e3e 3e20 6f75 7470 7574  ).    >>> output
-0001c7e0: 2e73 6861 7065 0a20 2020 2074 6f72 6368  .shape.    torch
-0001c7f0: 2e53 697a 6528 5b31 302c 2033 305d 290a  .Size([10, 30]).
-0001c800: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-0001c810: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0001c820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c830: 2020 6e5f 656d 6265 6464 696e 673a 2069    n_embedding: i
-0001c840: 6e74 203d 2033 302c 0a20 2020 2020 2020  nt = 30,.       
-0001c850: 2020 2020 2020 2020 2020 7065 7269 6f64            period
-0001c860: 6963 5f74 6162 6c65 5f6c 656e 6774 683a  ic_table_length:
-0001c870: 2069 6e74 203d 2033 302c 0a20 2020 2020   int = 30,.     
-0001c880: 2020 2020 2020 2020 2020 2020 696e 6974              init
-0001c890: 616c 697a 6572 3a20 7374 7220 3d20 2778  alizer: str = 'x
-0001c8a0: 6176 6965 725f 756e 6966 6f72 6d5f 272c  avier_uniform_',
-0001c8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c8c0: 2020 2a2a 6b77 6172 6773 293a 0a0a 2020    **kwargs):..  
-0001c8d0: 2020 2020 2020 7375 7065 7228 4454 4e4e        super(DTNN
-0001c8e0: 456d 6265 6464 696e 672c 2073 656c 6629  Embedding, self)
-0001c8f0: 2e5f 5f69 6e69 745f 5f28 2a2a 6b77 6172  .__init__(**kwar
-0001c900: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
-0001c910: 2e6e 5f65 6d62 6564 6469 6e67 203d 206e  .n_embedding = n
-0001c920: 5f65 6d62 6564 6469 6e67 0a20 2020 2020  _embedding.     
-0001c930: 2020 2073 656c 662e 7065 7269 6f64 6963     self.periodic
-0001c940: 5f74 6162 6c65 5f6c 656e 6774 6820 3d20  _table_length = 
-0001c950: 7065 7269 6f64 6963 5f74 6162 6c65 5f6c  periodic_table_l
-0001c960: 656e 6774 680a 2020 2020 2020 2020 7365  ength.        se
-0001c970: 6c66 2e69 6e69 7461 6c69 7a65 7220 3d20  lf.initalizer = 
-0001c980: 696e 6974 616c 697a 6572 2020 2320 5365  initalizer  # Se
-0001c990: 7420 7765 6967 6874 2069 6e69 7469 616c  t weight initial
-0001c9a0: 697a 6174 696f 6e0a 0a20 2020 2020 2020  ization..       
-0001c9b0: 2069 6e69 745f 6675 6e63 3a20 4361 6c6c   init_func: Call
-0001c9c0: 6162 6c65 203d 2067 6574 6174 7472 2869  able = getattr(i
-0001c9d0: 6e69 7469 616c 697a 6572 732c 2073 656c  nitializers, sel
-0001c9e0: 662e 696e 6974 616c 697a 6572 290a 2020  f.initalizer).  
-0001c9f0: 2020 2020 2020 7365 6c66 2e65 6d62 6564        self.embed
-0001ca00: 6469 6e67 5f6c 6973 743a 2074 6f72 6368  ding_list: torch
-0001ca10: 2e54 656e 736f 7220 3d20 696e 6974 5f66  .Tensor = init_f
-0001ca20: 756e 6328 0a20 2020 2020 2020 2020 2020  unc(.           
-0001ca30: 2074 6f72 6368 2e65 6d70 7479 285b 7365   torch.empty([se
-0001ca40: 6c66 2e70 6572 696f 6469 635f 7461 626c  lf.periodic_tabl
-0001ca50: 655f 6c65 6e67 7468 2c20 7365 6c66 2e6e  e_length, self.n
-0001ca60: 5f65 6d62 6564 6469 6e67 5d29 290a 0a20  _embedding])).. 
-0001ca70: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
-0001ca80: 7365 6c66 2920 2d3e 2073 7472 3a0a 2020  self) -> str:.  
-0001ca90: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-0001caa0: 2061 2073 7472 696e 6720 7265 7072 6573   a string repres
-0001cab0: 656e 7469 6e67 2074 6865 2063 6f6e 6669  enting the confi
-0001cac0: 6775 7261 7469 6f6e 206f 6620 7468 6520  guration of the 
-0001cad0: 6c61 7965 722e 0a0a 2020 2020 2020 2020  layer...        
-0001cae0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-0001caf0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0001cb00: 6e5f 656d 6265 6464 696e 673a 2069 6e74  n_embedding: int
-0001cb10: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0001cb20: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-0001cb30: 2066 6561 7475 7265 7320 666f 7220 6561   features for ea
-0001cb40: 6368 2061 746f 6d0a 2020 2020 2020 2020  ch atom.        
-0001cb50: 7065 7269 6f64 6963 5f74 6162 6c65 5f6c  periodic_table_l
-0001cb60: 656e 6774 683a 2069 6e74 2c20 6f70 7469  ength: int, opti
-0001cb70: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-0001cb80: 204c 656e 6774 6820 6f66 2065 6d62 6564   Length of embed
-0001cb90: 6469 6e67 2c20 3833 3d42 690a 2020 2020  ding, 83=Bi.    
-0001cba0: 2020 2020 696e 6974 616c 697a 6572 3a20      initalizer: 
-0001cbb0: 7374 722c 206f 7074 696f 6e61 6c0a 2020  str, optional.  
-0001cbc0: 2020 2020 2020 2020 2020 5765 6967 6874            Weight
-0001cbd0: 2069 6e69 7469 616c 697a 6174 696f 6e20   initialization 
-0001cbe0: 666f 7220 6669 6c74 6572 732e 0a20 2020  for filters..   
-0001cbf0: 2020 2020 2020 2020 204f 7074 696f 6e73           Options
-0001cc00: 3a20 7b78 6176 6965 725f 756e 6966 6f72  : {xavier_unifor
-0001cc10: 6d5f 2c20 7861 7669 6572 5f6e 6f72 6d61  m_, xavier_norma
-0001cc20: 6c5f 2c20 6b61 696d 696e 675f 756e 6966  l_, kaiming_unif
-0001cc30: 6f72 6d5f 2c20 6b61 696d 696e 675f 6e6f  orm_, kaiming_no
-0001cc40: 726d 616c 5f2c 2074 7275 6e63 5f6e 6f72  rmal_, trunc_nor
-0001cc50: 6d61 6c5f 7d0a 0a20 2020 2020 2020 2022  mal_}..        "
-0001cc60: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0001cc70: 6e20 6627 7b73 656c 662e 5f5f 636c 6173  n f'{self.__clas
-0001cc80: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d28 6e5f  s__.__name__}(n_
-0001cc90: 656d 6265 6464 696e 673d 7b73 656c 662e  embedding={self.
-0001cca0: 6e5f 656d 6265 6464 696e 677d 2c20 7065  n_embedding}, pe
-0001ccb0: 7269 6f64 6963 5f74 6162 6c65 5f6c 656e  riodic_table_len
-0001ccc0: 6774 683d 7b73 656c 662e 7065 7269 6f64  gth={self.period
-0001ccd0: 6963 5f74 6162 6c65 5f6c 656e 6774 687d  ic_table_length}
-0001cce0: 2c20 696e 6974 616c 697a 6572 3d7b 7365  , initalizer={se
-0001ccf0: 6c66 2e69 6e69 7461 6c69 7a65 727d 2927  lf.initalizer})'
-0001cd00: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-0001cd10: 6428 7365 6c66 2c20 696e 7075 7473 3a20  d(self, inputs: 
-0001cd20: 746f 7263 682e 5465 6e73 6f72 293a 0a20  torch.Tensor):. 
-0001cd30: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-0001cd40: 7320 456d 6265 6464 696e 6773 2061 6363  s Embeddings acc
-0001cd50: 6f72 6469 6e67 2074 6f20 696e 6469 6365  ording to indice
-0001cd60: 732e 0a0a 2020 2020 2020 2020 5061 7261  s...        Para
-0001cd70: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-0001cd80: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-0001cd90: 2020 696e 7075 7473 3a20 746f 7263 682e    inputs: torch.
-0001cda0: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-0001cdb0: 2020 2049 6e64 6963 6573 206f 6620 4174     Indices of At
-0001cdc0: 6f6d 7320 7768 6f73 6520 656d 6265 6464  oms whose embedd
-0001cdd0: 696e 6773 2061 7265 2072 6571 7565 7374  ings are request
-0001cde0: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
-0001cdf0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-0001ce00: 2d2d 2d2d 0a20 2020 2020 2020 2061 746f  ----.        ato
-0001ce10: 6d5f 656d 6265 6464 696e 6773 3a20 746f  m_embeddings: to
-0001ce20: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-0001ce30: 2020 2020 2020 2045 6d62 6564 6469 6e67         Embedding
-0001ce40: 7320 6f66 2061 746f 6d73 2061 6363 6f72  s of atoms accor
-0001ce50: 6469 6e67 7320 746f 2069 6e64 6963 6573  dings to indices
-0001ce60: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
-0001ce70: 2020 2020 2020 2061 746f 6d5f 6e75 6d62         atom_numb
-0001ce80: 6572 203d 2069 6e70 7574 730a 2020 2020  er = inputs.    
-0001ce90: 2020 2020 6174 6f6d 5f65 6e62 6564 6469      atom_enbeddi
-0001cea0: 6e67 7320 3d20 746f 7263 682e 6e6e 2e66  ngs = torch.nn.f
-0001ceb0: 756e 6374 696f 6e61 6c2e 656d 6265 6464  unctional.embedd
-0001cec0: 696e 6728 6174 6f6d 5f6e 756d 6265 722c  ing(atom_number,
-0001ced0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b370: 2020 2020 2020 2073 7464 3d30 2e31 2929         std=0.1))
+0001b380: 0a20 2020 2020 2020 2073 656c 662e 6220  .        self.b 
+0001b390: 3d20 6e6e 2e50 6172 616d 6574 6572 280a  = nn.Parameter(.
+0001b3a0: 2020 2020 2020 2020 2020 2020 746f 7263              torc
+0001b3b0: 682e 6361 7428 2874 6f72 6368 2e7a 6572  h.cat((torch.zer
+0001b3c0: 6f73 2873 656c 662e 6e5f 6869 6464 656e  os(self.n_hidden
+0001b3d0: 292c 2074 6f72 6368 2e6f 6e65 7328 7365  ), torch.ones(se
+0001b3e0: 6c66 2e6e 5f68 6964 6465 6e29 2c0a 2020  lf.n_hidden),.  
+0001b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b400: 2020 2020 2074 6f72 6368 2e7a 6572 6f73       torch.zeros
+0001b410: 2873 656c 662e 6e5f 6869 6464 656e 292c  (self.n_hidden),
+0001b420: 2074 6f72 6368 2e7a 6572 6f73 2873 656c   torch.zeros(sel
+0001b430: 662e 6e5f 6869 6464 656e 2929 2929 0a20  f.n_hidden)))). 
+0001b440: 2020 2020 2020 2073 656c 662e 6275 696c         self.buil
+0001b450: 7420 3d20 5472 7565 0a0a 2020 2020 6465  t = True..    de
+0001b460: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
+0001b470: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+0001b480: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
+0001b490: 2020 2020 2020 6627 7b73 656c 662e 5f5f        f'{self.__
+0001b4a0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0001b4b0: 7d28 4d3d 7b73 656c 662e 4d7d 2c20 6261  }(M={self.M}, ba
+0001b4c0: 7463 685f 7369 7a65 3d7b 7365 6c66 2e62  tch_size={self.b
+0001b4d0: 6174 6368 5f73 697a 657d 2c20 6e5f 6869  atch_size}, n_hi
+0001b4e0: 6464 656e 3d7b 7365 6c66 2e6e 5f68 6964  dden={self.n_hid
+0001b4f0: 6465 6e7d 2c20 696e 6974 3d7b 7365 6c66  den}, init={self
+0001b500: 2e69 6e69 747d 2927 0a20 2020 2020 2020  .init})'.       
+0001b510: 2029 0a0a 2020 2020 6465 6620 666f 7277   )..    def forw
+0001b520: 6172 6428 7365 6c66 2c20 696e 7075 7473  ard(self, inputs
+0001b530: 3a20 4c69 7374 2920 2d3e 2074 6f72 6368  : List) -> torch
+0001b540: 2e54 656e 736f 723a 0a20 2020 2020 2020  .Tensor:.       
+0001b550: 2022 2222 5065 7266 6f72 6d20 4d20 7374   """Perform M st
+0001b560: 6570 7320 6f66 2073 6574 3273 6574 2067  eps of set2set g
+0001b570: 6174 6865 722c 0a0a 2020 2020 2020 2020  ather,..        
+0001b580: 4465 7461 696c 6564 2064 6573 6372 6970  Detailed descrip
+0001b590: 7469 6f6e 7320 696e 3a20 6874 7470 733a  tions in: https:
+0001b5a0: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
+0001b5b0: 3135 3131 2e30 3633 3931 0a0a 2020 2020  1511.06391..    
+0001b5c0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0001b5d0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0001b5e0: 2d0a 2020 2020 2020 2020 696e 7075 7473  -.        inputs
+0001b5f0: 3a20 4c69 7374 0a20 2020 2020 2020 2020  : List.         
+0001b600: 2020 2054 6869 7320 636f 6e74 6169 6e73     This contains
+0001b610: 2074 776f 2065 6c65 6d65 6e74 732e 0a20   two elements.. 
+0001b620: 2020 2020 2020 2020 2020 2061 746f 6d5f             atom_
+0001b630: 6665 6174 7572 6573 3a20 6e70 2e6e 6461  features: np.nda
+0001b640: 7272 6179 0a20 2020 2020 2020 2020 2020  rray.           
+0001b650: 2061 746f 6d5f 7370 6c69 743a 206e 702e   atom_split: np.
+0001b660: 6e64 6172 7261 790a 0a20 2020 2020 2020  ndarray..       
+0001b670: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+0001b680: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+0001b690: 2071 5f73 7461 723a 2074 6f72 6368 2e54   q_star: torch.T
+0001b6a0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+0001b6b0: 2020 4669 6e61 6c20 7374 6174 6520 6f66    Final state of
+0001b6c0: 2074 6865 206d 6f64 656c 2061 6674 6572   the model after
+0001b6d0: 2061 6c6c 204d 2073 7465 7073 2e0a 0a20   all M steps... 
+0001b6e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001b6f0: 2020 2061 746f 6d5f 6665 6174 7572 6573     atom_features
+0001b700: 2c20 6174 6f6d 5f73 706c 6974 203d 2069  , atom_split = i
+0001b710: 6e70 7574 730a 2020 2020 2020 2020 6320  nputs.        c 
+0001b720: 3d20 746f 7263 682e 7a65 726f 7328 2873  = torch.zeros((s
+0001b730: 656c 662e 6261 7463 685f 7369 7a65 2c20  elf.batch_size, 
+0001b740: 7365 6c66 2e6e 5f68 6964 6465 6e29 290a  self.n_hidden)).
+0001b750: 2020 2020 2020 2020 6820 3d20 746f 7263          h = torc
+0001b760: 682e 7a65 726f 7328 2873 656c 662e 6261  h.zeros((self.ba
+0001b770: 7463 685f 7369 7a65 2c20 7365 6c66 2e6e  tch_size, self.n
+0001b780: 5f68 6964 6465 6e29 290a 0a20 2020 2020  _hidden))..     
+0001b790: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+0001b7a0: 6528 7365 6c66 2e4d 293a 0a20 2020 2020  e(self.M):.     
+0001b7b0: 2020 2020 2020 2071 5f65 7870 616e 6465         q_expande
+0001b7c0: 6420 3d20 685b 6174 6f6d 5f73 706c 6974  d = h[atom_split
+0001b7d0: 5d0a 2020 2020 2020 2020 2020 2020 6520  ].            e 
+0001b7e0: 3d20 2874 6f72 6368 2e66 726f 6d5f 6e75  = (torch.from_nu
+0001b7f0: 6d70 7928 6174 6f6d 5f66 6561 7475 7265  mpy(atom_feature
+0001b800: 7329 202a 2071 5f65 7870 616e 6465 6429  s) * q_expanded)
+0001b810: 2e73 756d 2864 696d 3d2d 3129 0a20 2020  .sum(dim=-1).   
+0001b820: 2020 2020 2020 2020 2065 5f6d 6f6c 7320           e_mols 
+0001b830: 3d20 7365 6c66 2e5f 6479 6e61 6d69 635f  = self._dynamic_
+0001b840: 7061 7274 6974 696f 6e28 652c 2061 746f  partition(e, ato
+0001b850: 6d5f 7370 6c69 742c 2073 656c 662e 6261  m_split, self.ba
+0001b860: 7463 685f 7369 7a65 290a 0a20 2020 2020  tch_size)..     
+0001b870: 2020 2020 2020 2023 2041 6464 2061 6e6f         # Add ano
+0001b880: 7468 6572 2076 616c 7565 287e 2d49 6e66  ther value(~-Inf
+0001b890: 2920 746f 2070 7265 7665 6e74 2065 7272  ) to prevent err
+0001b8a0: 6f72 2069 6e20 736f 6674 6d61 780a 2020  or in softmax.  
+0001b8b0: 2020 2020 2020 2020 2020 655f 6d6f 6c73            e_mols
+0001b8c0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+0001b8d0: 2020 2020 2074 6f72 6368 2e63 6174 285b       torch.cat([
+0001b8e0: 655f 6d6f 6c2c 2074 6f72 6368 2e74 656e  e_mol, torch.ten
+0001b8f0: 736f 7228 5b2d 3130 3030 2e5d 295d 2c20  sor([-1000.])], 
+0001b900: 6469 6d3d 3029 0a20 2020 2020 2020 2020  dim=0).         
+0001b910: 2020 2020 2020 2066 6f72 2065 5f6d 6f6c         for e_mol
+0001b920: 2069 6e20 655f 6d6f 6c73 0a20 2020 2020   in e_mols.     
+0001b930: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0001b940: 2020 2020 2061 203d 2074 6f72 6368 2e63       a = torch.c
+0001b950: 6174 285b 0a20 2020 2020 2020 2020 2020  at([.           
+0001b960: 2020 2020 2074 6f72 6368 2e6e 6e2e 6675       torch.nn.fu
+0001b970: 6e63 7469 6f6e 616c 2e73 6f66 746d 6178  nctional.softmax
+0001b980: 2865 5f6d 6f6c 5b3a 2d31 5d2c 2064 696d  (e_mol[:-1], dim
+0001b990: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
+0001b9a0: 2020 2020 666f 7220 655f 6d6f 6c20 696e      for e_mol in
+0001b9b0: 2065 5f6d 6f6c 730a 2020 2020 2020 2020   e_mols.        
+0001b9c0: 2020 2020 5d2c 0a20 2020 2020 2020 2020      ],.         
+0001b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9e0: 2064 696d 3d30 290a 0a20 2020 2020 2020   dim=0)..       
+0001b9f0: 2020 2020 2072 203d 2073 6361 7474 6572       r = scatter
+0001ba00: 2874 6f72 6368 2e72 6573 6861 7065 2861  (torch.reshape(a
+0001ba10: 2c20 5b2d 312c 2031 5d29 202a 2061 746f  , [-1, 1]) * ato
+0001ba20: 6d5f 6665 6174 7572 6573 2c0a 2020 2020  m_features,.    
+0001ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba40: 2020 2020 746f 7263 682e 6672 6f6d 5f6e      torch.from_n
+0001ba50: 756d 7079 2861 746f 6d5f 7370 6c69 7429  umpy(atom_split)
+0001ba60: 2e6c 6f6e 6728 292c 0a20 2020 2020 2020  .long(),.       
+0001ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba80: 2064 696d 3d30 290a 2020 2020 2020 2020   dim=0).        
+0001ba90: 2020 2020 2320 4d6f 6465 6c20 7573 696e      # Model usin
+0001baa0: 6720 7468 6973 206c 6179 6572 206d 7573  g this layer mus
+0001bab0: 7420 7365 7420 6070 6164 5f62 6174 6368  t set `pad_batch
+0001bac0: 6573 3d54 7275 6560 0a20 2020 2020 2020  es=True`.       
+0001bad0: 2020 2020 2071 5f73 7461 7220 3d20 746f       q_star = to
+0001bae0: 7263 682e 6361 7428 5b68 2c20 725d 2c20  rch.cat([h, r], 
+0001baf0: 6469 6d3d 3129 0a20 2020 2020 2020 2020  dim=1).         
+0001bb00: 2020 2068 2c20 6320 3d20 7365 6c66 2e5f     h, c = self._
+0001bb10: 4c53 544d 5374 6570 2871 5f73 7461 722c  LSTMStep(q_star,
+0001bb20: 2063 290a 2020 2020 2020 2020 7265 7475   c).        retu
+0001bb30: 726e 2071 5f73 7461 720a 0a20 2020 2064  rn q_star..    d
+0001bb40: 6566 205f 4c53 544d 5374 6570 2873 656c  ef _LSTMStep(sel
+0001bb50: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
+0001bb60: 2020 2020 2068 3a20 746f 7263 682e 5465       h: torch.Te
+0001bb70: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
+0001bb80: 2020 2020 2020 2020 633a 2074 6f72 6368          c: torch
+0001bb90: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
+0001bba0: 2020 2020 2020 2020 2020 2078 3d4e 6f6e             x=Non
+0001bbb0: 6529 202d 3e20 5475 706c 655b 746f 7263  e) -> Tuple[torc
+0001bbc0: 682e 5465 6e73 6f72 2c20 746f 7263 682e  h.Tensor, torch.
+0001bbd0: 5465 6e73 6f72 5d3a 0a20 2020 2020 2020  Tensor]:.       
+0001bbe0: 2022 2222 5468 6973 206d 6574 686f 7264   """This methord
+0001bbf0: 2070 6572 666f 726d 7320 6120 7369 6e67   performs a sing
+0001bc00: 6c65 2073 7465 7020 6f66 2061 204c 6f6e  le step of a Lon
+0001bc10: 6720 5368 6f72 742d 5465 726d 204d 656d  g Short-Term Mem
+0001bc20: 6f72 7920 284c 5354 4d29 2063 656c 6c2c  ory (LSTM) cell,
+0001bc30: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+0001bc40: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+0001bc50: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0001bc60: 683a 2074 6f72 6368 2e54 656e 736f 720a  h: torch.Tensor.
+0001bc70: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0001bc80: 6869 6464 656e 2073 7461 7465 206f 6620  hidden state of 
+0001bc90: 7468 6520 4c53 544d 2063 656c 6c2e 0a20  the LSTM cell.. 
+0001bca0: 2020 2020 2020 2063 3a20 746f 7263 682e         c: torch.
+0001bcb0: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+0001bcc0: 2020 2054 6865 2063 656c 6c20 7374 6174     The cell stat
+0001bcd0: 6520 6f66 2074 6865 204c 5354 4d20 6365  e of the LSTM ce
+0001bce0: 6c6c 2e0a 0a20 2020 2020 2020 2052 6574  ll...        Ret
+0001bcf0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+0001bd00: 2d2d 2d2d 0a20 2020 2020 2020 2068 5f6f  ----.        h_o
+0001bd10: 7574 3a20 746f 7263 682e 5465 6e73 6f72  ut: torch.Tensor
+0001bd20: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+0001bd30: 2075 7064 6174 6564 2068 6964 6465 6e20   updated hidden 
+0001bd40: 7374 6174 6520 6f66 2074 6865 204c 5354  state of the LST
+0001bd50: 4d20 6365 6c6c 2e0a 2020 2020 2020 2020  M cell..        
+0001bd60: 635f 6f75 743a 2074 6f72 6368 2e54 656e  c_out: torch.Ten
+0001bd70: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+0001bd80: 5468 6520 7570 6461 7465 6420 6365 6c6c  The updated cell
+0001bd90: 2073 7461 7465 206f 6620 7468 6520 4c53   state of the LS
+0001bda0: 544d 2063 656c 6c2e 0a0a 2020 2020 2020  TM cell...      
+0001bdb0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+0001bdc0: 7a20 3d20 746f 7263 682e 6d6d 2868 2c20  z = torch.mm(h, 
+0001bdd0: 7365 6c66 2e55 2920 2b20 7365 6c66 2e62  self.U) + self.b
+0001bde0: 0a20 2020 2020 2020 207a 203d 2046 2e6c  .        z = F.l
+0001bdf0: 696e 6561 7228 682e 666c 6f61 7428 292e  inear(h.float().
+0001be00: 6465 7461 6368 2829 2c0a 2020 2020 2020  detach(),.      
+0001be10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001be20: 656c 662e 552e 666c 6f61 7428 292e 542e  elf.U.float().T.
+0001be30: 6465 7461 6368 2829 2c20 7365 6c66 2e62  detach(), self.b
+0001be40: 2e64 6574 6163 6828 2929 0a20 2020 2020  .detach()).     
+0001be50: 2020 2069 203d 2074 6f72 6368 2e73 6967     i = torch.sig
+0001be60: 6d6f 6964 287a 5b3a 2c20 3a73 656c 662e  moid(z[:, :self.
+0001be70: 6e5f 6869 6464 656e 5d29 0a20 2020 2020  n_hidden]).     
+0001be80: 2020 2066 203d 2074 6f72 6368 2e73 6967     f = torch.sig
+0001be90: 6d6f 6964 287a 5b3a 2c20 7365 6c66 2e6e  moid(z[:, self.n
+0001bea0: 5f68 6964 6465 6e3a 3220 2a20 7365 6c66  _hidden:2 * self
+0001beb0: 2e6e 5f68 6964 6465 6e5d 290a 2020 2020  .n_hidden]).    
+0001bec0: 2020 2020 6f20 3d20 746f 7263 682e 7369      o = torch.si
+0001bed0: 676d 6f69 6428 7a5b 3a2c 2032 202a 2073  gmoid(z[:, 2 * s
+0001bee0: 656c 662e 6e5f 6869 6464 656e 3a33 202a  elf.n_hidden:3 *
+0001bef0: 2073 656c 662e 6e5f 6869 6464 656e 5d29   self.n_hidden])
+0001bf00: 0a20 2020 2020 2020 207a 3320 3d20 7a5b  .        z3 = z[
+0001bf10: 3a2c 2033 202a 2073 656c 662e 6e5f 6869  :, 3 * self.n_hi
+0001bf20: 6464 656e 3a5d 0a20 2020 2020 2020 2063  dden:].        c
+0001bf30: 5f6f 7574 203d 2066 202a 2063 202b 2069  _out = f * c + i
+0001bf40: 202a 2074 6f72 6368 2e74 616e 6828 7a33   * torch.tanh(z3
+0001bf50: 290a 2020 2020 2020 2020 685f 6f75 7420  ).        h_out 
+0001bf60: 3d20 6f20 2a20 746f 7263 682e 7461 6e68  = o * torch.tanh
+0001bf70: 2863 5f6f 7574 290a 2020 2020 2020 2020  (c_out).        
+0001bf80: 7265 7475 726e 2068 5f6f 7574 2c20 635f  return h_out, c_
+0001bf90: 6f75 740a 0a20 2020 2064 6566 205f 6479  out..    def _dy
+0001bfa0: 6e61 6d69 635f 7061 7274 6974 696f 6e28  namic_partition(
+0001bfb0: 7365 6c66 2c20 696e 7075 745f 7465 6e73  self, input_tens
+0001bfc0: 6f72 3a20 746f 7263 682e 5465 6e73 6f72  or: torch.Tensor
+0001bfd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001bfe0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0001bff0: 7469 7469 6f6e 5f74 656e 736f 723a 206e  tition_tensor: n
+0001c000: 702e 6e64 6172 7261 792c 0a20 2020 2020  p.ndarray,.     
+0001c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c020: 2020 2020 2020 6e75 6d5f 7061 7274 6974        num_partit
+0001c030: 696f 6e73 3a20 696e 7429 202d 3e20 4c69  ions: int) -> Li
+0001c040: 7374 5b74 6f72 6368 2e54 656e 736f 725d  st[torch.Tensor]
+0001c050: 3a0a 2020 2020 2020 2020 2222 2250 6172  :.        """Par
+0001c060: 7469 7469 6f6e 7320 6064 6174 6160 2069  titions `data` i
+0001c070: 6e74 6f20 606e 756d 5f70 6172 7469 7469  nto `num_partiti
+0001c080: 6f6e 7360 2074 656e 736f 7273 2075 7369  ons` tensors usi
+0001c090: 6e67 2069 6e64 6963 6573 2066 726f 6d20  ng indices from 
+0001c0a0: 6070 6172 7469 7469 6f6e 7360 2e0a 0a20  `partitions`... 
+0001c0b0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+0001c0c0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0001c0d0: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e70  ----.        inp
+0001c0e0: 7574 5f74 656e 736f 723a 2074 6f72 6368  ut_tensor: torch
+0001c0f0: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+0001c100: 2020 2020 5468 6520 7465 6e73 6f72 2074      The tensor t
+0001c110: 6f20 6265 2070 6172 7469 7469 6f6e 6564  o be partitioned
+0001c120: 2e0a 2020 2020 2020 2020 7061 7274 6974  ..        partit
+0001c130: 696f 6e5f 7465 6e73 6f72 3a20 6e70 2e6e  ion_tensor: np.n
+0001c140: 6461 7272 6179 0a20 2020 2020 2020 2020  darray.         
+0001c150: 2020 2041 2031 2d44 2074 656e 736f 7220     A 1-D tensor 
+0001c160: 7768 6f73 6520 7369 7a65 2069 7320 6571  whose size is eq
+0001c170: 7561 6c20 746f 2074 6865 2066 6972 7374  ual to the first
+0001c180: 2064 696d 656e 7369 6f6e 206f 6620 6069   dimension of `i
+0001c190: 6e70 7574 5f74 656e 736f 7260 2e0a 2020  nput_tensor`..  
+0001c1a0: 2020 2020 2020 6e75 6d5f 7061 7274 6974        num_partit
+0001c1b0: 696f 6e73 3a20 696e 740a 2020 2020 2020  ions: int.      
+0001c1c0: 2020 2020 2020 5468 6520 6e75 6d62 6572        The number
+0001c1d0: 206f 6620 7061 7274 6974 696f 6e73 2074   of partitions t
+0001c1e0: 6f20 6f75 7470 7574 2e0a 0a20 2020 2020  o output...     
+0001c1f0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+0001c200: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+0001c210: 2020 2070 6172 7469 7469 6f6e 733a 204c     partitions: L
+0001c220: 6973 745b 746f 7263 682e 5465 6e73 6f72  ist[torch.Tensor
+0001c230: 5d0a 2020 2020 2020 2020 2020 2020 4120  ].            A 
+0001c240: 6c69 7374 206f 6620 606e 756d 5f70 6172  list of `num_par
+0001c250: 7469 7469 6f6e 7360 2060 5465 6e73 6f72  titions` `Tensor
+0001c260: 6020 6f62 6a65 6374 7320 7769 7468 2074  ` objects with t
+0001c270: 6865 2073 616d 6520 7479 7065 2061 7320  he same type as 
+0001c280: 6064 6174 6160 2e0a 0a20 2020 2020 2020  `data`...       
+0001c290: 2022 2222 0a20 2020 2020 2020 2023 2063   """.        # c
+0001c2a0: 7265 6174 6520 6120 626f 6f6c 6561 6e20  reate a boolean 
+0001c2b0: 6d61 736b 2066 6f72 2065 6163 6820 7061  mask for each pa
+0001c2c0: 7274 6974 696f 6e0a 2020 2020 2020 2020  rtition.        
+0001c2d0: 7061 7274 6974 696f 6e5f 6d61 736b 7320  partition_masks 
+0001c2e0: 3d20 5b70 6172 7469 7469 6f6e 5f74 656e  = [partition_ten
+0001c2f0: 736f 7220 3d3d 2069 2066 6f72 2069 2069  sor == i for i i
+0001c300: 6e20 7261 6e67 6528 6e75 6d5f 7061 7274  n range(num_part
+0001c310: 6974 696f 6e73 295d 0a0a 2020 2020 2020  itions)]..      
+0001c320: 2020 2320 7061 7274 6974 696f 6e20 7468    # partition th
+0001c330: 6520 696e 7075 7420 7465 6e73 6f72 2075  e input tensor u
+0001c340: 7369 6e67 2074 6865 206d 6173 6b73 0a20  sing the masks. 
+0001c350: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+0001c360: 7320 3d20 5b69 6e70 7574 5f74 656e 736f  s = [input_tenso
+0001c370: 725b 6d61 736b 5d20 666f 7220 6d61 736b  r[mask] for mask
+0001c380: 2069 6e20 7061 7274 6974 696f 6e5f 6d61   in partition_ma
+0001c390: 736b 735d 0a0a 2020 2020 2020 2020 7265  sks]..        re
+0001c3a0: 7475 726e 2070 6172 7469 7469 6f6e 730a  turn partitions.
+0001c3b0: 0a0a 636c 6173 7320 4454 4e4e 456d 6265  ..class DTNNEmbe
+0001c3c0: 6464 696e 6728 6e6e 2e4d 6f64 756c 6529  dding(nn.Module)
+0001c3d0: 3a0a 2020 2020 2222 2244 544e 4e45 6d62  :.    """DTNNEmb
+0001c3e0: 6564 6469 6e67 206c 6179 6572 2066 6f72  edding layer for
+0001c3f0: 2044 544e 4e20 6d6f 6465 6c2e 0a0a 2020   DTNN model...  
+0001c400: 2020 4173 7369 676e 2069 6e69 7469 616c    Assign initial
+0001c410: 2061 746f 6d69 6320 6465 7363 7269 7074   atomic descript
+0001c420: 6f72 732e 205b 315d 5f0a 0a20 2020 2054  ors. [1]_..    T
+0001c430: 6869 7320 6c61 7965 7220 6372 6561 7465  his layer create
+0001c440: 7320 276e 2720 6e75 6d62 6572 206f 6620  s 'n' number of 
+0001c450: 656d 6265 6464 696e 6773 2061 7320 696e  embeddings as in
+0001c460: 6974 6961 6c20 6174 6f6d 6963 2064 6573  itial atomic des
+0001c470: 6372 6970 746f 7273 2e20 4163 636f 7264  criptors. Accord
+0001c480: 696e 6720 746f 2074 6865 2072 6571 7569  ing to the requi
+0001c490: 7265 6420 7765 6967 6874 2069 6e69 7469  red weight initi
+0001c4a0: 616c 697a 6572 2061 6e64 2070 6572 696f  alizer and perio
+0001c4b0: 6469 635f 7461 626c 655f 6c65 6e67 7468  dic_table_length
+0001c4c0: 2028 546f 7461 6c20 6e75 6d62 6572 206f   (Total number o
+0001c4d0: 6620 756e 6971 7565 2061 746f 6d73 292e  f unique atoms).
+0001c4e0: 0a0a 2020 2020 5265 6665 7265 6e63 6573  ..    References
+0001c4f0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+0001c500: 2020 2020 5b31 5d20 5363 68c3 bc74 742c      [1] Sch..tt,
+0001c510: 204b 7269 7374 6f66 2054 2e2c 2065 7420   Kristof T., et 
+0001c520: 616c 2e20 2251 7561 6e74 756d 2d63 6865  al. "Quantum-che
+0001c530: 6d69 6361 6c20 696e 7369 6768 7473 2066  mical insights f
+0001c540: 726f 6d20 6465 6570 0a20 2020 2020 2020  rom deep.       
+0001c550: 2074 656e 736f 7220 6e65 7572 616c 206e   tensor neural n
+0001c560: 6574 776f 726b 732e 2220 4e61 7475 7265  etworks." Nature
+0001c570: 2063 6f6d 6d75 6e69 6361 7469 6f6e 7320   communications 
+0001c580: 382e 3120 2832 3031 3729 3a20 312d 382e  8.1 (2017): 1-8.
+0001c590: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+0001c5a0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+0001c5b0: 2020 2020 6e5f 656d 6265 6464 696e 673a      n_embedding:
+0001c5c0: 2069 6e74 2c20 6f70 7469 6f6e 616c 0a20   int, optional. 
+0001c5d0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+0001c5e0: 2066 6561 7475 7265 7320 666f 7220 6561   features for ea
+0001c5f0: 6368 2061 746f 6d0a 2020 2020 7065 7269  ch atom.    peri
+0001c600: 6f64 6963 5f74 6162 6c65 5f6c 656e 6774  odic_table_lengt
+0001c610: 683a 2069 6e74 2c20 6f70 7469 6f6e 616c  h: int, optional
+0001c620: 0a20 2020 2020 2020 204c 656e 6774 6820  .        Length 
+0001c630: 6f66 2065 6d62 6564 6469 6e67 2c20 3833  of embedding, 83
+0001c640: 3d42 690a 2020 2020 696e 6974 616c 697a  =Bi.    initaliz
+0001c650: 6572 3a20 7374 722c 206f 7074 696f 6e61  er: str, optiona
+0001c660: 6c0a 2020 2020 2020 2020 5765 6967 6874  l.        Weight
+0001c670: 2069 6e69 7469 616c 697a 6174 696f 6e20   initialization 
+0001c680: 666f 7220 6669 6c74 6572 732e 0a20 2020  for filters..   
+0001c690: 2020 2020 204f 7074 696f 6e73 3a20 7b78       Options: {x
+0001c6a0: 6176 6965 725f 756e 6966 6f72 6d5f 2c20  avier_uniform_, 
+0001c6b0: 7861 7669 6572 5f6e 6f72 6d61 6c5f 2c20  xavier_normal_, 
+0001c6c0: 6b61 696d 696e 675f 756e 6966 6f72 6d5f  kaiming_uniform_
+0001c6d0: 2c20 6b61 696d 696e 675f 6e6f 726d 616c  , kaiming_normal
+0001c6e0: 5f2c 2074 7275 6e63 5f6e 6f72 6d61 6c5f  _, trunc_normal_
+0001c6f0: 7d0a 0a20 2020 2045 7861 6d70 6c65 730a  }..    Examples.
+0001c700: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0001c710: 203e 3e3e 2066 726f 6d20 6465 6570 6368   >>> from deepch
+0001c720: 656d 2e6d 6f64 656c 732e 746f 7263 685f  em.models.torch_
+0001c730: 6d6f 6465 6c73 2069 6d70 6f72 7420 6c61  models import la
+0001c740: 7965 7273 0a20 2020 203e 3e3e 2069 6d70  yers.    >>> imp
+0001c750: 6f72 7420 746f 7263 680a 2020 2020 3e3e  ort torch.    >>
+0001c760: 3e20 6c61 7965 7220 3d20 6c61 7965 7273  > layer = layers
+0001c770: 2e44 544e 4e45 6d62 6564 6469 6e67 2833  .DTNNEmbedding(3
+0001c780: 302c 2033 302c 2027 7861 7669 6572 5f75  0, 30, 'xavier_u
+0001c790: 6e69 666f 726d 5f27 290a 2020 2020 3e3e  niform_').    >>
+0001c7a0: 3e20 6f75 7470 7574 203d 206c 6179 6572  > output = layer
+0001c7b0: 2874 6f72 6368 2e74 656e 736f 7228 5b30  (torch.tensor([0
+0001c7c0: 2c20 312c 2032 2c20 332c 2034 2c20 352c  , 1, 2, 3, 4, 5,
+0001c7d0: 2036 2c20 372c 2038 2c20 395d 2929 0a20   6, 7, 8, 9])). 
+0001c7e0: 2020 203e 3e3e 206f 7574 7075 742e 7368     >>> output.sh
+0001c7f0: 6170 650a 2020 2020 746f 7263 682e 5369  ape.    torch.Si
+0001c800: 7a65 285b 3130 2c20 3330 5d29 0a0a 2020  ze([10, 30])..  
+0001c810: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+0001c820: 5f69 6e69 745f 5f28 7365 6c66 2c0a 2020  _init__(self,.  
+0001c830: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001c840: 5f65 6d62 6564 6469 6e67 3a20 696e 7420  _embedding: int 
+0001c850: 3d20 3330 2c0a 2020 2020 2020 2020 2020  = 30,.          
+0001c860: 2020 2020 2020 2070 6572 696f 6469 635f         periodic_
+0001c870: 7461 626c 655f 6c65 6e67 7468 3a20 696e  table_length: in
+0001c880: 7420 3d20 3330 2c0a 2020 2020 2020 2020  t = 30,.        
+0001c890: 2020 2020 2020 2020 2069 6e69 7461 6c69           initali
+0001c8a0: 7a65 723a 2073 7472 203d 2027 7861 7669  zer: str = 'xavi
+0001c8b0: 6572 5f75 6e69 666f 726d 5f27 2c0a 2020  er_uniform_',.  
+0001c8c0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0001c8d0: 2a6b 7761 7267 7329 3a0a 0a20 2020 2020  *kwargs):..     
+0001c8e0: 2020 2073 7570 6572 2844 544e 4e45 6d62     super(DTNNEmb
+0001c8f0: 6564 6469 6e67 2c20 7365 6c66 292e 5f5f  edding, self).__
+0001c900: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
+0001c910: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
+0001c920: 656d 6265 6464 696e 6720 3d20 6e5f 656d  embedding = n_em
+0001c930: 6265 6464 696e 670a 2020 2020 2020 2020  bedding.        
+0001c940: 7365 6c66 2e70 6572 696f 6469 635f 7461  self.periodic_ta
+0001c950: 626c 655f 6c65 6e67 7468 203d 2070 6572  ble_length = per
+0001c960: 696f 6469 635f 7461 626c 655f 6c65 6e67  iodic_table_leng
+0001c970: 7468 0a20 2020 2020 2020 2073 656c 662e  th.        self.
+0001c980: 696e 6974 616c 697a 6572 203d 2069 6e69  initalizer = ini
+0001c990: 7461 6c69 7a65 7220 2023 2053 6574 2077  talizer  # Set w
+0001c9a0: 6569 6768 7420 696e 6974 6961 6c69 7a61  eight initializa
+0001c9b0: 7469 6f6e 0a0a 2020 2020 2020 2020 696e  tion..        in
+0001c9c0: 6974 5f66 756e 633a 2043 616c 6c61 626c  it_func: Callabl
+0001c9d0: 6520 3d20 6765 7461 7474 7228 696e 6974  e = getattr(init
+0001c9e0: 6961 6c69 7a65 7273 2c20 7365 6c66 2e69  ializers, self.i
+0001c9f0: 6e69 7461 6c69 7a65 7229 0a20 2020 2020  nitalizer).     
+0001ca00: 2020 2073 656c 662e 656d 6265 6464 696e     self.embeddin
+0001ca10: 675f 6c69 7374 3a20 746f 7263 682e 5465  g_list: torch.Te
+0001ca20: 6e73 6f72 203d 2069 6e69 745f 6675 6e63  nsor = init_func
+0001ca30: 280a 2020 2020 2020 2020 2020 2020 746f  (.            to
+0001ca40: 7263 682e 656d 7074 7928 5b73 656c 662e  rch.empty([self.
+0001ca50: 7065 7269 6f64 6963 5f74 6162 6c65 5f6c  periodic_table_l
+0001ca60: 656e 6774 682c 2073 656c 662e 6e5f 656d  ength, self.n_em
+0001ca70: 6265 6464 696e 675d 2929 0a0a 2020 2020  bedding]))..    
+0001ca80: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+0001ca90: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
+0001caa0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
+0001cab0: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
+0001cac0: 696e 6720 7468 6520 636f 6e66 6967 7572  ing the configur
+0001cad0: 6174 696f 6e20 6f66 2074 6865 206c 6179  ation of the lay
+0001cae0: 6572 2e0a 0a20 2020 2020 2020 2052 6574  er...        Ret
+0001caf0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+0001cb00: 2d2d 2d2d 0a20 2020 2020 2020 206e 5f65  ----.        n_e
+0001cb10: 6d62 6564 6469 6e67 3a20 696e 742c 206f  mbedding: int, o
+0001cb20: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0001cb30: 2020 2020 4e75 6d62 6572 206f 6620 6665      Number of fe
+0001cb40: 6174 7572 6573 2066 6f72 2065 6163 6820  atures for each 
+0001cb50: 6174 6f6d 0a20 2020 2020 2020 2070 6572  atom.        per
+0001cb60: 696f 6469 635f 7461 626c 655f 6c65 6e67  iodic_table_leng
+0001cb70: 7468 3a20 696e 742c 206f 7074 696f 6e61  th: int, optiona
+0001cb80: 6c0a 2020 2020 2020 2020 2020 2020 4c65  l.            Le
+0001cb90: 6e67 7468 206f 6620 656d 6265 6464 696e  ngth of embeddin
+0001cba0: 672c 2038 333d 4269 0a20 2020 2020 2020  g, 83=Bi.       
+0001cbb0: 2069 6e69 7461 6c69 7a65 723a 2073 7472   initalizer: str
+0001cbc0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0001cbd0: 2020 2020 2020 2057 6569 6768 7420 696e         Weight in
+0001cbe0: 6974 6961 6c69 7a61 7469 6f6e 2066 6f72  itialization for
+0001cbf0: 2066 696c 7465 7273 2e0a 2020 2020 2020   filters..      
+0001cc00: 2020 2020 2020 4f70 7469 6f6e 733a 207b        Options: {
+0001cc10: 7861 7669 6572 5f75 6e69 666f 726d 5f2c  xavier_uniform_,
+0001cc20: 2078 6176 6965 725f 6e6f 726d 616c 5f2c   xavier_normal_,
+0001cc30: 206b 6169 6d69 6e67 5f75 6e69 666f 726d   kaiming_uniform
+0001cc40: 5f2c 206b 6169 6d69 6e67 5f6e 6f72 6d61  _, kaiming_norma
+0001cc50: 6c5f 2c20 7472 756e 635f 6e6f 726d 616c  l_, trunc_normal
+0001cc60: 5f7d 0a0a 2020 2020 2020 2020 2222 220a  _}..        """.
+0001cc70: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+0001cc80: 277b 7365 6c66 2e5f 5f63 6c61 7373 5f5f  '{self.__class__
+0001cc90: 2e5f 5f6e 616d 655f 5f7d 286e 5f65 6d62  .__name__}(n_emb
+0001cca0: 6564 6469 6e67 3d7b 7365 6c66 2e6e 5f65  edding={self.n_e
+0001ccb0: 6d62 6564 6469 6e67 7d2c 2070 6572 696f  mbedding}, perio
+0001ccc0: 6469 635f 7461 626c 655f 6c65 6e67 7468  dic_table_length
+0001ccd0: 3d7b 7365 6c66 2e70 6572 696f 6469 635f  ={self.periodic_
+0001cce0: 7461 626c 655f 6c65 6e67 7468 7d2c 2069  table_length}, i
+0001ccf0: 6e69 7461 6c69 7a65 723d 7b73 656c 662e  nitalizer={self.
+0001cd00: 696e 6974 616c 697a 6572 7d29 270a 0a20  initalizer})'.. 
+0001cd10: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
+0001cd20: 656c 662c 2069 6e70 7574 733a 2074 6f72  elf, inputs: tor
+0001cd30: 6368 2e54 656e 736f 7229 3a0a 2020 2020  ch.Tensor):.    
+0001cd40: 2020 2020 2222 2252 6574 7572 6e73 2045      """Returns E
+0001cd50: 6d62 6564 6469 6e67 7320 6163 636f 7264  mbeddings accord
+0001cd60: 696e 6720 746f 2069 6e64 6963 6573 2e0a  ing to indices..
+0001cd70: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0001cd80: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+0001cd90: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2069  ------.        i
+0001cda0: 6e70 7574 733a 2074 6f72 6368 2e54 656e  nputs: torch.Ten
+0001cdb0: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+0001cdc0: 496e 6469 6365 7320 6f66 2041 746f 6d73  Indices of Atoms
+0001cdd0: 2077 686f 7365 2065 6d62 6564 6469 6e67   whose embedding
+0001cde0: 7320 6172 6520 7265 7175 6573 7465 642e  s are requested.
+0001cdf0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0001ce00: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0001ce10: 2d0a 2020 2020 2020 2020 6174 6f6d 5f65  -.        atom_e
+0001ce20: 6d62 6564 6469 6e67 733a 2074 6f72 6368  mbeddings: torch
+0001ce30: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+0001ce40: 2020 2020 456d 6265 6464 696e 6773 206f      Embeddings o
+0001ce50: 6620 6174 6f6d 7320 6163 636f 7264 696e  f atoms accordin
+0001ce60: 6773 2074 6f20 696e 6469 6365 732e 0a0a  gs to indices...
+0001ce70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ce80: 2020 2020 6174 6f6d 5f6e 756d 6265 7220      atom_number 
+0001ce90: 3d20 696e 7075 7473 0a20 2020 2020 2020  = inputs.       
+0001cea0: 2061 746f 6d5f 656e 6265 6464 696e 6773   atom_enbeddings
+0001ceb0: 203d 2074 6f72 6368 2e6e 6e2e 6675 6e63   = torch.nn.func
+0001cec0: 7469 6f6e 616c 2e65 6d62 6564 6469 6e67  tional.embedding
+0001ced0: 2861 746f 6d5f 6e75 6d62 6572 2c0a 2020  (atom_number,.  
 0001cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf00: 2020 2020 2020 2020 2073 656c 662e 656d           self.em
-0001cf10: 6265 6464 696e 675f 6c69 7374 290a 2020  bedding_list).  
-0001cf20: 2020 2020 2020 7265 7475 726e 2061 746f        return ato
-0001cf30: 6d5f 656e 6265 6464 696e 6773 0a         m_enbeddings.
+0001cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf10: 2020 2020 2020 7365 6c66 2e65 6d62 6564        self.embed
+0001cf20: 6469 6e67 5f6c 6973 7429 0a20 2020 2020  ding_list).     
+0001cf30: 2020 2072 6574 7572 6e20 6174 6f6d 5f65     return atom_e
+0001cf40: 6e62 6564 6469 6e67 730a 0a0a 636c 6173  nbeddings...clas
+0001cf50: 7320 4564 6765 4e65 7477 6f72 6b28 6e6e  s EdgeNetwork(nn
+0001cf60: 2e4d 6f64 756c 6529 3a0a 2020 2020 2222  .Module):.    ""
+0001cf70: 2254 6865 2045 6467 654e 6574 776f 726b  "The EdgeNetwork
+0001cf80: 206d 6f64 756c 6520 6973 2061 2050 7954   module is a PyT
+0001cf90: 6f72 6368 2073 7562 6d6f 6475 6c65 2064  orch submodule d
+0001cfa0: 6573 6967 6e65 6420 666f 7220 6d65 7373  esigned for mess
+0001cfb0: 6167 6520 7061 7373 696e 6720 696e 2067  age passing in g
+0001cfc0: 7261 7068 206e 6575 7261 6c20 6e65 7477  raph neural netw
+0001cfd0: 6f72 6b73 2e0a 0a20 2020 2045 7861 6d70  orks...    Examp
+0001cfe0: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
+0001cff0: 0a20 2020 203e 3e3e 2070 6169 725f 6665  .    >>> pair_fe
+0001d000: 6174 7572 6573 203d 2074 6f72 6368 2e72  atures = torch.r
+0001d010: 616e 6428 2834 2c20 3229 2c20 6474 7970  and((4, 2), dtyp
+0001d020: 653d 746f 7263 682e 666c 6f61 7433 3229  e=torch.float32)
+0001d030: 0a20 2020 203e 3e3e 2061 746f 6d5f 6665  .    >>> atom_fe
+0001d040: 6174 7572 6573 203d 2074 6f72 6368 2e72  atures = torch.r
+0001d050: 616e 6428 2835 2c20 3229 2c20 6474 7970  and((5, 2), dtyp
+0001d060: 653d 746f 7263 682e 666c 6f61 7433 3229  e=torch.float32)
+0001d070: 0a20 2020 203e 3e3e 2061 746f 6d5f 746f  .    >>> atom_to
+0001d080: 5f70 6169 7220 3d20 5b5d 0a20 2020 203e  _pair = [].    >
+0001d090: 3e3e 206e 5f61 746f 6d73 203d 2032 0a20  >> n_atoms = 2. 
+0001d0a0: 2020 203e 3e3e 2073 7461 7274 203d 2030     >>> start = 0
+0001d0b0: 0a20 2020 203e 3e3e 2043 302c 2043 3120  .    >>> C0, C1 
+0001d0c0: 3d20 6e70 2e6d 6573 6867 7269 6428 6e70  = np.meshgrid(np
+0001d0d0: 2e61 7261 6e67 6528 6e5f 6174 6f6d 7329  .arange(n_atoms)
+0001d0e0: 2c20 6e70 2e61 7261 6e67 6528 6e5f 6174  , np.arange(n_at
+0001d0f0: 6f6d 7329 290a 2020 2020 3e3e 3e20 6174  oms)).    >>> at
+0001d100: 6f6d 5f74 6f5f 7061 6972 2e61 7070 656e  om_to_pair.appen
+0001d110: 6428 6e70 2e74 7261 6e73 706f 7365 286e  d(np.transpose(n
+0001d120: 702e 6172 7261 7928 5b43 312e 666c 6174  p.array([C1.flat
+0001d130: 7465 6e28 2920 2b20 7374 6172 742c 2043  ten() + start, C
+0001d140: 302e 666c 6174 7465 6e28 2920 2b20 7374  0.flatten() + st
+0001d150: 6172 745d 2929 290a 2020 2020 3e3e 3e20  art]))).    >>> 
+0001d160: 6174 6f6d 5f74 6f5f 7061 6972 203d 2074  atom_to_pair = t
+0001d170: 6f72 6368 2e54 656e 736f 7228 6174 6f6d  orch.Tensor(atom
+0001d180: 5f74 6f5f 7061 6972 290a 2020 2020 3e3e  _to_pair).    >>
+0001d190: 3e20 6174 6f6d 5f74 6f5f 7061 6972 203d  > atom_to_pair =
+0001d1a0: 2074 6f72 6368 2e73 7175 6565 7a65 2861   torch.squeeze(a
+0001d1b0: 746f 6d5f 746f 5f70 6169 722e 746f 2874  tom_to_pair.to(t
+0001d1c0: 6f72 6368 2e69 6e74 3634 292c 2064 696d  orch.int64), dim
+0001d1d0: 3d30 290a 2020 2020 3e3e 3e20 696e 7075  =0).    >>> inpu
+0001d1e0: 7473 203d 205b 7061 6972 5f66 6561 7475  ts = [pair_featu
+0001d1f0: 7265 732c 2061 746f 6d5f 6665 6174 7572  res, atom_featur
+0001d200: 6573 2c20 6174 6f6d 5f74 6f5f 7061 6972  es, atom_to_pair
+0001d210: 5d0a 2020 2020 3e3e 3e20 6e5f 7061 6972  ].    >>> n_pair
+0001d220: 5f66 6561 7475 7265 7320 3d20 320a 2020  _features = 2.  
+0001d230: 2020 3e3e 3e20 6e5f 6869 6464 656e 203d    >>> n_hidden =
+0001d240: 2032 0a20 2020 203e 3e3e 2069 6e69 7420   2.    >>> init 
+0001d250: 3d20 2778 6176 6965 725f 756e 6966 6f72  = 'xavier_unifor
+0001d260: 6d5f 270a 2020 2020 3e3e 3e20 6c61 7965  m_'.    >>> laye
+0001d270: 7220 3d20 4564 6765 4e65 7477 6f72 6b28  r = EdgeNetwork(
+0001d280: 6e5f 7061 6972 5f66 6561 7475 7265 732c  n_pair_features,
+0001d290: 206e 5f68 6964 6465 6e2c 2069 6e69 7429   n_hidden, init)
+0001d2a0: 0a20 2020 203e 3e3e 2072 6573 756c 7420  .    >>> result 
+0001d2b0: 3d20 6c61 7965 7228 696e 7075 7473 290a  = layer(inputs).
+0001d2c0: 2020 2020 3e3e 3e20 7265 7375 6c74 2e73      >>> result.s
+0001d2d0: 6861 7065 5b31 5d0a 2020 2020 320a 2020  hape[1].    2.  
+0001d2e0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+0001d2f0: 5f69 6e69 745f 5f28 7365 6c66 2c0a 2020  _init__(self,.  
+0001d300: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001d310: 5f70 6169 725f 6665 6174 7572 6573 3a20  _pair_features: 
+0001d320: 696e 7420 3d20 382c 0a20 2020 2020 2020  int = 8,.       
+0001d330: 2020 2020 2020 2020 2020 6e5f 6869 6464            n_hidd
+0001d340: 656e 3a20 696e 7420 3d20 3130 302c 0a20  en: int = 100,. 
+0001d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d360: 696e 6974 3a20 7374 7220 3d20 2778 6176  init: str = 'xav
+0001d370: 6965 725f 756e 6966 6f72 6d5f 272c 0a20  ier_uniform_',. 
+0001d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d390: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+0001d3a0: 2020 2022 2222 496e 6974 616c 6973 6573     """Initalises
+0001d3b0: 2061 2045 6467 654e 6574 776f 726b 204c   a EdgeNetwork L
+0001d3c0: 6179 6572 0a0a 2020 2020 2020 2020 5061  ayer..        Pa
+0001d3d0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+0001d3e0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+0001d3f0: 2020 2020 6e5f 7061 6972 5f66 6561 7475      n_pair_featu
+0001d400: 7265 733a 2069 6e74 2c20 6f70 7469 6f6e  res: int, option
+0001d410: 616c 0a20 2020 2020 2020 2020 2020 2054  al.            T
+0001d420: 6865 206c 656e 6774 6820 6f66 2074 6865  he length of the
+0001d430: 2070 6169 7220 6665 6174 7572 6573 2076   pair features v
+0001d440: 6563 746f 722e 0a20 2020 2020 2020 206e  ector..        n
+0001d450: 5f68 6964 6465 6e3a 2069 6e74 2c20 6f70  _hidden: int, op
+0001d460: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0001d470: 2020 206e 756d 6265 7220 6f66 2068 6964     number of hid
+0001d480: 6465 6e20 756e 6974 7320 696e 2074 6865  den units in the
+0001d490: 2070 6173 7369 6e67 2070 6861 7365 0a20   passing phase. 
+0001d4a0: 2020 2020 2020 2069 6e69 743a 2073 7472         init: str
+0001d4b0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0001d4c0: 2020 2020 2020 2049 6e69 7469 616c 697a         Initializ
+0001d4d0: 6174 696f 6e20 6675 6e63 7469 6f6e 2074  ation function t
+0001d4e0: 6f20 6265 2075 7365 6420 696e 2074 6865  o be used in the
+0001d4f0: 206d 6573 7361 6765 2070 6173 7369 6e67   message passing
+0001d500: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+0001d510: 2222 220a 0a20 2020 2020 2020 2073 7570  """..        sup
+0001d520: 6572 2845 6467 654e 6574 776f 726b 2c20  er(EdgeNetwork, 
+0001d530: 7365 6c66 292e 5f5f 696e 6974 5f5f 282a  self).__init__(*
+0001d540: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+0001d550: 2073 656c 662e 6e5f 7061 6972 5f66 6561   self.n_pair_fea
+0001d560: 7475 7265 733a 2069 6e74 203d 206e 5f70  tures: int = n_p
+0001d570: 6169 725f 6665 6174 7572 6573 0a20 2020  air_features.   
+0001d580: 2020 2020 2073 656c 662e 6e5f 6869 6464       self.n_hidd
+0001d590: 656e 3a20 696e 7420 3d20 6e5f 6869 6464  en: int = n_hidd
+0001d5a0: 656e 0a20 2020 2020 2020 2073 656c 662e  en.        self.
+0001d5b0: 696e 6974 3a20 7374 7220 3d20 696e 6974  init: str = init
+0001d5c0: 0a0a 2020 2020 2020 2020 696e 6974 5f66  ..        init_f
+0001d5d0: 756e 633a 2043 616c 6c61 626c 6520 3d20  unc: Callable = 
+0001d5e0: 6765 7461 7474 7228 696e 6974 6961 6c69  getattr(initiali
+0001d5f0: 7a65 7273 2c20 7365 6c66 2e69 6e69 7429  zers, self.init)
+0001d600: 0a20 2020 2020 2020 2073 656c 662e 573a  .        self.W:
+0001d610: 2074 6f72 6368 2e54 656e 736f 7220 3d20   torch.Tensor = 
+0001d620: 696e 6974 5f66 756e 6328 0a20 2020 2020  init_func(.     
+0001d630: 2020 2020 2020 2074 6f72 6368 2e65 6d70         torch.emp
+0001d640: 7479 285b 7365 6c66 2e6e 5f70 6169 725f  ty([self.n_pair_
+0001d650: 6665 6174 7572 6573 2c20 7365 6c66 2e6e  features, self.n
+0001d660: 5f68 6964 6465 6e20 2a20 7365 6c66 2e6e  _hidden * self.n
+0001d670: 5f68 6964 6465 6e5d 2929 0a20 2020 2020  _hidden])).     
+0001d680: 2020 2073 656c 662e 623a 2074 6f72 6368     self.b: torch
+0001d690: 2e54 656e 736f 7220 3d20 746f 7263 682e  .Tensor = torch.
+0001d6a0: 7a65 726f 7328 2873 656c 662e 6e5f 6869  zeros((self.n_hi
+0001d6b0: 6464 656e 202a 2073 656c 662e 6e5f 6869  dden * self.n_hi
+0001d6c0: 6464 656e 2c29 290a 2020 2020 2020 2020  dden,)).        
+0001d6d0: 7365 6c66 2e62 7569 6c74 3a20 626f 6f6c  self.built: bool
+0001d6e0: 203d 2054 7275 650a 0a20 2020 2064 6566   = True..    def
+0001d6f0: 205f 5f72 6570 725f 5f28 7365 6c66 2920   __repr__(self) 
+0001d700: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+0001d710: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
+0001d720: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
+0001d730: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0001d740: 286e 5f70 6169 725f 6665 6174 7572 6573  (n_pair_features
+0001d750: 3a7b 7365 6c66 2e6e 5f70 6169 725f 6665  :{self.n_pair_fe
+0001d760: 6174 7572 6573 7d2c 6e5f 6869 6464 656e  atures},n_hidden
+0001d770: 3a7b 7365 6c66 2e6e 5f68 6964 6465 6e7d  :{self.n_hidden}
+0001d780: 2c69 6e69 743a 7b73 656c 662e 696e 6974  ,init:{self.init
+0001d790: 7d29 270a 2020 2020 2020 2020 290a 0a20  })'.        ).. 
+0001d7a0: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
+0001d7b0: 656c 662c 2069 6e70 7574 733a 204c 6973  elf, inputs: Lis
+0001d7c0: 745b 746f 7263 682e 5465 6e73 6f72 5d29  t[torch.Tensor])
+0001d7d0: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
+0001d7e0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001d7f0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+0001d800: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0001d810: 2d2d 2d0a 2020 2020 2020 2020 696e 7075  ---.        inpu
+0001d820: 7473 3a20 4c69 7374 5b74 6f72 6368 2e54  ts: List[torch.T
+0001d830: 656e 736f 725d 0a20 2020 2020 2020 2020  ensor].         
+0001d840: 2020 2054 6865 206c 656e 6774 6820 6f66     The length of
+0001d850: 2061 746f 6d5f 746f 5f70 6169 7220 7368   atom_to_pair sh
+0001d860: 6f75 6c64 2062 6520 7361 6d65 2061 7320  ould be same as 
+0001d870: 6e5f 7061 6972 5f66 6561 7475 7265 732e  n_pair_features.
+0001d880: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0001d890: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0001d8a0: 0a20 2020 2020 2020 2072 6573 756c 743a  .        result:
+0001d8b0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+0001d8c0: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
+0001d8d0: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
+0001d8e0: 6d61 7070 696e 6720 6f66 2074 6865 2065  mapping of the e
+0001d8f0: 6467 6520 7665 6374 6f72 2074 6f20 6120  dge vector to a 
+0001d900: 6420 c397 2064 206d 6174 7269 782c 2077  d .. d matrix, w
+0001d910: 6865 7265 2064 2064 656e 6f74 6573 2074  here d denotes t
+0001d920: 6865 2064 696d 656e 7369 6f6e 206f 6620  he dimension of 
+0001d930: 7468 6520 696e 7465 726e 616c 2068 6964  the internal hid
+0001d940: 6465 6e20 7265 7072 6573 656e 7461 7469  den representati
+0001d950: 6f6e 206f 6620 6561 6368 206e 6f64 6520  on of each node 
+0001d960: 696e 2074 6865 2067 7261 7068 2e0a 2020  in the graph..  
+0001d970: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d980: 2020 7061 6972 5f66 6561 7475 7265 733a    pair_features:
+0001d990: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+0001d9a0: 2020 2020 2020 6174 6f6d 5f66 6561 7475        atom_featu
+0001d9b0: 7265 733a 2074 6f72 6368 2e54 656e 736f  res: torch.Tenso
+0001d9c0: 720a 2020 2020 2020 2020 6174 6f6d 5f74  r.        atom_t
+0001d9d0: 6f5f 7061 6972 3a20 746f 7263 682e 5465  o_pair: torch.Te
+0001d9e0: 6e73 6f72 0a20 2020 2020 2020 2070 6169  nsor.        pai
+0001d9f0: 725f 6665 6174 7572 6573 2c20 6174 6f6d  r_features, atom
+0001da00: 5f66 6561 7475 7265 732c 2061 746f 6d5f  _features, atom_
+0001da10: 746f 5f70 6169 7220 3d20 696e 7075 7473  to_pair = inputs
+0001da20: 0a0a 2020 2020 2020 2020 413a 2074 6f72  ..        A: tor
+0001da30: 6368 2e54 656e 736f 7220 3d20 746f 7263  ch.Tensor = torc
+0001da40: 682e 6164 6428 746f 7263 682e 6d61 746d  h.add(torch.matm
+0001da50: 756c 2870 6169 725f 6665 6174 7572 6573  ul(pair_features
+0001da60: 2c20 7365 6c66 2e57 292c 2073 656c 662e  , self.W), self.
+0001da70: 6229 0a20 2020 2020 2020 2041 203d 2074  b).        A = t
+0001da80: 6f72 6368 2e72 6573 6861 7065 2841 2c20  orch.reshape(A, 
+0001da90: 282d 312c 2073 656c 662e 6e5f 6869 6464  (-1, self.n_hidd
+0001daa0: 656e 2c20 7365 6c66 2e6e 5f68 6964 6465  en, self.n_hidde
+0001dab0: 6e29 290a 2020 2020 2020 2020 6f75 743a  n)).        out:
+0001dac0: 2074 6f72 6368 2e54 656e 736f 7220 3d20   torch.Tensor = 
+0001dad0: 746f 7263 682e 756e 7371 7565 657a 6528  torch.unsqueeze(
+0001dae0: 6174 6f6d 5f66 6561 7475 7265 735b 6174  atom_features[at
+0001daf0: 6f6d 5f74 6f5f 7061 6972 5b3a 2c20 315d  om_to_pair[:, 1]
+0001db00: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0001db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db20: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001db30: 696d 3d32 290a 2020 2020 2020 2020 6f75  im=2).        ou
+0001db40: 745f 7371 7565 657a 653a 2074 6f72 6368  t_squeeze: torch
+0001db50: 2e54 656e 736f 7220 3d20 746f 7263 682e  .Tensor = torch.
+0001db60: 7371 7565 657a 6528 746f 7263 682e 6d61  squeeze(torch.ma
+0001db70: 746d 756c 2841 2c20 6f75 7429 2c20 6469  tmul(A, out), di
+0001db80: 6d3d 3229 0a20 2020 2020 2020 2069 6e64  m=2).        ind
+0001db90: 3a20 746f 7263 682e 5465 6e73 6f72 203d  : torch.Tensor =
+0001dba0: 2061 746f 6d5f 746f 5f70 6169 725b 3a2c   atom_to_pair[:,
+0001dbb0: 2030 5d0a 0a20 2020 2020 2020 2072 6573   0]..        res
+0001dbc0: 756c 743a 2074 6f72 6368 2e54 656e 736f  ult: torch.Tenso
+0001dbd0: 7220 3d20 7365 676d 656e 745f 7375 6d28  r = segment_sum(
+0001dbe0: 6f75 745f 7371 7565 657a 652c 2069 6e64  out_squeeze, ind
+0001dbf0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0001dc00: 6e20 7265 7375 6c74 0a                   n result.
```

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/lcnn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/lcnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/mat.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/mat.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/megnet.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/megnet.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/modular.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/modular.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/mpnn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/mpnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/normalizing_flows_pytorch.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/normalizing_flows_pytorch.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/pagtn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/pagtn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/pna_gnn.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/pna_gnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/readout.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/readout.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/torch_models/torch_model.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/torch_models/torch_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/models/wandblogger.py` & `deepchem-2.7.2.dev20230626172011/deepchem/models/wandblogger.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/check_availability.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/check_availability.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/defaults.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/defaults.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/dnasim.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/dnasim.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/bace_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/bace_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/bace_features.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/bace_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/bbbc_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/bbbc_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/bbbp_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/bbbp_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/cell_counting_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/cell_counting_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/chembl25_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/chembl25_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/chembl_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/chembl_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/chembl_tasks.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/chembl_tasks.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/clearance_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/clearance_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/clintox_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/clintox_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/delaney_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/delaney_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/factors_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/factors_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/freesolv_dataset.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/freesolv_dataset.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/hiv_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/hiv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/hopv_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/hopv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/hppb_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/hppb_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/kaggle_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/kaggle_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/kaggle_features.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/kaggle_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/kinase_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/kinase_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/lipo_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/lipo_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/load_dataset_template.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/load_dataset_template.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_bandgap.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_bandgap.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/material_datasets/load_perovskite.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/material_datasets/load_perovskite.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/molnet_loader.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/molnet_loader.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/muv_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/muv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/nci_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/nci_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/pcba_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/pcba_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/pdbbind_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/pdbbind_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/ppb_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/ppb_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/qm7_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/qm7_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/qm8_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/qm8_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/qm9_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/qm9_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/sampl_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/sampl_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/sider_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/sider_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/sweetlead_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/sweetlead_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/thermosol_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/thermosol_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/tox21_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/tox21_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/toxcast_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/toxcast_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/uspto_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/uspto_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/uv_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/uv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/uv_tasks.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/uv_tasks.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/load_function/zinc15_datasets.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/load_function/zinc15_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/preset_hyper_parameters.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/preset_hyper_parameters.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/run_benchmark.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/run_benchmark.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/run_benchmark_low_data.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/run_benchmark_low_data.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/molnet/run_benchmark_models.py` & `deepchem-2.7.2.dev20230626172011/deepchem/molnet/run_benchmark_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/rl/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/rl/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/rl/a2c.py` & `deepchem-2.7.2.dev20230626172011/deepchem/rl/a2c.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/rl/envs/test_tictactoe.py` & `deepchem-2.7.2.dev20230626172011/deepchem/rl/envs/test_tictactoe.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/rl/envs/tictactoe.py` & `deepchem-2.7.2.dev20230626172011/deepchem/rl/envs/tictactoe.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/rl/ppo.py` & `deepchem-2.7.2.dev20230626172011/deepchem/rl/ppo.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/splits/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/splits/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/splits/splitters.py` & `deepchem-2.7.2.dev20230626172011/deepchem/splits/splitters.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/splits/task_splitter.py` & `deepchem-2.7.2.dev20230626172011/deepchem/splits/task_splitter.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/trans/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/trans/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/trans/duplicate.py` & `deepchem-2.7.2.dev20230626172011/deepchem/trans/duplicate.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/trans/transformers.py` & `deepchem-2.7.2.dev20230626172011/deepchem/trans/transformers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/__init__.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/conformers.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/conformers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/coordinate_box_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/coordinate_box_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/data_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/data_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/debug_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/debug_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/dftutils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/dftutils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/docking_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/docking_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/electron_sampler.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/electron_sampler.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/evaluate.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/evaluate.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/fake_data_generator.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/fake_data_generator.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/fragment_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/fragment_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/genomics_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/genomics_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/geometry_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/geometry_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/graph_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/graph_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/grover.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/grover.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/hash_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/hash_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/molecule_feature_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/molecule_feature_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/noncovalent_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/noncovalent_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/pdbqt_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/pdbqt_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/pytorch_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/pytorch_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/rdkit_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/rdkit_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/save.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/save.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/sequence_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/sequence_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_coordinate_box_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_coordinate_box_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_data_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_data_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_dftutils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_dftutils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_docking_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_docking_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_electron_sampler.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_electron_sampler.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_evaluate.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_evaluate.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_fake_data_generator.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_fake_data_generator.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_fragment_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_fragment_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_generator_evaluator.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_generator_evaluator.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_genomics_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_genomics_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_geometry_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_geometry_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_graph_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_graph_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_grover.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_grover.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_hash_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_hash_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_molecule_feature_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_molecule_feature_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_noncovalent_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_noncovalent_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_pdbqt_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_pdbqt_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_pytorch_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_pytorch_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_rdkit_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_rdkit_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_sequence_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_sequence_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/test/test_voxel_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/test/test_voxel_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/typing.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/typing.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/vina_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/vina_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem/utils/voxel_utils.py` & `deepchem-2.7.2.dev20230626172011/deepchem/utils/voxel_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem.egg-info/PKG-INFO` & `deepchem-2.7.2.dev20230626172011/deepchem.egg-info/PKG-INFO`

 * *Files 8% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: deepchem
-Version: 2.7.2.dev20230622192421
+Version: 2.7.2.dev20230626172011
 Summary: Deep learning models for drug discovery,         quantum chemistry, and the life sciences.
 Home-page: https://github.com/deepchem/deepchem
 Maintainer: DeepChem contributors
 License: MIT
 Project-URL: Documentation, https://deepchem.readthedocs.io/en/latest/
 Project-URL: Source, https://github.com/deepchem/deepchem
 Keywords: deepchem,chemistry,biology,materials-science,life-science,drug-discovery
```

### Comparing `deepchem-2.7.2.dev20230622192421/deepchem.egg-info/SOURCES.txt` & `deepchem-2.7.2.dev20230626172011/deepchem.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/setup.cfg` & `deepchem-2.7.2.dev20230626172011/setup.cfg`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230622192421/setup.py` & `deepchem-2.7.2.dev20230626172011/setup.py`

 * *Files identical despite different names*

