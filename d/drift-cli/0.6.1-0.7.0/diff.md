# Comparing `tmp/drift_cli-0.6.1-py3-none-any.whl.zip` & `tmp/drift_cli-0.7.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,20 +1,20 @@
-Zip file size: 23345 bytes, number of entries: 18
--rw-r--r--  2.0 unx      192 b- defN 23-Jun-19 09:37 drift_cli/__init__.py
--rw-r--r--  2.0 unx       84 b- defN 23-Jun-19 09:37 drift_cli/__main__.py
--rw-r--r--  2.0 unx     2344 b- defN 23-Jun-19 09:37 drift_cli/alias.py
--rw-r--r--  2.0 unx     1216 b- defN 23-Jun-19 09:37 drift_cli/cli.py
--rw-r--r--  2.0 unx      829 b- defN 23-Jun-19 09:37 drift_cli/config.py
--rw-r--r--  2.0 unx     2716 b- defN 23-Jun-19 09:37 drift_cli/export.py
--rw-r--r--  2.0 unx     7359 b- defN 23-Jun-19 09:37 drift_cli/export_impl/raw.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-19 09:37 drift_cli/utils/__init__.py
--rw-r--r--  2.0 unx      129 b- defN 23-Jun-19 09:37 drift_cli/utils/consoles.py
--rw-r--r--  2.0 unx      513 b- defN 23-Jun-19 09:37 drift_cli/utils/error.py
--rw-r--r--  2.0 unx     4726 b- defN 23-Jun-19 09:37 drift_cli/utils/helpers.py
--rw-r--r--  2.0 unx     2280 b- defN 23-Jun-19 09:37 drift_cli/utils/humanize.py
--rw-r--r--  2.0 unx    16725 b- defN 23-Jun-19 09:37 drift_cli-0.6.1.dist-info/LICENSE
--rw-r--r--  2.0 unx    22526 b- defN 23-Jun-19 09:37 drift_cli-0.6.1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-19 09:37 drift_cli-0.6.1.dist-info/WHEEL
--rw-r--r--  2.0 unx       45 b- defN 23-Jun-19 09:37 drift_cli-0.6.1.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       10 b- defN 23-Jun-19 09:37 drift_cli-0.6.1.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1443 b- defN 23-Jun-19 09:37 drift_cli-0.6.1.dist-info/RECORD
-18 files, 63229 bytes uncompressed, 20987 bytes compressed:  66.8%
+Zip file size: 23656 bytes, number of entries: 18
+-rw-r--r--  2.0 unx      192 b- defN 23-Jun-26 15:04 drift_cli/__init__.py
+-rw-r--r--  2.0 unx       84 b- defN 23-Jun-26 15:04 drift_cli/__main__.py
+-rw-r--r--  2.0 unx     2344 b- defN 23-Jun-26 15:04 drift_cli/alias.py
+-rw-r--r--  2.0 unx     1216 b- defN 23-Jun-26 15:04 drift_cli/cli.py
+-rw-r--r--  2.0 unx      829 b- defN 23-Jun-26 15:04 drift_cli/config.py
+-rw-r--r--  2.0 unx     2912 b- defN 23-Jun-26 15:04 drift_cli/export.py
+-rw-r--r--  2.0 unx     8237 b- defN 23-Jun-26 15:04 drift_cli/export_impl/raw.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-26 15:04 drift_cli/utils/__init__.py
+-rw-r--r--  2.0 unx      129 b- defN 23-Jun-26 15:04 drift_cli/utils/consoles.py
+-rw-r--r--  2.0 unx      513 b- defN 23-Jun-26 15:04 drift_cli/utils/error.py
+-rw-r--r--  2.0 unx     4839 b- defN 23-Jun-26 15:04 drift_cli/utils/helpers.py
+-rw-r--r--  2.0 unx     2280 b- defN 23-Jun-26 15:04 drift_cli/utils/humanize.py
+-rw-r--r--  2.0 unx    16725 b- defN 23-Jun-26 15:04 drift_cli-0.7.0.dist-info/LICENSE
+-rw-r--r--  2.0 unx    22526 b- defN 23-Jun-26 15:04 drift_cli-0.7.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-26 15:04 drift_cli-0.7.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       45 b- defN 23-Jun-26 15:04 drift_cli-0.7.0.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       10 b- defN 23-Jun-26 15:04 drift_cli-0.7.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1443 b- defN 23-Jun-26 15:04 drift_cli-0.7.0.dist-info/RECORD
+18 files, 64416 bytes uncompressed, 21298 bytes compressed:  66.9%
```

## zipnote {}

```diff
@@ -30,26 +30,26 @@
 
 Filename: drift_cli/utils/helpers.py
 Comment: 
 
 Filename: drift_cli/utils/humanize.py
 Comment: 
 
-Filename: drift_cli-0.6.1.dist-info/LICENSE
+Filename: drift_cli-0.7.0.dist-info/LICENSE
 Comment: 
 
-Filename: drift_cli-0.6.1.dist-info/METADATA
+Filename: drift_cli-0.7.0.dist-info/METADATA
 Comment: 
 
-Filename: drift_cli-0.6.1.dist-info/WHEEL
+Filename: drift_cli-0.7.0.dist-info/WHEEL
 Comment: 
 
-Filename: drift_cli-0.6.1.dist-info/entry_points.txt
+Filename: drift_cli-0.7.0.dist-info/entry_points.txt
 Comment: 
 
-Filename: drift_cli-0.6.1.dist-info/top_level.txt
+Filename: drift_cli-0.7.0.dist-info/top_level.txt
 Comment: 
 
-Filename: drift_cli-0.6.1.dist-info/RECORD
+Filename: drift_cli-0.7.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## drift_cli/export.py

```diff
@@ -52,24 +52,30 @@
 )
 @click.option(
     "--jpeg",
     help="Export data as JPEG instead of raw data (only for images)",
     default=False,
     is_flag=True,
 )
+@click.option(
+    "--with-metadata/--no-with-metadata",
+    help="Export metadata along with the data",
+    default=False,
+)
 @click.pass_context
 def raw(
     ctx,
     src: str,
     dest: str,
     start: str,
     stop: str,
     topics: str,
     csv: bool,
     jpeg: bool,
+    with_metadata: bool,
 ):  # pylint: disable=too-many-arguments
     """Export data from SRC bucket to DST folder
 
     SRC should be in the format of ALIAS/BUCKET_NAME.
     DST should be a path to a folder.
 
     As result, the folder will contain a folder for each entry in the bucket.
@@ -99,9 +105,10 @@
                 dest,
                 parallel=ctx.obj["parallel"],
                 topics=topics.split(","),
                 start=start,
                 stop=stop,
                 csv=csv,
                 jpeg=jpeg,
+                with_metadata=with_metadata,
             )
         )
```

## drift_cli/export_impl/raw.py

```diff
@@ -1,24 +1,39 @@
 """Export data"""
 import asyncio
-from concurrent.futures import ThreadPoolExecutor, Executor, ProcessPoolExecutor
+import json
+from concurrent.futures import ThreadPoolExecutor, Executor
 from pathlib import Path
-from typing import Optional, List, Tuple
+from typing import List, Tuple
 
 import numpy as np
-from drift_client import DriftClient
+from drift_client import DriftClient, DriftDataPackage
 from drift_protocol.common import StatusCode
 from drift_protocol.meta import MetaInfo
+from google.protobuf.json_format import MessageToDict
 from rich.progress import Progress
 from wavelet_buffer import WaveletBuffer
-from wavelet_buffer.img import codecs, RgbJpeg, HslJpeg, GrayJpeg
+from wavelet_buffer.img import RgbJpeg, HslJpeg, GrayJpeg
 
 from drift_cli.utils.helpers import read_topic, filter_topics
 
 
+def _export_metadata_to_json(path: Path, pkg: DriftDataPackage):
+    with open(f"{path}/{pkg.package_id}.json", "w") as f:
+        meta = {
+            "id": pkg.package_id,
+            "status": pkg.status_code,
+            "published_time": pkg.publish_timestamp,
+            "source_timestamp": pkg.source_timestamp,
+        }
+        meta.update(MessageToDict(pkg.meta, preserving_proto_field_name=True))
+
+        json.dump(meta, f, indent=2, sort_keys=False)
+
+
 def _tokenize(mask: str) -> List[Tuple[str, int]]:
     """turn a channel mask into a list of tokens,
     each with the type as a string, and the absolute channel offset into the buffer
     """
     types = ["RGB", "HSL", "G"]
     tokens = []
     count = 0
@@ -76,14 +91,17 @@
     **kwargs,
 ):
     async for package, task in read_topic(pool, client, topic, progress, sem, **kwargs):
         Path.mkdir(Path(dest) / topic, exist_ok=True, parents=True)
         with open(Path(dest) / topic / f"{package.package_id}.dp", "wb") as file:
             file.write(package.blob)
 
+        if kwargs.get("with_metadata", False):
+            _export_metadata_to_json(Path(dest) / topic, package)
+
 
 async def _export_jpeg(
     pool: Executor,
     client: DriftClient,
     topic: str,
     dest: str,
     progress: Progress,
@@ -118,61 +136,62 @@
                 f"{package.package_id}_{i}.jpeg"
                 if len(images) > 1
                 else f"{package.package_id}.jpeg"
             )
             with open(Path(dest) / topic / name, "wb") as file:
                 file.write(img)
 
+        if kwargs.get("with_metadata", False):
+            _export_metadata_to_json(Path(dest) / topic, package)
+
 
 async def _export_csv(
     pool: Executor,
     client: DriftClient,
-    curren_topic: str,
+    topic: str,
     dest: str,
     progress: Progress,
     sem,
     **kwargs,
 ):
     Path.mkdir(Path(dest), exist_ok=True, parents=True)
 
-    filename = Path(dest) / f"{curren_topic}.csv"
+    filename = Path(dest) / f"{topic}.csv"
     started = False
     first_timestamp = 0
     last_timestamp = 0
     count = 0
-    async for package, task in read_topic(
-        pool, client, curren_topic, progress, sem, **kwargs
-    ):
+    async for package, task in read_topic(pool, client, topic, progress, sem, **kwargs):
         meta = package.meta
         if meta.type != MetaInfo.TIME_SERIES:
             progress.update(
                 task,
-                description=f"[SKIPPED] Topic {curren_topic} is not a time series",
+                description=f"[SKIPPED] Topic {topic} is not a time series",
                 completed=True,
             )
             break
 
         if not started:
-            with open(Path(dest) / f"{curren_topic}.csv", "w") as file:
+            with open(Path(dest) / f"{topic}.csv", "w") as file:
                 file.write(" " * 256 + "\n")
             started = True
             first_timestamp = meta.time_series_info.start_timestamp.ToMilliseconds()
         else:
             if last_timestamp != meta.time_series_info.start_timestamp.ToMilliseconds():
                 progress.update(
                     task,
-                    description=f"[ERROR] Topic {curren_topic} has gaps",
+                    description=f"[ERROR] Topic {topic} has gaps",
                     completed=True,
                 )
                 break
 
         if package.status_code != 0:
             progress.update(
                 task,
-                description=f"[ERROR] Topic {curren_topic} has a bad package",
+                description=f"[ERROR] Topic {topic} has a bad package",
                 completed=True,
             )
             break
 
         last_timestamp = package.meta.time_series_info.stop_timestamp.ToMilliseconds()
         with open(filename, "a") as file:
             np.savetxt(file, package.as_np(), delimiter=",", fmt="%.5f")
@@ -181,15 +200,15 @@
 
     if started:
         with open(filename, "r+") as file:
             file.seek(0)
             file.write(
                 ",".join(
                     [
-                        curren_topic,
+                        topic,
                         str(count),
                         str(first_timestamp),
                         str(last_timestamp),
                     ]
                 )
             )
 
@@ -200,23 +219,26 @@
         client: Drift client
         dest: Path to a folder
         parallel: Number of parallel tasks
     KArgs:
         start: Export records with timestamps newer than this time point in ISO format
         stop: Export records  with timestamps older than this time point in ISO format
         csv: Export data as CSV instead of raw data
-        topics: Export only 5
-        hese topics, separated by comma. You can use * as a wildcard
+        topics: Export only these topics, separated by comma. You can use * as a wildcard
+        with_meta: Export meta information in JSON format
     """
     sem = asyncio.Semaphore(parallel)
     with Progress() as progress:
         with ThreadPoolExecutor(max_workers=8) as pool:
             topics = filter_topics(client.get_topics(), kwargs.pop("topics", ""))
-            task = _export_csv if kwargs.pop("csv", False) else _export_topic
-            task = _export_jpeg if kwargs.pop("jpeg", False) else task
+            task = _export_csv if kwargs.get("csv", False) else _export_topic
+            task = _export_jpeg if kwargs.get("jpeg", False) else task
+
+            if kwargs.get("with_metadata", False) and kwargs.get("csv", False):
+                RuntimeError("Metadata export is not supported for CSV files")
 
             tasks = [
                 task(
                     pool,
                     client,
                     topic,
                     dest,
```

## drift_cli/utils/helpers.py

```diff
@@ -6,14 +6,15 @@
 from concurrent.futures import Executor
 from datetime import datetime
 from pathlib import Path
 from typing import Tuple, List
 
 from click import Abort
 from drift_client import DriftClient
+from drift_client.error import DriftClientError
 from rich.progress import Progress
 
 from drift_cli.config import read_config, Alias
 from drift_cli.utils.consoles import error_console
 from drift_cli.utils.humanize import pretty_size
 
 signal_queue = Queue()
@@ -99,14 +100,16 @@
         it = client.walk(topic, start=start, stop=stop)
 
         def _next():
             try:
                 return next(it)
             except StopIteration:
                 return None
+            except DriftClientError:
+                return None
 
         while True:
             drift_pkg = await loop.run_in_executor(pool, _next)
             if drift_pkg is None:
                 break
 
             if signal_queue.qsize() > 0:
```

## Comparing `drift_cli-0.6.1.dist-info/LICENSE` & `drift_cli-0.7.0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `drift_cli-0.6.1.dist-info/METADATA` & `drift_cli-0.7.0.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: drift-cli
-Version: 0.6.1
+Version: 0.7.0
 Summary: CLI client for PANDA | Drift Platform
 Author-email: Alexey Timin <atimin@gmail.com>
 Maintainer-email: Alexey Timin <atimin@gmail.com>
 License: Mozilla Public License Version 2.0
         ==================================
         
         1. Definitions
```

## Comparing `drift_cli-0.6.1.dist-info/RECORD` & `drift_cli-0.7.0.dist-info/RECORD`

 * *Files 22% similar despite different names*

```diff
@@ -1,18 +1,18 @@
 drift_cli/__init__.py,sha256=MPmEBVk4DyzXZDDmX7RXQ3WuW2xWbWwDmBLrKiBTVpY,192
 drift_cli/__main__.py,sha256=rjYpWjmdMA8fjVVCgF10yH0Zl2M0pronHDKEMF7qRio,84
 drift_cli/alias.py,sha256=IJO8XHfZ-S3-OZWP2RXKX2O818zLN_s2mlDvmunZ5Gs,2344
 drift_cli/cli.py,sha256=Ewop3LAZIFkWSQTHSUCXrLFJD_WuXqG5RT9B4P0zJ34,1216
 drift_cli/config.py,sha256=Pf7TSos607g8k0OwovJcHH3xNsRMkZK4Dk0wFzuX30g,829
-drift_cli/export.py,sha256=REXTlBykIlmJEWz1vIofsi4fnH_IPNrXu1gokfQ-x0g,2716
-drift_cli/export_impl/raw.py,sha256=oB5O20g8o8iUafQ1VLdcquTgUlr_PEhsQeXkpf4p-NM,7359
+drift_cli/export.py,sha256=QLoBKGYkRkcTfH8XSF__hZSuNQ7MnJRIhyIfO65Itj4,2912
+drift_cli/export_impl/raw.py,sha256=E47r_Lk5dTC4P2cnDK-V4vhGQP5m46VLqUu1UXMBBwo,8237
 drift_cli/utils/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 drift_cli/utils/consoles.py,sha256=0Lywaaz1433HiwE1DK2q3rnTh5rYzQw5uht0IErH8TI,129
 drift_cli/utils/error.py,sha256=3W_8vy-7WtJAyddqpU7F8ZeNdhLMfjKy9FxjQ0YtJcU,513
-drift_cli/utils/helpers.py,sha256=IdjtudbkfBDfF1wjTJXnrunCqhJjRPPokeKS2G4aL4w,4726
+drift_cli/utils/helpers.py,sha256=ZL8bRF-x6bT27QxqYMeBR6O94IO0yIZJO-EbYYEOc3E,4839
 drift_cli/utils/humanize.py,sha256=zNv87Roru0c0bb-3H5ElcjmDECJm5S3EUmxOv9uGcMM,2280
-drift_cli-0.6.1.dist-info/LICENSE,sha256=HyVuytGSiAUQ6ErWBHTqt1iSGHhLmlC8fO7jTCuR8dU,16725
-drift_cli-0.6.1.dist-info/METADATA,sha256=QvWidHBdHC_i7PKJq_g0g_CrP8g8PkdvW6N8tuXtCf0,22526
-drift_cli-0.6.1.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-drift_cli-0.6.1.dist-info/entry_points.txt,sha256=a-s7P_Qs_-8nC4SSsNVYRIt89eC0UJ1kbKwfzegg0Nc,45
-drift_cli-0.6.1.dist-info/top_level.txt,sha256=TKpQc8YX_9mP5LHboxJvCYI4BBg80wMmjWoxkcr77tk,10
-drift_cli-0.6.1.dist-info/RECORD,,
+drift_cli-0.7.0.dist-info/LICENSE,sha256=HyVuytGSiAUQ6ErWBHTqt1iSGHhLmlC8fO7jTCuR8dU,16725
+drift_cli-0.7.0.dist-info/METADATA,sha256=ieATpTacsDo-aiC6SaFDAyVdqHHOCUuaXmQH7RmyY58,22526
+drift_cli-0.7.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+drift_cli-0.7.0.dist-info/entry_points.txt,sha256=a-s7P_Qs_-8nC4SSsNVYRIt89eC0UJ1kbKwfzegg0Nc,45
+drift_cli-0.7.0.dist-info/top_level.txt,sha256=TKpQc8YX_9mP5LHboxJvCYI4BBg80wMmjWoxkcr77tk,10
+drift_cli-0.7.0.dist-info/RECORD,,
```

